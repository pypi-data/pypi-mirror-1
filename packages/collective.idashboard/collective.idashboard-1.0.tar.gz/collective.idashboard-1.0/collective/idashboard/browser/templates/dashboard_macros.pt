<metal:macro define-macro="portlet-edit">
    <li tal:define="hash request/portlethash;
                     html python:request.get('portlethtml-%s' % hash);"
        tal:attributes="id string:portleteditwrapper-${hash};
                         hash hash;">

        <div tal:attributes="id string:portletbody-${hash};">
            <tal:body replace="structure html" />
        </div>
    </li>
</metal:macro>

<metal:macro define-macro="current-portlets-list">
    <ul class="portlets-manager column"
         tal:attributes="id view/manager_name;">

    <tal:block repeat="portlet options/portlets">
    <li class="draggable dp-portlet" 
         tal:define=" hash portlet/hash;"
         tal:attributes="id string:portletwrapper-${hash};
                         hash hash;">

        <div class="portlet-controls"  
              tal:attributes="id string:portlet-controls-${hash}" style="display:None">
            <img style="cursor:pointer"
                class="toggle-dashboard-portlet"
                width="15"
                height="15"
                tal:attributes="onclick string:togglePortlet(this);"
                src="arrowDown.gif"/>
            <br/>
        </div>

        <div tal:attributes="id string:portletbody-${hash};">
            <tal:body replace="structure python:view.safe_render(portlet['renderer'])" />
        </div>
    </li>
    </tal:block>
    </ul>
</metal:macro>

<metal:macro define-macro="current-editable-portlets-list">
    <ul class="portlets-manager column"
        tal:attributes="id view/manager_name;
                        class string:kssattr-manager-${view/manager_name} 
                                     portlets-manager droppable column"> 

    <tal:block repeat="portlet options/portlets">
    <metal:macro define-macro="portlet-manage-view">
    <li class="draggable dp-portlet" 
         tal:define="
            hash portlet/hash|request/portlethash;
            phtml python:request.form.get('portlethtml-%s' % hash);
            html python: phtml or view.safe_render(portlet['renderer']);
            editable portlet/editview|python:phtml and True or False"
         tal:attributes="id string:portletwrapper-${hash};
                         hash hash;">

        <div class="portlet-controls"  
              tal:attributes="id string:portlet-controls-${hash}" style="display:None">
            <img style="cursor:pointer"
                class="toggle-dashboard-portlet"
                width="15"
                height="15"
                tal:attributes="onclick string:togglePortlet(this);"
                src="arrowDown.gif"/>

            <img class="remove-dashboard-portlet"
                 tal:attributes="onclick string:removePortlet(this);"
                 src="delete_icon.gif"/>

            <img tal:condition="editable"   
                class="edit-dashboard-portlet"
                tal:attributes="onclick string:configurePortlet(this);"
                src="maintenance_icon.gif"/>
            <br/>
        </div>
        <div class="dp-portletbody"
            tal:attributes="id string:portletbody-${hash};">
            <tal:body replace="structure html" />
        </div>
    </li>
    </metal:macro>
    </tal:block>
    </ul>
</metal:macro>
