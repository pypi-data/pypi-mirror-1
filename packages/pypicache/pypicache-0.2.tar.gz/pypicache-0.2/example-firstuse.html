<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.5: http://docutils.sourceforge.net/" />
<title>Building a pypi package index with pypicache-0.2</title>
<style type="text/css">

/*
:Author: David Goodger
:Contact: goodger@python.org
:Date: $Date: 2006-05-21 22:44:42 +0200 (Sun, 21 May 2006) $
:Revision: $Revision: 4564 $
:Copyright: This stylesheet has been placed in the public domain.

Default cascading style sheet for the HTML output of Docutils.

See http://docutils.sf.net/docs/howto/html-stylesheets.html for how to
customize this style sheet.
*/

/* used to remove borders from tables and images */
.borderless, table.borderless td, table.borderless th {
  border: 0 }

table.borderless td, table.borderless th {
  /* Override padding for "table.docutils td" with "! important".
     The right padding separates the table cells. */
  padding: 0 0.5em 0 0 ! important }

.first {
  /* Override more specific margin styles with "! important". */
  margin-top: 0 ! important }

.last, .with-subtitle {
  margin-bottom: 0 ! important }

.hidden {
  display: none }

a.toc-backref {
  text-decoration: none ;
  color: black }

blockquote.epigraph {
  margin: 2em 5em ; }

dl.docutils dd {
  margin-bottom: 0.5em }

/* Uncomment (and remove this text!) to get bold-faced definition list terms
dl.docutils dt {
  font-weight: bold }
*/

div.abstract {
  margin: 2em 5em }

div.abstract p.topic-title {
  font-weight: bold ;
  text-align: center }

div.admonition, div.attention, div.caution, div.danger, div.error,
div.hint, div.important, div.note, div.tip, div.warning {
  margin: 2em ;
  border: medium outset ;
  padding: 1em }

div.admonition p.admonition-title, div.hint p.admonition-title,
div.important p.admonition-title, div.note p.admonition-title,
div.tip p.admonition-title {
  font-weight: bold ;
  font-family: sans-serif }

div.attention p.admonition-title, div.caution p.admonition-title,
div.danger p.admonition-title, div.error p.admonition-title,
div.warning p.admonition-title {
  color: red ;
  font-weight: bold ;
  font-family: sans-serif }

/* Uncomment (and remove this text!) to get reduced vertical space in
   compound paragraphs.
div.compound .compound-first, div.compound .compound-middle {
  margin-bottom: 0.5em }

div.compound .compound-last, div.compound .compound-middle {
  margin-top: 0.5em }
*/

div.dedication {
  margin: 2em 5em ;
  text-align: center ;
  font-style: italic }

div.dedication p.topic-title {
  font-weight: bold ;
  font-style: normal }

div.figure {
  margin-left: 2em ;
  margin-right: 2em }

div.footer, div.header {
  clear: both;
  font-size: smaller }

div.line-block {
  display: block ;
  margin-top: 1em ;
  margin-bottom: 1em }

div.line-block div.line-block {
  margin-top: 0 ;
  margin-bottom: 0 ;
  margin-left: 1.5em }

div.sidebar {
  margin-left: 1em ;
  border: medium outset ;
  padding: 1em ;
  background-color: #ffffee ;
  width: 40% ;
  float: right ;
  clear: right }

div.sidebar p.rubric {
  font-family: sans-serif ;
  font-size: medium }

div.system-messages {
  margin: 5em }

div.system-messages h1 {
  color: red }

div.system-message {
  border: medium outset ;
  padding: 1em }

div.system-message p.system-message-title {
  color: red ;
  font-weight: bold }

div.topic {
  margin: 2em }

h1.section-subtitle, h2.section-subtitle, h3.section-subtitle,
h4.section-subtitle, h5.section-subtitle, h6.section-subtitle {
  margin-top: 0.4em }

h1.title {
  text-align: center }

h2.subtitle {
  text-align: center }

hr.docutils {
  width: 75% }

img.align-left {
  clear: left }

img.align-right {
  clear: right }

ol.simple, ul.simple {
  margin-bottom: 1em }

ol.arabic {
  list-style: decimal }

ol.loweralpha {
  list-style: lower-alpha }

ol.upperalpha {
  list-style: upper-alpha }

ol.lowerroman {
  list-style: lower-roman }

ol.upperroman {
  list-style: upper-roman }

p.attribution {
  text-align: right ;
  margin-left: 50% }

p.caption {
  font-style: italic }

p.credits {
  font-style: italic ;
  font-size: smaller }

p.label {
  white-space: nowrap }

p.rubric {
  font-weight: bold ;
  font-size: larger ;
  color: maroon ;
  text-align: center }

p.sidebar-title {
  font-family: sans-serif ;
  font-weight: bold ;
  font-size: larger }

p.sidebar-subtitle {
  font-family: sans-serif ;
  font-weight: bold }

p.topic-title {
  font-weight: bold }

pre.address {
  margin-bottom: 0 ;
  margin-top: 0 ;
  font-family: serif ;
  font-size: 100% }

pre.literal-block, pre.doctest-block {
  margin-left: 2em ;
  margin-right: 2em }

span.classifier {
  font-family: sans-serif ;
  font-style: oblique }

span.classifier-delimiter {
  font-family: sans-serif ;
  font-weight: bold }

span.interpreted {
  font-family: sans-serif }

span.option {
  white-space: nowrap }

span.pre {
  white-space: pre }

span.problematic {
  color: red }

span.section-subtitle {
  /* font-size relative to parent (h1..h6 element) */
  font-size: 80% }

table.citation {
  border-left: solid 1px gray;
  margin-left: 1px }

table.docinfo {
  margin: 2em 4em }

table.docutils {
  margin-top: 0.5em ;
  margin-bottom: 0.5em }

table.footnote {
  border-left: solid 1px black;
  margin-left: 1px }

table.docutils td, table.docutils th,
table.docinfo td, table.docinfo th {
  padding-left: 0.5em ;
  padding-right: 0.5em ;
  vertical-align: top }

table.docutils th.field-name, table.docinfo th.docinfo-name {
  font-weight: bold ;
  text-align: left ;
  white-space: nowrap ;
  padding-left: 0 }

h1 tt.docutils, h2 tt.docutils, h3 tt.docutils,
h4 tt.docutils, h5 tt.docutils, h6 tt.docutils {
  font-size: 100% }

ul.auto-toc {
  list-style-type: none }

</style>
</head>
<body>
<div class="document" id="building-a-pypi-package-index-with-pypicache-0-2">
<h1 class="title">Building a pypi package index with pypicache-0.2</h1>

<p>An index that was built following this example is currently hosted
<a class="reference" href="http://svn.wiretooth.com/pypi/">here</a>.</p>
<p>Copy the pypicache sources and some .egg files up to the server that will host
your index. If you dont think setuptools is available on the server then
simply include a setuptools .egg in the .eggs you place in the index
directory.:</p>
<pre class="literal-block">
scp pypicache-0.2.tar.gz setuptools-0.6c3-py2.4.egg *.egg user&#64;aldis:/srv/pypi-cached/
ssh -l user&#64;aldis
cd /srv/pypi-cached
tar -zxf pypicache-0.2.tar.gz
</pre>
<p>Do a dry run to see what files will be generated and to test the installation:</p>
<pre class="literal-block">
user&#64;aldis:/srv/pypi-cached# python pypicache-0.2/indexpackages.py --enable-htaccess -T &quot;cheesboard.wiretooth.com&quot; -U http://svn.wiretooth.com/pypi/ -N .
</pre>
<p>You will see output that starts something like this:</p>
<pre class="literal-block">
downloads-server-url: &quot;http://svn.wiretooth.com/&quot;
downloads-path: &quot;/pypi/&quot;
index-url: &quot;http://svn.wiretooth.com/pypi/&quot;
archive formats:gztar, ztar, bztar, zip, tar
Discarding ambiguous project/version interpretation: Pyrex/Tests-0.9.5.1
        Becuase the version part starts with a non digit
Discarding ambiguous project/version interpretation: python/cjson-1.0.2
        Becuase the version part starts with a non digit
Discarding ambiguous project/version interpretation: python/cjson-1.0.3
        Becuase the version part starts with a non digit
Pyrex: 0.9.5.1a [Pyrex-0.9.5.1a.tar.gz]
dry-wrote:/srv/pypi-cached/pyrex-0.9.5.1a.html
Pyrex-Tests: 0.9.5.1 [Pyrex-Tests-0.9.5.1.tar.gz]
dry-wrote:/srv/pypi-cached/pyrex-tests-0.9.5.1.html
SQLAlchemy: 0.3.7dev-r2498, 0.1.7 [SQLAlchemy-0.3.7dev_r2498-py2.4.egg, SQLAlchemy-0.1.7-py2.4.egg]
dry-wrote:/srv/pypi-cached/sqlalchemy-0.3.7dev-r2498.html
dry-wrote:/srv/pypi-cached/sqlalchemy-0.1.7.html
commandplate: 0.1dev1 [commandplate-0.1dev1-py2.5.egg, commandplate-0.1dev1.tar.gz]
dry-wrote:/srv/pypi-cached/commandplate-0.1dev1.html
docutils: 0.5dev, 0.4, snapshot [docutils-0.5dev.tar.gz, docutils-0.4.tar.gz, docutils-snapshot.tgz]
</pre>
<p>We set the content for master index page <cite>&lt;title&gt;</cite> using <tt class="docutils literal"><span class="pre">-T</span></tt>. The url of the
index was set with <tt class="docutils literal"><span class="pre">-U</span></tt>. This is the url that people should pass using the
<tt class="docutils literal"><span class="pre">-i</span></tt> option provided by <strong>easy_install</strong> when they want to install packages
from your index.</p>
<p>Notice the messages regarding the package named Pyrex-Tests. See <a class="reference" href="http://trac.wiretooth.com/public/ticket/12">ticket#12</a>
for details on the relatively simple heuristic that is used to resolve
ambiguities.</p>
<p>Assuming the run was successful the output will conclude by listing the
apache configuration files that would be written:</p>
<pre class="literal-block">
dry-wrote:/srv/pypi-cached/simplejson-1.7.1.html
dry-wrote:/srv/pypi-cached/simplejson-1.4.html
dry-wrote:/srv/pypi-cached/simplejson-1.3.html
zc.recipe.egg: 1.0.0b6 [zc.recipe.egg-1.0.0b6-py2.5.egg]
dry-wrote:/srv/pypi-cached/zc.recipe.egg-1.0.0b6.html
zope.interface: 3.2.0.2 [zope.interface-3.2.0.2-py2.4-linux-i686.egg]
dry-wrote:/srv/pypi-cached/zope.interface-3.2.0.2.html
dry-wrote:/srv/pypi-cached/index.html
dry-wrote:/srv/pypi-cached/project-index.txt
dry-wrote:/srv/pypi-cached/apache2-vhost.directives.conf
dry-wrote:/srv/pypi-cached/apache2-dir.directives.conf
dry-wrote:/srv/pypi-cached/.htaccess
</pre>
<p>The <cite>dry-wrote</cite> prefix on all the generated file names simply confirms that
<tt class="docutils literal"><span class="pre">-N,</span> <span class="pre">--dry-run</span></tt> is in effect and the named file was not written to disc. If
you want to pre view the config files, without actualy writing to disc, include
the options <tt class="docutils literal"><span class="pre">-N</span> <span class="pre">--log-config=INFO</span></tt>. Similarly, to preview the content of the
index pages, you can use <tt class="docutils literal"><span class="pre">--log-content=INFO</span></tt></p>
<p>Note that if <tt class="docutils literal"><span class="pre">-T</span> <span class="pre">name</span></tt> is a '.' separated prefix of of <tt class="docutils literal"><span class="pre">-U</span> <span class="pre">index-url</span></tt> then
you get a <tt class="docutils literal"><span class="pre">ServerAlias</span></tt> for it in the generated apache vhost configuration.
This is not  always what you want and the <cite>generate ServerAlias</cite> feature may be
removed in a future release.</p>
<p>Run it for real:</p>
<pre class="literal-block">
user&#64;aldis:/srv/pypi-cached# python pypicache-0.2/indexpackages.py --enable-htaccess -T &quot;cheesboard.wiretooth.com&quot; -U http://svn.wiretooth.com/pypi/ .
downloads-server-url: &quot;http://svn.wiretooth.com/&quot;
downloads-path: &quot;/pypi/&quot;
index-url: &quot;http://svn.wiretooth.com/pypi/&quot;
archive formats:gztar, ztar, bztar, zip, tar
Discarding ambiguous project/version interpretation: Pyrex/Tests-0.9.5.1
        Becuase the version part starts with a non digit
Discarding ambiguous project/version interpretation: python/cjson-1.0.2
        Becuase the version part starts with a non digit
Discarding ambiguous project/version interpretation: python/cjson-1.0.3
        Becuase the version part starts with a non digit
Pyrex: 0.9.5.1a [Pyrex-0.9.5.1a.tar.gz]
wrote:/srv/pypi-cached/pyrex-0.9.5.1a.html
Pyrex-Tests: 0.9.5.1 [Pyrex-Tests-0.9.5.1.tar.gz]
wrote:/srv/pypi-cached/pyrex-tests-0.9.5.1.html
SQLAlchemy: 0.3.7dev-r2498, 0.1.7 [SQLAlchemy-0.3.7dev_r2498-py2.4.egg, SQLAlchemy-0.1.7-py2.4.egg]
wrote:/srv/pypi-cached/sqlalchemy-0.3.7dev-r2498.html
wrote:/srv/pypi-cached/sqlalchemy-0.1.7.html
&lt;snip&gt;
</pre>
<p>And this time we see <tt class="docutils literal"><span class="pre">wrote</span></tt> instead of <tt class="docutils literal"><span class="pre">dry-wrote</span></tt></p>
<p>Setup a vhost container, or update an existing one, to pull in the generated
configs. Assuming you have a debian/ubuntu style apache configuration you can
use something like this.:</p>
<pre class="literal-block">
echo &quot;
&lt;VirtualHost *&gt;
        ServerAdmin webmaster&#64;localhost
        &lt;Directory /&gt;
                Options None
                AllowOverride None
        &lt;/Directory&gt;
        Include /srv/pypi-cached/apache2-vhost.directives.conf
        RewriteLogLevel 3

        # If you need to host this under a different document root, do
        # something like this:
        # DocumentRoot /somewhere/else
        # Alias /pypi /somewhere/else

        Include /srv/pypi-cached/apache2-dir.directives.conf

        ErrorLog /var/log/apache2/error.log

        # Possible values include: debug, info, notice, warn, error, crit,
        # alert, emerg.
        LogLevel debug

        CustomLog /var/log/apache2/access.log combined
        ServerSignature On

&lt;/VirtualHost&gt;&quot; &gt; /etc/apache2/sites-available/001-cheeseboard.myhost.conf


a2ensite 001-cheeseboard.myhost.conf
/etc/init.d/apache2 reload
</pre>
<p>If you get Invalid command 'RewriteEngine' errors then you need to enable
mod_rewrite AND force a full apache restart.:</p>
<pre class="literal-block">
a2enmod rewrite; /etc/init.d/apache2 restart
</pre>
<p>If you don't have server access, or if you dont have control over the server
level config you need to sweet talk your administrator into enabling .htaccess
for your package cache. Point them at the generated config files (which are well
commented) and you might get lucky.</p>
</div>
</body>
</html>
