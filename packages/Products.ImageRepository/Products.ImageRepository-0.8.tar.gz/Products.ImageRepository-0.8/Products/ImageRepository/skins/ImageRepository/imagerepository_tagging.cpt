<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US"
      lang="en-US"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="plone">

<head>

    <metal:block fill-slot="css_slot">
        <style type="text/css" media="screen"
               tal:content="string:@import url($portal_url/imagerepository.css);"></style>
    </metal:block>

</head>

<body>

<div metal:fill-slot="main">
<metal:main_macro define-macro="main"
     tal:define="imagerepository here/@@image_repository_view;
                 images imagerepository/queryImageRepository;
                 keywords python:imagerepository.getSearchKeywordsFromResults(images);
                 Batch python:modules['Products.CMFPlone'].Batch;
                 b_start python:request.get('b_start', 0);
                 batch python:Batch(images, 12, int(b_start), orphan=1);
                 toLocalizedTime nocall:here/toLocalizedTime;
                 imagerepository_template string:$here_url/$template_id;">

    <div metal:use-macro="here/document_actions/macros/document_actions">
        Document actions (print, sendto etc)
    </div>

    <h1 tal:content="here/pretty_title_or_id" class="documentFirstHeading">Title or id</h1>

    <tal:keywords metal:use-macro="here/imagerepository_view/macros/keywords">
    </tal:keywords>

    <form name="edit_form"
          method="post"
          action="imagerepository_addKeywords"
          tal:attributes="action string:$here_url/$template_id">
        <div class="imageRepositoryEntry" tal:repeat="item batch">

            <tal:defs define="item_url item/getURL|item/absolute_url;
                              item_path item/getPath|python:'/'.join(item.getPhysicalPath());
                              item_id item/getId|item/id;
                              item_title_or_id item/pretty_title_or_id;
                              item_description item/Description;
                              item_type item/portal_type;
                              item_type_title item/Type;
                              item_modified item/ModificationDate;
                              item_created item/CreationDate;
                              item_type_class python: 'contenttype-' + normalizeString(item_type);
                              item_wf_state item/review_state|python: wtool.getInfoFor(item, 'review_state', '');
                              item_wf_state_class python:'state-' + normalizeString(item_wf_state);
                              hasGetUrl python:hasattr(item.aq_explicit, 'getURL');
                              item_rel_url python:hasGetUrl and item.getURL(relative=1) or getRelativeContentURL(item);
                              item_creator item/Creator;
                              item_creators item/listCreators;
                              item_subject item/Subject;
                              item_start item/start/ISO|item/StartDate|nothing;
                              item_end item/end/ISO|item/EndDate|nothing;
                              ">

                <a href="#" 
                   tal:attributes="href string:${item_url}/edit;
                                   title item_description;">
                    <span class="imageRepositoryEntryWrapper">
                        <img tal:replace="structure python:imagerepository.thumbnail_tag(item, size='tile')" />
                    </span>
                </a>
                <span class="imageRepositoryEntryTitle">
                    <input type="checkbox"
                           class="noborder"
                           name="paths:list" id="#"
                           value="#"
                           tal:attributes="value   item_path;
                                           id      string:cb_$item_id;
                                           checked python:test(request.get('ids_checked', False), 'checked', None);
                                           alt     string:Select $item_title_or_id;
                                           title   string:Select $item_title_or_id" />
                    <input type="hidden" name="obj_paths:list" value="#"
                           tal:attributes="value item_rel_url" />
                    <tal:title tal:content="item_title_or_id"> Item Title </tal:title>
                </span>

                <div class="imageRepositoryEntryInfos">
                    <tal:creators tal:repeat="creator item_creators">
                        <tal:name tal:condition="creator"
                                  tal:define="author python:mtool.getMemberInfo(creator)">
                            <div tal:content="python:author and author['fullname'] or creator">
                                Bob Dobalina
                            </div>
                        </tal:name>
                    </tal:creators>
    
                    <div tal:content="python:', '.join(item_subject)">
                        Keyword
                    </div>
                </div>

            </tal:defs>
        </div>

        <div class="visualClear"><!-- --></div>

        <tal:field tal:define="field python:here.getField('subject');
                               errors options/state/getErrors | python: {};">
            <tal:widget metal:use-macro="python:here.widget(field.getName(), mode='edit')" />
        </tal:field>

        <div class="formControls">

            <input class="context"
                   tabindex=""
                   type="submit"
                   value="Update"
                   name="form.button.Update"
                   i18n:attributes="value label_update;"
                   tal:attributes="tabindex tabindex/next;
                                   name string:imagerepository_addKeywords:method;" />

        </div>

        <input type="hidden" name="form.submitted" value="1" />

    </form>

    <div class="visualClear"><!-- --></div>

    <p class="discreet"
       i18n:domain="atcontenttypes"
       i18n:translate="text_no_albums_uploaded"
       tal:condition="not:images">
        No albums or photos uploaded yet.
    </p>

    <div tal:condition="images"
         metal:use-macro="here/batch_macros/macros/navigation" />

</metal:main_macro>
</div>

</body>

</html>
