Using loggrok.actions.Action


Define callbacks for message category.

First we need to make some categories for our custom
message parser.

>>> patterns = (
...     r'^\[thread1\] ([\s\S]*)$',
...     r'^\[thread2\] ([\s\S]*)$',
...     r'^<meta-name> (\w+ \w+)'
... )
>>> keys = (('details',),('details',),('name',))
>>> from loggrok.parse import MessageParser
>>> parser = MessageParser(patterns, keys)

Define the message category callbacks

>>> thread1, thread2, metaname = range(len(patterns))
>>> from loggrok.actions import Action
>>> action = Action()

>>> def t1(entry):
...     print '===='
...     print 'THREAD1', entry.message.details[:-1]
...
>>> def t2(entry):
...     print '===='
...     print 'THREAD2', entry.message.details[:-1]
...
>>> def mname(entry):
...     print '===='
...     print 'META-NAME', entry.message.name
...
>>> action.addMessageCategoryCallback(thread1, t1)
>>> action.addMessageCategoryCallback(thread2, t2)
>>> action.addMessageCategoryCallback(metaname, mname)
>>> from loggrok.log import LogStream
>>> stream = LogStream(fname)
>>> stream.messageParser = parser
>>> stream.action = action
>>> for entry in stream:
...     continue
...
====
THREAD1 C
D E
F G
H I
====
THREAD1 J K
====
THREAD2 L M
N
====
THREAD2 W X
====
THREAD1 Y Z
====
META-NAME Dj Froofy


