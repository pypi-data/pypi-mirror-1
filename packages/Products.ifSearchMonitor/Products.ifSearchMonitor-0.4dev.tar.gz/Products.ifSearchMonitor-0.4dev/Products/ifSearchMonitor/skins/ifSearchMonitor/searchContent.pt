<metal:block use-macro="here/global_defines/macros/defines" />
<html>
<head metal:use-macro="here/header/macros/html_header">
    <metal:javascriptslot fill-slot="javascript_head_slot">
        <script type="text/javascript" src="searchContent.js"></script>
    </metal:javascriptslot>
    <title>Recommend results</title>
</head>
<body>
<hr/>
<form action="searchContent">
Search:
    <input type="text"
           tal:attributes="value request/search_text|nothing"
           name="search_text"/> <input type="submit" value="Search"/><br/>
</form>
<a href="browseContent">Browse content</a> | <a href="#" onclick="closePopUp()">Close</a>
<hr/>

    <div tal:define="portal_path python: here.portal_url.getPortalPath();
                     content_path request/content_path|portal_path;
                     search_text request/search_text|python: '';
                     results python: here.portal_catalog.searchResults(path=content_path, SearchableText=search_text);
                     Batch python:modules['Products.CMFPlone'].Batch;
                     mq python:modules['ZTUtils'].make_query;
                     url batch_base_url | string:${here/absolute_url}/${template_id};
                     b_size python:10;
                     b_start python:0;
                     b_start request/b_start | b_start;">

    <tal:block tal:condition="results" tal:define="batch python:Batch(results, b_size, int(b_start), orphan=1);">

        <div style="background-color: #cee0fb;border-color: #3B6AA0;border-style: solid;border-width: 1px">
            <strong>
            <span tal:replace="python:len(results)">234</span> results.
            </strong><br/>
            <tal:block tal:condition="results" tal:define="ini python:b_start + 1;
                                                        end python:min(ini + b_size - 1, len(results));
                                                        prev python: b_start - b_size">
                <a style="text-decoration:none" tal:condition="python: b_start > 0"
                    tal:attributes="href python: '%s?%s' % (url , mq(request.form, {'b_start':prev}))">
                    &lt;Previous</a>
                <span tal:content="string: ${ini} - ${end}"></span>
                <a style="text-decoration:none" tal:condition="python: end < len(results)"
                    tal:attributes="href python: '%s?%s' % (url , mq(request.form, {'b_start':end}))">
                    Next&gt;</a>
            </tal:block>
        </div>

    <table>
        <tr tal:repeat="item batch">
            <td><img tal:attributes="src item/getIcon"/>
                <a tal:define="label python: test(item.Title, item.Title, item.id)"
                   tal:content="label"
                   href="#"
                   title="recommend it"
                   tal:attributes='onclick string:addRecommend("${item/id}", "${label}")'>Title</a></td>
        </tr>
    </table>

    </tal:block>

    <table tal:condition="not:results">
        <tr>
            <td>No results.</td>
        </tr>
    </table>
    </div>
</body>
</html>
