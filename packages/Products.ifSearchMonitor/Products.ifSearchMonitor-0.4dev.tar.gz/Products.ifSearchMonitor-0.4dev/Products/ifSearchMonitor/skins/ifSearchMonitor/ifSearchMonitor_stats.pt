<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US"
    lang="en-US"
    metal:use-macro="here/prefs_main_template/macros/master">

<tal:block metal:fill-slot="head_slot">
<tal:block tal:define="dummy python:request.set('disable_border',1)" />
</tal:block>

<body>

<div metal:fill-slot="prefs_configlet_main">

<div class="configlet">

<div class="documentEditable">

    <!-- simulating views until we have real objects. -->
    <ul class="contentViews">
        <li class="selected">
        <a href=""
        tal:attributes="href string:${template/id}"
        i18n:translate="">Statistics Report</a>
        </li>
        <li>
        <a href=""
        tal:attributes="href string:ifSearchMonitor_recommended"
        i18n:translate="">Recommended results</a>
        </li>
    </ul>

    <div class="contentActions">
    &nbsp;
    </div>
    <!-- End of tabs -->

    <div class="documentContent">
      <h1>ifSearchMonitor</h1>
        <p>
        Search statistics.
        </p>
    <form>
    <fieldset>
        <legend>Statistics</legend>
        <div tal:define="sort python:request and request.form.get('sort_key','number') or 'number';
                         orders python:request and request.form.get('order','des') or 'des';
                         results python:context.ifSearchMonitor_tool.getSearchedTerms(sort_key=sort,order=orders);
                         Batch python:modules['Products.CMFPlone'].Batch;
                         b_size python:20;
                         b_start python:0;
                         b_start request/b_start | b_start;">

            <div tal:condition="results"
                tal:define="batch python:Batch(results, b_size, int(b_start), orphan=1);">
                <table width="100%">
                    <tr>
                        <th>Search Terms</th>
                        <th tal:define="order python: (sort=='number' and orders=='des' and 'asc') or 'des';
                                        indicator python: (sort=='number' and '('+orders+')') or ''">
                            <a tal:attributes="href python:'ifSearchMonitor_stats?sort_key=number&order='+order"
                               tal:content="string: Times searched ${indicator}">Times searched</a></th>
                        <th tal:define="order python: (sort=='results' and orders=='des' and 'asc') or 'des';
                                        indicator python: (sort=='results' and '('+orders+')') or ''">
                            <a tal:attributes="href python:'ifSearchMonitor_stats?sort_key=results&order='+order"
                               tal:content="string: Avg. Results ${indicator}">Avg. Results</a></th>
                        <th tal:define="order python: (sort=='clicks' and orders=='des' and 'asc') or 'des';
                                        indicator python: (sort=='clicks' and '('+orders+')') or ''">
                            <a tal:attributes="href python:'ifSearchMonitor_stats?sort_key=clicks&order='+order"
                               tal:content="string: Clicks ${indicator}">Clicks</a></th>
                    </tr>
                    <metal:block tal:repeat="term batch">
                    <tr tal:define="stats python:context.ifSearchMonitor_tool.getTermStatistics(term)">
                        <td tal:content="term">The term.</td>
                        <td align="center" tal:content="python:stats[0]">The number of times the term is searched for.</td>
                        <td align="center" tal:content="python:stats[2]/stats[0]">The number of results generated for each search term. (displayed as average when there are multiple searches)</td>
                        <td align="center" tal:content="python:stats[1]">The number of times the user clicks through to a result in the search results per given search term.</td>
                        <td><a href="" tal:attributes="href string:ifSearchMonitor_recommend?terms=${term}">
                            Recommend Results</a>
                        </td>
                    </tr>
                    </metal:block>
                </table>
                <div metal:use-macro="here/batch_macros/macros/navigation" />
            </div>
            <div tal:condition="not: results">
                There are no statistics.
            </div>
        </div>
    </fieldset>
    </form>
</div>
</div>
</div>
</div>
</body>
</html>
