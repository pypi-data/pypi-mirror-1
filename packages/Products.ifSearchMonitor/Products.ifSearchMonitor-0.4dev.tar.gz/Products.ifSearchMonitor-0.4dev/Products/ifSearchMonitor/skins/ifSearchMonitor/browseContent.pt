<metal:block use-macro="here/global_defines/macros/defines" />
<html>
<head>
    <script type="text/javascript" src="searchContent.js"></script>
    <title>Recommend results</title>
</head>
<body>

<hr/>
<form action="searchContent">
Search:
    <input type="text"
           tal:attributes="value request/search_text|nothing"
           name="search_text"/> <input type="submit" value="Search"/><br/>
</form>
<a href="browseContent">Browse content</a> | <a href="#" onclick="closePopUp()">Close</a>
<hr/>

    <div tal:define="portal_path python: here.portal_url.getPortalPath();
                     content_path request/content_path|portal_path;
                     path_query python: {'query':content_path, 'depth':1};
                     query python: {'path':path_query};
                     results python: here.portal_catalog.queryCatalog(query);
                     Batch python:modules['Products.CMFPlone'].Batch;
                     mq python:modules['ZTUtils'].make_query;
                     url batch_base_url | string:${here/absolute_url}/${template_id};
                     b_size python:10;
                     b_start python:0;
                     b_start request/b_start | b_start;">

    <tal:block tal:condition="results" tal:define="batch python:Batch(results, b_size, int(b_start), orphan=1);">

        <div style="background-color: #cee0fb;border-color: #3B6AA0;border-style: solid;border-width: 1px">
            <strong>
            <span tal:replace="python:len(results)">234</span> results.
            </strong><br/>
            <tal:block tal:condition="results" tal:define="ini python:b_start + 1;
                                                        end python:min(ini + b_size - 1, len(results));
                                                        prev python: b_start - b_size">
                <a style="text-decoration:none" tal:condition="python: b_start > 0"
                    tal:attributes="href python: '%s?%s' % (url , mq(request.form, {'b_start':prev}))">
                    &lt;Previous</a>
                <span tal:content="string: ${ini} - ${end}"></span>
                <a style="text-decoration:none" tal:condition="python: end < len(results)"
                    tal:attributes="href python: '%s?%s' % (url , mq(request.form, {'b_start':end}))">
                    Next&gt;</a>
            </tal:block>
        </div>

    <table>
        <tr tal:condition="python: content_path != portal_path">
        <td><a tal:define="prev python: content_path.rfind('/');
                           path python: content_path[:prev]"
               tal:attributes="href string:browseContent?content_path=${path}" >..</a></td>
        </tr>
        <tr tal:repeat="item batch">
            <td tal:define="path python: test(item.is_folderish, content_path + '/' + item.id, None);
                            label python: test(item.Title, item.Title, item.id)">
                <img tal:attributes="src item/getIcon"/>
                <a tal:content="label"
                   tal:condition="path"
                   tal:attributes='href string:browseContent?content_path=${path}'>Title</a>
                <span tal:content="label" tal:condition="not:path"></span>
                <a href="#" tal:attributes='onclick string:addRecommend("${item/id}", "${label}")'>
                    [Recommend]
                </a>
                </td>
        </tr>
    </table>

    </tal:block>

    <table tal:condition="not:results">
        <tr tal:condition="python: content_path != portal_path">
        <td><a tal:define="prev python: content_path.rfind('/');
                           path python: content_path[:prev]"
               tal:attributes="href string:browseContent?content_path=${path}" >..</a></td>
        </tr>
        <tr>
            <td>-- Empty --</td>
        </tr>
    </table>
    </div>
</body>
</html>
