<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Built-In Cleanup Filter &mdash; WFront v0.4 documentation</title>
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.4',
        COLLAPSE_MODINDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="top" title="WFront v0.4 documentation" href="index.html" />
    <link rel="next" title="Examples" href="examples.html" />
    <link rel="prev" title="Routing" href="routing.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="modindex.html" title="Global Module Index"
             accesskey="M">modules</a> |</li>
        <li class="right" >
          <a href="examples.html" title="Examples"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="routing.html" title="Routing"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">WFront v0.4 documentation</a> &raquo;</li> 
      </ul>
    </div>  
    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="built-in-cleanup-filter">
<span id="filter"></span><h1>Built-In Cleanup Filter<a class="headerlink" href="#built-in-cleanup-filter" title="Permalink to this headline">¶</a></h1>
<p>The built-in filter function takes a dict <tt class="docutils literal"><span class="pre">d</span></tt> and runs
<tt class="docutils literal"><span class="pre">environ.update(d)</span></tt>.  This behavior can be augmented with magic <tt class="docutils literal"><span class="pre">wfront.*</span></tt>
directives in your dictionary.  For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{</span> <span class="s">&#39;HTTPS&#39;</span><span class="p">:</span> <span class="s">&#39;on&#39;</span><span class="p">,</span>
  <span class="s">&#39;wfront.remove.REMOTE_USER&#39;</span><span class="p">:</span> <span class="s">&#39;true&#39;</span><span class="p">,</span>
  <span class="s">&#39;wfront.copy.REMOTE_HOST&#39;</span><span class="p">:</span> <span class="s">&#39;our.remote_host.key&#39;</span><span class="p">,</span>
  <span class="s">&#39;wfront.subtract.HTTP_ACCEPT_ENCODING&#39;</span><span class="p">:</span> <span class="s">&#39;deflate&#39;</span> <span class="p">}</span>
</pre></div>
</div>
<p>The directives are consumed by the filter function and will not be placed into
the final <tt class="docutils literal"><span class="pre">environ</span></tt>.</p>
<div class="section" id="rewrite-directives">
<h2>Rewrite Directives<a class="headerlink" href="#rewrite-directives" title="Permalink to this headline">¶</a></h2>
<p>The <tt class="docutils literal"><span class="pre">wfront.*</span></tt> directives operate on the existing environ values and
take the general form:</p>
<blockquote>
<tt class="docutils literal"><span class="pre">'wfront.&lt;directive&gt;.&lt;environ</span> <span class="pre">key&gt;'</span> <span class="pre">=</span> <span class="pre">'&lt;new</span> <span class="pre">value&gt;'</span></tt></blockquote>
<div class="section" id="copy">
<h3>copy<a class="headerlink" href="#copy" title="Permalink to this headline">¶</a></h3>
<dl class="docutils">
<dt>Format:</dt>
<dd><tt class="docutils literal"><span class="pre">wfront.copy.&lt;source</span> <span class="pre">key&gt;</span> <span class="pre">=</span> <span class="pre">&lt;target</span> <span class="pre">key&gt;</span></tt></dd>
</dl>
<p>Copies <tt class="docutils literal"><span class="pre">environ['&lt;source</span> <span class="pre">key&gt;']</span></tt> to <tt class="docutils literal"><span class="pre">environ['&lt;target</span> <span class="pre">key&gt;']</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{</span> <span class="s">&#39;wfront.copy.HOST&#39;</span><span class="p">:</span> <span class="s">&#39;my.host.key&#39;</span> <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="subtract">
<h3>subtract<a class="headerlink" href="#subtract" title="Permalink to this headline">¶</a></h3>
<dl class="docutils">
<dt>Format:</dt>
<dd><tt class="docutils literal"><span class="pre">wfront.subtract.&lt;key&gt;</span> <span class="pre">=</span> <span class="pre">'string'</span></tt></dd>
</dl>
<p>Removes the first occurrence of &#8216;string&#8217; in <tt class="docutils literal"><span class="pre">&lt;key&gt;</span></tt>&#8216;s value:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{</span> <span class="s">&#39;wfront.subtract.SCRIPT_NAME&#39;</span><span class="p">:</span> <span class="s">&#39;/remove/this/prefix&#39;</span> <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="sub">
<h3>sub<a class="headerlink" href="#sub" title="Permalink to this headline">¶</a></h3>
<dl class="docutils">
<dt>Format:</dt>
<dd><p class="first"><tt class="docutils literal"><span class="pre">wfront.sub.&lt;key&gt;</span> <span class="pre">=</span> <span class="pre">'regex</span> <span class="pre">as</span> <span class="pre">a</span> <span class="pre">string'</span></tt></p>
<p class="last"><tt class="docutils literal"><span class="pre">wfront.sub.&lt;key&gt;</span> <span class="pre">=</span> <span class="pre">re.compile('regex</span> <span class="pre">object')</span></tt></p>
</dd>
</dl>
<p>Removes the first occurrence of <tt class="docutils literal"><span class="pre">regex</span></tt> in <tt class="docutils literal"><span class="pre">&lt;key&gt;</span></tt>&#8216;s value:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{</span> <span class="s">&#39;wfront.sub.HTTP_ACCEPT_ENCODING&#39;</span><span class="p">:</span> <span class="s">r&#39;,?deflate&#39;</span> <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="sprintf">
<h3>sprintf<a class="headerlink" href="#sprintf" title="Permalink to this headline">¶</a></h3>
<dl class="docutils">
<dt>Format:</dt>
<dd><tt class="docutils literal"><span class="pre">wfront.sprintf.&lt;key&gt;</span> <span class="pre">=</span> <span class="pre">'%s</span> <span class="pre">template'</span></tt></dd>
</dl>
<p>Places <tt class="docutils literal"><span class="pre">&lt;key&gt;</span></tt>&#8216;s value in the sprintf-style template.  The first occurrence
of %s in the template will be replaced with <tt class="docutils literal"><span class="pre">&lt;key&gt;</span></tt>&#8216;s current value, and the
result assigned back to environ:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{</span> <span class="s">&#39;wfront.sprintf.SCRIPT_NAME&#39;</span><span class="p">:</span> <span class="s">&#39;/prepended/</span><span class="si">%s</span><span class="s">&#39;</span><span class="p">,</span>
  <span class="s">&#39;wfront.sprintf.PATH_INFO&#39;</span><span class="p">:</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">/appended&#39;</span><span class="p">,</span>
  <span class="s">&#39;wfront.sprintf.sandwich&#39;</span><span class="p">:</span> <span class="s">&#39;in the </span><span class="si">%s</span><span class="s"> middle&#39;</span> <span class="p">}</span>
</pre></div>
</div>
<p>You can insert the values of other environ keys with named formats:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{</span> <span class="s">&#39;wfront.sprintf.foo&#39;</span><span class="p">:</span> <span class="s">&#39;bar is </span><span class="si">%(bar)s</span><span class="s">&#39;</span> <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="setdefault">
<h3>setdefault<a class="headerlink" href="#setdefault" title="Permalink to this headline">¶</a></h3>
<dl class="docutils">
<dt>Format:</dt>
<dd><p class="first"><tt class="docutils literal"><span class="pre">wfront.setdefault.&lt;key&gt;</span> <span class="pre">=</span> <span class="pre">'value'</span></tt></p>
<p class="last"><tt class="docutils literal"><span class="pre">wfront.setdefault.&lt;key&gt;</span> <span class="pre">=</span> <span class="pre">'%(other-key)s'</span></tt></p>
</dd>
</dl>
<p>Sets <tt class="docutils literal"><span class="pre">&lt;key&gt;</span></tt> to <tt class="docutils literal"><span class="pre">value</span></tt> only if <tt class="docutils literal"><span class="pre">&lt;key&gt;</span></tt> is not present in the environ or
is present with a value of <tt class="docutils literal"><span class="pre">''</span></tt>, an empty string:</p>
<div class="highlight-python"><pre>{ 'wfront.setdefault.HTTP_HOST: 'www.example.com' }</pre>
</div>
<p><tt class="docutils literal"><span class="pre">value</span></tt> may contain sprintf-style substitutions to insert values from other
environ keys:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{</span> <span class="s">&#39;wfront.setdefault.REQUEST_URI&#39;</span><span class="p">:</span> <span class="s">&#39;%(SCRIPT_NAME)s%(PATH_INFO)s&#39;</span> <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="remove">
<h3>remove<a class="headerlink" href="#remove" title="Permalink to this headline">¶</a></h3>
<dl class="docutils">
<dt>Format:</dt>
<dd><tt class="docutils literal"><span class="pre">wfront.remove.&lt;key&gt;</span> <span class="pre">=</span> <span class="pre">unspecified</span></tt></dd>
</dl>
<p>Removes <tt class="docutils literal"><span class="pre">&lt;key&gt;</span></tt> from environ completely.  The value is ignored:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{</span> <span class="s">&#39;wfront.remove.REMOTE_USER&#39;</span><span class="p">:</span> <span class="bp">True</span> <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="strip-path">
<h3>strip_path<a class="headerlink" href="#strip-path" title="Permalink to this headline">¶</a></h3>
<dl class="docutils">
<dt>Format:</dt>
<dd><tt class="docutils literal"><span class="pre">wfront.strip_path</span> <span class="pre">=</span> <span class="pre">'prefix'</span></tt></dd>
</dl>
<p>This directive takes no <tt class="docutils literal"><span class="pre">&lt;key&gt;</span></tt> argument.  <tt class="docutils literal"><span class="pre">prefix</span></tt> is removed from
<tt class="docutils literal"><span class="pre">SCRIPT_NAME</span></tt>, <tt class="docutils literal"><span class="pre">PATH_INFO</span></tt>, and <tt class="docutils literal"><span class="pre">REQUEST_URI</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{</span> <span class="s">&#39;wfront.strip_path&#39;</span><span class="p">:</span> <span class="s">&#39;/bogus/&#39;</span> <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="reset-host">
<h3>reset_host<a class="headerlink" href="#reset-host" title="Permalink to this headline">¶</a></h3>
<dl class="docutils">
<dt>Format:</dt>
<dd><tt class="docutils literal"><span class="pre">wfront.reset_host</span> <span class="pre">=</span> <span class="pre">unspecified</span></tt></dd>
</dl>
<p>This command takes no <tt class="docutils literal"><span class="pre">&lt;key&gt;</span></tt> argument and ignores the value.  Sets the
<tt class="docutils literal"><span class="pre">Host:</span></tt> header to match the determination made by WFront&#8217;s Host detection
heuristics.</p>
<p>Will use <tt class="docutils literal"><span class="pre">wfront_match</span></tt> if present in the
<tt class="docutils literal"><span class="pre">environ['wsgiorg.routing_args']</span></tt> collection, otherwise the <tt class="docutils literal"><span class="pre">Host:</span></tt> will
be determined using the current state of the environ.</p>
<div class="highlight-python"><pre>{ 'wfront.reset_host: '' }</pre>
</div>
</div>
</div>
<div class="section" id="shorthand">
<h2>Shorthand<a class="headerlink" href="#shorthand" title="Permalink to this headline">¶</a></h2>
<p>A less verbose syntax is available by supplying <tt class="docutils literal"><span class="pre">cleanup_syntax='shortcut'</span></tt>
to the WFront constructor. This is not enabled by default.</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">=source:</span> <span class="pre">target</span></tt></dt>
<dd>Alias for <tt class="docutils literal"><span class="pre">wfront.copy.&lt;source&gt;</span> <span class="pre">=</span> <span class="pre">&lt;target&gt;</span></tt></dd>
<dt><tt class="docutils literal"><span class="pre">-key:</span> <span class="pre">string</span></tt></dt>
<dd>Alias for <tt class="docutils literal"><span class="pre">wfront.subtract.&lt;key&gt;</span> <span class="pre">=</span> <span class="pre">&lt;string&gt;</span></tt></dd>
<dt><tt class="docutils literal"><span class="pre">~key:</span> <span class="pre">regex</span></tt></dt>
<dd>Alias for <tt class="docutils literal"><span class="pre">wfront.sub.&lt;key&gt;</span> <span class="pre">=</span> <span class="pre">&lt;regex&gt;</span></tt></dd>
<dt><tt class="docutils literal"><span class="pre">%key:</span> <span class="pre">template</span></tt></dt>
<dd>Alias for <tt class="docutils literal"><span class="pre">wfront.sprintf.&lt;key&gt;</span> <span class="pre">=</span> <span class="pre">&lt;template&gt;</span></tt></dd>
<dt><tt class="docutils literal"><span class="pre">key:</span> <span class="pre">None</span></tt></dt>
<dd>Alias for <tt class="docutils literal"><span class="pre">wfront.remove.&lt;key&gt;</span> <span class="pre">=</span> <span class="pre">True</span></tt></dd>
<dt><tt class="docutils literal"><span class="pre">-/:</span> <span class="pre">prefix</span></tt></dt>
<dd>Alias for <tt class="docutils literal"><span class="pre">wfront.strip_path</span> <span class="pre">=</span> <span class="pre">&lt;prefix&gt;</span></tt></dd>
<dt><tt class="docutils literal"><span class="pre">&gt;host:</span> <span class="pre">ignored</span></tt></dt>
<dd>Alias for <tt class="docutils literal"><span class="pre">wfront.reset_host</span></tt>.  The value is ignored.</dd>
</dl>
</div>
<div class="section" id="middleware">
<h2>Middleware<a class="headerlink" href="#middleware" title="Permalink to this headline">¶</a></h2>
<p>The rewrite rules can be used standalone as WSGI middleware:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">wfront</span> <span class="kn">import</span> <span class="n">EnvironRewriter</span><span class="p">,</span> <span class="n">echo_app</span> <span class="k">as</span> <span class="n">my_app</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">rewriter</span> <span class="o">=</span> <span class="n">EnvironRewriter</span><span class="p">(</span><span class="n">HTTPS</span><span class="o">=</span><span class="s">&#39;on&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">my_app</span> <span class="o">=</span> <span class="n">rewriter</span><span class="o">.</span><span class="n">as_middleware_for</span><span class="p">(</span><span class="n">my_app</span><span class="p">)</span>
</pre></div>
</div>
<dl class="class">
<dt id="wfront.rewriter.EnvironRewriter">
<!--[wfront.rewriter.EnvironRewriter]-->class <tt class="descclassname">wfront.rewriter.</tt><tt class="descname">EnvironRewriter</tt><big>(</big><em>*iterable</em>, <em>**rules</em><big>)</big><a class="headerlink" href="#wfront.rewriter.EnvironRewriter" title="Permalink to this definition">¶</a></dt>
<dd><p>A WSGI environ tweaker and rewriter.</p>
<dl class="attribute">
<dt id="wfront.rewriter.EnvironRewriter.route_resolver">
<!--[wfront.rewriter.EnvironRewriter.route_resolver]--><tt class="descname">route_resolver</tt><a class="headerlink" href="#wfront.rewriter.EnvironRewriter.route_resolver" title="Permalink to this definition">¶</a></dt>
<dd>A route resolving callable.  Defaults to
<a title="wfront.default_resolver" class="reference external" href="routing.html#wfront.default_resolver"><tt class="xref docutils literal"><span class="pre">default_resolver()</span></tt></a>.  Used by the <tt class="docutils literal"><span class="pre">reset_host</span></tt>
rewrite directive.  May be freely reassigned on
<a title="wfront.rewriter.EnvironRewriter" class="reference internal" href="#wfront.rewriter.EnvironRewriter"><tt class="xref docutils literal"><span class="pre">EnvironRewriter</span></tt></a> instances for other behavior.</dd></dl>

<dl class="method">
<dt id="wfront.rewriter.EnvironRewriter.__init__">
<!--[wfront.rewriter.EnvironRewriter.__init__]--><tt class="descname">__init__</tt><big>(</big><em>*iterable</em>, <em>**rules</em><big>)</big><a class="headerlink" href="#wfront.rewriter.EnvironRewriter.__init__" title="Permalink to this definition">¶</a></dt>
<dd><p>Construct a rewriter.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><em>*iterable</em> &#8211; optional, a single sequence of key/value pairs.</li>
<li><em>**rules</em> &#8211; optional, rules as keyword arguments.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>This constructor acts like the Python <tt class="docutils literal"><span class="pre">dict</span></tt> constructor.</p>
</dd></dl>

<dl class="method">
<dt id="wfront.rewriter.EnvironRewriter.rewrite">
<!--[wfront.rewriter.EnvironRewriter.rewrite]--><tt class="descname">rewrite</tt><big>(</big><em>environ</em><big>)</big><a class="headerlink" href="#wfront.rewriter.EnvironRewriter.rewrite" title="Permalink to this definition">¶</a></dt>
<dd>Applies rules to <em>environ</em>, updating it in place.</dd></dl>

<dl class="method">
<dt id="wfront.rewriter.EnvironRewriter.as_filter">
<!--[wfront.rewriter.EnvironRewriter.as_filter]--><tt class="descname">as_filter</tt><big>(</big><em>app</em>, <em>environ</em>, <em>start_response</em><big>)</big><a class="headerlink" href="#wfront.rewriter.EnvironRewriter.as_filter" title="Permalink to this definition">¶</a></dt>
<dd>Act as a WFront filter.</dd></dl>

<dl class="method">
<dt id="wfront.rewriter.EnvironRewriter.as_middleware_for">
<!--[wfront.rewriter.EnvironRewriter.as_middleware_for]--><tt class="descname">as_middleware_for</tt><big>(</big><em>app</em><big>)</big><a class="headerlink" href="#wfront.rewriter.EnvironRewriter.as_middleware_for" title="Permalink to this definition">¶</a></dt>
<dd>Act as a middleware wrapping <em>app</em>.</dd></dl>

</dd></dl>

</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <h3><a href="index.html">Table Of Contents</a></h3>
            <ul>
<li><a class="reference external" href="">Built-In Cleanup Filter</a><ul>
<li><a class="reference external" href="#rewrite-directives">Rewrite Directives</a><ul>
<li><a class="reference external" href="#copy">copy</a></li>
<li><a class="reference external" href="#subtract">subtract</a></li>
<li><a class="reference external" href="#sub">sub</a></li>
<li><a class="reference external" href="#sprintf">sprintf</a></li>
<li><a class="reference external" href="#setdefault">setdefault</a></li>
<li><a class="reference external" href="#remove">remove</a></li>
<li><a class="reference external" href="#strip-path">strip_path</a></li>
<li><a class="reference external" href="#reset-host">reset_host</a></li>
</ul>
</li>
<li><a class="reference external" href="#shorthand">Shorthand</a></li>
<li><a class="reference external" href="#middleware">Middleware</a></li>
</ul>
</li>
</ul>

            <h4>Previous topic</h4>
            <p class="topless"><a href="routing.html" title="previous chapter">Routing</a></p>
            <h4>Next topic</h4>
            <p class="topless"><a href="examples.html" title="next chapter">Examples</a></p>
            <h3>This Page</h3>
            <ul class="this-page-menu">
              <li><a href="_sources/filter.txt" rel="nofollow">Show Source</a></li>
            </ul>
          <h3>Quick search</h3>
            <form class="search" action="search.html" method="get">
              <input type="text" name="q" size="18" /> <input type="submit" value="Go" />
              <input type="hidden" name="check_keywords" value="yes" />
              <input type="hidden" name="area" value="default" />
            </form>
            <p style="font-size: 90%">Enter search terms or a module, class or function name.</p>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="modindex.html" title="Global Module Index"
             accesskey="M">modules</a> |</li>
        <li class="right" >
          <a href="examples.html" title="Examples"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="routing.html" title="Routing"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">WFront v0.4 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
      &copy; Copyright 2008, Jason Kirtland.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 0.6.
    </div>
  </body>
</html>