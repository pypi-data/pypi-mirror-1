#!/usr/bin/make -f

#export DH_VERBOSE=1
p_name=python-aditamserver

PYVERS=$(shell pyversions -vr)

include /usr/share/quilt/quilt.make


clean: unpatch
	dh_testdir
	dh_testroot
	rm -rf dist build *.egg-info
	find . -name '*\.py[co]' -delete
	dh_clean build-*

build: patch

install: $(PYVERS:%=install-python%)
install-python%:
	python$* setup.py install \
		--single-version-externally-managed \
		--root $(CURDIR)/debian/${p_name}
	mkdir -p $(CURDIR)/debian/${p_name}/etc/aditam
	mkdir -p $(CURDIR)/debian/${p_name}/etc/init.d
	cp $(CURDIR)/samples/aditam-logging.conf-sample \
		$(CURDIR)/debian/${p_name}/etc/aditam/aditam-logging.conf
	cp $(CURDIR)/samples/aditam-server.conf-sample \
		$(CURDIR)/debian/${p_name}/etc/aditam/aditam-server.conf
	cp $(CURDIR)/debian/init.d $(CURDIR)/debian/${p_name}/etc/init.d/aditam.server
	rm -f debian/${p_name}/usr/lib/python$*/site-packages/aditam.server-*.pth


binary-indep: build install
	dh_testdir -i
	dh_testroot -i
	#dh_installdocs -i
	dh_pysupport -i
	dh_compress -i -X.py
	dh_fixperms -i
	#dh_installinit -i
	dh_installdeb -i
	dh_gencontrol -i
	dh_md5sums -i
	dh_builddeb -i -- -Z bzip2

binary-arch:

binary: binary-indep binary-arch

.PHONY: build clean binary-indep binary-arch binary install build

