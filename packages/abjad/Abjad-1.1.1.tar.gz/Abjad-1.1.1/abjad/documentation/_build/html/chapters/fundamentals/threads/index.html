<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Threads &mdash; Abjad v1.1.1 documentation</title>
    <link rel="stylesheet" href="../../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '1.1.1',
        COLLAPSE_MODINDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../_static/ga-1.js"></script>
    <script type="text/javascript" src="../../../_static/ga-2.js"></script>
    <link rel="top" title="Abjad v1.1.1 documentation" href="../../../index.html" />
    <link rel="next" title="Codebase" href="../../devel/codebase/index.html" />
    <link rel="prev" title="Grobs" href="../grobhandlers/index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../modindex.html" title="Global Module Index"
             accesskey="M">modules</a> |</li>
        <li class="right" >
          <a href="../../devel/codebase/index.html" title="Codebase"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../grobhandlers/index.html" title="Grobs"
             accesskey="P">previous</a> |</li>
    <li><a href="http://www.projectabjad.org/">Project Abjad</a> &raquo;</li>
    
        <li><a href="../../../index.html">Abjad v1.1.1 documentation</a> &raquo;</li>
 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="threads">
<h1>Threads<a class="headerlink" href="#threads" title="Permalink to this headline">¶</a></h1>
<div class="section" id="what-is-a-thread">
<h2>What is a thread?<a class="headerlink" href="#what-is-a-thread" title="Permalink to this headline">¶</a></h2>
<p>Abjad has the notion of a <a class="reference external" href="../../appendices/glossary/index.html#term-thread"><em class="xref">thread</em></a>. A thread is a structural relationship binding a set of strictly sequential <tt class="xref docutils literal"><span class="pre">Voice</span></tt> level Abjad component, such as notes, rests, chords, tuplets or plain containers.</p>
<p>Threads may be <em>explicitly</em> defined via <tt class="xref docutils literal"><span class="pre">Voice</span></tt> instances:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">abjad</span><span class="o">&gt;</span> <span class="n">v</span> <span class="o">=</span> <span class="n">Voice</span><span class="p">(</span> <span class="p">)</span>
</pre></div>
</div>
<p>or they may exist <em>implicitly</em> in certain score constructs in the absence of <tt class="xref docutils literal"><span class="pre">Voice</span></tt> containers:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">abjad</span><span class="o">&gt;</span> <span class="n">staff</span> <span class="o">=</span> <span class="n">Staff</span><span class="p">(</span><span class="n">construct</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="mf">4</span><span class="p">))</span>
</pre></div>
</div>
<p>The existence of <tt class="xref docutils literal"><span class="pre">Voice</span></tt> objects does not, however, guarantee the existence of a thread between the element contained in different voices. Two contiguous voices <em>must</em> have the same name in order to be part of the same thread.</p>
<p>Here a thread does <em>not</em> exist between notes in the different <tt class="xref docutils literal"><span class="pre">Voice</span></tt> contexts:</p>
<div class="highlight-python"><pre>abjad&gt; v_one = Voice(construct.scale(4, (1, 16)))
abjad&gt; v_two = Voice(construct.scale(2))
abjad&gt; staff = Staff([v_one, v_two])
abjad&gt; f(staff)
\new Staff {
        \new Voice {
                c'16
                d'16
                e'16
                f'16
        }
        \new Voice {
                c'8
                d'8
        }
}</pre>
</div>
<p>Here a thread does exist:</p>
<div class="highlight-python"><pre>abjad&gt; v_one.name = 'flute'
abjad&gt; v_two.name = 'flute'
abjad&gt; f(staff)
\new Staff {
        \context Voice = "flute" {
                c'16
                d'16
                e'16
                f'16
        }
        \context Voice = "flute" {
                c'8
                d'8
        }
}</pre>
</div>
</div>
<div class="section" id="what-are-threads-for">
<h2>What are threads for?<a class="headerlink" href="#what-are-threads-for" title="Permalink to this headline">¶</a></h2>
<p>Consider the following situation:</p>
<img alt="../../../_images/thread-resolution_1.png" src="../../../_images/thread-resolution_1.png" />
<p>Are the two eighth notes in the second half of the measure the continuation of the ascending line in the first half, or is it the quarter note?
Is the very last <em>C</em> the continuation of the top melodic line or is it the <em>A</em>?
The stems might suggest an answer, but for Abjad, stem direction is not structural.
What path should Abjad take to traverse this little score from the first note to the last <em>A</em>? This same problem appears when trying to apply spanners to parallel structures.  Thus, threads are important in both score navigation (also called score traversal) and <tt class="xref docutils literal"><span class="pre">Spanner</span></tt> application.
In fact, threads are a <em>requirement</em> for <tt class="xref docutils literal"><span class="pre">Spanner</span></tt> application.</p>
<p>In Abjad, the ambiguity is resolved through the explicit use of named Voices, i.e. the explicit definition of threads.</p>
<p>The above musical fragment is constructed with the following code:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">abjad</span><span class="o">&gt;</span> <span class="n">vA</span> <span class="o">=</span> <span class="n">Voice</span><span class="p">(</span><span class="n">construct</span><span class="o">.</span><span class="n">notes</span><span class="p">([</span><span class="mf">5</span><span class="p">,</span> <span class="mf">7</span><span class="p">,</span> <span class="mf">9</span><span class="p">,</span> <span class="mf">11</span><span class="p">],</span> <span class="p">[(</span><span class="mf">1</span><span class="p">,</span> <span class="mf">8</span><span class="p">)]</span> <span class="o">*</span> <span class="mf">4</span><span class="p">))</span>
<span class="n">abjad</span><span class="o">&gt;</span> <span class="n">vB</span> <span class="o">=</span> <span class="n">Voice</span><span class="p">(</span><span class="n">construct</span><span class="o">.</span><span class="n">notes</span><span class="p">([</span><span class="mf">12</span><span class="p">,</span> <span class="mf">11</span><span class="p">,</span> <span class="mf">9</span><span class="p">],</span> <span class="p">[(</span><span class="mf">1</span><span class="p">,</span> <span class="mf">8</span><span class="p">),</span> <span class="p">(</span><span class="mf">1</span><span class="p">,</span> <span class="mf">8</span><span class="p">),</span> <span class="p">(</span><span class="mf">1</span><span class="p">,</span> <span class="mf">4</span><span class="p">)]))</span>
<span class="n">abjad</span><span class="o">&gt;</span> <span class="n">vC</span> <span class="o">=</span> <span class="n">Voice</span><span class="p">(</span><span class="n">Note</span><span class="p">(</span><span class="mf">12</span><span class="p">,</span> <span class="p">(</span><span class="mf">1</span><span class="p">,</span> <span class="mf">4</span><span class="p">))</span> <span class="o">*</span> <span class="mf">2</span><span class="p">)</span>
<span class="n">abjad</span><span class="o">&gt;</span> <span class="n">vA</span><span class="o">.</span><span class="n">voice</span><span class="o">.</span><span class="n">number</span> <span class="o">=</span> <span class="mf">1</span>
<span class="n">abjad</span><span class="o">&gt;</span> <span class="n">vB</span><span class="o">.</span><span class="n">voice</span><span class="o">.</span><span class="n">number</span> <span class="o">=</span> <span class="mf">1</span>
<span class="n">abjad</span><span class="o">&gt;</span> <span class="n">vC</span><span class="o">.</span><span class="n">voice</span><span class="o">.</span><span class="n">number</span> <span class="o">=</span> <span class="mf">2</span>
<span class="n">abjad</span><span class="o">&gt;</span> <span class="n">p</span> <span class="o">=</span> <span class="n">Container</span><span class="p">([</span><span class="n">vB</span><span class="p">,</span> <span class="n">vC</span><span class="p">])</span>
<span class="n">abjad</span><span class="o">&gt;</span> <span class="n">p</span><span class="o">.</span><span class="n">parallel</span> <span class="o">=</span> <span class="bp">True</span>
<span class="n">abjad</span><span class="o">&gt;</span> <span class="n">staff</span> <span class="o">=</span> <span class="n">Staff</span><span class="p">([</span><span class="n">vA</span><span class="p">,</span> <span class="n">p</span><span class="p">])</span>
</pre></div>
</div>
<img alt="../../../_images/thread-resolution_1.png" src="../../../_images/thread-resolution_1.png" />
<p>There&#8217;s a <tt class="xref docutils literal"><span class="pre">Staff</span></tt> that sequentially contains a <tt class="xref docutils literal"><span class="pre">Voice</span></tt> and a parallel <tt class="xref docutils literal"><span class="pre">Container</span></tt>. The <tt class="xref docutils literal"><span class="pre">Container</span></tt> in turn holds two Voices running simultaneously.</p>
<p>It is now clear from the code that the last <em>A</em> belongs with the two descending eighth notes. But there&#8217;s still no indication about a relationship of continuity between the first <tt class="xref docutils literal"><span class="pre">Voice</span></tt> in the sequence (<cite>vA</cite>) and any of the two following Voices.
Note that, while the voice number setting (<tt class="docutils literal"><span class="pre">vA.voice.number</span> <span class="pre">=</span> <span class="pre">1</span></tt>) may suggest that vA and vB belong together, this is not the case. The <tt class="docutils literal"><span class="pre">voice.number</span></tt> attribute simply sets the direction of the stems in the final printed output.</p>
<p>To see this more clearly, suppose we want to add a <tt class="xref docutils literal"><span class="pre">Slur</span></tt> starting on the first <tt class="xref docutils literal"><span class="pre">Note</span></tt> and ending on one of the last simultaneous Notes. To attach the <tt class="xref docutils literal"><span class="pre">Slur</span></tt> spanner to Voices we could either try:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">abjad</span><span class="o">&gt;</span> <span class="n">Slur</span><span class="p">([</span><span class="n">vA</span><span class="p">,</span> <span class="n">vB</span><span class="p">])</span>
</pre></div>
</div>
<p>or</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">abjad</span><span class="o">&gt;</span> <span class="n">Slur</span><span class="p">([</span><span class="n">vA</span><span class="p">,</span> <span class="n">vC</span><span class="p">])</span>
</pre></div>
</div>
<p>but both throw a <tt class="xref docutils literal"><span class="pre">ContiguityError</span></tt>. <em>Abjad</em> needs to see an explicit connection between either <cite>vA</cite> and <cite>vB</cite> or <cite>vA</cite> and <cite>vC</cite>.</p>
<p>Observe the behavior of the <tt class="xref docutils literal"><span class="pre">thread()</span></tt> iterator on the <cite>staff</cite>.</p>
<div class="highlight-python"><pre>abjad&gt; notes = iterate.thread(staff, Note, vA.thread.signature)
abjad&gt; print list(notes)
[Note(f', 8), Note(g', 8), Note(a', 8), Note(b', 8)]</pre>
</div>
<div class="highlight-python"><pre>abjad&gt; notes = iterate.thread(staff, Note, vB.thread.signature)
abjad&gt; print list(notes)
[Note(c'', 8), Note(b', 8), Note(a', 4)]</pre>
</div>
<div class="highlight-python"><pre>abjad&gt; notes = iterate.thread(staff, Note, vC.thread.signature)
abjad&gt; print list(notes)
[Note(c'', 4), Note(c'', 4)]</pre>
</div>
<p>In each case we are passing a different <em>thread signature</em> to the <tt class="xref docutils literal"><span class="pre">thread()</span></tt> iterator, so each case returns a different list of Notes.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">All <em>Abjad</em> Components have a <tt class="xref docutils literal"><span class="pre">_ThreadInterface</span></tt>.</p>
</div>
<p>We can see that the <em>thread signature</em> of each voice is indeed different by calling the <tt class="docutils literal"><span class="pre">report(</span> <span class="pre">)</span></tt> method on each of the Voice&#8217;s <tt class="xref docutils literal"><span class="pre">_ThreadInterface</span></tt>.</p>
<div class="highlight-python"><pre>abjad&gt; vA.thread.report( )
      root: Staff-138424236 (138424236)
     score:
staffgroup:
     staff: Staff-138424236
     voice: Voice-137756396
      self: Voice-137756396</pre>
</div>
<div class="highlight-python"><pre>abjad&gt; vB.thread.report( )
      root: Staff-138428332 (138428332)
     score:
staffgroup:
     staff: Staff-138428332
     voice: Voice-137284492
      self: Voice-137284492</pre>
</div>
<div class="highlight-python"><pre>abjad&gt; vC.thread.report( )
      root: Staff-138428332 (138428332)
     score:
staffgroup:
     staff: Staff-138428332
     voice: Voice-138331052
      self: Voice-138331052</pre>
</div>
<p>And by comparing them with the <tt class="docutils literal"><span class="pre">==</span></tt> binary operator:</p>
<div class="highlight-python"><pre>abjad&gt; print vA.thread.signature == vB.thread.signature
False
abjad&gt; print vA.thread.signature == vC.thread.signature
False
abjad&gt; print vB.thread.signature == vC.thread.signature
False</pre>
</div>
<p>To allow <em>Abjad</em> to treat the content of, say, voices <cite>vA</cite> and <cite>vB</cite> as belonging together, we explicitly define a thread between them. To do this  all we need to do is name these Voices equally:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">abjad</span><span class="o">&gt;</span> <span class="n">vA</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;piccolo&#39;</span>
<span class="n">abjad</span><span class="o">&gt;</span> <span class="n">vB</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;piccolo&#39;</span>
</pre></div>
</div>
<p>Now <cite>vA</cite> and <cite>vB</cite> and all their content belong to the same thread.</p>
<div class="highlight-python"><pre>abjad&gt; print vA.thread.signature == vB.thread.signature
True</pre>
</div>
<p>Note how the <em>thread signatures</em> have changed:</p>
<div class="highlight-python"><pre>abjad&gt; vA.thread.report( )
      root: Staff-138428396 (138428396)
     score:
staffgroup:
     staff: Staff-138428396
     voice: Voice-piccolo
      self: Voice-piccolo</pre>
</div>
<div class="highlight-python"><pre>abjad&gt; vB.thread.report( )
      root: Staff-138428396 (138428396)
     score:
staffgroup:
     staff: Staff-138428396
     voice: Voice-piccolo
      self: Voice-piccolo</pre>
</div>
<div class="highlight-python"><pre>abjad&gt; vC.thread.report( )
      root: Staff-138428396 (138428396)
     score:
staffgroup:
     staff: Staff-138428396
     voice: Voice-138331116
      self: Voice-138331116</pre>
</div>
<p>And how the <tt class="docutils literal"><span class="pre">iterate.thread(</span> <span class="pre">)</span></tt> function returns all the Notes belonging to both <cite>vA</cite> and <cite>vB</cite> when passing it the full <cite>staff</cite> and the <em>thread signature</em> of <cite>vA</cite>.</p>
<div class="highlight-python"><pre>abjad&gt; notes = iterate.thread(staff, Note, vA.thread.signature)
abjad&gt; print list(notes)
[Note(f', 8), Note(g', 8), Note(a', 8), Note(b', 8), Note(c'', 8), Note(b', 8), Note(a', 4)]</pre>
</div>
<p>Now the <tt class="xref docutils literal"><span class="pre">Slur</span></tt> spanner can be applied to Voices <cite>vA</cite> and <cite>vB</cite>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">abjad</span><span class="o">&gt;</span> <span class="n">Slur</span><span class="p">([</span><span class="n">vA</span><span class="p">,</span> <span class="n">vB</span><span class="p">])</span>
</pre></div>
</div>
<p>or directly to the Notes returned by the <tt class="xref docutils literal"><span class="pre">thread()</span></tt> iteration tool, which are the Notes belonging to both <cite>vA</cite> and <cite>vB</cite>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">abjad</span><span class="o">&gt;</span> <span class="n">notes</span> <span class="o">=</span> <span class="n">iterate</span><span class="o">.</span><span class="n">thread</span><span class="p">(</span><span class="n">staff</span><span class="p">,</span> <span class="n">Note</span><span class="p">,</span> <span class="n">vA</span><span class="o">.</span><span class="n">thread</span><span class="o">.</span><span class="n">signature</span><span class="p">)</span>
<span class="n">abjad</span><span class="o">&gt;</span> <span class="n">Slur</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">notes</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">abjad</span><span class="o">&gt;</span> <span class="n">show</span><span class="p">(</span><span class="n">staff</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../../../_images/thread-resolution_2.png" src="../../../_images/thread-resolution_2.png" />
<div class="section" id="coda">
<h3>Coda<a class="headerlink" href="#coda" title="Permalink to this headline">¶</a></h3>
<p>Incidentally, we could have constructed this score in a simpler way with only two Voices, one of them starting with a <tt class="xref docutils literal"><span class="pre">Skip</span></tt>:</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">A <tt class="xref docutils literal"><span class="pre">Skip</span></tt> is like an invisible <tt class="xref docutils literal"><span class="pre">Rest</span></tt>.</p>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">abjad</span><span class="o">&gt;</span> <span class="n">vX</span> <span class="o">=</span> <span class="n">Voice</span><span class="p">(</span><span class="n">construct</span><span class="o">.</span><span class="n">notes</span><span class="p">([</span><span class="mf">5</span><span class="p">,</span> <span class="mf">7</span><span class="p">,</span> <span class="mf">9</span><span class="p">,</span> <span class="mf">11</span><span class="p">,</span> <span class="mf">12</span><span class="p">,</span> <span class="mf">11</span><span class="p">,</span> <span class="mf">9</span><span class="p">],</span> <span class="p">[(</span><span class="mf">1</span><span class="p">,</span> <span class="mf">8</span><span class="p">)]</span> <span class="o">*</span> <span class="mf">6</span> <span class="o">+</span> <span class="p">[(</span><span class="mf">1</span><span class="p">,</span> <span class="mf">4</span><span class="p">)]))</span>
<span class="n">abjad</span><span class="o">&gt;</span> <span class="n">vY</span> <span class="o">=</span> <span class="n">Voice</span><span class="p">([</span><span class="n">Skip</span><span class="p">((</span><span class="mf">2</span><span class="p">,</span> <span class="mf">4</span><span class="p">))]</span> <span class="o">+</span> <span class="n">Note</span><span class="p">(</span><span class="mf">12</span><span class="p">,</span> <span class="p">(</span><span class="mf">1</span><span class="p">,</span> <span class="mf">4</span><span class="p">))</span> <span class="o">*</span> <span class="mf">2</span><span class="p">)</span>
<span class="n">abjad</span><span class="o">&gt;</span> <span class="n">vX</span><span class="o">.</span><span class="n">voice</span><span class="o">.</span><span class="n">number</span> <span class="o">=</span> <span class="mf">1</span>
<span class="n">abjad</span><span class="o">&gt;</span> <span class="n">vY</span><span class="o">.</span><span class="n">voice</span><span class="o">.</span><span class="n">number</span> <span class="o">=</span> <span class="mf">2</span>
<span class="n">abjad</span><span class="o">&gt;</span> <span class="n">staff</span> <span class="o">=</span> <span class="n">Staff</span><span class="p">([</span><span class="n">vX</span><span class="p">,</span> <span class="n">vY</span><span class="p">])</span>
<span class="n">abjad</span><span class="o">&gt;</span> <span class="n">staff</span><span class="o">.</span><span class="n">parallel</span> <span class="o">=</span> <span class="bp">True</span>
</pre></div>
</div>
<img alt="../../../_images/thread-resolution_3.png" src="../../../_images/thread-resolution_3.png" />
<p>But that would have defeated the purpose of this section!</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <h3><a href="../../../index.html">Table Of Contents</a></h3>
            <ul>
<li><a class="reference external" href="">Threads</a><ul>
<li><a class="reference external" href="#what-is-a-thread">What is a thread?</a></li>
<li><a class="reference external" href="#what-are-threads-for">What are threads for?</a><ul>
<li><a class="reference external" href="#coda">Coda</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            <h4>Previous topic</h4>
            <p class="topless"><a href="../grobhandlers/index.html"
                                  title="previous chapter">Grobs</a></p>
            <h4>Next topic</h4>
            <p class="topless"><a href="../../devel/codebase/index.html"
                                  title="next chapter">Codebase</a></p>
            <h3>This Page</h3>
            <ul class="this-page-menu">
              <li><a href="../../../_sources/chapters/fundamentals/threads/index.txt"
                     rel="nofollow">Show Source</a></li>
            </ul>
          <div id="searchbox" style="display: none">
            <h3>Quick search</h3>
              <form class="search" action="../../../search.html" method="get">
                <input type="text" name="q" size="18" />
                <input type="submit" value="Go" />
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
              </form>
              <p class="searchtip" style="font-size: 90%">
              Enter search terms or a module, class or function name.
              </p>
          </div>
          <script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../modindex.html" title="Global Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../../devel/codebase/index.html" title="Codebase"
             >next</a> |</li>
        <li class="right" >
          <a href="../grobhandlers/index.html" title="Grobs"
             >previous</a> |</li>
    <li><a href="http://www.projectabjad.org/">Project Abjad</a> &raquo;</li>
    
        <li><a href="../../../index.html">Abjad v1.1.1 documentation</a> &raquo;</li>
 
      </ul>
    </div>
    <div class="footer">
      &copy; Copyright 2009, Víctor Adán, Trevor Bača.
      Last updated on Aug 05, 2009.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 0.6.2.
    </div>
  </body>
</html>