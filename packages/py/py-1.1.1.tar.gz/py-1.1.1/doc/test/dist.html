<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
  <head>
    <title>py.test dist</title>
    <meta content="text/html;charset=ISO-8859-1" name="Content-Type"/>
    <link href="../style.css" media="screen" rel="stylesheet" type="text/css"/></head>
  <body>
    <div id="navspace">
      <div><a href="http://pylib.org"><img alt="py lib" height="57" id="pyimg" src="http://codespeak.net/img/pylib.png" width="77"/></a></div>
      <div id="menubar">
        <div>
          <div><a class="menu" href="../announce/release-1.1.1.html">1.1.1 ANN</a></div></div>
        <div>
          <div><a class="menu" href="../install.html">INSTALL</a></div></div>
        <div>
          <div><a class="menu" href="../contact.html">CONTACT</a></div></div>
        <div>
          <div><a class="menu" href="../changelog.html">CHANGELOG</a></div></div>
        <div>
          <div><a class="menu" href="../faq.html">FAQ</a></div></div>
        <div>
          <div>
            <h3>py.test:</h3>
            <div><a class="menu" href="index.html">Index</a></div>
            <div><a class="menu" href="quickstart.html">Quickstart</a></div>
            <div><a class="menu" href="features.html">Features</a></div>
            <div><a class="menu" href="plugin/index.html">Plugins</a></div>
            <div><a class="menu" href="funcargs.html">Funcargs</a></div>
            <div><a class="menu" href="customize.html">Customize</a></div>
            <div><a class="menu" href="talks.html">Tutorials</a></div></div></div>
        <div>
          <div>
            <h3>supporting APIs:</h3>
            <div><a class="menu" href="../index.html">Index</a></div>
            <div><a class="menu" href="../path.html">py.path</a></div>
            <div><a class="menu" href="../code.html">py.code</a></div></div></div></div></div>
    <div id="contentspace">
<div class="document" id="distributed-testing">
<span id="distribute-tests-across-machines"></span>
<h1 class="title">Distributed testing</h1>

<p><tt class="docutils literal">py.test</tt> can ad-hoc distribute test runs to multiple CPUs or remote
machines.  This allows to speed up development or to use special resources
of remote machines.  Before running tests remotely, <tt class="docutils literal">py.test</tt> efficiently
synchronizes your program source code to the remote place.  All test results
are reported back and displayed to your local test session.  You may
specify different Python versions and interpreters.</p>
<p><strong>Requirements</strong>: you need to install the <a class="reference external" href="http://codespeak.net/execnet">execnet</a> package
(at least version 1.0.0b4) to perform distributed test runs.</p>
<p><strong>NOTE</strong>: Version 1.1.x is not able to distribute tests across Python3/Python2 barriers.</p>
<div class="section" id="speed-up-test-runs-by-sending-tests-to-multiple-cpus">
<h1>Speed up test runs by sending tests to multiple CPUs</h1>
<p>To send tests to multiple CPUs, type:</p>
<pre class="literal-block">
py.test -n NUM
</pre>
<p>Especially for longer running tests or tests requiring
a lot of IO this can lead to considerable speed ups.</p>
</div>
<div class="section" id="running-tests-in-a-python-subprocess">
<h1>Running tests in a Python subprocess</h1>
<p>To instantiate a python2.4 sub process and send tests to it, you may type:</p>
<pre class="literal-block">
py.test -d --tx popen//python=python2.4
</pre>
<p>This will start a subprocess which is run with the &quot;python2.4&quot;
Python interpreter, found in your system binary lookup path.</p>
<p>If you prefix the --tx option value like this:</p>
<pre class="literal-block">
--tx 3*popen//python=python2.4
</pre>
<p>then three subprocesses would be created and tests
will be load-balanced across these three processes.</p>
</div>
<div class="section" id="sending-tests-to-remote-ssh-accounts">
<h1>Sending tests to remote SSH accounts</h1>
<p>Suppose you have a package <tt class="docutils literal">mypkg</tt> which contains some
tests that you can successfully run locally. And you
have a ssh-reachable machine <tt class="docutils literal">myhost</tt>.  Then
you can ad-hoc distribute your tests by typing:</p>
<pre class="literal-block">
py.test -d --tx ssh=myhostpopen --rsyncdir mypkg mypkg
</pre>
<p>This will synchronize your <tt class="docutils literal">mypkg</tt> package directory
to an remote ssh account and then locally collect tests
and send them to remote places for execution.</p>
<p>You can specify multiple <tt class="docutils literal"><span class="pre">--rsyncdir</span></tt> directories
to be sent to the remote side.</p>
</div>
<div class="section" id="sending-tests-to-remote-socket-servers">
<h1>Sending tests to remote Socket Servers</h1>
<p>Download the single-module <a class="reference external" href="http://codespeak.net/svn/py/dist/py/execnet/script/socketserver.py">socketserver.py</a> Python program
and run it like this:</p>
<pre class="literal-block">
python socketserver.py
</pre>
<p>It will tell you that it starts listening on the default
port.  You can now on your home machine specify this
new socket host with something like this:</p>
<pre class="literal-block">
py.test -d --tx socket=192.168.1.102:8888 --rsyncdir mypkg mypkg
</pre>
</div>
<div class="section" id="running-tests-on-many-platforms-at-once">
<span id="atonce"></span><h1>Running tests on many platforms at once</h1>
<p>The basic command to run tests on multiple platforms is:</p>
<pre class="literal-block">
py.test --dist=each --tx=spec1 --tx=spec2
</pre>
<p>If you specify a windows host, an OSX host and a Linux
environment this command will send each tests to all
platforms - and report back failures from all platforms
at once.   The specifications strings use the <a class="reference external" href="http://codespeak.net/execnet/trunk/basics.html#xspec">xspec syntax</a>.</p>
</div>
<div class="section" id="specifying-test-exec-environments-in-a-conftest-py">
<h1>Specifying test exec environments in a conftest.py</h1>
<p>Instead of specifying command line options, you can
put options values in a <tt class="docutils literal">conftest.py</tt> file like this:</p>
<pre class="literal-block">
pytest_option_tx = ['ssh=myhost//python=python2.5', 'popen//python=python2.5']
pytest_option_dist = True
</pre>
<p>Any commandline <tt class="docutils literal"><span class="pre">--tx</span></tt> specifictions  will add to the list of available execution
environments.</p>
</div>
<div class="section" id="specifying-rsync-dirs-in-a-conftest-py">
<h1>Specifying &quot;rsync&quot; dirs in a conftest.py</h1>
<p>In your <tt class="docutils literal">mypkg/conftest.py</tt> you may specify directories to synchronise
or to exclude:</p>
<pre class="literal-block">
rsyncdirs = ['.', '../plugins']
rsyncignore = ['_cache']
</pre>
<p>These directory specifications are relative to the directory
where the <tt class="docutils literal">conftest.py</tt> is found.</p>
</div>
</div>
</div>
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-7597274-3");
pageTracker._trackPageview();
} catch(err) {}</script>
</body></html>