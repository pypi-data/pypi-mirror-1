<?xml version="1.0" encoding="iso-8859-1"?>
<D:multistatus xmlns:D="DAV:" xmlns:template="http://www.boddie.org.uk/ns/xmltools/template"
  template:element="items,table">

  <!-- Collections are generated only for non-leaf, non-collection-export resources. -->

  <D:response template:if="not(/items/@leaf = 'yes')">
    <D:href template:value="$path"></D:href>
    <D:propstat>
      <D:prop>
        <D:creationdate>2005-01-01T00:00:00Z</D:creationdate>
        <D:displayname template:value="$path"></D:displayname>
        <D:resourcetype>
          <D:collection/>
        </D:resourcetype>
      </D:prop>
      <D:status>HTTP/1.1 200 OK</D:status>
    </D:propstat>
  </D:response>

  <!-- Collection exports are described by a simple template. -->

  <D:response template:if="/items/@collection-export = 'yes'">
    <D:href template:value="$path"></D:href>
    <D:propstat>
      <D:prop>
        <D:creationdate>2005-01-01T00:00:00Z</D:creationdate>
        <D:displayname template:value="$path"></D:displayname>
        <D:resourcetype>
        </D:resourcetype>
        <D:getcontenttype>text/calendar</D:getcontenttype>
      </D:prop>
      <D:status>HTTP/1.1 200 OK</D:status>
    </D:propstat>
  </D:response>

  <!-- Items, whether in a collection or as leaf resources are fully described. -->

  <D:response template:element="item">
    <D:href template:if="not(/items/@leaf = 'yes')" template:value="concat($path, template:url-encode(template:url-encode(@item-value)))"></D:href>
    <D:href template:if="/items/@leaf = 'yes'" template:value="$path"></D:href>
    <D:propstat>
      <D:prop>
        <D:creationdate template:if="created/@datetime != ''" template:value="concat(substring(created/@datetime, 1, 4), '-', substring(created/@datetime, 5, 2), '-', substring(created/@datetime, 7, 2), 'T', substring(created/@datetime, 10, 2), ':', substring(created/@datetime, 12, 2), ':', substring(created/@datetime, 14, 2), 'Z', substring(created/@datetime, 17))"></D:creationdate>
        <D:displayname template:if="@item-type = 'calendar'" template:value="@name"></D:displayname>
        <D:displayname template:if="@item-type = 'event'" template:value="summary/@details"></D:displayname>
        <D:displayname template:if="@item-type = 'to-do'" template:value="summary/@details"></D:displayname>
        <D:displayname template:if="@item-type = 'card'" template:value="fn/@details"></D:displayname>
        <D:displayname template:if="@item-type = 'journal'" template:value="summary/@details"></D:displayname>
        <D:displayname template:if="@item-type = 'message'" template:value="body/@details"></D:displayname>
        <D:resourcetype>
          <D:collection template:if="/items/@items-are-containers = 'yes'"/>
        </D:resourcetype>
        <D:getcontenttype template:if="not(/items/@items-are-containers = 'yes') and @item-type = 'calendar'">text/calendar</D:getcontenttype>
        <D:getcontenttype template:if="not(/items/@items-are-containers = 'yes') and @item-type = 'event'">text/calendar</D:getcontenttype>
        <D:getcontenttype template:if="not(/items/@items-are-containers = 'yes') and @item-type = 'to-do'">text/calendar</D:getcontenttype>
        <D:getcontenttype template:if="not(/items/@items-are-containers = 'yes') and @item-type = 'card'">text/x-vcard</D:getcontenttype>
        <D:getcontenttype template:if="not(/items/@items-are-containers = 'yes') and @item-type = 'message'">text/plain</D:getcontenttype>
        <D:getcontentlength template:if="not(/items/@items-are-containers = 'yes')">0</D:getcontentlength>
      </D:prop>
      <D:status>HTTP/1.1 200 OK</D:status>
    </D:propstat>
  </D:response>
</D:multistatus>
