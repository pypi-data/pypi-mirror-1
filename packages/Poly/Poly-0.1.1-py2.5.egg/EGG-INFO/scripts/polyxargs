#!/ebi/research/software/Linux/opt/stow/python-2.5.1-shared/bin/python
# -*- python -*-
from __future__ import division

__version__ = "$Revision: 1.7 $"

import os
import socket
import sys

from autolog import autolog

_log = autolog()

POLYSUB_ARGS = ["polysub", "--superglobal"]

def default_jobname():
    return "%s.%s.polyxargs" % (socket.gethostname(), os.getpid())

def main(args):
    new_args = POLYSUB_ARGS[:]

    # XXX: should have some defaults here but will have to read the
    # data in for that
    # idea: call polysub --dynamic and get things out of the pickle file
    #if "-J" not in args:
    #    new_args.append("-J")
    #    new_args.append(default_jobname())

    new_args.extend(args)
    try:
        new_args.insert(new_args.index("--")+1, "polyxjob")
    except ValueError:
        _log.die("job specification did not include --")

    os.execvp("polysub", new_args)

def _test(*args, **keywds):
    import doctest
    doctest.testmod(sys.modules[__name__], *args, **keywds)

if __name__ == "__main__":
    if __debug__:
        _test()
    sys.exit(main(sys.argv[1:]))
