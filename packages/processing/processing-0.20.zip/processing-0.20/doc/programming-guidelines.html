<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.4: http://docutils.sourceforge.net/" />
<title>Programming guidelines</title>
<link rel="stylesheet" href="html4css1.css" type="text/css" />
</head>
<body>
<div class="header">
<a class="reference" href="connection-ref.html">Prev</a> &nbsp; &nbsp; &nbsp; &nbsp; <a class="reference" href="index.html">Up</a> &nbsp; &nbsp; &nbsp; &nbsp; <a class="reference" href="tests.html">Next</a>
<hr class="header"/>
</div>
<div class="document" id="programming-guidelines">
<h1 class="title">Programming guidelines</h1>
<p>There are certain guidelines and idioms which should be adhered to
when using the <tt class="docutils literal"><span class="pre">processing</span></tt> package.</p>
<p>Platforms such as Windows which lack <tt class="docutils literal"><span class="pre">os.fork()</span></tt> have a few extra
gotchas.</p>
<div class="section">
<h1><a id="all-platforms" name="all-platforms">All platforms</a></h1>
<dl class="docutils">
<dt><em>Picklability</em>:</dt>
<dd>Ensure that the arguments to the methods of proxies are
picklable.</dd>
<dt><em>Shutting down manager</em>:</dt>
<dd><p class="first">Make sure that the manager's <tt class="docutils literal"><span class="pre">shutdown()</span></tt> method is eventually
called.</p>
<p class="last"><tt class="docutils literal"><span class="pre">shutdown()</span></tt> will be called automatically if the manager is
garbage collected or if it is used with the <tt class="docutils literal"><span class="pre">with</span></tt> statement.</p>
</dd>
<dt><em>Thread safety of proxies</em>:</dt>
<dd><p class="first">Do not use a proxy from more than one thread unless you protect it
with a lock.</p>
<p>Alternatively another copy of the proxy can be created using the
<tt class="docutils literal"><span class="pre">copy.copy()</span></tt> function.</p>
<p class="last">(There is never a problem with different processes using the
same proxy.)</p>
</dd>
</dl>
</div>
<div class="section">
<h1><a id="platforms-without-os-fork" name="platforms-without-os-fork">Platforms without <tt class="docutils literal"><span class="pre">os.fork()</span></tt></a></h1>
<dl class="docutils">
<dt><em>More picklability</em>:</dt>
<dd><p class="first">Ensure that all arguments to <tt class="docutils literal"><span class="pre">Process.__init__()</span></tt> are picklable.</p>
<p class="last">Also, if you subclass <tt class="docutils literal"><span class="pre">Process</span></tt> then make sure that instances
will be picklable when the <tt class="docutils literal"><span class="pre">start()</span></tt> method is called.</p>
</dd>
<dt><em>Global variables</em>:</dt>
<dd><p class="first">Bear in mind that if code run in a child process tries to access a
global variable, then the value it sees (if any) may not be the
same as the value in the parent process at the time that
<tt class="docutils literal"><span class="pre">start()</span></tt> was called.</p>
<p class="last">Global variables which are just module level constants cause no
problems.</p>
</dd>
<dt><em>Safe importing</em>:</dt>
<dd><p class="first">Make sure that the module containing the target of a <tt class="docutils literal"><span class="pre">Process</span></tt>
instance (or the definition of a subclass of <tt class="docutils literal"><span class="pre">Process</span></tt> you are
using) can be safely imported by a new Python interpreter without
causing side effects (such a starting a new process).</p>
<p>For example, under Windows running the following module would
recursively create new processes until you get a crash:</p>
<pre class="literal-block">
import processing

def foo():
    print 'hello'

p = processing.Process(target=foo)
p.start()
p.join()
</pre>
<p>Instead one should protect creation of the new process by using
<tt class="docutils literal"><span class="pre">if</span> <span class="pre">__name__</span> <span class="pre">==</span> <span class="pre">'__main__':</span></tt> as follows:</p>
<pre class="literal-block">
import processing

def foo():
    print 'hello'

if __name__ == '__main__':
    p = processing.Process(target=foo)
    p.start()
    p.join()
</pre>
<p class="last">This allows the newly spawned Python interpreter to safely import
the module and then run the module's <tt class="docutils literal"><span class="pre">foo()</span></tt> function.</p>
</dd>
</dl>
</div>
</div>
<div class="footer">
<hr class="footer" />
<a class="reference" href="connection-ref.html">Prev</a> &nbsp; &nbsp; &nbsp; &nbsp; <a class="reference" href="index.html">Up</a> &nbsp; &nbsp; &nbsp; &nbsp; <a class="reference" href="tests.html">Next</a>
</div>
</body>
</html>
