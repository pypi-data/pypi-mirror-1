<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>TurboGears &mdash; PyAMF - AMF for Python</title>
    <link rel="stylesheet" href="../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '0.5.1',
        COLLAPSE_MODINDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="search" type="application/opensearchdescription+xml"
          title="Search within PyAMF - AMF for Python"
          href="../../_static/opensearch.xml"/>
    <link rel="shortcut icon" href="../../_static/pyamf.ico"/>
    <link rel="author" title="About these documents" href="../../about.html" />
    <link rel="copyright" title="Copyright" href="../../copyright.html" />
    <link rel="top" title="PyAMF - AMF for Python" href="../../index.html" />
    <link rel="up" title="Gateways" href="index.html" />
    <link rel="next" title="Buildbot" href="buildbot.html" />
    <link rel="prev" title="CherryPy" href="cherrypy.html" /> 
  </head>
  <body>  

    <div class="document">
<div>
<a class="toplogo" href="../../index.html"><img src="../../_static/logo.png" border="0"/></a>
</div>

      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="turbogears">
<h1>TurboGears<a class="headerlink" href="#turbogears" title="Permalink to this headline">¶</a></h1>
<img alt="../../_images/turbogears-logo.png" src="../../_images/turbogears-logo.png" />
<div class="topic">
<p class="topic-title first">Introduction</p>
<p>PyAMF provides a simple WSGI Application that can be used to setup RPC
style service easily in Python. Because
<a class="reference external" href="http://turbogears.org">TurboGears2</a> supports WSGI from top-to-bottom,
it&#8217;s very simple to setup a TG2 app that contains web-services for your
Flex and Flash applications.</p>
</div>
<div class="section" id="install-turbogears">
<h2>Install TurboGears<a class="headerlink" href="#install-turbogears" title="Permalink to this headline">¶</a></h2>
<p>If you haven&#8217;t installed
<a class="reference external" href="http://docs.turbogears.org/2.0/main/DownloadInstall">TG2</a>, you&#8217;ll need
to do that first. After that&#8217;s done, you can create a new TG2 project in the
normal way:</p>
<div class="highlight-python"><pre>paster quickstart pyamftest
cd pyamftest
paster serve development.ini --reload</pre>
</div>
<p>Your project should now be started, and you should be able to browse to it
at <a class="reference external" href="http://127.0.0.1:8080">http://127.0.0.1:8080</a>.</p>
</div>
<div class="section" id="creating-the-pyamf-gateway">
<h2>Creating the PyAMF gateway<a class="headerlink" href="#creating-the-pyamf-gateway" title="Permalink to this headline">¶</a></h2>
<p>Now, you&#8217;re ready to start creating a PyAMF gateway for your Flex app. The
first thing to do is to create a new <tt class="docutils literal"><span class="pre">mygateway.py</span></tt> file wherever you want
it:</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30</pre></td><td class="code"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">logging</span>

<span class="kn">from</span> <span class="nn">pyamf.remoting.gateway.wsgi</span> <span class="kn">import</span> <span class="n">WSGIGateway</span>


<span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span>
    <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">,</span>
    <span class="n">format</span><span class="o">=</span><span class="s">&#39;</span><span class="si">%(asctime)s</span><span class="s"> </span><span class="si">%(levelname)-5.5s</span><span class="s"> [</span><span class="si">%(name)s</span><span class="s">] </span><span class="si">%(message)s</span><span class="s">&#39;</span>
<span class="p">)</span>


<span class="k">class</span> <span class="nc">Services</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">echo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&quot;Turbogears gateway says:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">sum</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>

    <span class="k">def</span> <span class="nf">scramble</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">shuffle</span>
        <span class="n">s</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">text</span><span class="p">]</span>
        <span class="n">shuffle</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="k">return</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>


<span class="c"># Expose our services</span>
<span class="n">services</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;Services&quot;</span> <span class="p">:</span> <span class="n">Services</span><span class="p">()}</span>

<span class="n">GatewayController</span> <span class="o">=</span> <span class="n">WSGIGateway</span><span class="p">(</span><span class="n">services</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logging</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>This sets up a GatewayController WSGI app that has three services that
can be called from Flex: <tt class="docutils literal"><span class="pre">echo</span></tt>, <tt class="docutils literal"><span class="pre">sum</span></tt>, and <tt class="docutils literal"><span class="pre">scramble</span></tt>, which each do
exactly what they say they do.</p>
</div>
<div class="section" id="setup-a-controller">
<h2>Setup a controller<a class="headerlink" href="#setup-a-controller" title="Permalink to this headline">¶</a></h2>
<p>Then you can import your <tt class="docutils literal"><span class="pre">GatewayController</span></tt> into <tt class="docutils literal"><span class="pre">root.py</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">tg</span> <span class="kn">import</span> <span class="n">use_wsgi_app</span>
<span class="kn">from</span> <span class="nn">mygateway</span> <span class="kn">import</span> <span class="n">GatewayController</span>
</pre></div>
</div>
<p>Now all you have to do is add a method that delegates to the wsgi app:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nd">@expose</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">gateway</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">use_wsgi_app</span><span class="p">(</span><span class="n">GatewayController</span><span class="p">)</span>
</pre></div>
</div>
<p>Of course, you&#8217;ll need to import <tt class="docutils literal"><span class="pre">use_wsgi_app</span></tt> from <tt class="docutils literal"><span class="pre">tg</span></tt>, and your
<tt class="docutils literal"><span class="pre">GatewayController</span></tt> from wherever you put it. But once you&#8217;ve done those
things you&#8217;ll have a AMF Gateway mounted at <tt class="docutils literal"><span class="pre">/gateway</span></tt> which you can approach
from Flex.</p>
</div>
<div class="section" id="create-a-flex-client">
<h2>Create a Flex Client<a class="headerlink" href="#create-a-flex-client" title="Permalink to this headline">¶</a></h2>
<p>Now we&#8217;re ready for the big time event, we can create a brand new Flex client
which talks to our TG2 hosted PyAMF services. This little tutorial pretty much
assumes that you know how to use Flex and just want to see how to connect it to
a TurboGears app.</p>
<p>Here&#8217;s the MXML:</p>
<div class="highlight-xml"><table class="highlighttable"><tr><td class="linenos"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43</pre></td><td class="code"><div class="highlight"><pre><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span>
<span class="nt">&lt;mx:Application</span> <span class="na">xmlns:mx=</span><span class="s">&quot;http://www.adobe.com/2006/mxml&quot;</span> <span class="na">horizontalAlign=</span><span class="s">&quot;left&quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;mx:RemoteObject</span> <span class="na">endpoint=</span><span class="s">&quot;http://127.0.0.1:8080/gateway&quot;</span> 
                     <span class="na">destination=</span><span class="s">&quot;Services&quot;</span> <span class="na">id=</span><span class="s">&quot;remoteObj&quot;</span>
                     <span class="na">result=</span><span class="s">&quot;displayResult(event)&quot;</span> <span class="na">fault=</span><span class="s">&quot;remoteFault(event)&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;mx:method</span> <span class="na">name=</span><span class="s">&quot;scramble&quot;</span> <span class="na">result=</span><span class="s">&quot;scrambleResult(event)&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/mx:RemoteObject&gt;</span>

    <span class="nt">&lt;mx:Button</span> <span class="na">click=</span><span class="s">&quot;remoteObj.echo(&#39;Hello, There!&#39;)&quot;</span> <span class="na">label=</span><span class="s">&quot;Hello&quot;</span><span class="nt">/&gt;</span>

    <span class="nt">&lt;mx:HBox</span> <span class="na">width=</span><span class="s">&quot;100%&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;mx:Button</span> <span class="na">click=</span><span class="s">&quot;remoteObj.sum(new Number(a.text), new Number(b.text))&quot;</span> <span class="na">label=</span><span class="s">&quot;Sum&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;mx:TextInput</span> <span class="na">id=</span><span class="s">&quot;a&quot;</span> <span class="na">text=</span><span class="s">&quot;47&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;mx:TextInput</span> <span class="na">id=</span><span class="s">&quot;b&quot;</span> <span class="na">text=</span><span class="s">&quot;99&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/mx:HBox&gt;</span>
    <span class="nt">&lt;mx:HBox</span> <span class="na">width=</span><span class="s">&quot;100%&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;mx:Button</span> <span class="na">click=</span><span class="s">&quot;remoteObj.scramble(c.text)&quot;</span> <span class="na">label=</span><span class="s">&quot;Scramble&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;mx:TextInput</span> <span class="na">id=</span><span class="s">&quot;c&quot;</span> <span class="na">text=</span><span class="s">&quot;She sells seashells by the seashore&quot;</span> <span class="na">width=</span><span class="s">&quot;100%&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/mx:HBox&gt;</span>

    <span class="nt">&lt;mx:Text</span> <span class="na">id=</span><span class="s">&quot;result&quot;</span> <span class="na">width=</span><span class="s">&quot;100%&quot;</span> <span class="na">height=</span><span class="s">&quot;100%&quot;</span> <span class="nt">/&gt;</span>

    <span class="nt">&lt;mx:Script&gt;</span>
    <span class="cp">&lt;![CDATA[</span>
<span class="cp">        import mx.utils.ObjectUtil;</span>
<span class="cp">        import mx.rpc.events.ResultEvent;</span>
<span class="cp">        import mx.rpc.events.FaultEvent;</span>

<span class="cp">        private function displayResult(re:ResultEvent): void {</span>
<span class="cp">            result.text += ObjectUtil.toString(re.result) + &quot;\n&quot;;</span>
<span class="cp">        }</span>

<span class="cp">        private function scrambleResult(re:ResultEvent): void {</span>
<span class="cp">            c.text = re.result as String;</span>
<span class="cp">        }</span>

<span class="cp">        private function remoteFault(fault:FaultEvent): void {</span>
<span class="cp">            result.text = fault.fault.faultDetail;</span>
<span class="cp">        }</span>
<span class="cp">    ]]&gt;</span>
    <span class="nt">&lt;/mx:Script&gt;</span>
<span class="nt">&lt;/mx:Application&gt;</span>
</pre></div>
</td></tr></table></div>
<p>You can paste that into a new Flex Builder project (or use the free SDK to create
a project with the text editor of your choice).  You can then put the HTML and SWF
files generated by Flex Builder into your TG2 project&#8217;s static directory (wherever
you want them to be available) at which point you should be able to browse there,
get your Flex app, and use it to connect to the web services you just created.</p>
</div>
</div>


          </div>
        </div>
      </div>

      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <h3><a href="../../contents.html">Table Of Contents</a></h3>
            <ul>
<li><a class="reference external" href="">TurboGears</a><ul>
<li><a class="reference external" href="#install-turbogears">Install TurboGears</a></li>
<li><a class="reference external" href="#creating-the-pyamf-gateway">Creating the PyAMF gateway</a></li>
<li><a class="reference external" href="#setup-a-controller">Setup a controller</a></li>
<li><a class="reference external" href="#create-a-flex-client">Create a Flex Client</a></li>
</ul>
</li>
</ul>

            <h4>Previous topic</h4>
            <p class="topless"><a href="cherrypy.html"
                                  title="previous chapter">CherryPy</a></p>
            <h4>Next topic</h4>
            <p class="topless"><a href="buildbot.html"
                                  title="next chapter">Buildbot</a></p>
            <h3>This Page</h3>
            <ul class="this-page-menu">
              <li><a href="../../_sources/tutorials/gateways/turbogears.txt"
                     rel="nofollow">Show Source</a></li>
            </ul>
          <div id="searchbox" style="display: none">
            <h3>Quick search</h3>
              <form class="search" action="../../search.html" method="get">
                <input type="text" name="q" size="18" />
                <input type="submit" value="Go" />
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
              </form>
              <p class="searchtip" style="font-size: 90%">
              Enter search terms or a module, class or function name.
              </p>
          </div>
          <script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
<div class="footer">
Copyright &#169; 2007-2009 The <a href='http://pyamf.org'>PyAMF</a> Project
</div>

  </body>
</html>