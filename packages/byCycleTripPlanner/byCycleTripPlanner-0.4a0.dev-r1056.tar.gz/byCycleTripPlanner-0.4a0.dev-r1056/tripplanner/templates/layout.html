## -*- coding: UTF-8 -*-
% if not c.wrap:
  ${next.body()}
% else:
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  ${h.if_ie('<xml:namespace ns="urn:schemas-microsoft-com:vml" prefix="v"/>')}


  <head>
    <meta http-equiv="Content-Type" content="application/xhtml+xml; charset=utf-8" />

    <meta name="author" content="Wyatt Baldwin, wyatt@byCycle.org" />

    <meta name="keywords" content="bicycle, bike, bicycle trip planner, bicycle route finder, bike trip planner, bike route finder, bicycle route, bicycle trip, bike route, bike trip, bicycle routing, bike routing, maps, bicycle maps, bike maps, bicycle advocacy, community, sustainability, portland, oregon, milwaukee, wisconsin" />

    <meta name="description" content="byCycle.org Bicycle Trip Planner -- A web-based, interactive, bicycle trip planner (route finder) for the Portland, Oregon, Milwaukee, Wisconsin, and, soon, other regions." />

    <title>byCycle.org - Bicycle Trip Planner - ${self.region_title()}</title>

    ${h.stylesheet_link('/stylesheets/base.css')}
    ${h.if_ie(h.stylesheet_link('/stylesheets/base_ie.css'))}
    ${h.stylesheet_link('/javascripts/OpenLayers-2.6/theme/default/style.css')}
    ${h.stylesheet_link('/stylesheets/print.css', media='print')}
    ${self.stylesheet_links()}

    <link rel="stylesheet" href="http://dev.jquery.com/view/tags/ui/latest/themes/flora/flora.all.css" type="text/css" media="screen" title="Flora (Default)">

    <script type="text/javascript">
      //<![CDATA[
      // Global setup
      var debug = ${'true' if bool(g.debug) else 'false'};
      byCycle_prefix = '${h.url_for('/')}';
      //]]>
    </script>
  </head>


  <body>


    <div id="wrapper">


      <!-- Header -->
      <div id="header">
        <a href="http://info.bycycle.org/about" title="About byCycle.org">About</a>
      </div>
      <!-- /Header -->


      <!-- Content -->
      <div id="content">


        <!-- Column A -->
        <div id="col-a">


          <!-- Controls -->
            <ul id="controls" class="ui-accordion-container">
              <!--<li>
                <a href="#">byCycle.org</a>

                <div>
                  Welcome to the byCycle.org bicycle trip planner.
                </div>
              </li>-->

              <li id="search-the-map">
                <a href='#'>Search the Map</a>

                <div>
                  <form id="query_form" method="get" action="/regions/portlandor/services/find">
                    <div>
                      <input id="q" type="text" value="" title="Enter an address or route" tabindex="1" name="q"/>
                      <input type="submit" value="Search Map" title="Click to search the map" tabindex="2" name="commit"/>
                    </div>
                    <div class="input_label"> Enter an address or intersection -OR- pick a location from the map. </div>
                  </form>

                  <div id="locations"
                       class="${'selected-' if c.service == 'geocodes' else ''}tab-content">
                    % if c.service == 'geocodes' and c.http_status == 200:
                      <div class="fragment">
                        ${self.json()}
                        ${next.body()}
                      </div>
                    % endif
                    <ul id="location_list" class="result_list"><!-- INTENTIONALLY EMPTY --></ul>
                  </div>
                </div>
              </li>

              <li id="find-a-route">
                <a href="#">Find a Route</a>

                <div>
                  <form id="route_form" method="get" action="/regions/portlandor/routes/find">
                    <div>
                      <input id="s" type="text" value="" title="Enter start address" tabindex="3" name="s"/>
                      <br />
                      <input id="e" type="text" value="" title="Enter end address" tabindex="5" name="e"/>
                      <br />
                      <select id="pref" tabindex="8" name="pref">
                        <option value="default">- Route Type -</option>
                        <option value="default">Normal</option>
                        <option value="safer">Safer</option>
                      </select>
                      <br />
                      <input type="submit" value="Find Route" title="Click to find a route" tabindex="9" name="commit"/>
                    </div>
                    <div class="input_label"> Enter your start and end addresses and, optionally, select a route type. </div>
                  </form>

                  <div id="routes">
                    % if c.service == 'routes' and c.http_status == 200:
                      <div class="fragment">
                        ${self.json()}
                        ${next.body()}
                      </div>
                    % endif
                    <p>
                      <b>Disclaimer</b>: As you are riding, please keep in mind that you
                      don't <i>have</i> to follow the suggested route. <i>It may not be
                      safe at any given point.</i> If you see what looks like an unsafe or
                      undesirable stretch in the suggested route, you can decide to walk,
                      ride on the sidewalk, or go a different way.
                    </p>
                    <p>
                      Users should independently verify all information presented here.
                      This service is provided <b>AS IS</b> with <b>NO WARRANTY</b> of any
                      kind.
                    </p>
                  </div>
                </div>
              </li>

              <li id="errors">
                <a href="#">Errors</a>
                <ul></ul>
              </li>
            </ul>
          <!-- /Controls -->


        </div>
        <!-- /Column A -->


        <!-- Column B -->
        <div id="col-b">


          <!-- Map -->
          <div id="map_pane">
            <div id="map_message" style="display: none; padding: 5px;">
              You will need to update to a recent version of Internet Explorer, Firefox, or Safari to view the map.
            </div>
          </div>
          <!-- /Map -->


        </div>
        <!-- /Column B -->


        <div class="clear"></div>
      </div>
      <!-- /Content -->


      <div id="spinner" class="spinner noprint">
        ${h.image('spinner.gif', width=16, height=16, alt='Click to hide')}
      </div>


    </div>
    <!-- /Wrapper -->

    ${h.javascript_link('/javascripts/jquery.js', '/javascripts/jquery-ui.js')}
    ${h.javascript_link('/javascripts/util.js', '/javascripts/bycycle.js')}
    ${h.javascript_link('/javascripts/map.js')}
    <script type="text/javascript">
      //<![CDATA[
      window.$ = null;  // In case the map's JS library uses $
      util.writeScript('/javascripts/' + byCycle.config.map_type + '.js');
      //]]>
    </script>
    ${h.javascript_link('/javascripts/ui.js', '/javascripts/regions.js')}
    ${h.javascript_link('/javascripts/query.js', '/javascripts/result.js')}


    <script type="text/javascript">
      //<![CDATA[
      window.$j = jQuery.noConflict();
      byCycle.UI.beforeLoad();
      byCycle.UI.service = '${c.service}';
      byCycle.UI.member_name = '${c.member_name}';
      byCycle.UI.collection_name = '${c.collection_name}';
      byCycle.UI.region_id = '${c.region.slug if c.region else ""}';
      byCycle.UI.http_status = ${'%i' % c.http_status if c.http_status else 'undefined'};
      byCycle.UI.q = '${c.q}';
      //]]>
    </script>


    <!-- TODO: Maybe we could get this dynamically the first time it's needed? -->
    <%include file="/widgets/center_marker.html" />

    ##<%include file="_google_analytics.html" />
  </body>
</html>


<%namespace file="/widgets/fixed-pane.html" import="fixed_pane" />

<%def name="region_title()">
  ${c.region.title if c.region else 'Select a region'}
</%def>

<%def name="stylesheet_links()"></%def>

<%def name="input_container(classes=[])">
  <!-- Input Container -->
  <div id="input_container" class="noprint ${' '.join(classes)}">
    % if caller:
      ${caller.body()}
    % endif
  </div>
  <!-- /Input Container -->
</%def>

<%def name="links()"></%def>

<%def name="result_pane(classes=[])">
  <!-- Result Pane -->
  <div id="result_pane" class="display-pane ${' '.join(classes)}">
    % if caller:
      ${caller.body()}
    % endif
  </div>
  <!-- /Result Pane -->
</%def>

<%def name="map_controls()"></%def>
<%def name="javascript_includes()"></%def>
<%def name="javascript()"></%def>

<%def name="errors()">
  <div class="errors">
    <h2>${getattr(c.exception, 'title', 'Error')}</h2>
    % if hasattr(c.exception, 'errors'):
      % for error in c.exception.errors:
        <p class="error">
          ${error}
        </p>
      % endfor
    % else:
      <p class="error">
        ${c.exception.description}
      </p>
    % endif
    <% explanation = getattr(c.exception, 'explanation', None) %>
    % if explanation is not None:
      <div class="explanation">
        <h3>What This Means</h3>
        <p>${explanation.strip().replace('\n', '</p><p>')}</p>
      </div>
    % endif
  </div>
</%def>

<!-- Route preference form control -->
<%def name='route_pref()'>
  % if c.region.slug == 'portlandor':
    <select id="pref" name="pref" tabindex="8">
      <option value="default">- Route Type -</option>
      <option value="default">Normal</option>
      <option value="safer">Safer</option>
    </select>
  % endif
</%def>

<%def name="json()">
  % if c.format != 'json':
    ${h.hidden_field(None, value=c.json, class_='json')}
  % endif
</%def>

% endif ## if not c.wrap
