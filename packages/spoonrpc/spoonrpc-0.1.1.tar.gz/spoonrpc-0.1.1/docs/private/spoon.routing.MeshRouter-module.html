<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
          "DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>spoon.routing.MeshRouter</title>
  <link rel="stylesheet" href="epydoc.css" type="text/css"></link>
</head>
<body bgcolor="white" text="black" link="blue" vlink="#204080"
      alink="#204080">

<!-- =========== START OF NAVBAR =========== -->
<table class="navbar" border="0" width="100%" cellpadding="0" bgcolor="#a0c0ff" cellspacing="0">
  <tr valign="center">
    <th class="navbar">&nbsp;&nbsp;&nbsp;<a class="navbar" href="spoon-module.html">Home</a>&nbsp;&nbsp;&nbsp;</th>
    <th class="navbar">&nbsp;&nbsp;&nbsp;<a class="navbar" href="trees.html">Trees</a>&nbsp;&nbsp;&nbsp;</th>
    <th class="navbar">&nbsp;&nbsp;&nbsp;<a class="navbar" href="indices.html">Index</a>&nbsp;&nbsp;&nbsp;</th>
    <th class="navbar">&nbsp;&nbsp;&nbsp;<a class="navbar" href="help.html">Help</a>&nbsp;&nbsp;&nbsp;</th>
    <th class="navbar" width="100%"></th>
  </tr>
</table>
<table width="100%" cellpadding="0" cellspacing="0">
  <tr valign="top">
    <td width="100%">
      <font size="-1"><b class="breadcrumbs">
        <a href="spoon-module.html">Package&nbsp;spoon</a> ::
        <a href="../private/spoon.routing-module.html">Package&nbsp;routing</a> ::
        Module&nbsp;MeshRouter
      </b></font></br>
    </td>
    <td><table cellpadding="0" cellspacing="0">
      <tr><td align="right"><font size="-2">[<b>show&nbsp;private</b>&nbsp;|&nbsp;hide&nbsp;private]</font></td></tr>
      <tr><td align="right"><font size="-2">[<a href="frames.html"target="_top">frames</a>&nbsp;|&nbsp;<a href="../private/spoon.routing.MeshRouter-module.html" target="_top">no&nbsp;frames</a>]</font></td></tr>
    </table></td>
</tr></table>

<!-- =========== START OF MODULE DESCRIPTION =========== -->
<h2 class="module">Module spoon.routing.MeshRouter</h2>

<p>Mesh Routing, this is the protocol by which an ad-hoc network of nodes 
can be created and how messages may be passed between them.</p>
<p>Routing in SpoonRPC</p>
Baseline:
<ul>
  <li>
    a network of nodes (each node is probably a server)
  </li>
  <li>
    nodes are connected directly to each other by links (probably 
    TCP)
  </li>
  <li>
    from node A to node B, there may be more than one direct route 
    (redundant paths are okay, encouraged in fact, to avoid pitfalls of 
    IRC)
  </li>
</ul>
<p>Route tracking</p>
<p>Each node tracks -- for every other node in the network -- how many 
hops it is to that node, and which link is used to get there.</p>
<p>New links</p>
<p>When a node gains a new link, it sends a message to each of its other 
links announcing the new hop-count for this new link (&quot;Node T, 1 
hop&quot;). Each link compares this with any existing route for T, and if 
the hop count is smaller, the route entry is replaced and a new hop count 
message is sent to each of its local links (except the one it received 
the original message from). In this way, the new route will propagate. 
When such a message loops back on itself around a redundant link, it will 
be discarded because the hop count will be larger than the one already 
stored.</p>
<p>If the hop count is larger, but the link making the announcement is 
the link already in this node's route table, then the route's hop-count 
is changed and the message is propagated anyway. (It means the node's 
route is now longer than it was, or possibly infinite.)</p>
<p>An example may help: Node A is linked directly to B and C. It has a 
route to node X through B, with 4 hops. (All it stores for &quot;X&quot; 
is &quot;B, 4 hops&quot;.) If it receives a message from C saying &quot;X 
is 2 hops for me&quot; then it will change X's route to &quot;C, 3 
hops&quot; and send this new route to its other local links (like B). If, 
on the other hand, C says &quot;X is 5 hops for me&quot; then A will 
ignore the message. If A receives a message from B saying &quot;X is 5 
hops for me&quot; then A changes its route to &quot;B, 6 hops&quot; and 
sends this new route to all local links.</p>
<p>Once a new link is established, the two newly connected nodes will 
each send the other a hopcount update message containing all of the nodes 
each knows about. In the case of a node with no connections to the 
network, connecting to a node with connections, this will make the new 
node aware of all of the nodes that are available. In the case of a link 
forming between two existing networks (or perhaps fragments of a previous 
network that got disconnected), these messages will cause the two 
networks to be made fully aware of eachother.</p>
<p>Dead links</p>
<p>When a node drops a link, it sends out a message to all other links 
announcing the hop-count for the dead route as &quot;infinity&quot;. 
(This can be represented as 0, -1, maxint, or whatever.) If a link 
receives an &quot;infinity&quot; route for node X from the link that is 
its current route to X, then the node must drop that route and propagate 
the &quot;infinity&quot; route to all its other links. In this way, if 
that was the only route to X, everyone will eventually drop the route and 
have X unreachable.</p>
<p>If a node receives an &quot;infinity&quot; route for node X from a 
link that is not its current route to X, it should immediately propagate 
its current route to that link. This will end up being propagated as if 
it were a new link (this is really just good neighbor policy.)</p>
This rerouting mechanism may leave some nodes with inefficient 
(winding) routes to nodes that move around. So the &quot;good 
neighbor&quot; policy dictates that when you have a route to X, and a 
link that is not your route sends you info about a much longer route (at 
least 2 hops longer than yours), you turn around and tell this link about 
your route.
<hr/>

<!-- =========== START OF CLASSES =========== -->
<table class="summary" border="1" cellpadding="3" cellspacing="0" width="100%" bgcolor="white">
<tr bgcolor="#70b0f0" class="summary">
  <th colspan="2">Classes</th></tr>
<tr><td width="15%">
  <b><a href="../private/spoon.routing.MeshRouter.MeshRouter-class.html"><code>MeshRouter</code></a></b></td>
  <td>This class handles LMTYPE_NETWORK messages and LMTYPE_NETWORK_PROTO 
messages.</td></tr>
</table><br />


<!-- =========== START OF EXCEPTIONS =========== -->
<table class="summary" border="1" cellpadding="3" cellspacing="0" width="100%" bgcolor="white">
<tr bgcolor="#70b0f0" class="summary">
  <th colspan="2">Exceptions</th></tr>
<tr><td width="15%">
  <b><a href="../private/spoon.routing.MeshRouter.NodeUnreachable-class.html"><code>NodeUnreachable</code></a></b></td>
  <td>Raised when trying to send to a node that is not currently 
reachable.</td></tr>
<tr><td width="15%">
  <b><a href="../private/spoon.routing.MeshRouter.RoutingProtocolError-class.html"><code>RoutingProtocolError</code></a></b></td>
  <td>&nbsp;</td></tr>
</table><br />


<!-- =========== START OF FUNCTION SUMMARY =========== -->
<table class="summary" border="1" cellpadding="3" cellspacing="0" width="100%" bgcolor="white">
<tr bgcolor="#70b0f0" class="summary">
  <th colspan="2">Function Summary</th></tr>
<tr><td align="right" valign="top" width="15%"><font size="-1">&nbsp;</font></td>
  <td><code><a name="decode_netmessage"></a><span class="summary-sig"><span class="summary-sig-name">decode_netmessage</span>(<span class=summary-sig-arg>fd</span>,
          <span class=summary-sig-arg>tag</span>)</span></code>
</td></tr>
<tr><td align="right" valign="top" width="15%"><font size="-1">&nbsp;</font></td>
  <td><code><a name="encode_netmessage"></a><span class="summary-sig"><span class="summary-sig-name">encode_netmessage</span>(<span class=summary-sig-arg>fd</span>,
          <span class=summary-sig-arg>obj</span>)</span></code>
</td></tr>
</table><br />


<!-- =========== START OF VARIABLE SUMMARY =========== -->
<table class="summary" border="1" cellpadding="3" cellspacing="0" width="100%" bgcolor="white">
<tr bgcolor="#70b0f0" class="summary">
  <th colspan="2">Variable Summary</th></tr>
<tr><td align="right" valign="top" width="15%"><font size="-1"><code>int</code></font></td>
<td><b><a href="../private/spoon.routing.MeshRouter-module.html#INFINITY"><code>INFINITY</code></a></b> = <span title="2147483647">2147483647&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>
</table><br />


<!-- =========== START OF VARIABLE DETAILS =========== -->
<table class="details" border="1" cellpadding="3" cellspacing="0" width="100%" bgcolor="white">
<tr bgcolor="#70b0f0" class="details">
  <th colspan="2">Variable Details</th></tr>
</table>
<table width="100%" class="var-details" bgcolor="#e0e0e0"><tr><td>
<a name="INFINITY"></a>
<h3>INFINITY</h3>
<dl>
  <dt></dt>
  <dd>
    <dl>
      <dt><b>Type:</b></dt>
      <dd>
          <code>int</code>

      </dd>
<span title="2147483647">      <dt><b>Value:</b></dt>
      <dd><table><tr><td>
<pre class="variable">
2147483647&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</pre>
        </td></tr></table></dd>
</span>    </dl>
  </dd>
</dl></td></tr></table>
<br />


<!-- =========== START OF NAVBAR =========== -->
<table class="navbar" border="0" width="100%" cellpadding="0" bgcolor="#a0c0ff" cellspacing="0">
  <tr valign="center">
    <th class="navbar">&nbsp;&nbsp;&nbsp;<a class="navbar" href="spoon-module.html">Home</a>&nbsp;&nbsp;&nbsp;</th>
    <th class="navbar">&nbsp;&nbsp;&nbsp;<a class="navbar" href="trees.html">Trees</a>&nbsp;&nbsp;&nbsp;</th>
    <th class="navbar">&nbsp;&nbsp;&nbsp;<a class="navbar" href="indices.html">Index</a>&nbsp;&nbsp;&nbsp;</th>
    <th class="navbar">&nbsp;&nbsp;&nbsp;<a class="navbar" href="help.html">Help</a>&nbsp;&nbsp;&nbsp;</th>
    <th class="navbar" width="100%"></th>
  </tr>
</table>

<table border="0" cellpadding="0" cellspacing="0" width="100%">
  <tr>
    <td align="left"><font size="-2">Generated by Epydoc 2.1 on Sun Nov 26 15:33:58 2006</font></td>
    <td align="right"><a href="http://epydoc.sourceforge.net"
                      ><font size="-2">http://epydoc.sf.net</font></a></td>
  </tr>
</table>
</body>
</html>
