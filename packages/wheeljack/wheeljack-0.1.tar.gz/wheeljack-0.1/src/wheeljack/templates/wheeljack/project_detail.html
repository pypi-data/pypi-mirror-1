{% extends "wheeljack/base.html" %}

{% block "content" %}
<h1>Project {{ object.name }}</h1>

<ul class="object-tools">
  <li>
    <a href="{% url edit_project object.id %}" class="editlink">
      Edit Project
    </a>
  </li>
  <li>
    <a href="{% url delete_project object.id %}" class="deletelink">
      Delete Project
    </a>
  </li>
</ul>


<div id="build-info">
  <table id="build-detail">
    <caption>Project info</caption>

    <tr>    
      <th>Repository</th>
      <td>{{ object.repository }}</td>
    </tr>

    <tr>    
      <th>Build command</th>
      <td>{{ object.build_cmd }}</td>
    </tr>

    <tr>    
      <th>Watch list</th>
      <td>
        {% for email in object.watch_list.split %}
        {{ email }}{% if not forloop.last %},{% endif %}
        {% endfor %}
      </td>
    </tr>

    <tr>
      <th colspan="2" class="caption">Build info</th>
    </tr>

    <tr>    
      <th>Revision</th>
      <td>{{ buildlog.revision }}</td>
    </tr>

    <tr>    
      <th>Build state</th>
      {% if buildlog.success %}
      <td class="success">OK</td>
      {% else %}
      <td class="failed">FAILED</td>
      {% endif %}
    </tr>

    <tr>    
      <th>Last build</th>
      <td>{{ buildlog.end|date:"r" }}</td>
    </tr>

    <tr>    
      <th>Build time</th>
      {% with buildlog.start as start %}
      <td>{{ buildlog.end|timesince:start }}</td>
      {% endwith %}
    </tr>

    <tr>
      <th>Build output</th>
      <td>
        <code>{{ buildlog.output }}</code>
      </td>
    </tr>
  </table>

  <table cellspacing="0" id="build-listing">
    <caption>All builds</caption>
    <thead>
      <th>Revision</th><th>Build state</th><th>Finished at</th><th>Build time</th>
    </thead>
    
    {% for build in object.buildlog_set.all %}
    <tr>
      <th>
        <a href="{% url wheeljack.views.project_detail object.id build.id %}">
          {{ build.revision }}
        </a>
      </th>
      {% if build.success %}
      <td class="success">OK</td>
      {% else %}
      <td class="failed">FAILED</td>
      {% endif %}
      <td>
        {{ build.end|date:"r" }}
      </td>
      <td>{{ build.end|timesince:build.start }}</td>
    </tr>
    {% endfor %}

  </table>

</div>
{% endblock %}
