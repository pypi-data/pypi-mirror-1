{% extends "base.html" %}
{% load i18n %}

{% block "content" %}

<h1>Select project</h1>

<div id="content-main">

  <ul class="object-tools">
    <li>
      <a href="{% url add_project %}" class="addlink">
        Add Project
      </a>
    </li>
  </ul>

  <div class="module filtered" id="changelist">
    <div id="toolbar">
      <form id="changelist-search" action="" method="get">
        <div>
          {% for key, value in request.GET.iteritems %}
          {% ifnotequal key "q" %}
          <input type="hidden" name="{{ key }}" value="{{ value }}" />
          {% endifnotequal %}
          {% endfor %}
          <input type="text" size="40" name="q" value="{{ request.GET.q }}"
                 id="searchbar" />
          <input type="submit" value="Search" />
        </div>
      </form>
    </div>
    <script type="text/javascript">document.getElementById("searchbar").focus();</script>

    <div id="changelist-filter">
      <h2>Filter</h2>

      <h3> By last build date </h3>
      <ul>
        {% for choice in date_filter %}
        <li {% if choice.selected %} class="selected"{% endif %}>
          <a href="{{ choice.query_string|iriencode }}">
            {{ choice.display|escape }}
          </a>
        </li>
        {% endfor %}
      </ul>

      <h3> By success </h3>
      <ul>
        {% for choice in state_filter %}
        <li {% if choice.selected %} class="selected"{% endif %}>
          <a href="{{ choice.query_string|iriencode }}">
            {{ choice.display|escape }}
          </a>
        </li>
        {% endfor %}
    </div>

    <table cellspacing="0">
      <thead>
        <th>Project</th><th>Build state</th><th>Last build</th><th>Build time</th>
      </thead>
      <tbody>
        {% for project in object_list %}
        <tr class="{% cycle "row1" "row2" %}">
          <th>
            <a href="{{ project.get_absolute_url }}">
              {{ project.name }}
            </a>
          </th>
          {% if project.last_build.success %}
          <td class="success">OK</td>
          {% else %}
          <td class="failed">FAILED</td>
          {% endif %}
          <td>{{ project.last_build.end|date:"r" }}</td>
          {% with project.last_build.start as start %}
          <td>{{ project.last_build.end|timesince:start }}</td>
          {% endwith %}
        </tr>
        {% endfor %}
      </tbody>
    </table>

  </div>
</div>


{% endblock %}

