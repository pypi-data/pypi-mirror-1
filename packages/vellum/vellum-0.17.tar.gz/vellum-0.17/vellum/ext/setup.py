"""
    some stuff to help writing out setup.py files

    the code is fugly, don't complain, fix

    .. warning::
      its also incomplete
"""

def gen_setup(scribe, output='setup.py', **expr):
    if not scribe.option('run_dry'):
        with open(output, "w") as f:
            f.write(_gen_setup(scribe.options['setup']))


def _gen_setup(data):
    return """#!/usr/bin/python
# THIS FILE IS AUTOGENERATED BY VELLUM
# if you need changes, do them in build.vel

try:
    from setuptools import setup
except ImportError:
    from distutils.core import setup

setup(%s)
"""%_kwcall(data)


def _kwcall(dict):
    return '\n    %s\n'%',\n    '.join('%s=%s'%(key, _pyvalue(value).replace('\n','\n    ')) 
                      for key, value in sorted(dict.items())) 

def _pylist(listing):
    if not listing:
        return '[]'
    return '[\n    %s\n]'%',\n    '.join(map(_pyvalue, listing))



def _pyvalue(val):
    if isinstance(val, str):
        return repr(val)
    elif isinstance(val, list):
        return _pylist(val)
    return ''

