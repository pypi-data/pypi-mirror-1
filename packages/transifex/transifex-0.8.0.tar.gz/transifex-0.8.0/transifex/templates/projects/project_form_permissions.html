{% extends "projects/project_menu.html" %}
{% load i18n %}
{% load pagination_tags %}
{% load txcommontags %}
{% load permissions %}
{% load txpermissions %}

{% block title %}{{ block.super }} | {{ project.name }} | {% trans "Access Control" %}{% endblock %}

{% block breadcrumb %}{{ block.super }} &raquo; {{ project.name }}{% endblock %}

{% block content_main %}

<div class="obj_bigdetails">
<h2 class="name">{% trans "Access Control" %}</h2>

{% if approved %}
  <h3>{% trans "Give access to a translator to send translations to your project" %}</h3>
{% else %}
  <h3>{% trans "Requests for access to submit files" %}</h3>
{% endif %}

{% get_permission "project_perm.submit_file" for request.user and project as "can_submit_file" %}
{% get_permission "project_perm.maintain" for request.user and project as "is_maintainer" %}
{% get_permission_request "project_perm.submit_file" for request.user and project as "can_submit_file_request" %}

<div class="project_create generic_form">

{% if is_maintainer %}
<div class="separate">
    <form name="anyone_submit_form" action='{% url project_edit project.slug %}' method='post' class="microform">
    <input type="hidden" name="next" value="{{ request.path }}"/>
    <table>
        <tbody>
        {% form_as_table_rows project_permission_form %}
        </tbody>
    </table>
    </form>
</div>
{% endif %}

{% if not project.anyone_submit %}

<div class="separate">
{% if form and not can_submit_file_request %}
    {% include "txpermissions/permission_form.html" %}
{% else %}
    {% if approved %}
        {% txpermission_form for project using "project_perm.submit_file" %}
    {% else %}
        {% if not can_submit_file and not can_submit_file_request %}
            {% txpermission_request_form for project using "project_perm.submit_file" %}
        {% endif %}
    {% endif %}
{% endif %}
</div>


{% get_permission_requests project as "all_permission_requests" %}
{% if all_permission_requests %}
<div class="list separate ">
<h4>{% trans "Pending requests:" %}</h4>
<ul>
{% for perm in all_permission_requests|dictsort:"user.username" %}
    <li class="i16 user">
        <a class="name" href="{% url profile_public perm.user.username %}">{{ perm.user }}</a>
        {% if can_submit_file %}
          <span>- {{perm.user.email|mungify}}</span>
        {% endif %}
        {% txpermission_request_approve_form project perm %} 
        {% txpermission_request_delete_form project perm %}
    </li>
{% endfor %}
</ul>
</div>
{% endif %}

{% get_permissions project as "all_permissions" %}
{% if all_permissions %}
{% autopaginate all_permissions 20 %}
<div class="list separate">
<h4>{% trans "Users with access to submit files:" %}</h4>
<ul>
{% for perm in all_permissions|dictsort:"user.username" %}
    <li>
        <a class="name" href="{% url profile_public perm.user.username %}">{{ perm.user }}</a> 
        {% if can_submit_file %}
          <span>- {{perm.user.email|mungify}}</span>
        {% endif %}
        {% txpermission_delete_form project perm %}
    </li>
{% endfor %}
</ul>
<div class="pagination bottom">{% paginate %}</div>
</div>
{% endif %}

{% endif %}

</div>
{% endblock %}

