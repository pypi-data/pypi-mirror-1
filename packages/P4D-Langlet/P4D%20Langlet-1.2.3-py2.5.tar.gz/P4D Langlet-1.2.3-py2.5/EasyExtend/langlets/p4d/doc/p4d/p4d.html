<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html xmlns:p4d="http://fiber-space.de/p4dns">
<head>
  <meta content="text/html; charset=UTF-8" http-equiv="content-type">
  <title>P4D</title>
  <meta content="Kay Schluehr" name="author">
  <meta content="Description of the P4D extension" name="description">
</head>
<body>
<table
 style="width: 100%; text-align: left; margin-left: auto; margin-right: auto;"
 cellpadding="0" cellspacing="2">
  <tbody>
    <tr>
      <td><br>
      </td>
      <td
 style="background-color: rgb(102, 255, 255); width: 100%; text-align: left;">
      <div style="margin-left: 320px;"><span
 style="font-weight: bold; font-family: arial;">Easy Extend</span><br>
      </div>
      </td>
    </tr>
  </tbody>
</table>
<img alt="" src="p4d-Dateien/EELogo_Small2.PNG"
 style="width: 67px; height: 53px;"><br>
<hr style="width: 100%; height: 2px;"><br>
<table style="text-align: left; width: 864px; height: 346px;"
 cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td style="vertical-align: top;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      <br>
      </td>
      <td style="vertical-align: top;"><img
 style="width: 530px; height: 226px;" alt="" src="p4d-Dateien/P4D.png"><br>
      </td>
      <td style="vertical-align: top;"><br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;"><br>
      </td>
      <td style="vertical-align: top;"><small><span
 style="font-family: copperplate gothic light;"><big
 style="font-family: franklin gothic book;">&nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp; Author:
Kay Schluehr<br>
      </big></span><big style="font-family: franklin gothic book;">&nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
Date: 2008-08-16<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Version: 1.2.3</big><span
 style="font-family: arial;"></span></small><small><span
 style="font-family: arial;"></span></small><small><span
 style="font-family: arial;"><br>
      </span></small></td>
      <td style="vertical-align: top;"><br>
      </td>
    </tr>
    <tr>
      <td
 style="vertical-align: top; background-color: rgb(153, 255, 255);"><a
 href="../../../downloads/downloads.html">Download</a><br>
      <a target="_blank" href="p4dapi/index.html">API
documentation</a><br>
      <a href="bytelets.html">Bytelets</a><br>
      </td>
      <td style="vertical-align: top;"><br>
      </td>
      <td style="vertical-align: top;"><br>
      </td>
    </tr>
  </tbody>
</table>
<br>
<hr style="width: 100%; height: 2px;">
<ul id="mozToc">
<!--mozToc h1 1 h2 2 h3 3 h4 4-->
  <li><a href="#mozTocId998564">1.
Introduction&nbsp;</a></li>
  <li><a href="#mozTocId711196">2. Using P4D </a>
    <ul>
      <li><a href="#mozTocId406163">2.1 Install and
run </a></li>
      <li><a href="#mozTocId688529">2.2
Philosophers Football </a></li>
      <li><a href="#mozTocId132389">2.3 Basic P4D
element access </a>
        <ul>
          <li><a href="#mozTocId479129">2.3.1 Attribute
access using the @ operator </a></li>
        </ul>
      </li>
      <li><a href="#mozTocId89385">2.4
Declarative filters </a>
        <ul>
          <li><a href="#mozTocId746263">2.4.1&nbsp;
Using wildcards in filters </a></li>
          <li><a href="#mozTocId532695">2.4.2&nbsp;
Pitfalls</a></li>
        </ul>
      </li>
      <li><a href="#mozTocId178156">2.5&nbsp; The elm keyword</a></li>
      <li><a href="#mozTocId776561">2.6 namespaces</a>
        <ul>
          <li><a href="#mozTocId233648">2.6.1&nbsp;
The p4d
namespace </a></li>
        </ul>
      </li>
      <li><a href="#mozTocId630715">2.7 Python
expressions in P4D elements </a>
        <ul>
          <li><a href="#mozTocId52388">2.7.1&nbsp;
Object lists as element content </a></li>
        </ul>
      </li>
      <li><a href="#mozTocId102106">2.8 P4D comments</a></li>
      <li><a href="#mozTocId927133">2.9 Element
assignments and deletions ( new in P4D 1.2 ) </a>
        <ul>
          <li><a href="#mozTocId87753">2.9.1 Assignments </a></li>
          <li><a href="#mozTocId266176">2.9.2 Deletions </a></li>
        </ul>
      </li>
    </ul>
  </li>
  <li><a href="#mozTocId138234">3. Support for
XML languages</a>
    <ul>
      <li><a href="#mozTocId345825">3.1. xmlstr and
p4dstr </a></li>
      <li><a href="#mozTocId793892">3.2&nbsp;
xml2p4d conversion from the command-line </a></li>
      <li><a href="#mozTocId571264">3.3&nbsp; The
p4d namespace and its transformations </a></li>
      <li><a href="#mozTocId709862">3.4&nbsp;
Translating XML comments and CDATA</a></li>
      <li><a href="#mozTocId460833">3.4. Case Study
- Adobe Flex</a>
        <ul>
          <li><a href="#mozTocId844946">3.4.1&nbsp;
Import flexutils.p4d
from Python </a></li>
        </ul>
      </li>
    </ul>
  </li>
  <li><a href="#mozTocId234863">4. Bytelets ( new in P4D 1.2 )</a></li>
  <li><a href="#mozTocId261442">5. Token.ext
&amp; Grammar.ext </a>
    <ul>
      <li><a href="#mozTocId929987">5.1 Token.ext</a></li>
      <li><a href="#mozTocId723366">5.2 Grammar.ext</a>
        <ul>
          <li><a href="#mozTocId877232">5.2.1&nbsp;
Translation of p4d_compound_stmt </a></li>
        </ul>
      </li>
    </ul>
  </li>
  <li><a href="#mozTocId808156">6. History</a></li>
</ul>
&nbsp;
<hr style="width: 100%; height: 2px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<br>
<table style="text-align: left; width: 823px; height: 14538px;"
 cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td style="vertical-align: top;">
      <h1><a class="mozTocH1" name="mozTocId998564"></a>1.
Introduction&nbsp;</h1>
A short version of an introduction to P4D can be summarized by a small
formula:<br>
      <br>
      <big><span style="font-weight: bold;">P4D = E4X
without E and X but P and P4D trees</span></big><br>
      <br>
A slightly more extended version goes like this:<br>
      <br>
P4D ( = Python For Data ) is a full formed Python dialect that enables
writing tree shaped data directly in source code. The main sources of
inspiration for P4D were <a href="http://en.wikipedia.org/wiki/E4X"
 target="blank">E4X</a> which handles access to XML quite gracefully on
language level and provides XML literals and <a
 href="http://slip.sourceforge.net/" target="blank">SliP</a> which
preserves the structural properties of XML while being more apt to the
concise Python syntax. As a result P4D keeps much of the original E4X
design idea ( and also the syntax ) but drops XML literals and replaces
them by more pythonic data structures. The transitions between P4D and
XML are smooth. So you can use P4D to convert an XML document into a
P4D datastructure edit and transform this structure and output an XML
document again.<br>
      <br>
P4D is implemented as an <a target="blank"
 href="http://www.fiber-space.de/EasyExtend/doc/EE.html">EasyExtend
langlet</a> which means among other things that P4D files compile to
Python bytecode. So accessing P4D modules from Python is feasible ( it
is actually feasible on source level as well but this will be explained
later in this doc ) while accessing Python from P4D is obviously
possible.<br>
      <br>
      <h1><a class="mozTocH1" name="mozTocId711196"></a>2. Using P4D<br>
      </h1>
      <h2><a class="mozTocH2" name="mozTocId406163"></a>2.1 Install and
run<br>
      </h2>
P4D requires a Python 2.5 installation.
Other versions of Python won't work with P4D.<br>
      <br>
You can download P4D <a href="../../../downloads/downloads.html">here</a>.
It is a Python package that is installed on
the command line using the canonical <br>
      <br>
      <small style="font-family: Courier New,Courier,monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
python setup.py install</small><br>
      <br>
      <br>
      <small style="font-family: Courier New,Courier,monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&lt;MyPythonDir&gt;/lib/site-packages/EasyExtend/langlets/p4d</small><br>
      <br>
P4D can be started as a Python script placed in the
&lt;MyPythonDir&gt;/Scripts folder of you cd to the above directory and
type<br>
      <small style="font-family: Courier New,Courier,monospace;"><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
python run_p4d.py</small><br>
      <br>
A P4D specific console shall be opened immediately:<br>
      <br>
      <table
 style="background-color: rgb(255, 255, 239); font-family: courier new; width: 793px; height: 29px; text-align: left;"
 border="0" cellpadding="2" cellspacing="2">
        <tbody>
          <tr>
            <td
 style="background-color: rgb(236, 236, 236); vertical-align: top;"><small><br>
C:\lang\Python25\Lib\site-packages\EasyExtend\langlets\p4d&gt;python
run_p4d.py<br>
__________________________________________________________________________________<br>
            <br>
&nbsp;p4d<br>
            <br>
&nbsp;On Python 2.5.1 (r251:54863, Apr 18 2007, 08:51:08) [MSC v.1310
32 bit (Intel)]<br>
__________________________________________________________________________________<br>
            <br>
p4d&gt;<br>
            </small></td>
          </tr>
        </tbody>
      </table>
      <br>
      <h2><a class="mozTocH2" name="mozTocId688529"></a>2.2
Philosophers Football <br>
      </h2>
A P4D statement <span style="font-style: italic;"></span>is a tree of
elements containing other P4D statements or elements. Following example
encodes some data of Monty Pythons <a
 href="http://www.youtube.com/watch?v=ur5fGSBsfq8" target="blank">philosophers
football game</a>. <span style="font-style: italic;"></span><br>
      <br>
      <table
 style="background-color: rgb(255, 255, 239); font-family: courier new; width: 793px; height: 462px; text-align: left;"
 border="0" cellpadding="2" cellspacing="2">
        <tbody>
          <tr>
            <td
 style="background-color: rgb(236, 236, 236); vertical-align: top;"><small>game
= monty-python-football:<br>
&nbsp;&nbsp;&nbsp; location: "München"<br>
&nbsp;&nbsp;&nbsp; team(country="Deutschland"):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; player(no=1):"Leibniz"<br>
            </small><small>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
player(no=2):"I.Kant"<br>
            </small><small>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
player(no=3):"Hegel"<br>
            </small><small>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
player(no=4):"Schopenhauer"<br>
            </small><small>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
player(no=5):"Schelling"<br>
            </small><small>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
player(no=6):"Beckenbauer"&nbsp; &nbsp; &nbsp;</small><small>#
Beckenbauer obviously a bit of a surprise there</small><br>
            <small>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
player(no=7):"Jaspers"<br>
            </small><small>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
player(no=8):"Schlegel"<br>
            </small><small>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
player(no=9):"Wittgenstein"&nbsp;&nbsp;&nbsp; <br>
            </small><small>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
player(no=10):"Nietzsche"<br>
            </small><small>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
player(no=11):"Heidegger"<br>
            <br>
            </small><small>&nbsp;&nbsp;&nbsp;
team(country="Griechenland"):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; player(no=1):"Plato"<br>
            </small><small>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
player(no=2):"Epiktet"<br>
            </small><small>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
player(no=3):"Aristoteles"<br>
            </small><small>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
player(no=4):"Sophokles"<br>
            </small><small>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
player(no=5):"Empedokles"<br>
            </small><small>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
player(no=6):"Plotin"<br>
            </small><small>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
player(no=7):"Epikur"<br>
            </small><small>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
player(no=8):"Heraklit"<br>
            </small><small>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
player(no=9):"Demokrit"<br>
            </small><small>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
player(no=10):"Sokrates"<br>
            </small><small>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
player(no=11):"Archimedes"<br>
            <br>
&nbsp;&nbsp;&nbsp; referees: <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; main:"K'ung fu-tsze</small><small>"<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; assistants:<br>
            </small><small>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;
&nbsp;&nbsp; linesman(no=1): "Saint Thomas Aquinas"</small><br>
            <small>&nbsp;&nbsp;&nbsp;&nbsp; </small><small>&nbsp;
&nbsp; &nbsp;&nbsp; linesman(no=2): "Saint Augustine"</small><br>
            <small>&nbsp;&nbsp;&nbsp; play:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; half-time(no = 1):</small><br>
            <small>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
team(country="Germany" goals = 0)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </small><small>team(country="Greece"
goals = 0)</small><br>
            <small>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
half-time(no = 2):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
team(country="Germany" goals = 0):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
substitutes:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
subst(p4d:in="Marx"
p4d:out="Wittgenstein")&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
matchwinner: "False"<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </small><small>team(country="Greece",
goals = 2):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
substitutes<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
goal-scorer(goal=1): "Sokrates"<br>
            </small><small>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
goal-scorer(goal=2): "Sokrates"<br>
            </small><small>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
matchwinner: "True"</small><br>
            <small> </small><small> </small></td>
          </tr>
        </tbody>
      </table>
      <br>
      <h2><a class="mozTocH2" name="mozTocId132389"></a>2.3 Basic P4D
element access<br>
      </h2>
Now we show how to access elements using P4Ds syntax. The game object
which is an ordinary Python object serves as an entry point.<br>
      <br>
      <table
 style="background-color: rgb(255, 255, 239); font-family: courier new; width: 793px; height: 29px; text-align: left;"
 border="0" cellpadding="2" cellspacing="2">
        <tbody>
          <tr>
            <td
 style="background-color: rgb(236, 236, 236); vertical-align: top;"><small>p4d&gt;
game<br>
P4D&lt;monty-python-football&gt;<br>
            </small></td>
          </tr>
        </tbody>
      </table>
      <br>
Notice here one particular detail. In P4D one can write hyphenated
names: <small style="font-family: Courier New,Courier,monospace;">NAME
('-' NAME)*</small>. However one can write them within P4D elements
only. In other contexts the same syntactical form will be interpreted
as an arithmetic difference.<br>
      <br>
      <table
 style="background-color: rgb(255, 255, 239); font-family: courier new; width: 793px; height: 29px; text-align: left;"
 border="0" cellpadding="2" cellspacing="2">
        <tbody>
          <tr>
            <td
 style="background-color: rgb(236, 236, 236); vertical-align: top;"><small>p4d&gt;
game.location<br>
[P4D&lt;location&gt;]<br>
            </small></td>
          </tr>
        </tbody>
      </table>
      <br>
We can access elements using the dot-operator. The return value is a
P4DList object. A P4DList is derived from Pythons list type. It
provides some additional methods which it shares with basic P4D
objects. So one can access text directly for instance:<br>
      <br>
      <table
 style="background-color: rgb(255, 255, 239); font-family: courier new; width: 793px; height: 29px; text-align: left;"
 border="0" cellpadding="2" cellspacing="2">
        <tbody>
          <tr>
            <td
 style="background-color: rgb(236, 236, 236); vertical-align: top;"><small>p4d&gt;
location = game.location<br>
p4d&gt; location.text()<br>
            </small></td>
          </tr>
        </tbody>
      </table>
      <br>
This however works only if the P4DList contains <span
 style="font-style: italic;">exactly </span>one element. Otherwise an
AttributeError is raised as in the following example.<br>
      <br>
      <table
 style="background-color: rgb(255, 255, 239); font-family: courier new; width: 793px; height: 29px; text-align: left;"
 border="0" cellpadding="2" cellspacing="2">
        <tbody>
          <tr>
            <td
 style="background-color: rgb(236, 236, 236); vertical-align: top;"><small>p4d&gt;
game.team.player<br>
Traceback<br>
...<br>
AttributeError...<br>
            </small></td>
          </tr>
        </tbody>
      </table>
      <br>
Notice that the attributes in the attribute list as in <br>
      <br>
      <table
 style="background-color: rgb(255, 255, 239); font-family: courier new; width: 793px; height: 29px; text-align: left;"
 border="0" cellpadding="2" cellspacing="2">
        <tbody>
          <tr>
            <td
 style="background-color: rgb(236, 236, 236); vertical-align: top;"><small>team(country="Greece"
goals = 2)</small><small><br>
            </small></td>
          </tr>
        </tbody>
      </table>
      <br>
don't have to be separated by comma. Commas are optional though and you
can write the element in Python style:<br>
      <br>
      <table
 style="background-color: rgb(255, 255, 239); font-family: courier new; width: 793px; height: 29px; text-align: left;"
 border="0" cellpadding="2" cellspacing="2">
        <tbody>
          <tr>
            <td
 style="background-color: rgb(236, 236, 236); vertical-align: top;"><small>team(country="Greece",
goals = 2)</small><small><br>
            </small></td>
          </tr>
        </tbody>
      </table>
      <br>
      <h3><a class="mozTocH3" name="mozTocId479129"></a>2.3.1 Attribute
access using the @ operator<br>
      </h3>
We can access P4D object attributes either using the attributes()
method or we use the @-operator which is a syntactical shortcut.<br>
      <br>
      <table
 style="background-color: rgb(255, 255, 239); font-family: courier new; width: 793px; height: 29px; text-align: left;"
 border="0" cellpadding="2" cellspacing="2">
        <tbody>
          <tr>
            <td
 style="background-color: rgb(236, 236, 236); vertical-align: top;"><small>p4d&gt;
game.team[0].@country<br>
"Deutschland"<br>
p4d&gt; winning_team_goals =
int(game.play.child("final-score").team[1].@goals)<br>
            </small></td>
          </tr>
        </tbody>
      </table>
      <br>
In the latter case we have to use the child() method of the P4D element
to access the <small><span
 style="font-family: Courier New,Courier,monospace;">final-score</span></small>
element. This is necessary because we do not use <small><span
 style="font-family: Courier New,Courier,monospace;">final-score </span></small>within
the context of an P4D object definition.<br>
      <br>
Another use of the @-operator is to select all attributes of an
element. This is done by the combination of @ with the wildcard symbol
*.<br>
      <br>
      <table
 style="background-color: rgb(255, 255, 239); font-family: courier new; width: 793px; height: 29px; text-align: left;"
 border="0" cellpadding="2" cellspacing="2">
        <tbody>
          <tr>
            <td
 style="background-color: rgb(236, 236, 236); vertical-align: top;"><small>p4d&gt;
game.play.child("half-time").team[1].@*<br>
{"country":"Greece", "goals": "2"}<br>
            </small></td>
          </tr>
        </tbody>
      </table>
      <br>
      <h2><a class="mozTocH3" name="mozTocId89385"></a>2.4
Declarative filters<br>
      </h2>
Subelement filters are an E4X feature also available in P4D. A
subelement filter is basically a statement about element properties
used to filter subelements of the element to which the filter
is applied. <br>
      <br>
      <table
 style="background-color: rgb(255, 255, 239); font-family: courier new; width: 793px; height: 29px; text-align: left;"
 border="0" cellpadding="2" cellspacing="2">
        <tbody>
          <tr>
            <td
 style="background-color: rgb(255, 255, 255); vertical-align: top;"><small>X.(filter-declaration)<br>
            <br>
&nbsp;&nbsp;&nbsp; --&gt;<br>
            <br>
for item in X.children():<br>
&nbsp;&nbsp;&nbsp; filter-function(item)<br>
            </small></td>
          </tr>
        </tbody>
      </table>
      <br>
The main purpose of filters is navigation. Intuitively speaking one
tries to reduce a list of child nodes to a list of exactly 1 element.
On this 1 element list one can apply another filter and so on. <br>
      <br>
      <span style="font-weight: bold;">Example 1:</span><br>
      <br>
      <table
 style="background-color: rgb(255, 255, 239); font-family: courier new; width: 793px; height: 29px; text-align: left;"
 border="0" cellpadding="2" cellspacing="2">
        <tbody>
          <tr>
            <td
 style="background-color: rgb(236, 236, 236); vertical-align: top;"><small>a
= a:<br>
&nbsp;&nbsp;&nbsp; b(x = 0 y = 1): "abc"<br>
            </small><small>&nbsp;&nbsp;&nbsp; b(x = 0 y = 2): "a"<br>
            </small><small>&nbsp;&nbsp;&nbsp; c(x = 1 y = 2): "abc"<br>
&nbsp;&nbsp;&nbsp; c(x = 0 y = 2):<br>
&nbsp;&nbsp;&nbsp; &nbsp; &nbsp; d: "def" <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </small><small>d: "efg" </small><small><br>
            </small></td>
          </tr>
        </tbody>
      </table>
      <br>
With on element a we can apply several different filters:<br>
      <table
 style="background-color: rgb(255, 255, 239); font-family: courier new; width: 811px; height: 190px; text-align: left;"
 border="0" cellpadding="2" cellspacing="2">
        <tbody>
          <tr>
            <td
 style="background-color: rgb(236, 236, 236); vertical-align: top;"><small>p4d&gt;
a.(@x == 0)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </small><small># -- elements X in a
with X.@x == '0'</small><br>
            <small>[P4D&lt;b&gt;, P4D&lt;b&gt;,
P4D&lt;c&gt;]&nbsp;&nbsp; <br>
            <br>
p4d&gt; a.b.(.text() == "abc")&nbsp;&nbsp; # -- elements b in a.b with
b.text() == "abc"<br>
[P4D&lt;b&gt;] &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>
            <br>
            </small><small>p4d&gt; a.c.(d ==
"abc")&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # -- elements c
in a.c with subelement d and d.text() == "efg"<br>
[P4D&lt;c&gt;] &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>
            </small><br>
            <small>p4d&gt; a.(@x == 1 or @y == 1)&nbsp;&nbsp; # --
elements X in a with X.@x == 1 or X.@y == 1</small><br>
            <small>[P4D&lt;b&gt;,
P4D&lt;c&gt;]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <br>
            <br>
            </small><small>p4d&gt; a.b.(.children() == [])&nbsp; # --
elements b in a.b with b.children() == []<br>
[P4D&lt;b&gt;, </small><small>P4D&lt;b&gt;</small><small>] &nbsp;
&nbsp; &nbsp; &nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>
            </small><br>
            </td>
          </tr>
        </tbody>
      </table>
      <br>
      <span style="font-weight: bold;">Example 2:</span><br>
      <br>
Applying filters to the philosophers football game:<br>
      <br>
      <table
 style="background-color: rgb(255, 255, 239); font-family: courier new; width: 811px; height: 87px; text-align: left;"
 border="0" cellpadding="2" cellspacing="2">
        <tbody>
          <tr>
            <td
 style="background-color: rgb(236, 236, 236); vertical-align: top;"><small>p4d&gt;
game.(@country == "Deutschland").player.(@no == 3).text()</small><small></small><br>
            <small>'Hegel'<br>
            <br>
p4d&gt; game.play.children("half-time")[1].team.(matchwinner ==
"True").@country</small><small></small><br>
            <small>'Greece'</small><br>
            </td>
          </tr>
        </tbody>
      </table>
      <span style="font-weight: bold;"></span><br>
As you see the "half-time" element must be selected using the
children() object method because "half-time" is not a Python name.<br>
      <br>
      <h3><a class="mozTocH4" name="mozTocId746263"></a>2.4.1&nbsp;
Using wildcards in filters<big><big><small><small
 style="font-weight: normal;"><span style="font-weight: normal;"></span></small></small><br>
      </big></big></h3>
In the second example above we mentioned the subelement tag explicitely
in the filter declaration:<br>
      <br>
      <table
 style="background-color: rgb(255, 255, 239); font-family: courier new; width: 809px; height: 44px; text-align: left;"
 border="0" cellpadding="2" cellspacing="2">
        <tbody>
          <tr>
            <td
 style="background-color: rgb(236, 236, 236); vertical-align: top;"><small>p4d&gt;
a.(b == "abc") &nbsp; &nbsp; &nbsp;&nbsp;&nbsp; # lambda this:
this.text( ) == "abc" and this.tag == 'b' <br>
[P4D&lt;b&gt;] &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>
            </small></td>
          </tr>
        </tbody>
      </table>
      <br>
Using a single underscore _ instead of b leads to a different
translation where the clause <small><span
 style="font-family: Courier New,Courier,monospace;">this.tag == '_'</span>
      </small>will be just omitted:<br>
      <br>
      <table
 style="background-color: rgb(255, 255, 239); font-family: courier new; width: 810px; height: 110px; text-align: left;"
 border="0" cellpadding="2" cellspacing="2">
        <tbody>
          <tr>
            <td
 style="background-color: rgb(236, 236, 236); vertical-align: top;"><small>p4d&gt;
a.(_ == "abc") &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp; #
lambda this: this.text( ) == "abc" <br>
[P4D&lt;b&gt;, </small><small>P4D&lt;c&gt;</small><small>] &nbsp;
&nbsp; &nbsp; &nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>
            <br>
            </small><small>p4d&gt; a.(_.text()[0] == "a") &nbsp;
&nbsp;&nbsp;&nbsp; </small><small># lambda this: this.text( )[ 0 ] ==
"a" </small><br>
            <small>[P4D&lt;b&gt;, </small><small>P4D&lt;b&gt;, </small><small>P4D&lt;c&gt;</small><small>]
&nbsp; &nbsp; &nbsp; &nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>
            </small><br>
            </td>
          </tr>
        </tbody>
      </table>
      <br>
      <h3><a class="mozTocH4" name="mozTocId532695"></a>2.4.2&nbsp;
Pitfalls</h3>
Filters operate just skindeep i.e. on the level of child elements of a
current node. You see this when trying to use a filter declaration to
filter among nodes on a deeper level of hierarchy e.g.<br>
      <br>
      <table
 style="background-color: rgb(255, 255, 239); font-family: courier new; width: 820px; height: 28px; text-align: left;"
 border="0" cellpadding="2" cellspacing="2">
        <tbody>
          <tr>
            <td
 style="background-color: rgb(236, 236, 236); vertical-align: top;"><small>a.(c.d.text()
== "def") &nbsp; &nbsp; &nbsp;&nbsp;&nbsp; # lambda this: this.d.text()
== "def" and this.tag == 'c' <br>
            </small></td>
          </tr>
        </tbody>
      </table>
      <br>
Looks quite o.k. but isn't. Actually this query fails with following
exception:<br>
      <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      <small style="color: rgb(255, 0, 0);"><span
 style="font-family: Courier New,Courier,monospace;">P4DAccessError:
Cannot access P4D text on P4DList with length!=1.</span></small><br>
      <br>
The message means that <small><span
 style="font-family: Courier New,Courier,monospace;">c.d </span></small>is
a list of nodes of length != 1 ( two nodes in our example ) and P4D
only treats P4DList objects of length = 1 like P4DNode objects!<br>
      <br>
      <h2><a class="mozTocH2" name="mozTocId178156"></a>2.5&nbsp; The <small
 style="font-family: Courier New,Courier,monospace;">elm</small> keyword</h2>
So far we have assigned P4D elements to regular Python names using the
assignment form<br>
      <br>
      <small><span style="font-family: Courier New,Courier,monospace;">&nbsp;&nbsp;
&nbsp; &nbsp; &nbsp;py_name
'=' p4d-element</span><br>
      </small><br>
However each P4D element starts itself with a name so we have<br>
      <small><span style="font-family: Courier New,Courier,monospace;"><br>
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;py_name
'=' p4d_name ...</span></small><br>
      <br>
Whenever a <small><span
 style="font-family: Courier New,Courier,monospace;">p4d_name</span></small>
is also a valid <small><span
 style="font-family: Courier New,Courier,monospace;">py_name</span></small>
valid we can reduce boilerplate and just write<br>
      <small><span style="font-family: Courier New,Courier,monospace;"><br>
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;elm p4d_name ...<br>
      <br>
      </span></small><small><span
 style="font-family: Courier New,Courier,monospace;"></span></small><small><span
 style="font-family: Courier New,Courier,monospace;"></span></small><br>
      <table
 style="background-color: rgb(255, 255, 239); font-family: courier new; width: 793px; height: 29px; text-align: left;"
 border="0" cellpadding="2" cellspacing="2">
        <tbody>
          <tr>
            <td
 style="background-color: rgb(236, 236, 236); vertical-align: top;"><small><br>
# explicit assignment:<br>
            <br>
philosopher = philosopher:<br>
&nbsp; &nbsp; name: "Gottfried Wilhelm Leibniz"</small><br>
            <small>&nbsp; &nbsp;&nbsp;birth: <br>
&nbsp; &nbsp; &nbsp; &nbsp; date: "1646-07-1"<br>
&nbsp; &nbsp; &nbsp; &nbsp; city: "Leipzig"<br>
&nbsp; &nbsp; death: <br>
            </small><small>&nbsp; &nbsp; &nbsp; &nbsp; date:
"1716-11-14"<br>
&nbsp; &nbsp; &nbsp; &nbsp; city: "Hannover"<br>
            <br>
            </small><small># implicit&nbsp;assignment:</small><br>
            <small><br>
elm philosopher:<br>
&nbsp; &nbsp; name: "Georg Wilhelm Friedrich Hegel"<br>
&nbsp; &nbsp; birth:<br>
&nbsp; &nbsp; &nbsp; &nbsp; date: "1770-08-27"<br>
&nbsp; &nbsp; &nbsp; &nbsp; city: "Stuttgart"<br>
            </small><small>&nbsp; &nbsp; death:<br>
&nbsp; &nbsp; &nbsp; &nbsp; date: "1831-11-14"<br>
&nbsp; &nbsp; &nbsp; &nbsp; city:</small><small> "Berlin"</small></td>
          </tr>
        </tbody>
      </table>
      <br>
Definitions using <small><span
 style="font-family: Courier New,Courier,monospace;">elm</span></small>
will always be expanded into the explicit assignment form.<br>
      <br>
Implicit assignment cannot be used with hyphened names such as<small><span
 style="font-family: Courier New,Courier,monospace;">
monty-python-football</span></small>&nbsp;or prefixed names like&nbsp;<small><span
 style="font-family: Courier New,Courier,monospace;">p4d:if. </span></small>In
both cases a SyntaxError is raised and an explicit assignment using a
valid Python name is recommended.<br>
      <br>
Why <small style="font-family: Courier New,Courier,monospace;">elm</small>
and not the more intuitively appealing <small><span
 style="font-family: Courier New,Courier,monospace;">elem</span></small>?
An <small><span style="font-family: Courier New,Courier,monospace;">elem</span></small>
keyword would be like <small><span
 style="font-family: Courier New,Courier,monospace;">var</span></small>
or <small><span style="font-family: Courier New,Courier,monospace;">val</span></small>.
Any second Python program has defined one and would be invalid. <br>
      <span style="font-weight: bold;"></span><br>
      <h2><a class="mozTocH3" name="mozTocId776561"></a>2.6 namespaces</h2>
XML and P4D elements provide context and scope. Elements shall
therefore be
sufficient for most practical disambiguation purposes. However XML
moves beyond this and provides&nbsp; <span style="font-style: italic;">XML
namespaces</span> which lets you mix elements of different XML based
domain specific languages freely. Although P4D supported XML namespaces
initially just for compliency reasons <br>
      <br>
A namespace consists of two parts: a prefix and an URI ( or URN ). The
URI shall serve as a strong name
providing real means of contextual disambiguation. The prefix is kind
of a variable that binds to an URI. When in use namespace prefixes are
separated by colon from a so called <span style="font-style: italic;">local
name</span>. Prefxixes are the visible clue you have most likely
noticed in XML elements like this<br>
      <br>
      <small style="font-family: Courier New,Courier,monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&lt;xsl:stylesheet version "1.0" ...&gt;<br>
      <br>
      </small>Library authors who take namespaces really serious
substitute prefixes by their corresponding URIs ( URNs ) entirely when
XML documents are getting dumped. The <a target="blank"
 href="http://www.python.org/doc/current/lib/module-xml.etree.ElementTree.html">elementtree</a>
package of the Python standard library is an example of this practice.<br>
      <br>
P4D considers namespaces prefixes basically as an additional
syntactical detail. One can retrieve namespace information from
elements though. This doesn't mean much more than a variable lookup.<br>
      <br>
      <table
 style="background-color: rgb(255, 255, 239); font-family: courier new; width: 793px; height: 29px; text-align: left;"
 border="0" cellpadding="2" cellspacing="2">
        <tbody>
          <tr>
            <td
 style="background-color: rgb(236, 236, 236); vertical-align: top;"><small>a
= a:<br>
&nbsp;&nbsp;&nbsp; b:c(xmlns:b = "http://bla.bla.bla")<br>
            <br>
p4d&gt; a.b::c<br>
P4D&lt;b:c&gt;<br>
p4d&gt; a.b::c.namespace()<br>
&lt;EasyExtend.langlets.p4d.p4dbase.P4DNamespace object at
0x01487C10&gt;<br>
            </small><small>p4d&gt; b_ns = a.b::c.namespace()<br>
p4d&gt; b_ns.prefix<br>
'b'<br>
p4d&gt; b_ns.uri<br>
            </small><small>'http://bla.bla.bla'</small><br>
            </td>
          </tr>
        </tbody>
      </table>
      <br>
The doublecolon operator <span style="font-weight: bold;">::</span> is
used to express full element access of a prefixed name. Alternatively
one can use the child method with the full tag name:<span
 style="font-style: italic;"></span><br>
      <br>
      <table
 style="background-color: rgb(255, 255, 239); font-family: courier new; width: 793px; height: 29px; text-align: left;"
 border="0" cellpadding="2" cellspacing="2">
        <tbody>
          <tr>
            <td
 style="background-color: rgb(236, 236, 236); vertical-align: top;"><small>p4d&gt;
a.child("b:c")<br>
            </small><small>P4D&lt;b:c&gt;</small><br>
            </td>
          </tr>
        </tbody>
      </table>
      <br>
If an element is not prefixed the invocation of namespace() on it
returns a P4DNamespace object with empty content.<br>
      <br>
      <table
 style="background-color: rgb(255, 255, 239); font-family: courier new; width: 793px; height: 29px; text-align: left;"
 border="0" cellpadding="2" cellspacing="2">
        <tbody>
          <tr>
            <td
 style="background-color: rgb(236, 236, 236); vertical-align: top;"><small>p4d&gt;
a.namespace().uri&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
# None<br>
            </small><small>p4d&gt;
a.namespace().prefix&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # None</small><br>
            </td>
          </tr>
        </tbody>
      </table>
      <br>
If an element is not prefixed the invocation of namespace() on it
returns a P4DNamespace object with empty content.<br>
      <br>
      <h3><a class="mozTocH3" name="mozTocId233648"></a>2.6.1&nbsp;
The <span style="font-family: Courier New,Courier,monospace;">p4d</span>
namespace<br>
      </h3>
There is one default namespace URL in P4D which is <small
 style="font-family: Courier New,Courier,monospace;">http://fiber-space.de/p4dns</small>.
The corresponding prefix is <small
 style="font-family: Courier New,Courier,monospace;">p4d</small>. The <small
 style="font-family: Courier New,Courier,monospace;">p4d</small>
namespace is introduced for a very particular reason: it wraps language
keywords. Just look at the following example:<br>
      <br>
      <table
 style="background-color: rgb(255, 255, 239); font-family: courier new; width: 793px; height: 29px; text-align: left;"
 border="0" cellpadding="2" cellspacing="2">
        <tbody>
          <tr>
            <td
 style="background-color: rgb(236, 236, 236); vertical-align: top;"><small>if:<br>
&nbsp;&nbsp;&nbsp; while(x=1):<br>
&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; pass <br>
            </small></td>
          </tr>
        </tbody>
      </table>
      <br>
P4D would fail to parse this expression. Keywords are treated special
by the parser. However you might prefix these element tags using p4d:<br>
      <br>
      <table
 style="background-color: rgb(255, 255, 239); font-family: courier new; width: 793px; height: 29px; text-align: left;"
 border="0" cellpadding="2" cellspacing="2">
        <tbody>
          <tr>
            <td
 style="background-color: rgb(236, 236, 236); vertical-align: top;"><small>p4d:if:<br>
&nbsp; &nbsp; p4d:while(x=1):<br>
&nbsp; &nbsp; &nbsp; &nbsp; p4d:pass <br>
            </small></td>
          </tr>
        </tbody>
      </table>
      <br>
In this case the parser reads <small>p4d:NAME</small> as a single
token.<br>
      <br>
How to navigate through this structure?<br>
      <br>
For namespace information retrieval you can simply access elements
using a double colon:<br>
      <br>
      <table
 style="background-color: rgb(255, 255, 239); font-family: courier new; width: 793px; height: 29px; text-align: left;"
 border="0" cellpadding="2" cellspacing="2">
        <tbody>
          <tr>
            <td
 style="background-color: rgb(236, 236, 236); vertical-align: top;"><small>a
= p4d:if:<br>
&nbsp; &nbsp; p4d:while(x=1):<br>
&nbsp; &nbsp; &nbsp; &nbsp; p4d:pass <br>
            <br>
p4d&gt; a.p4d::while.@x<br>
'1'<br>
            </small></td>
          </tr>
        </tbody>
      </table>
      <br>
Alternatively one can use the child(..) accessor method<br>
      <br>
      <table
 style="background-color: rgb(255, 255, 239); font-family: courier new; width: 793px; height: 29px; text-align: left;"
 border="0" cellpadding="2" cellspacing="2">
        <tbody>
          <tr>
            <td
 style="background-color: rgb(236, 236, 236); vertical-align: top;"><small>p4d
= p4d:if:<br>
&nbsp; &nbsp; p4d:while(x=1):<br>
&nbsp; &nbsp; &nbsp; &nbsp; p4d:pass <br>
            <br>
p4d&gt; a.child("p4d:while").@x<br>
'1'<br>
            </small></td>
          </tr>
        </tbody>
      </table>
      <br>
      <h2><a class="mozTocH2" name="mozTocId630715"></a>2.7 Python
expressions in P4D elements<br>
      </h2>
So
far we considered just static content. Content of P4D attributes or
elements had to be strings or numbers. If the content was a number it
was automatically converted into a string.<br>
      <br>
Now we want to place
arbitrary Python expressions within P4D elements or attributes. The
value of the expression shall be either a string or a P4DNode object.
Embedding however might cause trouble. Just look at the following
example:<br>
      <br>
      <table
 style="background-color: rgb(255, 255, 239); font-family: courier new; width: 793px; height: 29px; text-align: left;"
 border="0" cellpadding="2" cellspacing="2">
        <tbody>
          <tr>
            <td
 style="background-color: rgb(236, 236, 236); vertical-align: top;"><small>p4d&gt;
x = 1<br>
p4d&gt; y:x<br>
P4D&lt;y:x&gt;<br>
            </small></td>
          </tr>
        </tbody>
      </table>
      <br>
Here
y is understood as a namespace prefix and the assignment of x is
ignored. In order to let the value of x be the content of y we write:<br>
      <br>
      <table
 style="background-color: rgb(255, 255, 239); font-family: courier new; width: 793px; height: 29px; text-align: left;"
 border="0" cellpadding="2" cellspacing="2">
        <tbody>
          <tr>
            <td
 style="background-color: rgb(236, 236, 236); vertical-align: top;"><small>p4d&gt;
x = 1<br>
p4d&gt; y:&amp;x<br>
P4D&lt;y&gt;<br>
            </small></td>
          </tr>
        </tbody>
      </table>
      <br>
The ampersand operator can prefix an arbitrary Python expression. So
the following more compex expression shall work<br>
      <br>
      <table
 style="background-color: rgb(255, 255, 239); font-family: courier new; width: 793px; height: 29px; text-align: left;"
 border="0" cellpadding="2" cellspacing="2">
        <tbody>
          <tr>
            <td
 style="background-color: rgb(236, 236, 236); vertical-align: top;"><small>p4d&gt;
x = 0<br>
p4d&gt; y:&amp;(x if x&gt;0 else -x)<br>
P4D&lt;y&gt;<br>
            </small></td>
          </tr>
        </tbody>
      </table>
      <br>
The
expression is evaluated when the root P4D element is created. I
considered lazy evaluation ( call by need ) as well. This enables
dataflow and partial constructions. However it is not available in this
release.<br>
      <br>
Attribute values actually wouldn't require the
ampersand operator because there is nothing to disambiguate. However I
abandoned modality in favor for simplicity: <span
 style="font-style: italic;">evaluation in P4D elements always only
takes place when they are prefixed by an ampersand operator</span>.<br>
      <br>
Notice that omitting the ampersand operator leads to failure in case of
general expressions:<br>
      <br>
      <table
 style="background-color: rgb(255, 255, 239); font-family: courier new; width: 793px; height: 29px; text-align: left;"
 border="0" cellpadding="2" cellspacing="2">
        <tbody>
          <tr>
            <td
 style="background-color: rgb(236, 236, 236); vertical-align: top;"><small>p4d&gt;
x = 0<br>
p4d&gt; y:(x if x&gt;0 else -x) &nbsp; &nbsp; &nbsp; &nbsp;</small><small>
&nbsp; &nbsp; &nbsp;# wrong - expr needs to be prefixed with '&amp;'</small><br>
            <small>-&gt; ParseError<br>
            </small><small>p4d&gt; y(a = x if x&gt;0 else -x): 0
&nbsp; &nbsp; &nbsp; &nbsp;# wrong - expr needs to be prefixed with
'&amp;'<br>
-&gt; SyntaxError<br>
            </small><small>p4d&gt; y(a = x): 0 &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; # wrong - expr needs to be prefixed with '&amp;'<br>
-&gt; SyntaxError</small><br>
            <small>p4d&gt; elm y(a = "x if x&gt;0 else -x"): 0
&nbsp;# o.k. strings are permitted<br>
p4d&gt; elm </small><small>y(a = 42): 0 &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# o.k. numbers are permitted<br>
            </small><small>p4d&gt; elm y(a = &amp;x if x&gt;0 else
-x): 0 &nbsp; # o.k. ampersand prefix used<br>
p4d&gt; y.@a<br>
'0'</small></td>
          </tr>
        </tbody>
      </table>
      <br>
      <h3><a class="mozTocH3" name="mozTocId52388"></a>2.7.1&nbsp;
Object lists as element content<br>
      </h3>
This feature enables a more compact notion of lists of elements. It is
not directly representable in XML and might be the single biggest
departure. <br>
      <br>
Suppose you have a list L = [1,2,3,4] and for each entry in L you want
to create an <small style="font-family: Courier New,Courier,monospace;">Item</small>
element with the entry as content. <br>
The usual way to do this is to write:<br>
      <table
 style="background-color: rgb(255, 255, 239); font-family: courier new; width: 793px; height: 29px; text-align: left;"
 border="0" cellpadding="2" cellspacing="2">
        <tbody>
          <tr>
            <td
 style="background-color: rgb(236, 236, 236); vertical-align: top;"><small>#
variant 1<br>
            <br>
elm X:<br>
&nbsp;&nbsp;&nbsp; Item: 1<br>
            </small><small>&nbsp;&nbsp;&nbsp; Item: 2<br>
            </small><small>&nbsp;&nbsp;&nbsp; Item: 3<br>
            </small><small>&nbsp;&nbsp;&nbsp; Item: 4<br>
            <br>
            </small><small># variant 2 using the ampersand operator<br>
            <br>
            </small><small>elm X:<br>
&nbsp;&nbsp;&nbsp; Item: &amp;L[0]<br>
            </small><small>&nbsp;&nbsp;&nbsp; Item: </small><small>&amp;L[1]</small><br>
            <small>&nbsp;&nbsp;&nbsp; Item: </small><small>&amp;L[2]</small><br>
            <small>&nbsp;&nbsp;&nbsp; Item: </small><small>&amp;L[3]</small><br>
            </td>
          </tr>
        </tbody>
      </table>
      <br>
In P4D this boilerplate can be eliminated entirely and you can simply
write<br>
      <br>
      <table
 style="background-color: rgb(255, 255, 239); font-family: courier new; width: 793px; height: 29px; text-align: left;"
 border="0" cellpadding="2" cellspacing="2">
        <tbody>
          <tr>
            <td
 style="background-color: rgb(236, 236, 236); vertical-align: top;"><small>#
variant 1<br>
            <br>
elm X:<br>
&nbsp;&nbsp;&nbsp; Item: [1,2,3,4]<br>
            </small><small></small><small><br>
            </small><small># variant 2 using the ampersand operator<br>
            <br>
            </small><small>elm X:<br>
&nbsp;&nbsp;&nbsp; Item: &amp;L<br>
            </small><small></small></td>
          </tr>
        </tbody>
      </table>
      <br>
Those lists will be expanded and for each entry an Item object is
created internally:<br>
      <br>
      <table
 style="background-color: rgb(255, 255, 239); font-family: courier new; width: 793px; height: 29px; text-align: left;"
 border="0" cellpadding="2" cellspacing="2">
        <tbody>
          <tr>
            <td
 style="background-color: rgb(236, 236, 236); vertical-align: top;"><small>p4d&gt;
X.Item<br>
[P4D&lt;Item&gt;, P4D&lt;Item&gt;, P4D&lt;Item&gt;, P4D&lt;Item&gt;]</small></td>
          </tr>
        </tbody>
      </table>
      <br>
Attributes will be replicated and P4D nodes become embedded:<br>
      <br>
      <table
 style="background-color: rgb(255, 255, 239); font-family: courier new; width: 793px; height: 29px; text-align: left;"
 border="0" cellpadding="2" cellspacing="2">
        <tbody>
          <tr>
            <td
 style="background-color: rgb(236, 236, 236); vertical-align: top;"><small>elm
a:<br>
&nbsp;&nbsp; b(x = 0): [1,2,3]</small><br>
            <small><br>
elm Y:<br>
&nbsp;&nbsp;&nbsp; Item: &amp;a.b<br>
            <br>
p4d&gt; Y.Item<br>
            </small><small>[P4D&lt;Item&gt;, P4D&lt;Item&gt;,
P4D&lt;Item&gt;]<br>
            </small><small>p4d&gt; Y.Item[1].b.text()<br>
'2'</small><small><br>
p4d&gt; Y.Item[1].@x<br>
'0'<br>
            </small></td>
          </tr>
        </tbody>
      </table>
      <br>
      <h3>2.7.2&nbsp; Non P4D element content<br>
      </h3>
A common use case of the ampersand operator is to assemble a P4D object
from smaller parts:<br>
      <table
 style="background-color: rgb(255, 255, 239); font-family: courier new; width: 793px; height: 29px; text-align: left;"
 border="0" cellpadding="2" cellspacing="2">
        <tbody>
          <tr>
            <td
 style="background-color: rgb(236, 236, 236); vertical-align: top;"><small>elm
A:<br>
&nbsp; &nbsp; a(x = 0): [1,2]<br>
            </small><small><br>
elm B:<br>
&nbsp; &nbsp; a(x = 1): [3,4]<br>
            <br>
            </small><small>elm C:<br>
&nbsp; &nbsp; &amp;A<br>
&nbsp;&nbsp;&nbsp; &amp;B</small><small><br>
            </small></td>
          </tr>
        </tbody>
      </table>
      <br>
We can access A and B from C immediately. It is less obvious what
happens when A and B are not references to P4D objects.<br>
      <br>
Suppose you have the following statement:<br>
      <table
 style="background-color: rgb(255, 255, 239); font-family: courier new; width: 793px; height: 29px; text-align: left;"
 border="0" cellpadding="2" cellspacing="2">
        <tbody>
          <tr>
            <td
 style="background-color: rgb(236, 236, 236); vertical-align: top;"><small>x
= "Some Text"<br>
y = False<br>
            </small><small><br>
            </small><small>elm A:<br>
&nbsp;&nbsp;&nbsp; B:<br>
&nbsp; &nbsp; &nbsp; &nbsp; &amp;x<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &amp;y</small><small><br>
            </small></td>
          </tr>
        </tbody>
      </table>
      <br>
What can be used as content here? Shall an exception be raised because
x and y can be both content? Shall only y be content because it is a
string? Shall y be used because it is the last definition in the row or
x because it is the first one?<br>
      <br>
Actually I decided to use both ones and defined a new type which is
called P4DContentList. P4DContentList is derived from list and you
usually don't have to access it explicitely except for the special case
of having more than one objects that can be content. The implementation
of P4DContentList is rather simple:<br>
      <br>
      <table
 style="background-color: rgb(255, 255, 239); font-family: courier new; width: 793px; height: 29px; text-align: left;"
 border="0" cellpadding="2" cellspacing="2">
        <tbody>
          <tr>
            <td
 style="background-color: rgb(236, 236, 236); vertical-align: top;"><small>class
P4DContentList(list):<br>
&nbsp;&nbsp;&nbsp; def __str__(self):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return ''.join(str(item) for
item in self)</small><small><br>
            </small></td>
          </tr>
        </tbody>
      </table>
      <br>
The P4DContentList object will be printed as an ordinary string not as
a list. Notice that the sequence of non P4D objects is not preserved. <br>
      <br>
      <h3>2.7.2&nbsp; <small
 style="font-family: Courier New,Courier,monospace;">None</small> is
not content</h3>
The None object will not be inserted as content. Writing a P4D element
in this style<br>
      <br>
      <table
 style="background-color: rgb(255, 255, 239); font-family: courier new; width: 793px; height: 29px; text-align: left;"
 border="0" cellpadding="2" cellspacing="2">
        <tbody>
          <tr>
            <td
 style="background-color: rgb(236, 236, 236); vertical-align: top;"><small>y
= None<br>
            </small><small><br>
            </small><small>elm A:<br>
&nbsp;&nbsp;&nbsp; &amp;None<br>
&nbsp; &nbsp; &amp;y</small><small><br>
            </small></td>
          </tr>
        </tbody>
      </table>
      <br>
yields an element A without children and without content. This can be
used to optionally insert P4D elements in A:<br>
      <br>
      <table
 style="background-color: rgb(255, 255, 239); font-family: courier new; width: 793px; height: 29px; text-align: left;"
 border="0" cellpadding="2" cellspacing="2">
        <tbody>
          <tr>
            <td
 style="background-color: rgb(236, 236, 236); vertical-align: top;"><small>y
= (compute_element(args) if cond else None)<br>
            </small><small><br>
            </small><small>elm A:<br>
&nbsp; &nbsp; &amp;y</small><small><br>
            </small></td>
          </tr>
        </tbody>
      </table>
      <br>
      <br>
      <h2><a class="mozTocH2" name="mozTocId102106"></a>2.8 P4D comments</h2>
      <a name="p4d_comments"></a>Using
single or triple quoted strings are used to denotate P4D content within
P4D elements. They can't be used to create XML like comments which are <span
 style="font-style: italic;">significant</span>.
Signifcant means that the comments are&nbsp;usually not dropped by the
parser but content is sourced out into comments that doesn't fit well
into the document structure otherwise. <br>
      <br>
The comment style of P4D is <small><span
 style="font-family: Courier New,Courier,monospace;">{* &nbsp;... *}</span></small>.
      <br>
      <br>
      <table
 style="background-color: rgb(255, 255, 239); font-family: courier new; width: 793px; height: 29px; text-align: left;"
 border="0" cellpadding="2" cellspacing="2">
        <tbody>
          <tr>
            <td
 style="background-color: rgb(236, 236, 236); vertical-align: top;"><small>elm
foo:<br>
&nbsp; &nbsp; {* This is a<br>
&nbsp; &nbsp; &nbsp; &nbsp;comment *}<br>
            <br>
&nbsp; &nbsp; """... and this is<br>
&nbsp; &nbsp; &nbsp; &nbsp;content.<br>
&nbsp; &nbsp; """</small></td>
          </tr>
        </tbody>
      </table>
      <br>
You can access a comment by either using the comment() object method or
the child(tag) object method with tag = '*'. Notice that a P4D comment
is a regular P4D element! A P4D comment is much like a docstring in
Python which is just a usual string.<br>
      <h2><a class="mozTocH2" name="mozTocId927133"></a>2.9 Element
assignments and deletions <small>( <span
 style="color: rgb(204, 0, 0);">new in P4D 1.2</span> )</small><br>
      </h2>
      <h3><a class="mozTocH3" name="mozTocId87753"></a>2.9.1 Assignments<br>
      </h3>
You can modify content or replacing elements by assigning values to
them:<br>
      <table
 style="background-color: rgb(255, 255, 239); font-family: courier new; width: 793px; height: 29px; text-align: left;"
 border="0" cellpadding="2" cellspacing="2">
        <tbody>
          <tr>
            <td
 style="background-color: rgb(236, 236, 236); vertical-align: top;"><small>elm
a:<br>
&nbsp; &nbsp; b: 1<br>
            <br>
elm b:<br>
&nbsp;&nbsp;&nbsp; c: 2<br>
            <br>
p4d&gt; a.b.content()<br>
'1'<br>
p4d&gt; a.b = 2<br>
p4d&gt; a.b.content()<br>
'2'<br>
p4d&gt; a.b = b<br>
p4d&gt; a.b.c.content()<br>
'2'<br>
            </small></td>
          </tr>
        </tbody>
      </table>
      <br>
Notice that you can't assign a P4D element A to a P4D element B. When
you really want to change a tag you have to rebind the tag attribute:<br>
      <br>
      <table
 style="background-color: rgb(255, 255, 239); font-family: courier new; width: 793px; height: 29px; text-align: left;"
 border="0" cellpadding="2" cellspacing="2">
        <tbody>
          <tr>
            <td
 style="background-color: rgb(236, 236, 236); vertical-align: top;"><small>p4d&gt;
a.b[0].tag = 'x'<br>
p4d&gt; a.x<br>
[P4D&lt;x&gt;]<br>
            </small></td>
          </tr>
        </tbody>
      </table>
      <br>
Further limitations: you can't assign to b if b is a list of nodes with
length &gt; 1. <br>
      <br>
      <h3><a class="mozTocH3" name="mozTocId266176"></a>2.9.2 Deletions<br>
      </h3>
Subelement deletions are as easy as assignments<br>
      <br>
      <table
 style="background-color: rgb(255, 255, 239); font-family: courier new; width: 793px; height: 29px; text-align: left;"
 border="0" cellpadding="2" cellspacing="2">
        <tbody>
          <tr>
            <td
 style="background-color: rgb(236, 236, 236); vertical-align: top;"><small>p4d&gt;
elm a:<br>
....&nbsp;&nbsp;&nbsp; b<br>
....&nbsp;&nbsp;&nbsp; c<br>
....<br>
p4d&gt; a.children()<br>
            </small><small>[P4D&lt;b&gt;, P4D&lt;c&gt;]</small><br>
            <small>p4d&gt; del
a['c']&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
# remove 'key'<br>
p4d&gt; a.children()<br>
[P4D&lt;b&gt;]<br>
            </small></td>
          </tr>
        </tbody>
      </table>
      <br>
A KeyError is raised when no child element with tag = 'c' is available.<br>
      <br>
      <h1><a class="mozTocH1" name="mozTocId138234"></a>3. Support for
XML languages</h1>
Support for XML languages is an obvious goal of P4D. The transition
between P4D and XML shall be smooth since internally the same
datastructure is used to hold elements. In section 5.1 we start with
some conversion groundwork. Section 5.2. examines Adobe Flex and MXML
as one particular use case. <br>
      <h2><a class="mozTocH2" name="mozTocId345825"></a>3.1. xmlstr and
p4dstr<br>
      </h2>
      <table
 style="background-color: rgb(255, 255, 239); font-family: courier new; width: 793px; height: 29px; text-align: left;"
 border="0" cellpadding="2" cellspacing="2">
        <tbody>
          <tr>
            <td
 style="background-color: rgb(236, 236, 236); vertical-align: top;"><small><span
 style="color: rgb(0, 0, 0);"></span>p4d&gt; elm philosopher:<br>
....&nbsp;&nbsp;&nbsp; name: "Hegel"<br>
....&nbsp;&nbsp;&nbsp; main-work: "Phaenomenologie des Geistes"<br>
....&nbsp;&nbsp;&nbsp; first-edition: 1807<br>
....<br>
p4d&gt; hegel_data = philosopher.xmlstr()<br>
p4d&gt; print hegel_data<br>
&lt;philosopher&gt;<br>
&nbsp;&nbsp;&nbsp; &lt;name&gt;Hegel&lt;/name&gt;<br>
&nbsp;&nbsp;&nbsp; &lt;main-work&gt;Phaenomenologie des
Geistes&lt;/main-work&gt;<br>
&nbsp;&nbsp;&nbsp; &lt;first-edition&gt;1807&lt;/first-edition&gt;<br>
&lt;/philosopher&gt;<br>
p4d&gt;<br>
            </small></td>
          </tr>
        </tbody>
      </table>
      <br>
You can reconstruct the original P4D element with the same ease:<br>
      <br>
      <table
 style="background-color: rgb(255, 255, 239); font-family: courier new; width: 793px; height: 29px; text-align: left;"
 border="0" cellpadding="2" cellspacing="2">
        <tbody>
          <tr>
            <td
 style="background-color: rgb(236, 236, 236); vertical-align: top;"><small><span
 style="color: rgb(0, 0, 0);"></span>p4d&gt; philosopher =
P4D.from_xml(hegel_data)<br>
p4d&gt; print philosopher.p4dstr()<br>
philosopher:<br>
&nbsp;&nbsp;&nbsp; name: "Hegel"<br>
&nbsp;&nbsp;&nbsp; main-work: "Phaenomenologie des Geistes"<br>
&nbsp;&nbsp;&nbsp; first-edition: "1807"<br>
            </small></td>
          </tr>
        </tbody>
      </table>
      <br>
You can print additional data that are optional e.g. a standard XML
declaration:<br>
      <br>
      <table
 style="background-color: rgb(255, 255, 239); font-family: courier new; width: 793px; height: 29px; text-align: left;"
 border="0" cellpadding="2" cellspacing="2">
        <tbody>
          <tr>
            <td
 style="background-color: rgb(236, 236, 236); vertical-align: top;"><small><span
 style="color: rgb(0, 0, 0);"></span>p4d&gt; print
philosopher.xmlstr(xml_declaration = True)<br>
&lt;?xml version="1.0" encoding="UTF-8" ?&gt;<br>
&lt;philosopher&gt;<br>
&nbsp;&nbsp;&nbsp; &lt;name&gt;Hegel&lt;/name&gt;<br>
&nbsp;&nbsp;&nbsp; &lt;main-work&gt;Phaenomenologie des
Geistes&lt;/main-work&gt;<br>
&nbsp;&nbsp;&nbsp; &lt;first-edition&gt;1807&lt;/first-edition&gt;<br>
&lt;/philosopher&gt;<br>
            </small></td>
          </tr>
        </tbody>
      </table>
      <br>
Another option is to create an assignment when a P4D representation is
created:<br>
      <br>
      <table
 style="background-color: rgb(255, 255, 239); font-family: courier new; width: 793px; height: 29px; text-align: left;"
 border="0" cellpadding="2" cellspacing="2">
        <tbody>
          <tr>
            <td
 style="background-color: rgb(236, 236, 236); vertical-align: top;"><small>p4d&gt;
print philosopher.p4dstr(name = "p4ddoc")<br>
p4ddoc = philosopher:<br>
&nbsp;&nbsp;&nbsp; name: "Hegel"<br>
&nbsp;&nbsp;&nbsp; main-work: "Phaenomenologie des Geistes"<br>
&nbsp;&nbsp;&nbsp; first-edition: "1807"<br>
            </small></td>
          </tr>
        </tbody>
      </table>
      <br>
      <h2><a class="mozTocH2" name="mozTocId793892"></a>3.2&nbsp;
xml2p4d conversion from the command-line<br>
      </h2>
Let's say you have an XML file <small
 style="font-family: Courier New,Courier,monospace;">foo.xml</small>
and you want to convert it into P4D. Then you can use the --xml2p4d
command line option and run<br>
      <br>
      <small style="font-family: Courier New,Courier,monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
python run_p4d.py --xml2p4d foo.xml</small><br>
      <br>
This will create a file <small
 style="font-family: Courier New,Courier,monospace;">foo.p4d</small> in
the directory of <small
 style="font-family: Courier New,Courier,monospace;">foo.xml</small>.
If you omit the name foo but just write<br>
      <br>
      <small style="font-family: Courier New,Courier,monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
python run_p4d.py --xml2p4d *.xml<br>
      <br>
      </small>all files with extension xml in the directory you are
pointing to will be converted to p4d.<br>
      <br>
      <h2><a class="mozTocH2" name="mozTocId571264"></a>3.3&nbsp; The
p4d namespace and its transformations<br>
      </h2>
The namespace that is characterized by the URL <small
 style="font-family: Courier New,Courier,monospace;">http://fiber-space.de/p4dns
      </small>and the prefix <small
 style="font-family: Courier New,Courier,monospace;">p4d </small>is
somewhat special as we have noted in section two already. <br>
      <br>
Now take a look at the following XML element kept from a catalog.xml
file which lists resources of Adobe Flex components.<br>
      <br>
      <small> </small><small> </small><small> </small>
      <table
 style="background-color: rgb(255, 255, 239); font-family: courier new; width: 793px; height: 29px; text-align: left;"
 border="0" cellpadding="2" cellspacing="2">
        <tbody>
          <tr>
            <td
 style="background-color: rgb(236, 236, 236); vertical-align: top;"><small>&lt;library
path="library.swf"&gt;<br>
&nbsp;&nbsp; &lt;script name="mx/core/mx_internal" mod="1146526998000"
&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;def id="mx.core:mx_internal" /&gt; <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;dep id="AS3" type="n" /&gt; <br>
&nbsp;&nbsp; &lt;/script&gt;<br>
&lt;/library&gt;<br>
            </small></td>
          </tr>
        </tbody>
      </table>
      <br>
It would translate into <br>
      <br>
      <small> </small><small> </small><small> </small>
      <table
 style="background-color: rgb(255, 255, 239); font-family: courier new; width: 793px; height: 29px; text-align: left;"
 border="0" cellpadding="2" cellspacing="2">
        <tbody>
          <tr>
            <td
 style="background-color: rgb(236, 236, 236); vertical-align: top;"><small>library(path="library.swf"):<br>
&nbsp;&nbsp; script(name="mx/core/mx_internal", mod="1146526998000"):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; def(id="mx.core:mx_internal")<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; dep(id="AS3" type="n")<br>
            </small></td>
          </tr>
        </tbody>
      </table>
      <br>
and this fragment would immediately fail to compile because def which
is used as an element name is a P4D ( and Python ) keyword. That's why
the p4d namespaces prefix is added automatically by default:<br>
      <br>
      <small> </small><small> </small><small> </small>
      <table
 style="background-color: rgb(255, 255, 239); font-family: courier new; width: 793px; height: 29px; text-align: left;"
 border="0" cellpadding="2" cellspacing="2">
        <tbody>
          <tr>
            <td
 style="background-color: rgb(236, 236, 236); vertical-align: top;"><small>p4d&gt;
p4d_lib = P4D.from_xml(xml_lib).p4dstr()<br>
p4d&gt; print p4d_lib<br>
library( path="library.swf" ):<br>
&nbsp;&nbsp;&nbsp; script( name="mx/core/mx_internal", mod=</small><small>"1146526998000"</small><small>
):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span
 style="font-weight: bold;">p4d:def</span>( id="mx.core:mx_internal" )<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; dep( type="n", id="AS3" )<br>
            </small></td>
          </tr>
        </tbody>
      </table>
      <br>
The reverse operation works also in the other direction i.e. when
creating the XML fragment from P4D. Applying&nbsp; xmlstr() <br>
      <br>
      <small> </small><small> </small><small> </small>
      <table
 style="background-color: rgb(255, 255, 239); font-family: courier new; width: 793px; height: 29px; text-align: left;"
 border="0" cellpadding="2" cellspacing="2">
        <tbody>
          <tr>
            <td
 style="background-color: rgb(236, 236, 236); vertical-align: top;"><small>p4d&gt;
print P4D.eval(p4d_lib).xmlstr()<br>
            </small><small>&lt;library
path="library.swf"&gt;<br>
&nbsp;&nbsp; &lt;script name="mx/core/mx_internal" mod="1146526998000"
&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;def id="mx.core:mx_internal" /&gt; <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;dep id="AS3" type="n" /&gt; <br>
&nbsp;&nbsp; &lt;/script&gt;<br>
&lt;/library&gt;<br>
            </small> </td>
          </tr>
        </tbody>
      </table>
      <br>
We can also suppress adding the p4d prefix on loading from XML or we
can suppress stripping the prefix away:<br>
      <br>
      <small> </small><small> </small><small> </small>
      <table
 style="background-color: rgb(255, 255, 239); font-family: courier new; width: 793px; height: 29px; text-align: left;"
 border="0" cellpadding="2" cellspacing="2">
        <tbody>
          <tr>
            <td
 style="background-color: rgb(236, 236, 236); vertical-align: top;"><small>p4d&gt;
print library.xmlstr(<span style="font-weight: bold;">strip_p4d = False</span>)<br>
            </small><small>&lt;library path="library.swf"&gt;<br>
&nbsp;&nbsp;&nbsp; &lt;script name="mx/core/mx_internal"
mod="1146526998000"&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;<span
 style="font-weight: bold;">p4d:def
xmlns:p4d="http://fiber-space.de/p4dns"</span>
id="mx.core:mx_internal"/&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;dep type="n"
id="AS3"/&gt;<br>
&nbsp;&nbsp;&nbsp; &lt;/script&gt;<br>
&lt;/library&gt;</small><br>
            <br>
            </td>
          </tr>
        </tbody>
      </table>
      <br>
Not only has the namespace prefix been
preserved but also the correct namespace declaration has been inserted.
The latter will be done only once.<br>
      <br>
      <h2><a class="mozTocH2" name="mozTocId709862"></a>3.4&nbsp;
Translating XML comments and CDATA</h2>
XML comments will be translated into <a href="#p4d_comments">P4D
comments</a>. That's why P4D comments were introduced in the first
place. A slightly different translation will be performed for CDATA
sections. A P4D comment is fully specified by {* content *}. If we
replace the single star by a double star the P4D comment will be
translated into &lt;![CDATA[ content ]]&gt;.<br>
      <br>
      <small> </small><small> </small><small> </small>
      <table
 style="background-color: rgb(255, 255, 239); font-family: courier new; width: 793px; height: 29px; text-align: left;"
 border="0" cellpadding="2" cellspacing="2">
        <tbody>
          <tr>
            <td
 style="background-color: rgb(236, 236, 236); vertical-align: top;"><small>p4d&gt;
elm stuff:<br>
....&nbsp;&nbsp;&nbsp; '''<br>
....&nbsp;&nbsp;&nbsp; Some text<br>
....&nbsp;&nbsp;&nbsp; '''<br>
....&nbsp;&nbsp;&nbsp; {* and a simple comment ... *}<br>
....&nbsp;&nbsp;&nbsp; {** and a cdata<br>
....&nbsp;&nbsp;&nbsp; section<br>
....&nbsp;&nbsp;&nbsp; **}<br>
....<br>
p4d&gt; print stuff.xmlstr()<br>
&lt;stuff&gt;<br>
&nbsp;&nbsp;&nbsp; Some text<br>
            <br>
&nbsp;&nbsp;&nbsp; &lt;!-- and a simple comment
...&nbsp;&nbsp;&nbsp;&nbsp; --&gt;<br>
&nbsp;&nbsp;&nbsp; &lt;![CDATA[ and a cdata<br>
&nbsp;&nbsp;&nbsp; section<br>
&nbsp;&nbsp;&nbsp; ]]&gt;<br>
&lt;/stuff&gt;<br>
p4d&gt; <br>
p4d&gt; print P4D.from_xml(stuff.xmlstr()).p4dstr() &nbsp; &nbsp; # and
the other way round<br>
stuff:<br>
&nbsp;&nbsp;&nbsp; "Some text"<br>
&nbsp;&nbsp;&nbsp; {*<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; and a simple comment ...<br>
&nbsp;&nbsp;&nbsp; *}<br>
&nbsp;&nbsp;&nbsp; {**<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; and a cdata<br>
&nbsp;&nbsp;&nbsp; section<br>
&nbsp;&nbsp;&nbsp; **}<br>
            <br>
p4d&gt;<br>
            </small></td>
          </tr>
        </tbody>
      </table>
      <br>
Whitespace handling is not perfect. I hope I'll drive it perfection in
the future :)<br>
      <br>
Notice that CDATA comments are treated much like regular P4D comments
i.e. they are normal P4D elements, there is a CDATA() method used to
access a CDATA section and there is an element tag which is '**'.<br>
      <br>
There is obviously some redundancy about comments in P4D but usually
you don't have to care much about them unless you are converting from /
to XML for particular reasons.<br>
      <br>
      <h2><a class="mozTocH2" name="mozTocId460833"></a>3.4. Case Study
- Adobe Flex</h2>
Adobe Flex is a framework used to support so called Rich Internet
Applications ( RIA ). This is such a hot topic right now that it is
somewhat too hot for me to discuss here. So my interest is focussed
mainly on MXML which is an XML language for declarative GUIs
descriptions and part of Flex. The idea of using XML to describe
programming language constructs has been critizised a lot in the past
and I mostly agree with it myself. However one has to change the
perspective to do justice about it. When you consider MXML from the
point of view of a tool vendor who offers a GUI designer that enables
roundtrip engineering in a safe way, it makes good sense. MXML becomes
essentially a human readable serialization format for the FlexBuilder
tool. This is much in alignment with Flash which is also basically a
tool and a player. However Adobe has released an SDK a while ago and
now you can build your applications from the ground up in a way that is
more appealing to programmers like me ( I don't alway rate flexibility
over comfort even when programming but I nevertheless tend to be
fundamentalist as a programmer ).<br>
      <br>
I added the <small><span
 style="font-family: Courier New,Courier,monospace;">flexutils.p4d</span></small>
module to P4D. It might not be for everyone and I'll refuse to explain
Flex related issues ( like configuration ) here. If interested read the
code and adapt it to your advantage. It is not much anyway. However <small><span
 style="font-family: Courier New,Courier,monospace;">flexutils.p4d</span></small>
touches some framework related topics which might be of interest for a
general readership.<br>
      <h3><a class="mozTocH3" name="mozTocId844946"></a>3.4.1&nbsp;
Import <small style="font-family: Courier New,Courier,monospace;">flexutils.p4d</small>
from Python<br>
      </h3>
Any langlet <small><span
 style="font-family: Courier New,Courier,monospace;">( *.p4d ) </span></small>module
compiles to Python bytecodes and can therefore be imported as a
bytecode <small><span
 style="font-family: Courier New,Courier,monospace;">( *.p4d )</span></small>
file. But now suppose you have a Python module that imports a p4d file.
That's what <small><span
 style="font-family: Courier New,Courier,monospace;">run_p4d.py </span></small>does:<br>
      <br>
      <table
 style="background-color: rgb(255, 255, 239); font-family: courier new; width: 793px; height: 29px; text-align: left;"
 border="0" cellpadding="2" cellspacing="2">
        <tbody>
          <tr>
            <td
 style="background-color: rgb(255, 255, 255); vertical-align: top;"><small>&nbsp;
# run_p4d.py<br>
&nbsp; # ----------<br>
&nbsp; <br>
&nbsp; import flexutils&nbsp;&nbsp; # imports a p4d-module<br>
            </small></td>
          </tr>
        </tbody>
      </table>
      <br>
and you change <small><span
 style="font-family: Courier New,Courier,monospace;">flexutils.p4d</span></small>.
Only as long as flexutils.p4d gets compiled <span
 style="font-style: italic;">before</span> run_p4d.py is executed
everything works well and the most recent changes will be notified.
Otherwise the old <small><span
 style="font-family: Courier New,Courier,monospace;">flexutils.pyc</span></small>
will be imported. In order to enforce recompilation on change we
replace the import directive:<br>
      <br>
      <table
 style="background-color: rgb(255, 255, 239); font-family: courier new; width: 793px; height: 29px; text-align: left;"
 border="0" cellpadding="2" cellspacing="2">
        <tbody>
          <tr>
            <td
 style="background-color: rgb(255, 255, 255); vertical-align: top;"><small>&nbsp;
# run_p4d.py<br>
&nbsp; # ----------<br>
&nbsp; import EasyExtend.eeimporter as eeimporter <br>
&nbsp; import langlet as p4d_langlet<br>
&nbsp; flexutils = eeimporter.import_from_langlet(p4d_langlet,
"flexutils")<br>
            </small></td>
          </tr>
        </tbody>
      </table>
      <br>
The <small style="font-family: Courier New,Courier,monospace;">import_from_langlet</small>
function is generic over langlets. You need to pass the right langlet
of course to apply the correct transformations on <small><span
 style="font-family: Courier New,Courier,monospace;">flexutils.p4d</span></small>.
This import pattern doesn't have to be applied when you import Python
modules from P4D. <br>
      <br>
      <table
 style="background-color: rgb(255, 255, 239); font-family: courier new; width: 793px; height: 29px; text-align: left;"
 border="0" cellpadding="2" cellspacing="2">
        <tbody>
          <tr>
            <td style="vertical-align: top;"><img
 style="width: 25px; height: 25px;" alt=""
 src="p4d-Dateien/Achtung4.PNG"><br>
            </td>
            <td
 style="background-color: rgb(255, 255, 255); vertical-align: top; font-family: Times New Roman,Times,serif;">You
can't run <br>
            <small style="font-family: Courier New,Courier,monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
if __name__ == '__main__': <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;
BODY<br>
            </small><br>
defined inside a <small><span
 style="font-family: Courier New,Courier,monospace;">.py</span></small>
module from <small><span
 style="font-family: Courier New,Courier,monospace;">P4D</span></small>.
You can run this inside <small><span
 style="font-family: Courier New,Courier,monospace;">.p4d</span></small>
modules though. The reason is that EasyExtend transforms this statement
into an ordinary method call and calls this method but only for langlet
modules not for Python modules that won't get transformed at all. <br>
            </td>
          </tr>
        </tbody>
      </table>
      <h1><a class="mozTocH1" name="mozTocId234863"></a>4. Bytelets <small>(
      <span style="color: rgb(255, 0, 0);">new in P4D 1.2</span> )</small><br>
      </h1>
A detailed treatment of Bytelets can be found <a href="bytelets.html">here</a>.<br>
      <br>
At this place it shall only be mentioned that Bytelets affect P4D as a
whole in following respects:<br>
      <ul>
        <li>Two more namespaces are introduced. Their prefixes are <small><span
 style="font-family: Courier New,Courier,monospace;">bl</span></small>
and <small style="font-family: Courier New,Courier,monospace;">bl-schema</small>.</li>
        <li>Hexadecimal literals like 0x89 or 0xA57 are not mapped on
integers in P4D but on Hex objects. Moreover it is possible to write
sequences of such numbers separated by a space e.g. 0x01 0x78 0x67.
This is an important departure from Python and might break existing
semantics.<br>
        </li>
      </ul>
      <h1><a class="mozTocH1" name="mozTocId261442"></a>5. Token.ext
&amp; Grammar.ext<br>
      </h1>
The syntactical extensions involve both the lexer and the parser. <br>
      <h2><a class="mozTocH2" name="mozTocId929987"></a>5.1 Token.ext</h2>
      <dl>
        <dd class="grammar">
          <div class="productions">
          <table
 style="background-color: rgb(153, 255, 255); width: 680px; height: 54px;"
 border="3">
            <tbody>
              <tr>
                <td style="font-family: courier new;"><small>DOUBLECOLON<br>
                </small><small>OPERATOR<br>
NAME<br>
P4_NS<br>
Name<br>
P4D_Comment<br>
                </small></td>
                <td style="font-family: courier new;"><small>::=<br>
                </small><small>::=<br>
::=<br>
::=<br>
::=<br>
                </small><small>::=</small><br>
                </td>
                <td style="font-family: courier new;"><small>'::' <br>
OPERATOR_DEF | DOUBLECOLON<br>
Name ('-' NAME)* | P4_NS<br>
'p4d' ':' NAME<br>
A_CHAR ( A_CHAR | A_DIGIT )*<br>
'{' '*' ('*'|ANY)* '*' '}'<br>
                </small></td>
              </tr>
            </tbody>
          </table>
          </div>
        </dd>
      </dl>
Most noteworthy is the redefinition of NAME and the introduction
of Name that carries on the standard definition of the Token module.<br>
Enabling hyphenated names of the kind <small
 style="font-family: Courier New,Courier,monospace;">monty-python-football</small>
is problematic in other contexts where it has to be understood as an
arithmetic difference or isn't permitted entirely. The transformation
actually takes care:<br>
      <br>
      <table
 style="background-color: rgb(255, 255, 239); font-family: courier new; width: 793px; height: 29px; text-align: left;"
 border="0" cellpadding="2" cellspacing="2">
        <tbody>
          <tr>
            <td
 style="background-color: rgb(236, 236, 236); vertical-align: top;"><small>p4d&gt;
a = b = 0<br>
p4d&gt; a-b<br>
0<br>
            </small><small>p4d&gt; a-b:0<br>
P4D&lt;a-b&gt;<br>
p4d&gt; import a-b<br>
Traceback...<br>
...<br>
SyntaxError: invalid syntax. No hyphenation permitted in Python names.<br>
            </small></td>
          </tr>
        </tbody>
      </table>
      <br>
With P4_NS we can <span style="font-style: italic;">escape </span>keywords.
Just look at the difference in behaviour:<br>
      <br>
      <table
 style="background-color: rgb(255, 255, 239); font-family: courier new; width: 793px; height: 29px; text-align: left;"
 border="0" cellpadding="2" cellspacing="2">
        <tbody>
          <tr>
            <td
 style="background-color: rgb(236, 236, 236); vertical-align: top;"><small>p4d&gt;
a:pass:""<br>
Traceback...<br>
...<br>
ParserError: Failed to parse input 'pass' at (line 1 , column 6).<br>
            <br>
&nbsp;&nbsp;&nbsp; a:pass:""<br>
            <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ^^^^<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <br>
            </small><small>p4d&gt; p4d:pass:""<br>
P4D&lt;p4d:pass&gt;<br>
            </small></td>
          </tr>
        </tbody>
      </table>
      <br>
This wouldn't be feasible with the current parser if we won't deal with
      <small style="font-family: Courier New,Courier,monospace;">"p4d:pass"</small>
as a single chunk and doing some postprocessing.<br>
      <br>
      <h2><a class="mozTocH2" name="mozTocId723366"></a>5.2 Grammar.ext</h2>
      <dl>
        <dd class="grammar">
          <div class="productions">
          <table
 style="background-color: rgb(153, 255, 255); width: 778px; height: 23px;"
 border="3">
            <tbody>
              <tr>
                <td style="font-family: courier new;"><small
 style="font-family: Courier New,Courier,monospace;">compound_stmt</small><br>
                <small
 style="font-family: Courier New,Courier,monospace;">p4d_compound_stmt</small><br>
                <small
 style="font-family: Courier New,Courier,monospace;">p4d_element</small><br>
                <small
 style="font-family: Courier New,Courier,monospace;">p4d_attribute_list<br>
                </small><small
 style="font-family: Courier New,Courier,monospace;">p4d_attribute</small><br>
                <small
 style="font-family: Courier New,Courier,monospace;">p4d_suite</small><br>
                <small
 style="font-family: Courier New,Courier,monospace;">p4d_simple_stmt</small><br>
                <small
 style="font-family: Courier New,Courier,monospace;">p4d_stmt</small><br>
                <small
 style="font-family: Courier New,Courier,monospace;">p4d_expr<br>
                </small><small
 style="font-family: Courier New,Courier,monospace;"><br>
p4d_accessor</small><br>
                <small
 style="font-family: Courier New,Courier,monospace;">trailer</small><br>
                <small
 style="font-family: Courier New,Courier,monospace;">p4d_name</small><br>
                <small
 style="font-family: Courier New,Courier,monospace;">p4d_attr_access</small><br>
                <small
 style="font-family: Courier New,Courier,monospace;">atom<br>
                <br>
                <br>
                <br>
                <br>
HEXNUM<br>
subscript<br>
                <br>
                <br>
                </small></td>
                <td style="font-family: courier new;"><small
 style="font-family: Courier New,Courier,monospace;">::=<br>
                </small><small
 style="font-family: Courier New,Courier,monospace;">::=<br>
::=<br>
::=<br>
                </small><small
 style="font-family: Courier New,Courier,monospace;">::=<br>
                </small><small
 style="font-family: Courier New,Courier,monospace;">::=<br>
                </small><small
 style="font-family: Courier New,Courier,monospace;">::=<br>
                </small><small
 style="font-family: Courier New,Courier,monospace;">::=<br>
                </small><small
 style="font-family: Courier New,Courier,monospace;">::=<br>
                </small><small
 style="font-family: Courier New,Courier,monospace;"><br>
::=<br>
                </small><small
 style="font-family: Courier New,Courier,monospace;">::=<br>
                </small><small
 style="font-family: Courier New,Courier,monospace;">::=<br>
                </small><small
 style="font-family: Courier New,Courier,monospace;">::=<br>
                </small><small
 style="font-family: Courier New,Courier,monospace;">::=<br>
                <br>
                </small><small
 style="font-family: Courier New,Courier,monospace;"> </small><br
 style="font-family: Courier New,Courier,monospace;">
                <small><br>
                <br>
::=<br>
::=<br>
                <br>
                <br>
                </small></td>
                <td style="font-family: courier new;"><small
 style="font-family: Courier New,Courier,monospace;">if_stmt |
while_stmt | for_stmt | try_stmt | ... | p4d_compound_stmt</small><br>
                <small
 style="font-family: Courier New,Courier,monospace;">['elm' | NAME '=']
p4d_element ':' p4d_suite</small><br>
                <small
 style="font-family: Courier New,Courier,monospace;">p4d_name ['('
[p4d_attribute_list] ')']</small><br>
                <small
 style="font-family: Courier New,Courier,monospace;">p4d_attribute
([','] p4d_attribute)*<br>
                </small><small
 style="font-family: Courier New,Courier,monospace;">p4d_name '='
['&amp;'] test</small><br>
                <small
 style="font-family: Courier New,Courier,monospace;">p4d_simple_stmt |
NEWLINE INDENT p4d_stmt+ DEDENT</small><br>
                <small
 style="font-family: Courier New,Courier,monospace;">(p4d_element |
p4d_expr) NEWLINE</small><br>
                <small
 style="font-family: Courier New,Courier,monospace;">p4d_simple_stmt |
p4d_compound_stmt</small><br>
                <small
 style="font-family: Courier New,Courier,monospace;">'&amp;' '.'* test
| '(' [ p4d_expr (',' p4d_expr)*] ')' | '[' [ p4d_expr (',' p4d_expr)*]
']' | STRING | NUMBER | HEXNUM | P4D_Comment<br>
'.'
p4d_attr_access |'::' NAME | '.' '(' test ')'</small><br>
                <small
 style="font-family: Courier New,Courier,monospace;">'(' [arglist] ')'
| '[' subscriptlist ']' | '.' NAME | p4d_accessor</small><br>
                <small
 style="font-family: Courier New,Courier,monospace;">NAME [':' NAME]</small><br>
                <small
 style="font-family: Courier New,Courier,monospace;">'@' ( NAME | '*')</small><br>
                <small
 style="font-family: Courier New,Courier,monospace;">atom: ('('
[yield_expr|testlist_gexp] ')' |<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; '[' [listmaker] ']' |<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; '{' [dictmaker] '}' |<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; '`' testlist1 '`' |<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; NAME | NUMBER | STRING+ |
HEXNUM | p4d_attr_accesss<br>
Hexnumber+<br>
'.' '.' '.' | test | [test] ':' test [sliceop] | [test] '::' test |<br>
'::' test | [test] ':'<br>
                <br>
                </small></td>
              </tr>
            </tbody>
          </table>
          </div>
        </dd>
      </dl>
      <small style="font-family: Courier New,Courier,monospace;"><br>
      </small>Rules that substitute those of Pythons grammar are <small
 style="font-family: Courier New,Courier,monospace;">atom</small>, <small
 style="font-family: Courier New,Courier,monospace;">trailer</small>
and <small style="font-family: Courier New,Courier,monospace;">compound_stmt</small>.
P4D specific statements are realized as compound statements and they
follow the rules of Pythons indentation.<br>
      <h3><a class="mozTocH3" name="mozTocId877232"></a>5.2.1&nbsp;
Translation of <small
 style="font-family: Courier New,Courier,monospace;">p4d_compound_stmt</small><br>
      </h3>
A P4D compound statement is translated into a P4D object constructor
call. Instead of giving a formal specification here we simply show some
translations of common P4D compound statement structures.<br>
      <br>
      <small> </small><small> </small><small> </small>
      <table
 style="background-color: rgb(255, 255, 239); font-family: courier new; width: 793px; height: 29px; text-align: left;"
 border="0" cellpadding="2" cellspacing="2">
        <tbody>
          <tr>
            <td
 style="background-color: rgb(236, 236, 236); vertical-align: top;"><small>p4d&gt;
            <span style="color: rgb(0, 0, 153);">a</span>:<br>
....&nbsp;&nbsp;&nbsp; <span style="color: rgb(0, 153, 0);">b</span>:<span
 style="color: rgb(204, 0, 0);">0</span><br>
....<br>
[python-source&gt;<br>
P4D( mapeval([<span style="color: rgb(0, 0, 153);">'a'</span>, {}, [[<span
 style="color: rgb(0, 153, 0);">'b'</span>, {}, [<span
 style="color: rgb(204, 0, 0);">'0'</span>]]]] , globals(
)))<br>
            <br>
&lt;python-source]<br>
P4D&lt;a&gt;<br>
            </small></td>
          </tr>
        </tbody>
      </table>
      <br>
The list that is passed to <small
 style="font-family: Courier New,Courier,monospace;">mapeval</small>
has the canonical form<br>
      <br>
      <small style="font-family: Courier New,Courier,monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
[TAG, ATTRS, CHILDREN, TEXT]</small><br>
      <br>
The textual content isn't stored separately but among the <small
 style="font-family: Courier New,Courier,monospace;">CHILDREN</small>.
P4D automatically stringifies numbers such as the 0. Actually the <br>
content can be omitted completely<br>
      <br>
      <small> </small><small> </small><small> </small>
      <table
 style="background-color: rgb(255, 255, 239); font-family: courier new; width: 793px; height: 29px; text-align: left;"
 border="0" cellpadding="2" cellspacing="2">
        <tbody>
          <tr>
            <td
 style="background-color: rgb(236, 236, 236); vertical-align: top;"><small>p4d&gt;
            <span style="color: rgb(0, 0, 153);">a</span>:<br>
....&nbsp;&nbsp;&nbsp; <span style="color: rgb(0, 153, 0);">b</span><span
 style="color: rgb(204, 0, 0);"></span><br>
....<br>
[python-source&gt;<br>
P4D( mapeval([<span style="color: rgb(0, 0, 153);">'a'</span>, {}, [[<span
 style="color: rgb(0, 153, 0);">'b'</span>, {}, [<span
 style="color: rgb(204, 0, 0);"></span>]]]] , globals( )))<br>
            <br>
&lt;python-source]<br>
P4D&lt;a&gt;<br>
            </small></td>
          </tr>
        </tbody>
      </table>
      <br>
Here is another example using attributes ( and also namespaces ).<br>
      <br>
      <table
 style="background-color: rgb(255, 255, 239); font-family: courier new; width: 793px; height: 29px; text-align: left;"
 border="0" cellpadding="2" cellspacing="2">
        <tbody>
          <tr>
            <td
 style="background-color: rgb(236, 236, 236); vertical-align: top;"><small>p4d&gt;
p4d:if:<br>
....&nbsp;&nbsp;&nbsp; p4d:while(x=1 y=2):<br>
....&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
p4d:pass<br>
....<br>
[python-source&gt;<br>
P4D( mapeval(['p4d:if', {}, [['p4d:while', {'y': 'evaltostr_1', 'x':
'evaltostr_2'}, [['p4d:pass', {}, []]]]]] ,<br>
&nbsp;globals( )))<br>
            <br>
&lt;python-source]<br>
P4D&lt;p4d:if&gt;</small></td>
          </tr>
        </tbody>
      </table>
      <br>
What's more remarkable here are the attribute value strings <small
 style="font-family: Courier New,Courier,monospace;">'evaltostr_1' </small>and<small
 style="font-family: Courier New,Courier,monospace;"> 'evaltostr_2'</small>.
These strings are the reason for the presence of mapeval. The mapeval
function seeks for strings beginning with "evaltostr_" and "evaltoobj_"
and evaluates the appended part of the string which is "1" and "2"
here. Finally it turns them into strings again. What is redundant in
our particular example makes sense in the more general case.<br>
      <br>
      <table
 style="background-color: rgb(255, 255, 239); font-family: courier new; width: 793px; height: 29px; text-align: left;"
 border="0" cellpadding="2" cellspacing="2">
        <tbody>
          <tr>
            <td
 style="background-color: rgb(236, 236, 236); vertical-align: top;"><small>p4d&gt;
a = 89<br>
p4d&gt; b(x = <span style="color: rgb(0, 0, 153);">1+a</span>):""<br>
[python-source&gt;<br>
P4D( mapeval(['b', {'x': 'evaltostr_<span style="color: rgb(0, 0, 153);">1
+ a</span>'}, []] , globals( )))<br>
            <br>
&lt;python-source]<br>
P4D&lt;b&gt;<br>
            <br>
            </small></td>
          </tr>
        </tbody>
      </table>
      <br>
Now we can access the evaluated attribute value:<br>
      <br>
      <table
 style="background-color: rgb(255, 255, 239); font-family: courier new; width: 793px; height: 29px; text-align: left;"
 border="0" cellpadding="2" cellspacing="2">
        <tbody>
          <tr>
            <td
 style="background-color: rgb(236, 236, 236); vertical-align: top;"><small>p4d&gt;
c = b(x = <span style="color: rgb(0, 0, 0);">1+a</span>):""<br>
p4d&gt; c.@x<br>
'90'<br>
            </small></td>
          </tr>
        </tbody>
      </table>
      <br>
      <br>
      <h1><a class="mozTocH1" name="mozTocId808156"></a>6. History</h1>
      <br>
      <table style="text-align: left; width: 785px; height: 68px;"
 border="1" cellpadding="2" cellspacing="2">
        <tbody>
          <tr>
            <td
 style="vertical-align: top; text-align: left; background-color: rgb(240, 240, 240);"><span
 style="font-weight: bold;">Date</span><br>
            </td>
            <td
 style="vertical-align: top; text-align: left; background-color: rgb(240, 240, 240);"><span
 style="font-weight: bold;">Version</span><br>
            </td>
            <td
 style="vertical-align: top; text-align: left; background-color: rgb(240, 240, 240);"><span
 style="font-weight: bold;">Change</span><br>
            </td>
          </tr>
          <tr>
            <td style="vertical-align: top;">2008-08-16</td>
            <td style="vertical-align: top;">1.2.3<br>
            </td>
            <td style="vertical-align: top;">
            <ul>
              <li>Bugfix in evalutils: elements of the kind <br>
              </li>
            </ul>
            <small style="font-family: Courier New,Courier,monospace;"><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; A:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
B: ["x1", "x2"]<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
C: ["y1", "y2"]<br>
            <br>
            </small>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
caused problems when C was expanded.<br>
            <ul>
              <li>Add P4DContentList for storing content that stems
from multiple inputs as in the following case:<br>
              </li>
            </ul>
            <small style="font-family: Courier New,Courier,monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
A:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
"A string"<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
"Another String"</small><br>
            <ul>
              <li>add get() method to P4D and P4DList objects. It's
close to child() but unlike child it doesn't raise a ValueError
exception if child element is unavailable.<br>
              </li>
            </ul>
            </td>
          </tr>
          <tr>
            <td style="vertical-align: top;">2008-08-13<br>
            </td>
            <td style="vertical-align: top;">1.2.2<br>
            </td>
            <td style="vertical-align: top;">
            <ul>
              <li>Bugfix in xmlutils: attribute accepts empty string
values.</li>
              <li>Bugfix in p4dutils: xml2p4d conversion failed due to
import error on P4D when not started from P4D.</li>
            </ul>
            </td>
          </tr>
          <tr>
            <td style="vertical-align: top;">2008-08-10</td>
            <td style="vertical-align: top;">1.2.1<br>
            </td>
            <td style="vertical-align: top;">
            <ul>
              <li>Worst case error i.e. <span
 style="font-style: italic;">grammar bug</span> fixed. Token.ext
specified (* ... *) as comments within P4D elements. I completely
overlooked that this can't be used since foo(*bar) is a valid. This bug
remained unrecognized because Grammar / Token are separated from each
other. We need to replace (* ... *) by {* ... *}. This is both Python
2.X as well as Python 3.0 compliant. <span
 style="color: rgb(51, 0, 51);">This change is not downwards compatible!</span><br>
              </li>
            </ul>
            </td>
          </tr>
          <tr>
            <td style="vertical-align: top;">2008-07-12</td>
            <td style="vertical-align: top;">1.2<br>
            </td>
            <td style="vertical-align: top;">
            <ul>
              <li>One can now set attribute values and content easily
without referring to the internal datastructure.</li>
              <li>Introduction of Bytelets and the <span
 style="font-style: italic;">bl</span> namespace which is supported on
language level.</li>
              <li>Adding a Hex object in this context.<br>
              </li>
              <li><small><span
 style="font-family: Courier New,Courier,monospace;">elm foo:bar</span></small><small><span
 style="font-family: Courier New,Courier,monospace;">:</span></small>
... works now like an assignment&nbsp; <small><span
 style="font-family: Courier New,Courier,monospace;">bar = </span></small><small><span
 style="font-family: Courier New,Courier,monospace;">foo:bar:</span></small>...
which is valid&nbsp; for all for all non keywords and non hyphened
names.<br>
              </li>
            </ul>
            </td>
          </tr>
          <tr>
            <td style="vertical-align: top;">2008-07-11</td>
            <td style="vertical-align: top;">1.1.1<br>
            </td>
            <td style="vertical-align: top;">
            <ul>
              <li>Fix: remove py4as3 import from xmlutils and p4dbase<br>
              </li>
            </ul>
            </td>
          </tr>
          <tr>
            <td style="vertical-align: top;">2008-07-11</td>
            <td style="vertical-align: top;">1.1</td>
            <td style="vertical-align: top;">
            <ul>
              <li>Fix XML formatAttributes() in xmlutils.</li>
              <li>Make locals() available for mapeval.<br>
              </li>
              <li>Add flexutils module</li>
              <li>Add elm keyword</li>
              <li>Add P4D comments</li>
              <li>Fix double-colon access for namespaces with p4d
prefix.</li>
              <li>Add element lists or tuples.</li>
              <li>Add P4D.eval()</li>
              <li>Add CDATA handling</li>
              <li>Change filter semantics<br>
              </li>
            </ul>
            </td>
          </tr>
          <tr>
            <td
 style="vertical-align: top; background-color: rgb(250, 250, 250);">2008-06-26<br>
            </td>
            <td style="vertical-align: top;">1.0<br>
            </td>
            <td style="vertical-align: top;">Initial release<br>
            </td>
          </tr>
        </tbody>
      </table>
      <br>
      <hr style="width: 100%; height: 2px;"><br>
      </td>
    </tr>
  </tbody>
</table>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<br>
<br>
<br>
</body>
</html>
