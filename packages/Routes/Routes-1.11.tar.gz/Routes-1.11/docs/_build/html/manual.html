<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Routes Manual &mdash; Routes v1.11 documentation</title>
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '1.11',
        COLLAPSE_MODINDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="search" type="application/opensearchdescription+xml"
          title="Search within Routes v1.11 documentation"
          href="_static/opensearch.xml"/>
    <link rel="top" title="Routes v1.11 documentation" href="index.html" />
    <link rel="next" title="Glossary" href="glossary.html" />
    <link rel="prev" title="Routes Documentation" href="contents.html" /> 
  </head>
  <body>
<div style="color: #D1361B; font-size: 70px; font-weight: bold; padding: 10px 0 0 10px;">Routes</div>
</div>

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="modindex.html" title="Global Module Index"
             accesskey="M">modules</a> |</li>
        <li class="right" >
          <a href="glossary.html" title="Glossary"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="contents.html" title="Routes Documentation"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">Routes home</a>&nbsp;|&nbsp;</li>
        <li><a href="contents.html">Documentation</a>&raquo;</li>
 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="routes-manual">
<h1>Routes Manual<a class="headerlink" href="#routes-manual" title="Permalink to this headline">¶</a></h1>
<p><em>Updated 2009-09-04 for Routes 1.11</em></p>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<img align="left" alt="_images/routes-logo.png" class="align-left" src="_images/routes-logo.png" style="width: 100px; height: 171px;" />
<p>Routes tackles an interesting problem that comes up frequently in web
development, <em>how do you map URLs to your application&#8217;s actions</em>? That is, how
do you say that <em>this</em> should be accessed as &#8220;/blog/2008/01/08&#8221;, and &#8220;/login&#8221;
should do <em>that</em>? Many web frameworks have a fixed dispatching system; e.g.,
&#8220;/A/B/C&#8221; means to read file &#8220;C&#8221; in directory &#8220;B&#8221;, or to call method &#8220;C&#8221; of
class &#8220;B&#8221; in module &#8220;A.B&#8221;. These work fine until you need to refactor your code
and realize that moving a method changes its public URL and invalidates users&#8217;
bookmarks.  Likewise, if you want to reorganize your URLs and make a section
into a subsection, you have to change your carefully-tested logic code.</p>
<p>Routes takes a different approach. You determine your URL hierarchy and and
actions separately, and then link them together in whichever ways you decide.
If you change your mind about a particular URL, just change one line in your
route map and never touch your action logic. You can even have multiple URLs
pointing to the same action; e.g., to support legacy bookmarks.  Routes was
originally inspired by the dispatcher in Ruby on Rails but has since diverged.</p>
<p>Routes is the primary dispatching system in the Pylons web framework, and an
optional choice in CherryPy. It can be added to any
framework without much fuss, and used for an entire site or a URL subtree.
It can also forward subtrees to other dispatching systems, which is how
TurboGears 2 is implemented on top of Pylons.</p>
<p>Current features:</p>
<ul class="simple">
<li>Sophisticated route lookup and URL generation</li>
<li>Named routes</li>
<li>Redirect routes</li>
<li>Wildcard paths before and after static parts</li>
<li>Sub-domain support built-in</li>
<li>Conditional matching based on domain, cookies, HTTP method (RESTful), and more</li>
<li>Easily extensible utilizing custom condition functions and route generation
functions</li>
<li>Extensive unit tests</li>
</ul>
<p>Buzzword compliance:  REST, DRY.</p>
<p>If you&#8217;re new to Routes or have not read the Routes 1.11 manual before, we
recommend reading the <a class="reference external" href="glossary.html">Glossary</a> before continuing.</p>
<p>This manual is written from the user&#8217;s perspective: how to use Routes in a
framework that already supports it. The <a class="reference external" href="porting.html">Porting</a>
manual describes how to add Routes support to a new framework.</p>
<p>You may have heard about a development version called &#8220;Routes 2&#8221;.  Routes 2 is
now called &#8220;Routes-experimental&#8221;.  It was originally intended to be a
refactoring with a new API.  Instead its features are being incorporated into
Routes 1 in a compatible manner.  There may be another Routes 2 in the future
that drops deprecated features, but it&#8217;s too early to say when/if that might
happen.</p>
</div>
<div class="section" id="setting-up-routes">
<h2>Setting up routes<a class="headerlink" href="#setting-up-routes" title="Permalink to this headline">¶</a></h2>
<p>It is assumed that you are using a framework that has preconfigured Routes for
you.  In Pylons, you define your routes in the <tt class="docutils literal"><span class="pre">make_map</span></tt> function in your
<em>myapp/config/routing.py</em> module.  Here is a typical configuration:</p>
<div class="highlight-python"><pre>1   from routes import Mapper
2   map = Mapper()
3   map.minimization = False
4   map.connect(None, "/error/{action}/{id}, controller="error")
5   map.connect("home", "/", controller="main", action="index")
6   # ADD CUSTOM ROUTES HERE
7   map.connect(None, "/{controller}/{action}")
8   map.connect(None, "/{controller}/{action}/{id}")</pre>
</div>
<p>Lines 1 and 2 create a mapper.  Line 3 is backward compatibility code that
disables an earlier misfeature.</p>
<p>Line 4 matches any three-component route that starts with &#8220;/error&#8221;, and sets
the &#8220;controller&#8221; variable to a constant, so that a URL
&#8220;/error/images/arrow.jpg&#8221; would produce:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{</span><span class="s">&quot;controller&quot;</span><span class="p">:</span> <span class="s">&quot;error&quot;</span><span class="p">,</span> <span class="s">&quot;action&quot;</span><span class="p">:</span> <span class="s">&quot;images&quot;</span><span class="p">,</span> <span class="s">&quot;id&quot;</span><span class="p">:</span> <span class="s">&quot;arrow.jpg&quot;</span><span class="p">}</span>
</pre></div>
</div>
<p>Line 5 matches the single URL &#8220;/&#8221;, and sets both the controller and action to
constants.  It also has a route name &#8220;home&#8221;, which can be used in generation.
(The other routes have <tt class="xref docutils literal"><span class="pre">None</span></tt> instead of a name, so they don&#8217;t have names.
It&#8217;s recommended to name all routes that may be used in generation, but it&#8217;s
not necessary to name other routes.)</p>
<p>Line 7 matches any two-component URL, and line 8 matches any 3-component URL.
These are used as catchall routes if we&#8217;re too lazy to define a separate route
for every action.  If you <em>have</em> defined a route for every action, you can
delete these two routes.</p>
<p>Note that a URL &#8220;/error/images/arrow.jpg&#8221; could match both line 4 and line 8.
The mapper resolves this by trying routes in the order defined, so this URL
would match line 4.</p>
<p>If no routes match the URL, the mapper returns a &#8220;match failed&#8221; condition,
which is seen in Pylons as HTTP 404 &#8220;Not Found&#8221;.</p>
<p>Here are some more examples of valid routes:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">m</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&quot;/feeds/{category}/atom.xml&quot;</span><span class="p">,</span> <span class="n">controller</span><span class="o">=</span><span class="s">&quot;feeds&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&quot;atom&quot;</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&quot;history&quot;</span><span class="p">,</span> <span class="s">&quot;/archives/by_eon/{century}&quot;</span><span class="p">,</span> <span class="n">controller</span><span class="o">=</span><span class="s">&quot;archives&quot;</span><span class="p">,</span>
          <span class="n">action</span><span class="o">=</span><span class="s">&quot;aggregate&quot;</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&quot;article&quot;</span><span class="p">,</span> <span class="s">&quot;/article/{section}/{slug}/{page}.html&quot;</span><span class="p">,</span>
          <span class="n">controller</span><span class="o">=</span><span class="s">&quot;article&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&quot;view&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Extra variables may be any Python type, not just strings.  However, if the
route is used in generation, <tt class="docutils literal"><span class="pre">str()</span></tt> will  be called on the value unless
the generation call specifies an overriding value.</p>
<p>Other argument syntaxes are allowed for compatibility with earlier versions of
Routes.  These are described in the <tt class="docutils literal"><span class="pre">Backward</span> <span class="pre">Compatibility</span></tt> section.</p>
<p>Route paths should always begin with a slash (&#8220;/&#8221;).  Earlier versions of
Routes allowed slashless paths, but their behavior now is undefined.</p>
<div class="section" id="requirements">
<h3>Requirements<a class="headerlink" href="#requirements" title="Permalink to this headline">¶</a></h3>
<p>It&#8217;s possible to restrict a path variable to a regular expression; e.g., to
match only a numeric component or a restricted choice of words.  There are two
syntaxes for this: inline and the <tt class="docutils literal"><span class="pre">requirements</span></tt> argument.  An inline
requirement looks like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nb">map</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">R&quot;/blog/{id:\d+}&quot;</span><span class="p">)</span>
<span class="nb">map</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">R&quot;/download/{platform:windows|mac}/{filename}&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>This matches &#8220;/blog/123&#8221; but not &#8220;/blog/12A&#8221;.  The equivalent <tt class="docutils literal"><span class="pre">requirements</span></tt>
syntax is:</p>
<div class="highlight-python"><pre>map.connect("/blog/{id}", requirements={"id": R"\d+"}
map.connect("/download/{platform}/{filename}",
    requirements={"platform": R"windows|mac"})</pre>
</div>
<p>Note the use of raw string syntax (<tt class="docutils literal"><span class="pre">R&quot;&quot;</span></tt>) for regexes which might contain
backslashes.  Without the R you&#8217;d have to double every backslash.</p>
<p>Another example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">m</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&quot;archives/{year}/{month}/{day}&quot;</span><span class="p">,</span> <span class="n">controller</span><span class="o">=</span><span class="s">&quot;archives&quot;</span><span class="p">,</span>
          <span class="n">action</span><span class="o">=</span><span class="s">&quot;view&quot;</span><span class="p">,</span> <span class="n">year</span><span class="o">=</span><span class="mf">2004</span><span class="p">,</span>
          <span class="n">requirements</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="s">R&quot;\d{2,4}&quot;</span><span class="p">,</span> <span class="n">month</span><span class="o">=</span><span class="s">R&quot;\d{1,2}&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p>The inline syntax was added in Routes (XXX 1.10?? not in changelog).  Previous
versions had only the <tt class="docutils literal"><span class="pre">requirements</span></tt> argument.  Two advantages of the
<tt class="docutils literal"><span class="pre">requirements</span></tt> argument are that if you have several variables with identical
requirements, you can set one variable or even the entire argument to a
global:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">NUMERIC</span> <span class="o">=</span> <span class="s">R&quot;\d+&quot;</span>
<span class="nb">map</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">requirements</span><span class="o">=</span><span class="p">{</span><span class="s">&quot;id&quot;</span><span class="p">:</span> <span class="n">NUMERIC</span><span class="p">})</span>

<span class="n">ARTICLE_REQS</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;year&quot;</span><span class="p">:</span> <span class="s">R&quot;\d\d\d\d&quot;</span><span class="p">,</span> <span class="s">&quot;month&quot;</span><span class="p">:</span> <span class="s">R&quot;\d\d&quot;</span><span class="p">,</span> <span class="s">&quot;day&quot;</span><span class="p">:</span> <span class="s">R&quot;\d\d&quot;</span><span class="p">}</span>
<span class="nb">map</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">requirements</span><span class="o">=</span><span class="n">ARTICLE_REQS</span><span class="p">)</span>
</pre></div>
</div>
<p>Because the argument <tt class="docutils literal"><span class="pre">requirements</span></tt> is reserved, you can&#8217;t define a routing
variable by that name.</p>
</div>
<div class="section" id="magic-path-info">
<h3>Magic path_info<a class="headerlink" href="#magic-path-info" title="Permalink to this headline">¶</a></h3>
<p>If the &#8220;path_info&#8221; variable is used at the end of the URL, Routes moves
everything preceding it into the &#8220;SCRIPT_NAME&#8221; environment variable.  This is
useful when delegating to another WSGI application that does its own routing:
the subapplication will route on the remainder of the URL rather than the
entire URL.  You still
need the &#8220;:.*&#8221; requirement to capture the following URL components into the
variable.</p>
<div class="highlight-python"><pre>map.connect(None, "/cards/{path_info:.*}",
    controller="main", action="cards")
# Incoming URL "/cards/diamonds/4.png"
=&gt; {"controller": "main", action: "cards", "path_info": "/diamonds/4.png"}
# Second WSGI application sees:
# SCRIPT_NAME="/cards"   PATH_INFO="/diamonds/4.png"</pre>
</div>
<p>This route does not match &#8220;/cards&#8221; because it requires a following slash.
Add another route to get around this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nb">map</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&quot;cards&quot;</span><span class="p">,</span> <span class="s">&quot;/cards&quot;</span><span class="p">,</span> <span class="n">controller</span><span class="o">=</span><span class="s">&quot;main&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&quot;cards&quot;</span><span class="p">,</span>
    <span class="n">path_info</span><span class="o">=</span><span class="s">&quot;/&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p>You may think you can combine the two with the following route:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nb">map</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&quot;cards&quot;</span><span class="p">,</span> <span class="s">&quot;/cards{path_info:.*}&quot;</span><span class="p">,</span>
    <span class="n">controller</span><span class="o">=</span><span class="s">&quot;main&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&quot;cards&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p class="last">There are two problems with this, however. One, it would also match
&#8220;/cardshark&#8221;.  Two, Routes 1.10 has a bug: it forgets to take
the suffix off the SCRIPT_NAME.</p>
</div>
<p>A future version of Routes may delegate directly to WSGI applications, but for
now this must be done in the framework.  In Pylons, you can do this in a
controller action as follows:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">paste.fileapp</span> <span class="kn">import</span> <span class="n">DirectoryApp</span>
<span class="k">def</span> <span class="nf">cards</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">environ</span><span class="p">,</span> <span class="n">start_response</span><span class="p">):</span>
    <span class="n">app</span> <span class="o">=</span> <span class="n">DirectoryApp</span><span class="p">(</span><span class="s">&quot;/cards-directory&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">app</span><span class="p">(</span><span class="n">environ</span><span class="p">,</span> <span class="n">start_response</span><span class="p">)</span>
</pre></div>
</div>
<p>Or create a fake controller module with a <tt class="docutils literal"><span class="pre">__controller__</span></tt> variable set to
the WSGI application:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">paste.fileapp</span> <span class="kn">import</span> <span class="n">DirectoryApp</span>
<span class="n">__controller__</span> <span class="o">=</span> <span class="n">DirectoryApp</span><span class="p">(</span><span class="s">&quot;/cards-directory&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="conditions">
<h3>Conditions<a class="headerlink" href="#conditions" title="Permalink to this headline">¶</a></h3>
<p>Conditions impose additional constraints on what kinds of requests can match.
The <tt class="docutils literal"><span class="pre">conditions</span></tt> argument is a dict with up to three keys:</p>
<blockquote>
<p>method</p>
<blockquote>
A list of uppercase HTTP methods.  The request must be one of the
listed methods.</blockquote>
<p>sub_domain</p>
<blockquote>
<p>Can be a list of subdomains, <tt class="xref docutils literal"><span class="pre">True</span></tt>, <tt class="xref docutils literal"><span class="pre">False</span></tt>, or <tt class="xref docutils literal"><span class="pre">None</span></tt>.  If a
list, the request must be for one of the specified subdomains.  If
<tt class="xref docutils literal"><span class="pre">True</span></tt>, the request must contain a subdomain but it can be anything.
If <tt class="xref docutils literal"><span class="pre">False</span></tt> or <tt class="xref docutils literal"><span class="pre">None</span></tt>, do not match if there&#8217;s a subdomain.</p>
<p><em>New in Routes 1.10: ``False`` and ``None`` values.</em></p>
</blockquote>
<p>function</p>
<blockquote>
A function that evaluates the request.  Its signature must be
<tt class="docutils literal"><span class="pre">func(environ,</span> <span class="pre">match_dict)</span> <span class="pre">=&gt;</span> <span class="pre">bool</span></tt>.  It should return true if the
match is successful or false otherwise.  The first arg is the WSGI
environment; the second is the routing variables that would be
returned if the match succeeds.  The function can modify <tt class="docutils literal"><span class="pre">match_dict</span></tt>
in place to affect which variables are returned.  This allows a wide
range of transformations.</blockquote>
</blockquote>
<p>Examples:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Match only if the HTTP method is &quot;GET&quot; or &quot;HEAD&quot;.</span>
<span class="n">m</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&quot;/user/list&quot;</span><span class="p">,</span> <span class="n">controller</span><span class="o">=</span><span class="s">&quot;user&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&quot;list&quot;</span><span class="p">,</span>
          <span class="n">conditions</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;GET&quot;</span><span class="p">,</span> <span class="s">&quot;HEAD&quot;</span><span class="p">]))</span>

<span class="c"># A sub-domain should be present.</span>
<span class="n">m</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&quot;/&quot;</span><span class="p">,</span> <span class="n">controller</span><span class="o">=</span><span class="s">&quot;user&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&quot;home&quot;</span><span class="p">,</span>
          <span class="n">conditions</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">sub_domain</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span>

<span class="c"># Sub-domain should be either &quot;fred&quot; or &quot;george&quot;.</span>
<span class="n">m</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&quot;/&quot;</span><span class="p">,</span> <span class="n">controller</span><span class="o">=</span><span class="s">&quot;user&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&quot;home&quot;</span><span class="p">,</span>
          <span class="n">conditions</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">sub_domain</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;fred&quot;</span><span class="p">,</span> <span class="s">&quot;george&quot;</span><span class="p">]))</span>

<span class="c"># Put the referrer into the resulting match dictionary.</span>
<span class="c"># This function always returns true, so it never prevents the match</span>
<span class="c"># from succeeding.</span>
<span class="k">def</span> <span class="nf">referals</span><span class="p">(</span><span class="n">environ</span><span class="p">,</span> <span class="n">result</span><span class="p">):</span>
    <span class="n">result</span><span class="p">[</span><span class="s">&quot;referer&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;HTTP_REFERER&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">True</span>
<span class="n">m</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&quot;/{controller}/{action}/{id}&quot;</span><span class="p">,</span>
    <span class="n">conditions</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">function</span><span class="o">=</span><span class="n">referals</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="wildcard-routes">
<h3>Wildcard routes<a class="headerlink" href="#wildcard-routes" title="Permalink to this headline">¶</a></h3>
<p>By default, path variables do not match a slash.  This ensures that each
variable will match exactly one component.  You can use requirements to
override this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nb">map</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&quot;/static/{filename:.*?}&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>This matches &#8220;/static/foo.jpg&#8221;, &#8220;/static/bar/foo.jpg&#8221;, etc.</p>
<p>Beware that careless regexes may eat the entire rest of the URL and cause
components to the right of it not to match:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># OK because the following component is static and the regex has a &quot;?&quot;.</span>
<span class="nb">map</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&quot;/static/{filename:.*?}/download&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>The lesson is to always test wildcard patterns.</p>
</div>
<div class="section" id="submappers">
<h3>Submappers<a class="headerlink" href="#submappers" title="Permalink to this headline">¶</a></h3>
<p>A submapper lets you add several similar routes
without having to repeat identical keyword arguments.  There are two syntaxes,
one using a Python <tt class="docutils literal"><span class="pre">with</span></tt> block, and the other avoiding it.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Using &#39;with&#39;</span>
<span class="nb">map</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&quot;home&quot;</span><span class="p">,</span> <span class="s">&quot;/&quot;</span><span class="p">,</span> <span class="n">controller</span><span class="o">=</span><span class="s">&quot;home&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&quot;splash&quot;</span><span class="p">)</span>
<span class="k">with</span> <span class="nb">map</span><span class="o">.</span><span class="n">submapper</span><span class="p">(</span><span class="n">controller</span><span class="o">=</span><span class="s">&quot;home&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">m</span><span class="p">:</span>
    <span class="n">m</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&quot;index&quot;</span><span class="p">,</span> <span class="s">&quot;/index&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&quot;index&quot;</span><span class="p">)</span>

<span class="c"># Not using &#39;with&#39;</span>
<span class="nb">map</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&quot;home&quot;</span><span class="p">,</span> <span class="s">&quot;/&quot;</span><span class="p">,</span> <span class="n">controller</span><span class="o">=</span><span class="s">&quot;home&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&quot;splash&quot;</span><span class="p">)</span>
<span class="n">m</span> <span class="o">=</span> <span class="nb">map</span><span class="o">.</span><span class="n">submapper</span><span class="p">(</span><span class="n">controller</span><span class="o">=</span><span class="s">&quot;home&quot;</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&quot;index&quot;</span><span class="p">,</span> <span class="s">&quot;/index&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&quot;index&quot;</span><span class="p">)</span>

<span class="c"># Both of these syntaxes create the following routes::</span>
<span class="c"># &quot;/&quot;      =&gt; {&quot;controller&quot;: &quot;home&quot;, action=&quot;splash&quot;}</span>
<span class="c"># &quot;/index&quot; =&gt; {&quot;controller&quot;: &quot;home&quot;, action=&quot;index&quot;}</span>
</pre></div>
</div>
<p>You can also specify a common path prefix for your routes:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">with</span> <span class="nb">map</span><span class="o">.</span><span class="n">submapper</span><span class="p">(</span><span class="n">path_prefix</span><span class="o">=</span><span class="s">&quot;/admin&quot;</span><span class="p">,</span> <span class="n">controller</span><span class="o">=</span><span class="s">&quot;admin&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">m</span><span class="p">:</span>
    <span class="n">m</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&quot;admin_users&quot;</span><span class="p">,</span> <span class="s">&quot;/users&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&quot;users&quot;</span><span class="p">)</span>
    <span class="n">m</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&quot;admin_databases&quot;</span><span class="p">,</span> <span class="s">&quot;/databases&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&quot;databases&quot;</span><span class="p">)</span>

<span class="c"># /admin/users     =&gt; {&quot;controller&quot;: &quot;admin&quot;, &quot;action&quot;: &quot;users&quot;}</span>
<span class="c"># /admin/databases =&gt; {&quot;controller&quot;: &quot;admin&quot;, &quot;action&quot;: &quot;databases&quot;}</span>
</pre></div>
</div>
<p>All arguments to <tt class="docutils literal"><span class="pre">.submapper</span></tt> must be keyword arguments.</p>
<p>The submapper is <em>not</em> a complete mapper.  It&#8217;s just a temporary object
with a <tt class="docutils literal"><span class="pre">.connect</span></tt> method that adds routes to the mapper it was spawned
from.</p>
<p><em>New in Routes 1.11.</em></p>
</div>
<div class="section" id="adding-routes-from-a-nested-application">
<h3>Adding routes from a nested application<a class="headerlink" href="#adding-routes-from-a-nested-application" title="Permalink to this headline">¶</a></h3>
<p><em>New in Routes 1.11.</em>  Sometimes in nested applications, the child application
gives the parent a list of routes to add to its mapper.  These can be added
with the <tt class="docutils literal"><span class="pre">.extend</span></tt> method, optionally providing a path prefix:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">routes</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">Route</span><span class="p">(</span><span class="s">&quot;index&quot;</span><span class="p">,</span> <span class="s">&quot;/index.html&quot;</span><span class="p">,</span> <span class="n">controller</span><span class="o">=</span><span class="s">&quot;home&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&quot;index&quot;</span><span class="p">),</span>
    <span class="p">]</span>

<span class="nb">map</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">routes</span><span class="p">)</span>
<span class="c"># /index.html =&gt; {&quot;controller&quot;: &quot;home&quot;, &quot;action&quot;: &quot;index&quot;}</span>

<span class="nb">map</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">routes</span><span class="p">,</span> <span class="s">&quot;/subapp&quot;</span><span class="p">)</span>
<span class="c"># /subapp/index.html =&gt; {&quot;controller&quot;: &quot;home&quot;, &quot;action&quot;: &quot;index&quot;}</span>
</pre></div>
</div>
<p>This does not exactly add the route objects to the mapper.  It creates
identical new route objects and adds those to the mapper.</p>
<p><em>New in Routes 1.11.</em></p>
</div>
</div>
<div class="section" id="generation">
<h2>Generation<a class="headerlink" href="#generation" title="Permalink to this headline">¶</a></h2>
<p>To generate URLs, use the <tt class="docutils literal"><span class="pre">url</span></tt> or <tt class="docutils literal"><span class="pre">url_for</span></tt> object provided by your
framework.  <tt class="docutils literal"><span class="pre">url</span></tt> is an instance of Routes <tt class="docutils literal"><span class="pre">URLGenerator</span></tt>, while
<tt class="docutils literal"><span class="pre">url_for</span></tt> is the older <tt class="docutils literal"><span class="pre">routes.url_for()</span></tt> function.  <tt class="docutils literal"><span class="pre">url_for</span></tt> is being
phased out, so new applications should use <tt class="docutils literal"><span class="pre">url</span></tt>.</p>
<p>To generate a named route, specify the route name as a positional argument:</p>
<div class="highlight-python"><pre>url("home")   =&gt;  "/"</pre>
</div>
<p>If the route contains path variables, you must specify values for them using
keyword arguments:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">url</span><span class="p">(</span><span class="s">&quot;blog&quot;</span><span class="p">,</span> <span class="n">year</span><span class="o">=</span><span class="mf">2008</span><span class="p">,</span> <span class="n">month</span><span class="o">=</span><span class="mf">10</span><span class="p">,</span> <span class="n">day</span><span class="o">=</span><span class="mf">2</span><span class="p">)</span>
</pre></div>
</div>
<p>Non-string values are automatically converted to strings using <tt class="docutils literal"><span class="pre">str()</span></tt>.
(This may break with Unicode values containing non-ASCII characters.)</p>
<p>However, if the route defines an extra variable with the same name as a path
variable, the extra variable is used as the default if that keyword is not
specified.  Example:</p>
<div class="highlight-python"><pre>m.connect("archives", "/archives/{id}",
    controller="archives", action="view", id=1)
url("blog", id=123)  =&gt;  "/blog/123"
url("blog")  =&gt;  "/blog/1"</pre>
</div>
<p>(The extra variable is <em>not</em> used for matching unless minimization is enabled.)</p>
<p>Any keyword args that do not correspond to path variables will be put in the
query string.  Append a &#8220;_&#8221; if the variable name collides with a Python
keyword:</p>
<div class="highlight-python"><pre>map.connect("archive", "/archive/{year}")
url("archive", year=2009, font=large)  =&gt;  "/archive/2009?font=large"
url("archive", year=2009, print_=1)  =&gt;  "/archive/2009?print=1"</pre>
</div>
<p>If the application is mounted at a subdirectory of the URL space,
all generated URLs will have the application prefix.  The application prefix is
the &#8220;SCRIPT_NAME&#8221; variable in the request&#8217;s WSGI environment.</p>
<p>If the positional argument corresponds to no named route, it is assumed to be a
literal URL.  The application&#8217;s mount point is prefixed to it, and keyword args
are converted to query parameters:</p>
<div class="highlight-python"><pre>url("/search", q="My question")  =&gt;  "/search?q=My+question"</pre>
</div>
<p>If there is no positional argument, Routes will use the keyword args to choose
a route.  The first route that has all path variables specified by keyword args
and the fewest number of extra variables not overridden by keyword args will be
chosen.  This was common in older versions of Routes but can cause application
bugs if an unexpected route is chosen, so using route names is much preferable
because that guarantees only the named route will be chosen.  The most common
use for unnamed generation is when you have a seldom-used controller with a lot
of ad hoc methods; e.g., <tt class="docutils literal"><span class="pre">url(controller=&quot;admin&quot;,</span> <span class="pre">action=&quot;session&quot;)</span></tt>.</p>
<p>An exception is raised if no route corresponds to the arguments.  The exception
is <tt class="docutils literal"><span class="pre">routes.util.GenerationException</span></tt>.  (Prior to Routes 1.9, <tt class="xref docutils literal"><span class="pre">None</span></tt> was
returned instead.  It was changed to an exception to prevent invalid blank URLs
from being insered into templates.)</p>
<p>You&#8217;ll also get this exception if Python produces a Unicode URL (which could
happen if the route path or a variable value is Unicode).  Routes generates
only <tt class="docutils literal"><span class="pre">str</span></tt> URLs.</p>
<p>The following keyword args are special:</p>
<blockquote>
<p>anchor</p>
<blockquote>
<p>Specifies the URL anchor (the part to the right of &#8220;#&#8221;).</p>
<div class="highlight-python"><pre>url("home", "summary")  =&gt;  "/#summary"</pre>
</div>
</blockquote>
<p>host</p>
<blockquote>
Make the URL fully qualified and override the host (domain).</blockquote>
<p>protocol</p>
<blockquote>
Make the URL fully qualified and override the protocol (e.g., &#8220;ftp&#8221;).</blockquote>
<p>qualified</p>
<blockquote>
Make the URL fully qualified (i.e., add &#8220;protocol://host:port&#8221; prefix).</blockquote>
<p>sub_domain</p>
<blockquote>
See &#8220;Generating URLs with subdomains&#8221; below.</blockquote>
</blockquote>
<p>The syntax in this section is the same for both <tt class="docutils literal"><span class="pre">url</span></tt> and <tt class="docutils literal"><span class="pre">url_for</span></tt>.</p>
<p><em>New in Routes 1.10: ``url`` and the ``URLGenerator`` class behind it.</em></p>
<div class="section" id="generating-routes-based-on-the-current-url">
<h3>Generating routes based on the current URL<a class="headerlink" href="#generating-routes-based-on-the-current-url" title="Permalink to this headline">¶</a></h3>
<p><tt class="docutils literal"><span class="pre">url.current()</span></tt> returns the URL of the current request, without the query
string.  This is called &#8220;route memory&#8221;, and works only if the RoutesMiddleware
is in the middleware stack.  Keyword arguments override path variables or are
put on the query string.</p>
<p><tt class="docutils literal"><span class="pre">url_for</span></tt> combines the behavior of <tt class="docutils literal"><span class="pre">url</span></tt> and <tt class="docutils literal"><span class="pre">url_current</span></tt>.  This is
deprecated because nameless routes and route memory have the same syntax, which
can lead to the wrong route being chosen in some cases.</p>
<p>Here&#8217;s an example of route memory:</p>
<div class="highlight-python"><pre>m.connect("/archives/{year}/{month}/{day}", year=2004)

# Current URL is "/archives/2005/10/4".
# Routing variables are {"controller": "archives", "action": "view",
  "year": "2005", "month": "10", "day": "4"}

url.current(day=6)    =&gt;  "/archives/2005/10/6"
url.current(month=4)  =&gt;  "/archives/2005/4/4"
url.current()         =&gt;  "/archives/2005/10/4"</pre>
</div>
<p>Route memory can be disabled globally with <tt class="docutils literal"><span class="pre">map.explicit</span> <span class="pre">=</span> <span class="pre">True</span></tt>.</p>
</div>
<div class="section" id="generation-only-routes-aka-static-routes">
<h3>Generation-only routes (aka. static routes)<a class="headerlink" href="#generation-only-routes-aka-static-routes" title="Permalink to this headline">¶</a></h3>
<p>A static route is used only for generation &#8211; not matching &#8211; and it must be
named.  To define a static route, use the argument <tt class="docutils literal"><span class="pre">_static=True</span></tt>.</p>
<p>This example provides a convenient way to link to a search:</p>
<div class="highlight-python"><pre>map.connect("google", "http://google.com/", _static=True)
url("google", q="search term")  =&gt;  "/http://google.com/?q=search+term")</pre>
</div>
<p>This example generates a URL to a static image in a Pylons public directory.
Pylons serves the public directory in a way that bypasses Routes, so there&#8217;s no
reason to match URLs under it.</p>
<div class="highlight-python"><pre>map.connect("attachment", "/images/attachments/{category}/{id}.jpg",
    _static=True)
url("attachment", category="dogs", id="Mastiff") =&gt;
    "/images/attachments/dogs/Mastiff.jpg"</pre>
</div>
<p>Starting in Routes 1.10, static routes are exactly the same as regular routes
except they&#8217;re not added to the internal match table.  In previous versions of
Routes they could not contain path variables and they had to point to external
URLs.</p>
</div>
<div class="section" id="filter-functions">
<h3>Filter functions<a class="headerlink" href="#filter-functions" title="Permalink to this headline">¶</a></h3>
<p>A filter function modifies how a named route is generated.  Don&#8217;t confuse it
with a function condition, which is used in matching.  A filter function is its
opposite counterpart.</p>
<p>One use case is when you have a <tt class="docutils literal"><span class="pre">story</span></tt> object with attributes for year,
month, and day.  You don&#8217;t want to hardcode these attributes in every <tt class="docutils literal"><span class="pre">url</span></tt>
call because the interface may change someday.  Instead you pass the story as a
pseudo-argument, and the filter produces the actual generation args.  Here&#8217;s an
example:</p>
<div class="highlight-python"><pre>class Story(object):
    def __init__(self, year, month, day):
        self.year = year
        self.month = month
        self.day = day

    @staticmethod
    def expand(kw):
        try:
            story = kw["story"]
        except KeyError:
            pass   # Don't modify dict if ``story`` key not present.
        else:
            # Set the actual generation args from the story.
            kw["year"] = story.year
            kw["month"] = story.month
            kw["day"] = story.day
        return kw

m.connect("archives", "/archives/{year}/{month}/{day}",
    controller="archives", action="view", _filter=Story.expand)

my_story = Story(2009, 1, 2)
url("archives", story=my_story)  =&gt;  "/archives/2009/1/2"</pre>
</div>
<p>The <tt class="docutils literal"><span class="pre">_filter</span></tt> argument can be any function that takes a dict and returns a
dict.  In the example we&#8217;ve used a static method of the <tt class="docutils literal"><span class="pre">Story</span></tt> class to keep
everything story-related together, but you may prefer to use a standalone
function to keep Routes-related code away from your model.</p>
</div>
<div class="section" id="generating-urls-with-subdomains">
<h3>Generating URLs with subdomains<a class="headerlink" href="#generating-urls-with-subdomains" title="Permalink to this headline">¶</a></h3>
<p>If subdomain support is enabled and the <tt class="docutils literal"><span class="pre">sub_domain</span></tt> arg is passed to
<tt class="docutils literal"><span class="pre">url_for</span></tt>, Routes ensures the generated route points to that subdomain.</p>
<div class="highlight-python"><pre># Enable subdomain support.
map.sub_domains = True

# Ignore the www subdomain.
map.sub_domains_ignore = "www"

map.connect("/users/{action}")

# Add a subdomain.
url_for(action="update", sub_domain="fred")  =&gt;  "http://fred.example.com/users/update"

# Delete a subdomain.  Assume current URL is fred.example.com.
url_for(action="new", sub_domain=None)  =&gt;  "http://example.com/users/new"</pre>
</div>
</div>
</div>
<div class="section" id="unicode">
<h2>Unicode<a class="headerlink" href="#unicode" title="Permalink to this headline">¶</a></h2>
<p>Routes assumes UTF-8 encoding on incoming URLs, and <tt class="docutils literal"><span class="pre">url</span></tt> and <tt class="docutils literal"><span class="pre">url_for</span></tt>
also generate UTF-8.  You can change the encoding with the <tt class="docutils literal"><span class="pre">map.charset</span></tt>
attribute:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nb">map</span><span class="o">.</span><span class="n">charset</span> <span class="o">=</span> <span class="s">&quot;latin-1&quot;</span>
</pre></div>
</div>
<p>New in Routes 1.10: several bugfixes.</p>
</div>
<div class="section" id="restful-services">
<h2>RESTful services<a class="headerlink" href="#restful-services" title="Permalink to this headline">¶</a></h2>
<p>Routes makes it easy to configure RESTful web services.  <tt class="docutils literal"><span class="pre">map.resource</span></tt>
creates a set of add/modify/delete routes conforming to the Atom publishing
protocol.</p>
<p>A resource route addresses <em>members</em> in a <em>collection</em>, and the collection
itself.  Normally a collection is a plural word, and a member is the
corresponding singular word.  For instance, consider a collection of messages:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nb">map</span><span class="o">.</span><span class="n">resource</span><span class="p">(</span><span class="s">&quot;message&quot;</span><span class="p">,</span> <span class="s">&quot;messages&quot;</span><span class="p">)</span>

<span class="c"># The above command sets up several routes as if you had typed the</span>
<span class="c"># following commands:</span>
<span class="nb">map</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&quot;messages&quot;</span><span class="p">,</span> <span class="s">&quot;/messages&quot;</span><span class="p">,</span>
    <span class="n">controller</span><span class="o">=</span><span class="s">&quot;messages&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&quot;create&quot;</span><span class="p">,</span>
    <span class="n">conditions</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;POST&quot;</span><span class="p">]))</span>
<span class="nb">map</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&quot;messages&quot;</span><span class="p">,</span> <span class="s">&quot;/messages&quot;</span><span class="p">,</span>
    <span class="n">controller</span><span class="o">=</span><span class="s">&quot;messages&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&quot;index&quot;</span><span class="p">,</span>
    <span class="n">conditions</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;GET&quot;</span><span class="p">]))</span>
<span class="nb">map</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&quot;formatted_messages&quot;</span><span class="p">,</span> <span class="s">&quot;/messages.{format}&quot;</span><span class="p">,</span>
    <span class="n">controller</span><span class="o">=</span><span class="s">&quot;messages&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&quot;index&quot;</span><span class="p">,</span>
    <span class="n">conditions</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;GET&quot;</span><span class="p">]))</span>
<span class="nb">map</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&quot;new_message&quot;</span><span class="p">,</span> <span class="s">&quot;/messages/new&quot;</span><span class="p">,</span>
    <span class="n">controller</span><span class="o">=</span><span class="s">&quot;messages&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&quot;new&quot;</span><span class="p">,</span>
    <span class="n">conditions</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;GET&quot;</span><span class="p">]))</span>
<span class="nb">map</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&quot;formatted_new_message&quot;</span><span class="p">,</span> <span class="s">&quot;/messages/new.{format}&quot;</span><span class="p">,</span>
    <span class="n">controller</span><span class="o">=</span><span class="s">&quot;messages&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&quot;new&quot;</span><span class="p">,</span>
    <span class="n">conditions</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;GET&quot;</span><span class="p">]))</span>
<span class="nb">map</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&quot;/messages/{id}&quot;</span><span class="p">,</span>
    <span class="n">controller</span><span class="o">=</span><span class="s">&quot;messages&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&quot;update&quot;</span><span class="p">,</span>
    <span class="n">conditions</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;PUT&quot;</span><span class="p">]))</span>
<span class="nb">map</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&quot;/messages/{id}&quot;</span><span class="p">,</span>
    <span class="n">controller</span><span class="o">=</span><span class="s">&quot;messages&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&quot;delete&quot;</span><span class="p">,</span>
    <span class="n">conditions</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;DELETE&quot;</span><span class="p">]))</span>
<span class="nb">map</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&quot;edit_message&quot;</span><span class="p">,</span> <span class="s">&quot;/messages/{id}/edit&quot;</span><span class="p">,</span>
    <span class="n">controller</span><span class="o">=</span><span class="s">&quot;messages&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&quot;edit&quot;</span><span class="p">,</span>
    <span class="n">conditions</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;GET&quot;</span><span class="p">]))</span>
<span class="nb">map</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&quot;formatted_edit_message&quot;</span><span class="p">,</span> <span class="s">&quot;/messages/{id}.{format}/edit&quot;</span><span class="p">,</span>
    <span class="n">controller</span><span class="o">=</span><span class="s">&quot;messages&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&quot;edit&quot;</span><span class="p">,</span>
    <span class="n">conditions</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;GET&quot;</span><span class="p">]))</span>
<span class="nb">map</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&quot;message&quot;</span><span class="p">,</span> <span class="s">&quot;/messages/{id}&quot;</span><span class="p">,</span>
    <span class="n">controller</span><span class="o">=</span><span class="s">&quot;messages&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&quot;show&quot;</span><span class="p">,</span>
    <span class="n">conditions</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;GET&quot;</span><span class="p">]))</span>
<span class="nb">map</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&quot;formatted_message&quot;</span><span class="p">,</span> <span class="s">&quot;/messages/{id}.{format}&quot;</span><span class="p">,</span>
    <span class="n">controller</span><span class="o">=</span><span class="s">&quot;messages&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&quot;show&quot;</span><span class="p">,</span>
    <span class="n">conditions</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;GET&quot;</span><span class="p">]))</span>
</pre></div>
</div>
<p>This establishes the following convention:</p>
<div class="highlight-python"><pre>GET    /messages        =&gt; messages.index()    =&gt; url("messages")
POST   /messages        =&gt; messages.create()   =&gt; url("messages")
GET    /messages/new    =&gt; messages.new()      =&gt; url("new_message")
PUT    /messages/1      =&gt; messages.update(id) =&gt; url("message", id=1)
DELETE /messages/1      =&gt; messages.delete(id) =&gt; url("message", id=1)
GET    /messages/1      =&gt; messages.show(id)   =&gt; url("message", id=1)
GET    /messages/1/edit =&gt; messages.edit(id)   =&gt; url("edit_message", id=1)</pre>
</div>
<p>Thus, you GET the collection to see an index of links to members (&#8220;index&#8221;
method).  You GET a member to see it (&#8220;show&#8221;).  You GET &#8220;COLLECTION/new&#8221; to
obtain a new message form (&#8220;new&#8221;), which you POST to the collection (&#8220;create&#8221;).
You GET &#8220;MEMBER/edit&#8221; to obtain an edit for (&#8220;edit&#8221;), which you PUT to the
member (&#8220;update&#8221;).  You DELETE the member to delete it.  Note that there are
only four route names because multiple actions are doubled up on the same URLs.</p>
<p>This URL structure may look strange if you&#8217;re not used to the Atom protocol.
REST is a vague term, and some people think it means proper URL syntax (every
component contains the one on its right), others think it means not putting IDs
in query parameters, and others think it means using HTTP methods beyond GET
and POST.  <tt class="docutils literal"><span class="pre">map.resource</span></tt> does all three, but it may be overkill for
applications that don&#8217;t need Atom compliance or prefer to stick with GET and
POST.  <tt class="docutils literal"><span class="pre">map.resource</span></tt> has the advantage that many automated tools and
non-browser agents will be able to list and modify your resources without any
programming on your part.  But you don&#8217;t have to use it if you prefer a simpler
add/modify/delete structure.</p>
<p>HTML forms can produce only GET and POST requests.  As a workaround, if a POST
request contains a <tt class="docutils literal"><span class="pre">_method</span></tt> parameter, the Routes middleware changes the
HTTP method to whatever the parameter specifies, as if it had been requested
that way in the first place.  This convention is becoming increasingly common
in other frameworks.  If you&#8217;re using WebHelpers, the The WebHelpers <tt class="docutils literal"><span class="pre">form</span></tt>
function has a <tt class="docutils literal"><span class="pre">method</span></tt> argument which automatically sets the HTTP method and
&#8220;_method&#8221; parameter.</p>
<p>Several routes are paired with an identical route containing the <tt class="docutils literal"><span class="pre">format</span></tt>
variable.  The intention is to allow users to obtain different formats by means
of filename suffixes; e.g., &#8220;/messages/1.xml&#8221;.  This produces a routing
variable &#8220;xml&#8221;, which in Pylons will be passed to the controller action if it
defines a formal argument for it.  In generation you can pass the <tt class="docutils literal"><span class="pre">format</span></tt>
argument to produce a URL with that suffix:</p>
<div class="highlight-python"><pre>url("message", id=1, format="xml")  =&gt;  "/messages/1.xml"</pre>
</div>
<p>Routes does not recognize any particular formats or know which ones are valid
for your application.  It merely passes the <tt class="docutils literal"><span class="pre">format</span></tt> attribute through if it
appears.</p>
<p>New in Routes 1.7.3: changed URL suffix from &#8220;;edit&#8221; to &#8220;/edit&#8221;.  Semicolons
are not allowed in the path portion of a URL except to delimit path parameters,
which nobody uses.</p>
<div class="section" id="resource-options">
<h3>Resource options<a class="headerlink" href="#resource-options" title="Permalink to this headline">¶</a></h3>
<p>The <tt class="docutils literal"><span class="pre">map.resource</span></tt> method recognizes a number of keyword args which modifies
its behavior:</p>
<p>controller</p>
<blockquote>
Use the specified controller rather than deducing it from the collection
name.</blockquote>
<p>collection</p>
<blockquote>
<p>Additional URLs to allow for the collection.  Example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nb">map</span><span class="o">.</span><span class="n">resource</span><span class="p">(</span><span class="s">&quot;message&quot;</span><span class="p">,</span> <span class="s">&quot;messages&quot;</span><span class="p">,</span> <span class="n">collection</span><span class="o">=</span><span class="p">{</span><span class="s">&quot;rss&quot;</span><span class="p">:</span> <span class="s">&quot;GET&quot;</span><span class="p">})</span>
<span class="c"># &quot;GET /message/rss&quot;  =&gt;  ``Messages.rss()``.</span>
<span class="c"># Defines a named route &quot;rss_messages&quot;.</span>
</pre></div>
</div>
</blockquote>
<p>member</p>
<blockquote>
<p>Additional URLs to allow for a member.  Example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nb">map</span><span class="o">.</span><span class="n">resource</span><span class="p">(</span><span class="s">&#39;message&#39;</span><span class="p">,</span> <span class="s">&#39;messages&#39;</span><span class="p">,</span> <span class="n">member</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;mark&#39;</span><span class="p">:</span><span class="s">&#39;POST&#39;</span><span class="p">})</span>
<span class="c"># &quot;POST /message/1/mark&quot;  =&gt;  ``Messages.mark(1)``</span>
<span class="c"># also adds named route &quot;mark_message&quot;</span>
</pre></div>
</div>
<p>This can be used to display a delete confirmation form:</p>
<div class="highlight-python"><pre>map.resource("message", "messages", member={"ask_delete": "GET"}
# "GET /message/1/ask_delete"   =&gt;   ``Messages.ask_delete(1)``.
# Also adds a named route "ask_delete_message".</pre>
</div>
</blockquote>
<p>new</p>
<blockquote>
<p>Additional URLs to allow for new-member functionality.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nb">map</span><span class="o">.</span><span class="n">resource</span><span class="p">(</span><span class="s">&quot;message&quot;</span><span class="p">,</span> <span class="s">&quot;messages&quot;</span><span class="p">,</span> <span class="n">new</span><span class="o">=</span><span class="p">{</span><span class="s">&quot;preview&quot;</span><span class="p">:</span> <span class="s">&quot;POST&quot;</span><span class="p">})</span>
<span class="c"># &quot;POST /messages/new/preview&quot;</span>
</pre></div>
</div>
</blockquote>
<p>path_prefix</p>
<blockquote>
Prepend the specified prefix to all URL patterns.  The prefix may include
path variables.  This is mainly used to nest resources within resources.</blockquote>
<p>name_prefix</p>
<blockquote>
<p>Prefix the specified string to all route names.  This is most often
combined with <tt class="docutils literal"><span class="pre">path_prefix</span></tt> to nest resources:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nb">map</span><span class="o">.</span><span class="n">resource</span><span class="p">(</span><span class="s">&quot;message&quot;</span><span class="p">,</span> <span class="s">&quot;messages&quot;</span><span class="p">,</span> <span class="n">controller</span><span class="o">=</span><span class="s">&quot;categories&quot;</span><span class="p">,</span>
    <span class="n">path_prefix</span><span class="o">=</span><span class="s">&quot;/category/{category_id}&quot;</span><span class="p">,</span>
    <span class="n">name_prefix</span><span class="o">=</span><span class="s">&quot;category_&quot;</span><span class="p">)</span>
<span class="c"># GET /category/7/message/1</span>
<span class="c"># Adds named route &quot;category_message&quot;</span>
</pre></div>
</div>
</blockquote>
<p>parent_resource</p>
<blockquote>
<p>A dict containing information about the parent resource, for creating a
nested resource. It should contain the member_name and collection_name
of the parent resource. This dict will be available via the associated
Route object which can be accessed during a request via
<tt class="docutils literal"><span class="pre">request.environ[&quot;routes.route&quot;]</span></tt>.</p>
<p>If parent_resource is supplied and path_prefix isn&#8217;t, path_prefix will
be generated from parent_resource as &#8220;&lt;parent collection name&gt;/:&lt;parent
member name&gt;_id&#8221;.</p>
<p>If parent_resource is supplied and name_prefix isn&#8217;t, name_prefix will
be generated from parent_resource as &#8220;&lt;parent member name&gt;_&#8221;.</p>
<p>Example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">m</span> <span class="o">=</span> <span class="n">Mapper</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">resource</span><span class="p">(</span><span class="s">&#39;location&#39;</span><span class="p">,</span> <span class="s">&#39;locations&#39;</span><span class="p">,</span>
<span class="gp">... </span>           <span class="n">parent_resource</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">member_name</span><span class="o">=</span><span class="s">&#39;region&#39;</span><span class="p">,</span>
<span class="gp">... </span>                                <span class="n">collection_name</span><span class="o">=</span><span class="s">&#39;regions&#39;</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># path_prefix is &quot;regions/:region_id&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># name prefix is &quot;region_&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">url</span><span class="p">(</span><span class="s">&#39;region_locations&#39;</span><span class="p">,</span> <span class="n">region_id</span><span class="o">=</span><span class="mf">13</span><span class="p">)</span>
<span class="go">&#39;/regions/13/locations&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">url</span><span class="p">(</span><span class="s">&#39;region_new_location&#39;</span><span class="p">,</span> <span class="n">region_id</span><span class="o">=</span><span class="mf">13</span><span class="p">)</span>
<span class="go">&#39;/regions/13/locations/new&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">url</span><span class="p">(</span><span class="s">&#39;region_location&#39;</span><span class="p">,</span> <span class="n">region_id</span><span class="o">=</span><span class="mf">13</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="mf">60</span><span class="p">)</span>
<span class="go">&#39;/regions/13/locations/60&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">url</span><span class="p">(</span><span class="s">&#39;region_edit_location&#39;</span><span class="p">,</span> <span class="n">region_id</span><span class="o">=</span><span class="mf">13</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="mf">60</span><span class="p">)</span>
<span class="go">&#39;/regions/13/locations/60/edit&#39;</span>

<span class="go">Overriding generated path_prefix:</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span> <span class="o">=</span> <span class="n">Mapper</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">resource</span><span class="p">(</span><span class="s">&#39;location&#39;</span><span class="p">,</span> <span class="s">&#39;locations&#39;</span><span class="p">,</span>
<span class="gp">... </span>           <span class="n">parent_resource</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">member_name</span><span class="o">=</span><span class="s">&#39;region&#39;</span><span class="p">,</span>
<span class="gp">... </span>                                <span class="n">collection_name</span><span class="o">=</span><span class="s">&#39;regions&#39;</span><span class="p">),</span>
<span class="gp">... </span>           <span class="n">path_prefix</span><span class="o">=</span><span class="s">&#39;areas/:area_id&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># name prefix is &quot;region_&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">url</span><span class="p">(</span><span class="s">&#39;region_locations&#39;</span><span class="p">,</span> <span class="n">area_id</span><span class="o">=</span><span class="mf">51</span><span class="p">)</span>
<span class="go">&#39;/areas/51/locations&#39;</span>

<span class="go">Overriding generated name_prefix:</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span> <span class="o">=</span> <span class="n">Mapper</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">resource</span><span class="p">(</span><span class="s">&#39;location&#39;</span><span class="p">,</span> <span class="s">&#39;locations&#39;</span><span class="p">,</span>
<span class="gp">... </span>           <span class="n">parent_resource</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">member_name</span><span class="o">=</span><span class="s">&#39;region&#39;</span><span class="p">,</span>
<span class="gp">... </span>                                <span class="n">collection_name</span><span class="o">=</span><span class="s">&#39;regions&#39;</span><span class="p">),</span>
<span class="gp">... </span>           <span class="n">name_prefix</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># path_prefix is &quot;regions/:region_id&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">url</span><span class="p">(</span><span class="s">&#39;locations&#39;</span><span class="p">,</span> <span class="n">region_id</span><span class="o">=</span><span class="mf">51</span><span class="p">)</span>
<span class="go">&#39;/regions/51/locations&#39;</span>
</pre></div>
</div>
</blockquote>
</div>
</div>
<div class="section" id="redirect-routes">
<h2>Redirect routes<a class="headerlink" href="#redirect-routes" title="Permalink to this headline">¶</a></h2>
<p>Redirect routes allow you to specify redirects in the route map, similar to
RewriteRule in an Apache configuration.  This avoids the need to define dummy
controller actions just to handle redirects.  It&#8217;s especially useful when the
URL structure changes and you want to redirect legacy URLs to their new
equivalents.  The redirection is done by the Routes middleware, and the WSGI
application is not called.</p>
<p><tt class="docutils literal"><span class="pre">map.redirect</span></tt> takes two positional arguments:  the route path and the
destination URL.  Redirect routes do not have a name.  Both paths can contain
variables, and the route path can take inline requirements.  Keyword arguments
are the same as <tt class="docutils literal"><span class="pre">map.connect</span></tt>, both in regards to extra variables and to route
options.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nb">map</span><span class="o">.</span><span class="n">redirect</span><span class="p">(</span><span class="s">&quot;/legacyapp/archives/{url:.*}&quot;</span><span class="p">,</span> <span class="s">&quot;/archives/{url}&quot;</span><span class="p">)</span>

<span class="nb">map</span><span class="o">.</span><span class="n">redirect</span><span class="p">(</span><span class="s">&quot;/legacyapp/archives/{url:.*}&quot;</span><span class="p">,</span> <span class="s">&quot;/archives/{url}&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>By default a &#8220;302 Found&#8221; HTTP status is issued.  You can override this with the
<tt class="docutils literal"><span class="pre">_redirect_code</span></tt> keyword argument.  The value must be an entire status
string.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nb">map</span><span class="o">.</span><span class="n">redirect</span><span class="p">(</span><span class="s">&quot;/home/index&quot;</span><span class="p">,</span> <span class="s">&quot;/&quot;</span><span class="p">,</span> <span class="n">_redirect_code</span><span class="o">=</span><span class="s">&quot;301 Moved Permanently&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p><em>New in Routes 1.10.</em></p>
</div>
<div class="section" id="introspection">
<h2>Introspection<a class="headerlink" href="#introspection" title="Permalink to this headline">¶</a></h2>
<p>The mapper attribute <tt class="docutils literal"><span class="pre">.matchlist</span></tt> contains the list of routes to be matched
against incoming URLs.  You can iterate this list to see what routes are
defined.  This can be useful when debugging route configurations.</p>
</div>
<div class="section" id="other">
<h2>Other<a class="headerlink" href="#other" title="Permalink to this headline">¶</a></h2>
<p>If your application is behind an HTTP proxy such a load balancer on another
host, the WSGI environment will refer to the internal server rather than to the
proxy, which will mess up generated URLs.  Use the ProxyMiddleware in
PasteDeploy to fix the WSGI environment to what it would have been without the
proxy.</p>
<p>To debug routes, turn on debug logging for the &#8220;routes.middleware&#8221; logger.
(See Python&#8217;s <tt class="docutils literal"><span class="pre">logging</span></tt> module to set up your logging configuration.)</p>
</div>
<div class="section" id="backward-compatibility">
<h2>Backward compatibility<a class="headerlink" href="#backward-compatibility" title="Permalink to this headline">¶</a></h2>
<p>The following syntaxes are allowed for compatibility with previous versions
of Routes.  They may be removed in the future.</p>
<div class="section" id="omitting-the-name-arg">
<h3>Omitting the name arg<a class="headerlink" href="#omitting-the-name-arg" title="Permalink to this headline">¶</a></h3>
<p>In the tutorial we said that nameless routes can be defined by passing <tt class="xref docutils literal"><span class="pre">None</span></tt>
as the first argument.  You can also omit the first argument entirely:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nb">map</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="s">&quot;/{controller}/{action}&quot;</span><span class="p">)</span>
<span class="nb">map</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&quot;/{controller}/{action}&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>The syntax with <tt class="xref docutils literal"><span class="pre">None</span></tt> is preferred to be forward-compatible with future
versions of Routes.  It avoids the path argument changing position between
the first and second arguments, which is unpythonic.</p>
</div>
<div class="section" id="varname">
<h3>:varname<a class="headerlink" href="#varname" title="Permalink to this headline">¶</a></h3>
<p>Path variables were defined in the format <tt class="docutils literal"><span class="pre">:varname</span></tt> and <tt class="docutils literal"><span class="pre">:(varname)</span></tt>
prior to Routes 1.9.  The form with parentheses was called &#8220;grouping&#8221;, used
to delimit the variable name from a following letter or number.  Thus the old
syntax &#8220;/:controller/:(id)abc&#8221; corresponds to the new syntax
&#8220;/{controller}/{id}abc&#8221;.</p>
<p>The older wildcard syntax is <tt class="docutils literal"><span class="pre">*varname</span></tt> or <tt class="docutils literal"><span class="pre">*(varname)</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># OK because the following component is static.</span>
<span class="nb">map</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&quot;/static/*filename/download&quot;</span><span class="p">)</span>

<span class="c"># Deprecated syntax.  WRONG because the wildcard will eat the rest of the</span>
<span class="c"># URL, leaving nothing for the following variable, which will cause the</span>
<span class="c"># match to fail.</span>
<span class="nb">map</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&quot;/static/*filename/:action&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="minimization">
<h3>Minimization<a class="headerlink" href="#minimization" title="Permalink to this headline">¶</a></h3>
<p>Minimization was a misfeature which was intended to save typing, but which
often resulted in the wrong route being chosen.  New applications should
disable it by putting <tt class="docutils literal"><span class="pre">map.minimization</span> <span class="pre">=</span> <span class="pre">False</span></tt> in their route definitions.
Old applications that depend on it can set the attribute to true.</p>
<p>Without minimization, the URL must contain values for all path variables in
the route:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nb">map</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&quot;basic&quot;</span><span class="p">,</span> <span class="s">&quot;/{controller}/{action}&quot;</span><span class="p">,</span>
    <span class="n">controller</span><span class="o">=</span><span class="s">&quot;mycontroller&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&quot;myaction&quot;</span><span class="p">,</span> <span class="n">weather</span><span class="o">=</span><span class="s">&quot;sunny&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>This route matches any two-component URL, for instance &#8220;/help/about&#8221;.  The
resulting routing variables would be:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{</span><span class="s">&quot;controller&quot;</span><span class="p">:</span> <span class="s">&quot;help&quot;</span><span class="p">,</span> <span class="s">&quot;action&quot;</span><span class="p">:</span> <span class="s">&quot;about&quot;</span><span class="p">,</span> <span class="s">&quot;weather&quot;</span><span class="p">:</span> <span class="s">&quot;sunny&quot;</span><span class="p">}</span>
</pre></div>
</div>
<p>The path variables are taken from the URL, and any extra variables are added as
constants.  The extra variables for &#8220;controller&#8221; and &#8220;action&#8221; are <em>never used</em>
in matching, but are available as default values for generation:</p>
<div class="highlight-python"><pre>url("basic", controller="help") =&gt; "/help/about?weather=sunny"</pre>
</div>
<p>With minimization, the same route path would also match shorter URLs such as
&#8220;/help&#8221;, &#8220;/foo&#8221;, and &#8220;/&#8221;.  Missing values on the right of the URL would be
taken from the extra variables.  This was intended to lessen the number of
routes you had to write.  In practice it led to obscure application bugs
because sometimes an unexpected route would be matched.  Thus Routes 1.9
introduced non-minimization and recommended &#8220;map.minimization = False&#8221; for
all new applications.</p>
<p>A corollary problem was generating the wrong route.  Routes 1.9 tightened up
the rule for generating named routes.  If a route name is specified in
<tt class="docutils literal"><span class="pre">url()</span></tt> or <tt class="docutils literal"><span class="pre">url_for()</span></tt>, <em>only</em> that named route will be chosen.  In
previous versions, it might choose another route based on the keyword args.</p>
</div>
<div class="section" id="implicit-defaults-and-route-memory">
<h3>Implicit defaults and route memory<a class="headerlink" href="#implicit-defaults-and-route-memory" title="Permalink to this headline">¶</a></h3>
<p>Implicit defaults worked with minimization to provide automatic default values
for the &#8220;action&#8221; and &#8220;id&#8221; variables.  If a route was defined as
<tt class="docutils literal"><span class="pre">map.connect(&quot;/{contoller}/{action}/{id}&quot;)</span> <span class="pre">and</span> <span class="pre">the</span> <span class="pre">URL</span> <span class="pre">&quot;/archives&quot;</span></tt> was
requested, Routes would implicitly add <tt class="docutils literal"><span class="pre">action=&quot;index&quot;,</span> <span class="pre">id=None</span></tt> to the
routing variables.</p>
<p>To enable implicit defaults, set <tt class="docutils literal"><span class="pre">map.minimization</span> <span class="pre">=</span> <span class="pre">True;</span> <span class="pre">map.explicit</span> <span class="pre">=</span>
<span class="pre">False</span></tt>.  You can also enable implicit defaults on a per-route basis by setting
<tt class="docutils literal"><span class="pre">map.explicit</span> <span class="pre">=</span> <span class="pre">True</span></tt> and defining each route with a keyword argument <tt class="docutils literal"><span class="pre">explicit=False</span></tt>.</p>
<p>Previous versions also had implicit default values for &#8220;controller&#8221;,
&#8220;action&#8221;, and &#8220;id&#8221;.  These are now disabled by default, but can be enabled via
<tt class="docutils literal"><span class="pre">map.explicit</span> <span class="pre">=</span> <span class="pre">True</span></tt>.  This also enables route memory</p>
</div>
<div class="section" id="url-for">
<h3>url_for()<a class="headerlink" href="#url-for" title="Permalink to this headline">¶</a></h3>
<p><tt class="docutils literal"><span class="pre">url_for</span></tt> was a route generation function which was replaced by the <tt class="docutils literal"><span class="pre">url</span></tt>
object.  Usage is the same except that <tt class="docutils literal"><span class="pre">url_for</span></tt> uses route memory in some
cases and <tt class="docutils literal"><span class="pre">url</span></tt> never does.  Route memory is where variables from the current
URL (the current request) are injected into the generated URL.  To use route
memory with <tt class="docutils literal"><span class="pre">url</span></tt>, call <tt class="docutils literal"><span class="pre">url.current()</span></tt> passing the variables you want to
override.  Any other variables needed by the route will be taken from the
current routing variables.</p>
<p>In other words, <tt class="docutils literal"><span class="pre">url_for</span></tt> combines <tt class="docutils literal"><span class="pre">url</span></tt> and <tt class="docutils literal"><span class="pre">url.current()</span></tt> into one
function.  The location of <tt class="docutils literal"><span class="pre">url_for</span></tt> is also different.  <tt class="docutils literal"><span class="pre">url_for</span></tt> is
properly imported from <tt class="docutils literal"><span class="pre">routes</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">routes</span> <span class="kn">import</span> <span class="n">url_for</span>
</pre></div>
</div>
<p><tt class="docutils literal"><span class="pre">url_for</span></tt> was traditionally imported into WebHelpers, and it&#8217;s still used in
some tests and in <tt class="docutils literal"><span class="pre">webhelpers.paginate</span></tt>.  Many old Pylons applications
contain <tt class="docutils literal"><span class="pre">h.url_for()</span></tt> based on its traditional importation to helpers.py.
However, its use in new applications is discouraged both because of its
ambiguous syntax and because its implementation depends on an ugly singleton.</p>
<p>The <tt class="docutils literal"><span class="pre">url</span></tt> object is created by the RoutesMiddleware and inserted into the
WSGI environment.  Pylons makes it available as <tt class="docutils literal"><span class="pre">pylons.url</span></tt>, and in
templates as <tt class="docutils literal"><span class="pre">url</span></tt>.</p>
</div>
<div class="section" id="redirect-to">
<h3>redirect_to()<a class="headerlink" href="#redirect-to" title="Permalink to this headline">¶</a></h3>
<p>This combined <tt class="docutils literal"><span class="pre">url_for</span></tt> with a redirect.  Instead, please use your
framework&#8217;s redirect mechanism with a <tt class="docutils literal"><span class="pre">url</span></tt> call.  For instance in Pylons:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">pylons.controllers.util</span> <span class="kn">import</span> <span class="n">redirect</span>
<span class="n">redirect</span><span class="p">(</span><span class="n">url</span><span class="p">(</span><span class="s">&quot;login&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <h3><a href="contents.html">Table Of Contents</a></h3>
            <ul>
<li><a class="reference external" href="">Routes Manual</a><ul>
<li><a class="reference external" href="#introduction">Introduction</a></li>
<li><a class="reference external" href="#setting-up-routes">Setting up routes</a><ul>
<li><a class="reference external" href="#requirements">Requirements</a></li>
<li><a class="reference external" href="#magic-path-info">Magic path_info</a></li>
<li><a class="reference external" href="#conditions">Conditions</a></li>
<li><a class="reference external" href="#wildcard-routes">Wildcard routes</a></li>
<li><a class="reference external" href="#submappers">Submappers</a></li>
<li><a class="reference external" href="#adding-routes-from-a-nested-application">Adding routes from a nested application</a></li>
</ul>
</li>
<li><a class="reference external" href="#generation">Generation</a><ul>
<li><a class="reference external" href="#generating-routes-based-on-the-current-url">Generating routes based on the current URL</a></li>
<li><a class="reference external" href="#generation-only-routes-aka-static-routes">Generation-only routes (aka. static routes)</a></li>
<li><a class="reference external" href="#filter-functions">Filter functions</a></li>
<li><a class="reference external" href="#generating-urls-with-subdomains">Generating URLs with subdomains</a></li>
</ul>
</li>
<li><a class="reference external" href="#unicode">Unicode</a></li>
<li><a class="reference external" href="#restful-services">RESTful services</a><ul>
<li><a class="reference external" href="#resource-options">Resource options</a></li>
</ul>
</li>
<li><a class="reference external" href="#redirect-routes">Redirect routes</a></li>
<li><a class="reference external" href="#introspection">Introspection</a></li>
<li><a class="reference external" href="#other">Other</a></li>
<li><a class="reference external" href="#backward-compatibility">Backward compatibility</a><ul>
<li><a class="reference external" href="#omitting-the-name-arg">Omitting the name arg</a></li>
<li><a class="reference external" href="#varname">:varname</a></li>
<li><a class="reference external" href="#minimization">Minimization</a></li>
<li><a class="reference external" href="#implicit-defaults-and-route-memory">Implicit defaults and route memory</a></li>
<li><a class="reference external" href="#url-for">url_for()</a></li>
<li><a class="reference external" href="#redirect-to">redirect_to()</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            <h4>Previous topic</h4>
            <p class="topless"><a href="contents.html"
                                  title="previous chapter">Routes Documentation</a></p>
            <h4>Next topic</h4>
            <p class="topless"><a href="glossary.html"
                                  title="next chapter">Glossary</a></p>
            <h3>This Page</h3>
            <ul class="this-page-menu">
              <li><a href="_sources/manual.txt"
                     rel="nofollow">Show Source</a></li>
            </ul>
          <div id="searchbox" style="display: none">
            <h3>Quick search</h3>
              <form class="search" action="search.html" method="get">
                <input type="text" name="q" size="18" />
                <input type="submit" value="Go" />
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
              </form>
              <p class="searchtip" style="font-size: 90%">
              Enter search terms or a module, class or function name.
              </p>
          </div>
          <script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="modindex.html" title="Global Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="glossary.html" title="Glossary"
             >next</a> |</li>
        <li class="right" >
          <a href="contents.html" title="Routes Documentation"
             >previous</a> |</li>
        <li><a href="index.html">Routes home</a>&nbsp;|&nbsp;</li>
        <li><a href="contents.html">Documentation</a>&raquo;</li>
 
      </ul>
    </div>
    <div class="footer">
      &copy; Copyright 2009, Ben Bangert.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 0.6.1.
    </div>
  </body>
</html>