<html metal:use-macro="context/@@master/macros/master">

    <metal:slot fill-slot="main"
                tal:define="d              view/getPackageInfo; 
                            release_pkgs   d/releases;
                            dev_pkgs       d/dev;
                            releases       release_pkgs/releases;
                            release_files  release_pkgs/files;
                            dev_files      dev_pkgs/dev/files | python: [];
                            ">

      <h2>Available distributions for <span tal:content="request/package" />:</h2>
      <table border="1" id="package-info"
             tal:condition="releases">
        <thead>
            <th>Version</th>
            <th>Distribution file</th>
            <th>Size</th>
            <th>Modified</th>
            <th>Action</th>
        </thead>

        <tbody>
            <tal:loop repeat="version releases">
                <tal:loop repeat="d release_files/?version">
                    <tr>
                        <td tal:condition="python: repeat['d'].index() == 0" 
                            tal:attributes="rowspan python: len(release_files[version])">
                            <span tal:content="version" />
                        </td>

                        <td tal:content="d/name" />
                        <td tal:content="d/size" />
                        <td tal:content="d/mtime" />
                        <td> 
                            <a tal:condition="python: d['name'].endswith('egg')"
                               tal:attributes="href string:metadata?package=${request/package}&filename=${d/name}">
                                [Metadata]
                            </a>
                        </td>
                   </tr>
                </tal:loop>
            </tal:loop>
        </tbody>
      </table>
      <div class="message" tal:condition="not: releases">No distributions available</div>

      <h3>Development packages:</h3>
      <table border="1" id="package-info"
             tal:condition="dev_files">
        <thead>
            <th>Distribution file</th>
            <th>Size</th>
            <th>Modified</th>
        </thead>
        <tbody>
            <tal:loop repeat="d dev_files">
                <tr>
                    <td tal:content="d/name" />
                    <td tal:content="d/size" />
                    <td tal:content="d/mtime" />
               </tr>
            </tal:loop>
        </tbody>
      </table>
      <div class="message" tal:condition="not: dev_files">No development distributions available</div>

    </metal:slot>
</html>
