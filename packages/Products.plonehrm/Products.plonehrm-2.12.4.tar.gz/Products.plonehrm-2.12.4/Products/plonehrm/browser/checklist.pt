<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      metal:use-macro="here/main_template/macros/master"
      xml:lang="en"
      lang="en"
      i18n:domain="plonehrm">
  <head>
    <metal:block fill-slot="top_slot"
                 tal:define="border python: view.isContextWorklocation and 'enable_border' or 'disable_border';
			     dummy python: request.set(border, 0)" />
  </head>

  <body>
    <div metal:fill-slot="main"
	 tal:define="isWorklocation view/isContextWorklocation">

      <h1 class="documentFirstHeading"
	  tal:content="context/title" />
      <p class="documentDescription"
	 tal:content="context/description" />        

      <div tal:replace="structure context/@@alternative_views"
	   tal:condition="isWorklocation"/>


      <script type="text/javascript">
	var $ = jq;

	/* Display a calendar and updates the date of the item. */
	$(function() {
	  $(".checklist_inline_edit_date").datepicker(
	    {minDate: 0, maxDate: '+3Y',
             closeText: 'X',
	     dateFormat: 'dd-mm-yy',
	     onClose: function(dateText, inst) {
               var url = "checklist_inline_edit_date?item_id=" +
            	  inst.id + "&date=" + dateText;
	       $("#kssPortalMessage").load(url);

               $("#kssPortalMessage").attr({style: ""});
	      }
            }
          );
	});
      </script>


      <form method="post"
	    tal:define="can_edit_normal_items view/can_edit_normal_items;
			can_edit_manager_items view/can_edit_manager_items;"
	    tal:attributes="action python: context.absolute_url() + '/checklist'">
	<table class="listing">
	  <thead>
	    <tr>
	      <th></th>
	      <th  i18n:domain="checklist"
		   i18n:translate="label_task_text">Task</th>
	      <th i18n:domain="plone"
		  i18n:translate="Employee">Employee</th>
	      <th i18n:domain="plone"
		  i18n:translate="Work Location"
		  tal:condition="not: isWorklocation">Work location</th>
	      <th i18n:domain="checklist"
		  i18n:translate="label_due_date">Due date</th>
	    </tr>
	  </thead>
	  <tbody tal:define="items view/get_items;
			     sorted_items view/sorted_items;">
	    <tr tal:repeat="item sorted_items">
	      <tal:block tal:define="employee_name python: items[item][0].officialName();
				     employee_url python: items[item][0].absolute_url();
				     worklocation_name python: items[item][1].title;
				     worklocation_url python: items[item][1].absolute_url();
				     item_class python: 'item-' + item.get_style();
				     toLocalizedTime nocall:context/@@plone/toLocalizedTime;
				     complete_id python: items[item][0].UID() + '-' + str(item.id);
				     can_edit_this_item python: (item.isManager and can_edit_manager_items) or (not item.isManager and can_edit_normal_items)">
		<td>
		  <input type="checkbox"
			 tal:condition="can_edit_this_item"
			 tal:attributes="name complete_id;
					 value complete_id"/>
		  <input type="checkbox"
			 disabled="1"
			 tal:condition="not: can_edit_this_item" />
		</td>
		<td class="checklist_text_cell">
		  <a tal:attributes="href employee_url"
		       tal:content="item/text" />
		</td>
		<td><a tal:attributes="href employee_url"
		       tal:content="employee_name" />
		</td>
		<td tal:condition="not: isWorklocation">
		  <a tal:attributes="href worklocation_url"
		     tal:content="worklocation_name" />
		</td>
		<td tal:attributes="id python: 'td/' + complete_id"
		    class="checklist_date_cell" >
		  <tal:block tal:condition="can_edit_this_item">
		    <input type="text"
			   tal:condition="item/date"
			   tal:attributes="id python: complete_id;
					   class python: item_class + ' checklist_inline_edit_date';
					   value python: view.make_date(item.date)" />
		    <input type="text"
			   tal:condition="not: item/date"
			   tal:attributes="id python: complete_id;
					   class python: item_class + ' checklist_inline_edit_date';" />
		  </tal:block>
		  <tal:block tal:condition="not: can_edit_this_item">
		    <span tal:condition="item/date"
			  tal:attributes="class item_class"
			  tal:content="python: view.make_date(item.date)" />
		  </tal:block>
		    
		</td>
	      </tal:block>
	    </tr>
	  </tbody>
	</table>

	<input type="submit" class="context"
	       value="Mark tasks as done"
	       tal:condition="python: can_edit_manager_items or can_edit_normal_items"
	       i18n:attributes="value label_mark_tasks_as_done" />
      </form>
      <div style="clear: both;">
        &nbsp;
      </div>
      <div metal:use-macro="here/document_actions/macros/document_actions">
        Document actions (print, sendto etc)
      </div>
    </div>
  </body>
</html>
