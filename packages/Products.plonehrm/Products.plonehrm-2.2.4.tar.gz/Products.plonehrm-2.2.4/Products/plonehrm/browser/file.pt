<div i18n:domain="plonehrm"
     tal:omit-tag="">

  <dl class="module"
      tal:define="toLocalizedTime
		  nocall:context/@@plone/toLocalizedTime;"
      id="plonehrmFileViewlet">
    <dt class="moduleHeader">
      <a class="moduleButton"
	 id="add_file_button"
         tal:condition="view/add_url"
         tal:attributes="href view/add_url">
	<img src="add_icon.gif"
             alt="Add new file"
             title="Add new file"
             i18n:attributes="title add_new_file;
                              alt add_new_file;" /></a>
     <span tal:omit-tag=""
            i18n:translate="title_files">Files</span>
    </dt>
    <dd class="moduleItem lastItem">

      <!-- Shows the list of files. -->
      <tal:block condition="view/show_list">
      <div class="fileslist">
	<table tal:repeat="file view/file_list">
      <tbody>
        <tr>
            <td class="file_name">
            <span class="file_icon">
                <img tal:attributes="src string:${context/@@plone_portal_state/portal_url}/${file/getIcon}"/>
            </span>
                <a tal:attributes="href file/getURL;
                        title file/Description|nothing"
                tal:content="python: file.Title or file.id">Title</a>
            </td>
            <td class="file_remove">
                <a href=""
                class="action-icon"
                tal:attributes="href string:${file/getURL}/delete_confirmation">
                <img src="delete_icon.gif"
                alt="Remove this file"
                title="Remove this file"
                tal:attributes="src string:${context/@@plone_portal_state/portal_url}/delete_icon.gif"
                i18n:attributes="title label_remove_this_file;
                            alt label_remove_this_file" />
                </a>
            </td>
        </tr>
        <tr>
            <td>
               <span class="file_date discreet"
                tal:content="python:toLocalizedTime(file.Date)">date</span>
            <span class="discreet">-</span>
            <span class="file_size discreet"
                tal:content="file/getObjSize">size</span>
            </td>
          </tr>
        </tbody>
      </table>
      </div>
      </tal:block>

      <!-- Shows the upload file form. -->
      <form id="fileuploadform"
	    enctype="multipart/form-data"
	    method="POST"
	    tal:attributes="action string:${context/absolute_url}/kss_add_file/"
	    tal:condition="not:view/show_list">

	<script language="JavaScript">
	  var form = document.getElementById('fileuploadform')
	  var fileField = document.getElementById('file_file')
	  var errorMsg = document.getElementById('fileuploadform_errorfield')

	  /*
	  This function is used to validate the form before its
	  validation.
	  We did not use KSS here as the form can not be submitted
	  with KSS because of the file field.
	  */
	  function fileUploadSubmitForm() {	    
	    if (fileField.value == null || fileField.value == '') {
	      errorMsg.setAttribute("class", "errormessage")
	    } else {
	      form.submit()
	    }
	  }

	  /*
	  This function is called when a file is selected, in order to
	  hide the error message.
	  */
	  function fileUploadFileChanged() {
	    errorMsg.setAttribute("class", "dont-show")
	  }
	</script>

	<label for="file_title"
	       i18n:domain="plone"
	       i18n:translate="label_title">Title</label>
        <input name="file_title"
	       value=""
	       type="text"
	       size="30"
	       id="file_title"
	       class="filelistfield" />

	<label for="file_desc"
	       i18n:domain="plone"
	       i18n:translate="label_description">Description</label>
	<textarea rows="2" cols="20"
		  name="file_desc"
		  value=""
		  id="file_desc"
		  class="filelistfield">
	</textarea>
		
	<p id="fileuploadform_errorfield"
	     i18n:translate="label_no_file_selected"
	     class="dont-show">You did not specify a file.</p>
	
	<label for="file_file"
	       i18n:domain="plone"
	       i18n:translate="label_file">File</label>
	<input id="file_file"
	       type="file"
	       name="new_file_file" 
	       onchange="fileUploadFileChanged()"/><br />

        <input value="Add new file"
               id="submit-file"
               class="context"
               i18n:attributes="value add_new_file;"
               type="button"
	       onclick="fileUploadSubmitForm()"/>
        <input value="Cancel"
               id="cancel-file-form"
               class="context"
	       i18n:domain="plone"
               i18n:attributes="value label_cancel;"
               type="submit"  />
      </form>

    </dd>

  </dl>
</div>
