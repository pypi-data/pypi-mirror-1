<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      metal:use-macro="here/main_template/macros/master"
      xml:lang="en"
      lang="en"
      i18n:domain="plonehrm">
  <metal:styleslot fill-slot="style_slot">
    <!-- Extra css for calendar widget (plonehrm.absence) -->
    <tal:css define="css python:['jscalendar/calendar-system.css'];"
             repeat="item css">
      <style type="text/css"
             media="all"
             tal:condition="python:exists('portal/%s' % item)"
             tal:content="structure string:<!-- @import url($portal_url/$item); -->">
      </style>
    </tal:css>
  </metal:styleslot>
  <metal:javascript_head fill-slot="javascript_head_slot">
    <!-- Extra javascript for calendar widget (plonehrm.absence) -->
    <tal:js define="js python:['jscalendar/calendar_stripped.js',
                               'jscalendar/calendar-en.js'];"
            repeat="item js">
      <script type="text/javascript"
              charset="iso-8859-1"
              tal:condition="python:exists('portal/%s' % item)"
              tal:attributes="src string:$portal_url/$item">
      </script>
    </tal:js>

  </metal:javascript_head>
  <body>
    <div metal:fill-slot="main">

      <h1 class="documentFirstHeading"
	  i18n:translate="heading_edit_employee">
	Edit employee</h1>

      <form name="employee_edit_form"
	    enctype="multipart/form-data"
	    class="plonehrm_custom_edit"
	    method="post"
	    tal:attributes="action python: context.absolute_url() + '/@@edit_employee'" >

	<div tal:repeat="field python: [field for field in view.form_fields if field not in view.hidden_fields]"
	     class="field"
	     tal:attributes="id python: 'div_' + field"
	     tal:define="errors view/errors" >
	  
	  <label tal:content="python: view.translate_field_name(field)"
		 tal:attributes="for python: 'field_' + field" />
	  <span class="fieldRequired" title="Required"
		tal:condition="python: field in view.required_fields"
		i18n:domain="plone"
		i18n:translate="title_required">(Required)</span>
	  <br />

	  <p tal:condition="python: field in view.errors_list"
	     tal:repeat="error python: view.errors_list[field]"
	     tal:attributes="id python: 'error_' + field + '_' + error;
			     class python: field + '_' + error in view.errors and 'errormsg' or 'dont-show'"
	     tal:content="python: view.errors_list[field][error]" />

	  <input type="text"
		 tal:condition="python: field not in ['birthDate', 'idEndDate', 'gender', 'civilStatus', 'idType', 'portrait']"
		 tal:attributes="value python: view.form[field];
				 id python: 'field_' + field;
				 name field" />

	  <tal:block tal:condition="python: field in ['birthDate', 'idEndDate']">
	    <tal:start
	       define="today python:modules['DateTime'].now();
		       starting_year python: (field == 'birthDate') and 1940 or today.year();
		       ending_year python: (field == 'birthDate') and (today.year() - 12) or (today.year() + 15);
		       utils python:modules['Products.CMFPlone.utils'];
		       uniqueItemIndex python:utils.RealIndexIterator(pos=0);
		       fieldName field;
		       id fieldName;
		       show_hm python:False;
		       show_ymd python:True;
		       inputname fieldName;
		       formname string:employee_edit_form;
		       inputvalue python:view.form[field];
		       tabindex python:1;">
	      <metal:box use-macro="here/calendar_macros/macros/calendarDatePickerBox|here/calendar_slot/macros/calendarDatePickerBox">
		a calendar, hopefully
	      </metal:box>
	    </tal:start>
	  </tal:block>
	  
	  <tal:block tal:condition="python: field in ['gender', 'civilStatus', 'idType']">
	    <select tal:attributes="name field"
		    tal:define="vocabulary  python: view.get_vocabulary(field)">
	      <tal:block tal:repeat="value vocabulary">
		<option tal:attributes="value value"
			selected="selected"
			tal:condition="python: value == view.form[field]"
			tal:content="python: vocabulary[value]" />
		<option tal:attributes="value value"
			tal:condition="python: not value == view.form[field]"
			tal:content="python: vocabulary[value]" />

	      </tal:block>
	    </select>
	  </tal:block>

	  <tal:block tal:condition="python: field == 'portrait'">
	    <tal:block tal:condition="python: view.form['portrait']">
              <div class="field">
		<span tal:replace="structure python: view.form['portrait']" />
              </div>

	      <input class="noborder" type="radio" checked="checked"
                     value="nochange" name="portrait_delete"
                     onclick="document.getElementById('field_portrait').disabled=true"
                     id="portrait_nochange" />
	      <label for="portrait_nochange"
		     i18n:domain="plone"
		     i18n:translate="nochange_image">
		Keep existing image
	      </label>
	      <br />
		
	      <input class="noborder" type="radio"
                     value="delete" name="portrait_delete"
                     onclick="document.getElementById('field_portrait').disabled=true"
                     id="portrait_delete" />
	      
	      <label for="portrait_delete"
		     i18n:domain="plone"
		     i18n:translate="delete_image">
		Delete current image
	      </label>
	      <br />

	      <input class="noborder" type="radio"
		     value="replace" name="portrait_delete"
                     onclick="document.getElementById('field_portrait').disabled=false"
                     id="portrait_upload" />
	      <label for="portrait_upload"
		     i18n:domain="plone"
		     i18n:translate="upload_image">
		Replace with new image:
	      </label>

	      <div style="padding-left:1.5em;padding-top:0.5em;">		  
		<input type="file" size="30" name="portrait" id="field_portrait" />
		<script type="text/javascript">document.getElementById('field_portrait').disabled=true;</script>
	      </div>
	    </tal:block>

	    <tal:block tal:condition="python: not view.form['portrait']">
              <input type="file" size="30" name="portrait"
		     id="field_portrait" />
	    </tal:block>
	  </tal:block>
	</div>

	<input type="submit" class="context"
	       i18n:domain="plone"
	       i18n:attributes="value label_save" />
	<input type="submit" class="standalone"
	       name="form_cancel"
	       i18n:domain="plone"	       
	       i18n:attributes="value label_cancel" />

      </form>
      <div style="clear: both;">
        &nbsp;
      </div>
    </div>
  </body>
</html>
