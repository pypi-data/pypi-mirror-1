<html>
  <head>
    <title>Portal factory cleanup</title>
  </head>
  <body>
    <h1>Remove portal_factory items from the portal_catalog</h1>
    <p>
      You have seen this: you write a catalog query, on one of the
      brains you do a <code>brain.getObject()</code> and this fails
      because the object was wrongly added to the catalog while being
      created and it was not cleaned up.
    </p>
    <p>
      We are the cleanup crew.
    </p>
    <h2>Find and remove portal_factory items</h2>
    <p>
      Click the <em>Clean</em> button to find and remove all catalog
      brains that have portal_factory in their path.  This is a
      reserved id, so this should not catch valid content.
    </p>
    <p>
      Click the <em>Kill</em> button to be more aggressive: find all
      catalog brains, try to get the object that belongs that brain
      and remove the brain if this gives an error.  This will take a
      lot longer as it will wake up every object in your Zope Data.fs.
      This may find less or more items than the Clean button.
    </p>
    <p>We will print details in your zope instance log file.</p>
    <p tal:condition="request/form/submitted|nothing">
      You have clicked the
      <span tal:content="request/form/clean|request/form/kill|nothing" />
      button and cleaned
      <em tal:content="view/items_cleaned" /> item(s). 
    </p>
    <form action="" method="post"
          tal:condition="not:request/form/submitted|nothing">
      <input type="hidden" name="submitted" value="submitted" />
      <input type="submit" name="clean" value="Clean" />
      <input type="submit" name="kill" value="Kill" />
   </form>

  </body>
</html>