worker_processes  1;

error_log  logs/error.log;

pid        logs/nginx.pid;

events {
    worker_connections  1024;
}

http {
    include       conf/mime.types;
    default_type  application/octet-stream;
	add_header Server pyflow/0.1;

    sendfile        on;

    keepalive_timeout  65;

    gzip  on;
    gzip_min_length  1000;
    gzip_proxied     expired no-cache no-store private auth;
    gzip_types       text/plain application/xml text/html text/css text/javascript;

	upstream backend {
		ip_hash;

		server unix:tmp/pyflow.socket1;
		server unix:tmp/pyflow.socket2;
		server unix:tmp/pyflow.socket3;
		server unix:tmp/pyflow.socket4;
	}

    server {
        listen       8080;
        server_name  localhost;

        error_page   500 502 503 504  /50x.html;
        location = /50x.html {
            root   html;
        }

		location ~* \.(js|css|jpg|jpeg|gif|png|ico)$ {
			if (-f $request_filename) {
				expires      max;
				break; 
			}        
		}

		location ~ ^/static/ {
			root html;
		}
		location = /favicon.ico {
			root html;
		}

		location / {
			fastcgi_pass backend;
			include conf/fastcgi_params;
		}
    }
}
