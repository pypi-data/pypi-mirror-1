<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      metal:use-macro="context/main_template/macros/master"
      xml:lang="en"
      lang="en"
      i18n:domain="absence">
  <body>
    <div metal:fill-slot="main"
         tal:define="employee nocall:context/aq_parent">
      <h1 i18n:translate="heading_absence_details_employee">
        Absence details
        <span i18n:name="employeename" tal:content="employee/Title"/>
      </h1>
      <a i18n:translate="up-to-employee"
         i18n:domain="plonehrm"
         class="link-parent"
         tal:attributes="href employee/absolute_url">
        Up to employee
      </a>

      <div class="alternative-absence-views"
          tal:define="current_absence employee/@@plonehrm.absence/get_current_absence;">
        <tal:current condition="python:current_absence">
          <a tal:condition="python:context != current_absence"
             tal:attributes="href current_absence/absolute_url"
             i18n:translate="label_current_case">Current case</a>
          <span tal:condition="python:context == current_absence"
                i18n:translate="label_current_case">Current case</span>
          |
        </tal:current>
        <a tal:attributes="href string:${employee/absolute_url}/@@absencelist"
           i18n:translate="label_complete_history">Complete history</a>
      </div>

    <div id="absence-view-container">
        <table class="listing absence-head"
                cellspacing="0"
                cellpadding="0"
            tal:define="isCurrentAbsence context/is_current_absence">


        <tal:block tal:condition="isCurrentAbsence">
    <!-- 	If the absence is the current one (meaning it's not closed),
        then we display the title in red and "Absent since"/"Number of
        days" -->
            <tr>
            <th i18n:translate="heading_reason">
                Reason
            </th>
            <td class="absencetext" tal:content="context/Title" />
            </tr>
            <tr>
            <th i18n:translate="heading_absent_since">
                Absent since
            </th>
            <td tal:content="python:toLocalizedTime(context.start_date.isoformat())" />
            </tr>
            <tr>
            <th i18n:translate="heading_number_of_days">
                Number of days
            </th>
            <td tal:content="context/days_absent" />
            </tr>
        </tal:block>
        <tal:block tal:condition="not:isCurrentAbsence">
    <!-- 	If the absence is not the current one (meaning it's closed),
        then we display the title in without particular style and
        start and end date -->
            <tr>
            <th i18n:translate="heading_reason">
                Reason
            </th>
            <td tal:content="context/Title" />
            </tr>
            <tr>
            <th i18n:translate="label_start_date">
                Start date
            </th>
            <td tal:content="python:toLocalizedTime(context.start_date.isoformat())" />
            </tr>
            <tr>
            <th i18n:translate="label_end_date">
                End date
            </th>
            <td tal:content="python:toLocalizedTime(context.end_date.isoformat())" />
            </tr>
            <tr>
            <th i18n:translate="heading_number_of_days">
                Number of days
            </th>
            <td tal:content="context/days_absent" />
            </tr>
        </tal:block>
        </table>

        <span class="clear"></span>

        <table
            class="listing absence-view"
            tal:define="results
            python:context.getFolderContents({'sort_on':'main_date','sort_order':'reverse'})"
            tal:condition="results">
            <thead>
            <tr>
                <th i18n:translate="label_main_date">Date</th>
                <th i18n:translate="listingheader_description">Description</th>
                <th i18n:translate="label_created_by">Added by</th>
                <th  i18n:translate="label_created_on">Added on</th>
                <th i18n:domain="plone"
            i18n:translate="label_edit">Edit</th>
            </tr>
            </thead>
            <tbody>
            <tr tal:repeat="item results"
                tal:attributes="class python:repeat['item'].odd() and 'even' or 'odd'">
                <td tal:content="python:toLocalizedTime(item.main_date.isoformat())" />
                <td tal:define="item_type item/portal_type;
                                item_type_class python:'contenttype-' + normalizeString(item_type);"
                    tal:attributes="class item_type_class">

                <span tal:condition="python:item_type == 'Note'"
                        tal:content="item/Description" />

                <a tal:condition="python:item_type != 'Note'"
                    tal:attributes="href item/getURL"
                    tal:content="item/Title" />

                </td>
                <td class="discreet" tal:define="creator python:context.portal_membership.getMemberById(item.Creator);
                                name python:creator and creator.getProperty('fullname') or item.Creator;"
                    tal:content="name" />
                <td class="discreet" tal:content="python:toLocalizedTime(item.created)" />
                <td>
                <a class="action-icon"
                    tal:attributes="href string:${item/getURL}/edit">
                    <img src="edit.gif"
                        alt="Edit"
                        title="Edit"
                        i18n:domain="plone"
                        i18n:attributes="title label_edit;
                                        alt label_edit;" />
                </a>
                </td>
            </tr>
            </tbody>
        </table>
    </div>

      <div metal:use-macro="context/document_actions/macros/document_actions">
        Document actions (print, sendto etc)
      </div>
    </div>
  </body>
</html>
