<div id="absencelist"
     i18n:domain="absence">

  <dl class="module">
    <dt class="moduleHeader">
      <a class="moduleButton"
         tal:attributes="href string:${here/absolute_url}/@@absencelist">
         <img src="folder_icon.gif"
             title="Show the complete absence list"
             alt="Show the complete absence list"
             i18n:attributes="alt show_complete_absencelist;" />
      </a>
      <a tal:condition="python:view.show_add_absence_button()"
         class="moduleButton" id="add_absence_button"
         href="">
         <img src="ico-sick.gif"
             title="Add a new absence"
             alt="Add a new absence"
             i18n:attributes="alt add_new_absence;" />
      </a>
      <a tal:condition="python:view.show_close_absence_button()"
         class="moduleButton" id="close_absence_button"
         href="">
         <img src="ico-healthy.gif"
             title="Close the absence"
             alt="Close the absence"
             i18n:attributes="alt add_new_absence;" />
      </a>

      <span tal:omit-tag="" tal:condition="view/show_absence_list"
            i18n:translate="head_absencelist">Absences</span>
      <span tal:omit-tag="" tal:condition="view/show_absence_form"
            i18n:translate="head_add_absence">Add absence</span>
      <span tal:omit-tag="" tal:condition="view/show_absence_close_form"
            i18n:translate="head_close_absence">Close absence</span>
    </dt>

    <dd class="moduleItem lastItem">
      <p tal:content="view/error_message" />
      <form
          name="add_absence"
          method="post"
          id="addabsenceform"
          action=""
          tal:attributes="action string:${context/absolute_url}/@@add_absence"
          tal:condition="view/show_absence_form">
        <label for="new-absence-text">Description</label> 
        <input name="text"
               value=""
               type="text"
               size="30"
               id="new-absence-text"
               class="absencelistfield" />
        <br />
        <label for="new_absence_date">Start date</label> 
        <tal:start
            define="today python:modules['DateTime'].now();
                    utils python:modules['Products.CMFPlone.utils'];
                    uniqueItemIndex python:utils.RealIndexIterator(pos=0);
                    fieldName string:new_absence_date; 
                    id fieldName; 
                    show_hm python:False; 
                    show_ymd python:True; 
                    starting_year python:today.year() - 1; 
                    ending_year python:today.year(); 
                    inputname fieldName; 
                    formname string:add_absence; 
                    inputvalue python:str(today);
                    tabindex python:1;"> 
          <metal:box use-macro="here/calendar_macros/macros/calendarDatePickerBox|here/calendar_slot/macros/calendarDatePickerBox"> 
            a calendar, hopefully 
          </metal:box> 
        </tal:start> 

        <input value="Add absence"
               id="submit-absence"
               i18n:attributes="value label_add_absence;"
               type="submit"  />
        <input value="Cancel"
               id="cancel-absence-form"
               i18n:attributes="value label_cancel;"
               type="submit"  />
      </form>


      <form
          name="close_absence"
          method="post"
          id="closeabsenceform"
          action=""
          tal:condition="view/show_absence_close_form">
        <tal:block define="absence view/get_current_absence">
        <label for="new-absence-text">Description</label> 
        <input name="text"
               value=""
               tal:attributes="value absence/text"
               type="text"
               size="30"
               id="absence-text"
               class="absencelistfield" />
        <br />
        Start date: <span tal:content="absence/start_date"></span><br />
        <label for="close_absence_date">Closing date:</label> 
        <tal:start
            define="today python:modules['DateTime'].now();
                    utils python:modules['Products.CMFPlone.utils'];
                    uniqueItemIndex python:utils.RealIndexIterator(pos=0);
                    fieldName string:close_absence_date; 
                    id fieldName;
                    show_hm python:False; 
                    show_ymd python:True; 
                    starting_year python:today.year() - 1; 
                    ending_year python:today.year(); 
                    inputname fieldName; 
                    formname string:add_absence; 
                    inputvalue python:str(today);
                    tabindex python:1;"> 
          <metal:box use-macro="here/calendar_macros/macros/calendarDatePickerBox|here/calendar_slot/macros/calendarDatePickerBox"> 
            a calendar, hopefully 
          </metal:box> 
        </tal:start> 

        <input value="Close absence"
               id="submit-close-absence"
               i18n:attributes="value label_close_absence;"
               type="submit"  />
        <input value="Cancel"
               id="cancel-absence-form"
               i18n:attributes="value label_cancel;"
               type="submit"  />
        </tal:block>
      </form>
      
      <table 
          tal:condition="view/show_absence_list"
          class="absencelist"
          cellspacing="0"
          cellpadding="0">
        <tal:block define="toLocalizedTime nocall:context/@@plone/toLocalizedTime;
                           cropText nocall:context/@@plone/cropText;
                           absencelist view/get_absence_list;">
          <tr tal:repeat="absence absencelist"
          	  tal:attributes="class python:absence.end_date and 'employee_healthy' or 'employee_sick'">
            <td class="notesbullet">
              &nbsp;
            </td>
            <td tal:content="python:cropText(absence.text,18)"
                class="absencetext">
              Absence text.
            </td>
            <td class="notedate startdate"
                nowrap="true">
              <span tal:replace="python:toLocalizedTime(absence.start_date.isoformat())">
              </span>
              </td>
              <td class="notedate">
              <tal:end_date condition="absence/end_date">
                <span tal:replace="python:toLocalizedTime(absence.end_date.isoformat())" />
              </tal:end_date>
              </td>

            <!--td class="remove-absence">
              <img src="delete_icon.gif"
                   id="remove-#"
                   alt="Remove this absence"
                   tal:attributes="src string:${context/@@plone_portal_state/portal_url}/delete_icon.gif;
                                   id string:remove-${repeat/absence/number};" />
            </td-->
          </tr>
        </tal:block>
      </table>
    </dd>
  </dl>
</div>
