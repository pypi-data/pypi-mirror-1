<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      metal:use-macro="here/main_template/macros/master"
      xml:lang="en"
      lang="en"
      i18n:domain="absence">
  <metal:styleslot fill-slot="style_slot">
    <!-- Extra css for calendar widget (plonehrm.absence) -->
    <tal:css define="css python:['jscalendar/calendar-system.css'];"
             repeat="item css">
      <style type="text/css"
             media="all"
             tal:condition="python:exists('portal/%s' % item)"
             tal:content="structure string:<!-- @import url($portal_url/$item); -->">
      </style>
    </tal:css>
  </metal:styleslot>
  <metal:javascript_head fill-slot="javascript_head_slot">
    <!-- Extra javascript for calendar widget (plonehrm.absence) -->
    <tal:js define="js python:['jscalendar/calendar_stripped.js',
                               'jscalendar/calendar-en.js'];"
            repeat="item js">
      <script type="text/javascript"
              charset="iso-8859-1"
              tal:condition="python:exists('portal/%s' % item)"
              tal:attributes="src string:$portal_url/$item">
      </script>
    </tal:js>

  </metal:javascript_head>
  <body>
    <div metal:fill-slot="main">

      <h1 class="documentFirstHeading"
	  i18n:translate="heading_edit_file">
	Edit file</h1>

      <form name="file_edit_form"
	    enctype="multipart/form-data"
	    class="plonehrm_custom_edit"
	    method="post"
	    tal:attributes="action python: context.absolute_url() + '/@@edit_file'" >

	<div tal:repeat="field view/form_fields"
	     class="field"
	     tal:attributes="id python: 'div_' + field"
	     tal:define="errors view/errors" >
	  
	  <label tal:content="python: view.translate_field_name(field)"
		 tal:attributes="for python: 'field_' + field" />
	  <span class="fieldRequired" title="Required"
		tal:condition="python: field in view.required_fields"
		i18n:domain="plone"
		i18n:translate="title_required">(Required)</span>
	  <br />

	  <p tal:condition="python: field in view.errors_list"
	     tal:repeat="error python: view.errors_list[field]"
	     tal:attributes="id python: 'error_' + field + '_' + error;
			     class python: field + '_' + error in view.errors and 'errormsg' or 'dont-show'"
	     tal:content="python: view.errors_list[field][error]" />


	  <textarea tal:condition="python: field == 'description'"
		    tal:attributes="id python: 'field_' + field;
				    name field"
		    tal:content="python: view.form[field]" />

	  <input type="text"
		 tal:condition="python: field == 'title'"
		 tal:attributes="value python: view.form[field];
				 id python: 'field_' + field;
				 name field" />

	  <tal:block tal:condition="python: field == 'fileDate'">
	    <tal:start
	       define="today python:modules['DateTime'].now();
		       starting_year python: (field == 'birthDate') and 1940 or today.year();
		       ending_year python: (field == 'birthDate') and (today.year() - 12) or (today.year() + 15);
		       utils python:modules['Products.CMFPlone.utils'];
		       uniqueItemIndex python:utils.RealIndexIterator(pos=0);
		       fieldName field;
		       id fieldName;
		       show_hm python:False;
		       show_ymd python:True;
		       inputname fieldName;
		       formname string:employee_edit_form;
		       inputvalue python:view.form[field];
		       tabindex python:1;">
	      <metal:box use-macro="here/calendar_macros/macros/calendarDatePickerBox|here/calendar_slot/macros/calendarDatePickerBox">
		a calendar, hopefully
	      </metal:box>
	    </tal:start>
	  </tal:block>
	  
	  <tal:block tal:condition="python: field == 'file'">
	    <tal:block tal:condition="python: view.form['file']">
              <div class="field">
		<span class="file_icon">
                  <img tal:attributes="src python: view.form['file'].getIcon()"/>
		</span>

               <span class="file_date discreet"
                     tal:content="python:toLocalizedTime(view.form['file'].Date())">date</span>
               <span class="discreet">-</span>
               <span class="file_size discreet"
                     tal:content="python: view.form['file'].getObjSize()">size</span>
              </div>

	      <input class="noborder" type="radio" checked="checked"
                     value="nochange" name="file_delete"
                     onclick="document.getElementById('field_file').disabled=true"
                     id="file_nochange" />
	      <label for="file_nochange"
		     i18n:domain="plone"
		     i18n:translate="nochange_file">
		Keep existing file
	      </label>
	      <br />
		
	      <input class="noborder" type="radio"
		     value="replace" name="file_delete"
                     onclick="document.getElementById('field_file').disabled=false"
                     id="file_upload" />
	      <label for="file_upload"
		     i18n:domain="plone"
		     i18n:translate="upload_file">
		Replace with new file:
	      </label>

	      <div style="padding-left:1.5em;padding-top:0.5em;">		  
		<input type="file" size="30" name="file" id="field_file" />
		<script type="text/javascript">document.getElementById('field_file').disabled=true;</script>
	      </div>
	    </tal:block>

	    <tal:block tal:condition="python: not view.form['file']">
              <input type="file" size="30" name="file"
		     id="field_file" />
	    </tal:block>
	  </tal:block>
	</div>

	<input type="submit" class="context"
	       i18n:domain="plone"
	       i18n:attributes="value label_save" />
	<input type="submit" class="standalone"
	       name="form_cancel"
	       i18n:domain="plone"	       
	       i18n:attributes="value label_cancel" />

      </form>
      <div style="clear: both;">
        &nbsp;
      </div>
    </div>
  </body>
</html>
