<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.4: http://docutils.sourceforge.net/" />
<title>How to build lxml from source</title>
<link rel="stylesheet" href="style.css" type="text/css" />
</head>
<body>
<div class="document" id="how-to-build-lxml-from-source">
<h1 class="title">How to build lxml from source</h1>
<p>To build lxml from source, you need libxml2 and libxslt properly installed,
including header files (possibly shipped in -dev packages).  The build process
also requires <a class="reference" href="http://peak.telecommunity.com/DevCenter/setuptools">setuptools</a>.</p>
<div class="contents topic">
<p class="topic-title first"><a id="contents" name="contents">Contents</a></p>
<ul class="simple">
<li><a class="reference" href="#pyrex" id="id3" name="id3">Pyrex</a></li>
<li><a class="reference" href="#subversion" id="id4" name="id4">Subversion</a></li>
<li><a class="reference" href="#id2" id="id5" name="id5">Setuptools</a></li>
<li><a class="reference" href="#running-the-tests-and-reporting-errors" id="id6" name="id6">Running the tests and reporting errors</a></li>
<li><a class="reference" href="#contributing-an-egg" id="id7" name="id7">Contributing an egg</a></li>
<li><a class="reference" href="#static-linking-on-windows" id="id8" name="id8">Static linking on Windows</a></li>
<li><a class="reference" href="#building-debian-packages-from-svn-sources" id="id9" name="id9">Building Debian packages from SVN sources</a></li>
</ul>
</div>
<div class="section">
<h1><a id="pyrex" name="pyrex">Pyrex</a></h1>
<p>The lxml.etree and lxml.objectify modules are written in <a class="reference" href="http://www.cosc.canterbury.ac.nz/~greg/python/Pyrex/">Pyrex</a>.  Since we
distribute the Pyrex-generated .c files with lxml releases, however, you do
not need Pyrex to build lxml from the normal release sources.</p>
<p>If you are interested in building lxml from a Subversion checkout or want to
be an lxml developer, you do need a working Pyrex installation.</p>
<ul>
<li><p class="first">lxml 1.1 and later</p>
<p>Newer versions of lxml depend on features and bug fixes that are not yet
available in an official Pyrex release.  This includes support for the
external C-API of lxml, for Python 2.5 and for 64 bit architectures.</p>
<p>To build lxml 1.1 and later from non-release or modified sources, you must
therefore install an updated Pyrex version from here:</p>
<p><a class="reference" href="http://codespeak.net/svn/lxml/pyrex/">http://codespeak.net/svn/lxml/pyrex/</a></p>
<p>Since version 1.1.2, the lxml source distribution includes this Pyrex
version.  It will be used if the 'pyrex' directory is available in the lxml
root directory.  If you install from SVN or delete this directory from the
unpacked distribution directory, the normally installed Pyrex version will
be used.</p>
</li>
<li><p class="first">lxml 1.0 and earlier</p>
<p>The 1.0 series build with a standard installation of Pyrex 0.9.4.1.  Note
that Pyrex up to and including version 0.9.4 has known problems when
compiling lxml with gcc 4.x or Python 2.4.  Do not use it.  If you want to
build lxml from non-release sources, please install Pyrex version 0.9.4.1 or
later.</p>
<p>Pyrex now supports <a class="reference" href="http://peak.telecommunity.com/DevCenter/EasyInstall">EasyInstall</a>, so you can install it by running the
following command as super-user:</p>
<pre class="literal-block">
easy_install Pyrex
</pre>
</li>
</ul>
</div>
<div class="section">
<h1><a id="subversion" name="subversion">Subversion</a></h1>
<p>The lxml package is developed in a Subversion repository.  You can retrieve
the current developer version by calling:</p>
<pre class="literal-block">
svn co http://codespeak.net/svn/lxml/trunk lxml
</pre>
<p>This will create a directory <tt class="docutils literal"><span class="pre">lxml</span></tt> and download the source into it.  You
can also <a class="reference" href="http://codespeak.net/svn/lxml">browse the repository through the web</a> or use your favourite SVN
client to access it.</p>
</div>
<div class="section">
<h1><a id="id2" name="id2">Setuptools</a></h1>
<p>Usually, building lxml is done through setuptools.  Do a Subversion checkout
(or download the source tar-ball and unpack it) and then type:</p>
<pre class="literal-block">
python setup.py build
</pre>
<p>If you want to test lxml from the source directory, it is better to build it
in-place like this:</p>
<pre class="literal-block">
python setup.py  build_ext -i
</pre>
<p>or, in Unix-like environments:</p>
<pre class="literal-block">
make
</pre>
<p>If you get errors about missing header files (e.g., <tt class="docutils literal"><span class="pre">libxml/xmlversion.h</span></tt>)
then you need to add the location of that file to the include path like:</p>
<pre class="literal-block">
python setup.py build_ext -i -I /usr/include/libxml2
</pre>
<p>where the file is in <tt class="docutils literal"><span class="pre">/usr/include/libxml2/libxml/xmlversion.h</span></tt></p>
<p>To use lxml.etree in-place, you can place lxml's <tt class="docutils literal"><span class="pre">src</span></tt> directory on your
Python module search path (PYTHONPATH) and then import <tt class="docutils literal"><span class="pre">lxml.etree</span></tt> to play
with it.</p>
<p>To recompile after changes, note that you may have to run <tt class="docutils literal"><span class="pre">make</span> <span class="pre">clean</span></tt> or
delete the file <tt class="docutils literal"><span class="pre">src/lxml/etree.c</span></tt>.  Distutils do not automatically pick up
changes that affect files other than the main file <tt class="docutils literal"><span class="pre">src/lxml/etree.pyx</span></tt>.</p>
</div>
<div class="section">
<h1><a id="running-the-tests-and-reporting-errors" name="running-the-tests-and-reporting-errors">Running the tests and reporting errors</a></h1>
<p>The source distribution (tgz) and the Subversion repository contain a test
suite for lxml.  You can run it from the top-level directory:</p>
<pre class="literal-block">
python test.py
</pre>
<p>Note that the test script only tests the in-place build (see distutils
building above), as it searches the <tt class="docutils literal"><span class="pre">src</span></tt> directory.  You can use the
following one-step command to trigger an in-place build and test it:</p>
<pre class="literal-block">
make test
</pre>
<p>To run the ElementTree and cElementTree compatibility tests, make sure
you have lxml on your PYTHONPATH first, then run:</p>
<pre class="literal-block">
python selftest.py
</pre>
<p>and:</p>
<pre class="literal-block">
python selftest2.py
</pre>
<p>If the tests give failures, errors, or worse, segmentation faults, we'd really
like to know.  Please contact us on the <a class="reference" href="http://codespeak.net/mailman/listinfo/lxml-dev">mailing list</a>, and please specify
the version of lxml, libxml2, libxslt and Python you were using, as well as
your operating system type (Linux, Windows, MacOs, ...).</p>
</div>
<div class="section">
<h1><a id="contributing-an-egg" name="contributing-an-egg">Contributing an egg</a></h1>
<p>This is the procedure to make an lxml egg for your platform:</p>
<ul class="simple">
<li>download the lxml-x.y.tar.gz release. This contains the pregenerated C so we
don't run into any Pyrex issues. Unpack it and cd into it.</li>
<li>python setup.py build</li>
<li>if you're on a unixy platform, cd into build/lib.your.platform and
strip any .so file you find there. This reduces the size of the egg.</li>
<li>python setup.py bdist_egg upload</li>
</ul>
<p>The last 'upload' step only works if you have access to the lxml cheeseshop
entry.  If not, you can just make an egg with <tt class="docutils literal"><span class="pre">bdist_egg</span></tt> and mail it to the
lxml maintainer.</p>
</div>
<div class="section">
<h1><a id="static-linking-on-windows" name="static-linking-on-windows">Static linking on Windows</a></h1>
<p>Most operating systems have proper package management that makes installing
current versions of libxml2 and libxslt easy.  The most famous exception is
Microsoft Windows, which entirely lacks these capabilities.  It can therefore
be interesting to statically link the external libraries into lxml.etree to
avoid having to install them separately.</p>
<p>Download lxml and all required libraries to the same directory.  The iconv,
libxml2, libxslt, and zlib libraries are all available from the ftp site
<a class="reference" href="ftp://ftp.zlatkovic.com/pub/libxml/">ftp://ftp.zlatkovic.com/pub/libxml/</a>.</p>
<p>Your directory should now have the following files in it (although most likely
different versions):</p>
<pre class="literal-block">
iconv-1.9.1.win32.zip
libxml2-2.6.23.win32.zip
libxslt-1.1.15.win32.zip
lxml-1.0.0.tgz
zlib-1.2.3.win32.zip
</pre>
<p>Now extract each of those files in the <em>same</em> directory.  This should give you
something like this:</p>
<pre class="literal-block">
iconv-1.9.1.win32/
iconv-1.9.1.win32.zip
libxml2-2.6.23.win32/
libxml2-2.6.23.win32.zip
libxslt-1.1.15.win32/
libxslt-1.1.15.win32.zip
lxml-1.0.0/
lxml-1.0.0.tgz
zlib-1.2.3.win32/
zlib-1.2.3.win32.zip
</pre>
<p>Go to the lxml directory and edit the file <tt class="docutils literal"><span class="pre">setup.py</span></tt>.  There should
be a section near the top that looks like this:</p>
<pre class="literal-block">
STATIC_INCLUDE_DIRS = []
STATIC_LIBRARY_DIRS = []
STATIC_CFLAGS = []
</pre>
<p>Change this section to something like this, but take care to use the correct
version numbers:</p>
<pre class="literal-block">
STATIC_INCLUDE_DIRS = [
       "..\\libxml2-2.6.23.win32\\include ",
       "..\\libxslt-1.1.15.win32\\include",
       "..\\zlib-1.2.3.win32\\include",
       "..\\iconv-1.9.1.win32\\include"
       ]

STATIC_LIBRARY_DIRS = [
       "..\\libxml2-2.6.23.win32\\lib",
       "..\\libxslt-1.1.15.win32\\lib",
       "..\\libxslt-1.1.15.win32\\lib",
       "..\\zlib-1.2.3.win32\\lib",
       "..\\iconv-1.9.1.win32\\lib"
       ]

STATIC_CFLAGS = []
</pre>
<p>Add any CFLAGS you might consider useful to the third list.  As <a class="reference" href="http://codespeak.net/pipermail/lxml-dev/2006-September/001893.html">Ashish
Kulkarni</a> notes, you might have to add the standard Windows library
<tt class="docutils literal"><span class="pre">wsock32.dll</span></tt> to the list of libraries to make <tt class="docutils literal"><span class="pre">lxml.objectify</span></tt> compile.</p>
<p>Now you should be able to pass the <tt class="docutils literal"><span class="pre">--static</span></tt> option to setup.py and
everything should work well.  Try calling:</p>
<pre class="literal-block">
python setup.py bdist_wininst --static
</pre>
<p>This will create a windows installer in the <tt class="docutils literal"><span class="pre">pkg</span></tt> directory.</p>
</div>
<div class="section">
<h1><a id="building-debian-packages-from-svn-sources" name="building-debian-packages-from-svn-sources">Building Debian packages from SVN sources</a></h1>
<p><a class="reference" href="http://codespeak.net/pipermail/lxml-dev/2006-May/001254.html">Andreas Pakulat</a> proposed the following approach.</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">apt-get</span> <span class="pre">source</span> <span class="pre">lxml</span></tt></li>
<li>remove the unpacked directory</li>
<li>tar.gz the lxml SVN version and replace the orig.tar.gz that lies in the
directory</li>
<li>check md5sum of created tar.gz file and place new sum and size in dsc file</li>
<li>do <tt class="docutils literal"><span class="pre">dpkg-source</span> <span class="pre">-x</span> <span class="pre">lxml-[VERSION].dsc</span></tt> and cd into the newly created directory</li>
<li>run <tt class="docutils literal"><span class="pre">dch</span> <span class="pre">-i</span></tt> and add a comment like "use trunk version", this will
increase the debian version number so apt/dpkg won't get confused</li>
<li>run <tt class="docutils literal"><span class="pre">dpkg-buildpackage</span> <span class="pre">-rfakeroot</span> <span class="pre">-us</span> <span class="pre">-uc</span></tt> to build the package</li>
</ul>
<p>In case <tt class="docutils literal"><span class="pre">dpkg-buildpackage</span></tt> tells you that some dependecies are missing, you
can either install them manually or run <tt class="docutils literal"><span class="pre">apt-get</span> <span class="pre">build-dep</span> <span class="pre">lxml</span></tt>.</p>
<p>That will give you .deb packages in the parent directory which can be
installed using <tt class="docutils literal"><span class="pre">dpkg</span> <span class="pre">-i</span></tt>.</p>
</div>
<div class="sidemenu"><ul id="lxml"><li><span class="section title">lxml</span><ul class="menu" id="index"><li class="menu title"><a href="index.html">lxml</a><ul class="submenu"><li class="menu item"><a href="index.html#introduction">Introduction</a></li><li class="menu item"><a href="index.html#download">Download</a></li><li class="menu item"><a href="index.html#documentation">Documentation</a></li><li class="menu item"><a href="index.html#mailing-list">Mailing list</a></li><li class="menu item"><a href="index.html#license">License</a></li><li class="menu item"><a href="index.html#old-versions">Old Versions</a></li></ul></li></ul><ul class="menu" id="intro"><li class="menu title"><a href="intro.html">Why lxml?</a><ul class="submenu"><li class="menu item"><a href="intro.html#motto">Motto</a></li><li class="menu item"><a href="intro.html#aims">Aims</a></li></ul></li></ul><ul class="menu" id="FAQ"><li class="menu title"><a href="FAQ.html">Frequently Asked Questions</a><ul class="submenu"><li class="menu item"><a href="FAQ.html#general-questions">General Questions</a></li><li class="menu item"><a href="FAQ.html#bugs">Bugs</a></li><li class="menu item"><a href="FAQ.html#threading">Threading</a></li><li class="menu item"><a href="FAQ.html#parsing-and-serialisation">Parsing and Serialisation</a></li><li class="menu item"><a href="FAQ.html#xpath-and-document-traversal">XPath and Document Traversal</a></li></ul></li></ul><ul class="menu" id="performance"><li class="menu title"><a href="performance.html">Benchmarks and Speed</a><ul class="submenu"><li class="menu item"><a href="performance.html#bad-things-first">Bad things first</a></li><li class="menu item"><a href="performance.html#parsing-and-serialising">Parsing and Serialising</a></li><li class="menu item"><a href="performance.html#the-elementtree-api">The ElementTree API</a></li><li class="menu item"><a href="performance.html#tree-traversal">Tree traversal</a></li><li class="menu item"><a href="performance.html#xpath">XPath</a></li><li class="menu item"><a href="performance.html#lxml-objectify">lxml.objectify</a></li></ul></li></ul><ul class="menu" id="build"><li class="menu title"><a href="build.html">How to build lxml from source</a><ul class="submenu current"><li class="menu item"><a href="build.html#pyrex">Pyrex</a></li><li class="menu item"><a href="build.html#subversion">Subversion</a></li><li class="menu item"><a href="build.html#setuptools">Setuptools</a></li><li class="menu item"><a href="build.html#running-the-tests-and-reporting-errors">Running the tests and reporting errors</a></li><li class="menu item"><a href="build.html#contributing-an-egg">Contributing an egg</a></li><li class="menu item"><a href="build.html#static-linking-on-windows">Static linking on Windows</a></li><li class="menu item"><a href="build.html#building-debian-packages-from-svn-sources">Building Debian packages from SVN sources</a></li></ul></li></ul></li></ul><ul id="Developing with lxml"><li><span class="section title">Developing with lxml</span><ul class="menu" id="api"><li class="menu title"><a href="api.html">APIs specific to lxml</a><ul class="submenu"><li class="menu item"><a href="api.html#lxml-etree">lxml.etree</a></li><li class="menu item"><a href="api.html#other-element-apis">Other Element APIs</a></li><li class="menu item"><a href="api.html#trees-and-documents">Trees and Documents</a></li><li class="menu item"><a href="api.html#iteration">Iteration</a></li><li class="menu item"><a href="api.html#error-handling-on-exceptions">Error handling on exceptions</a></li><li class="menu item"><a href="api.html#xinclude">xinclude</a></li><li class="menu item"><a href="api.html#write-c14n-on-elementtree">write_c14n on ElementTree</a></li></ul></li></ul><ul class="menu" id="parsing"><li class="menu title"><a href="parsing.html">Parsing XML with lxml</a><ul class="submenu"><li class="menu item"><a href="parsing.html#parsers">Parsers</a></li><li class="menu item"><a href="parsing.html#iterparse-and-iterwalk">iterparse and iterwalk</a></li><li class="menu item"><a href="parsing.html#python-unicode-strings">Python unicode strings</a></li></ul></li></ul><ul class="menu" id="validation"><li class="menu title"><a href="validation.html">Validation with lxml</a><ul class="submenu"><li class="menu item"><a href="validation.html#dtd">DTD</a></li><li class="menu item"><a href="validation.html#relaxng">RelaxNG</a></li><li class="menu item"><a href="validation.html#xmlschema">XMLSchema</a></li></ul></li></ul><ul class="menu" id="xpathxslt"><li class="menu title"><a href="xpathxslt.html">XPath and XSLT with lxml</a><ul class="submenu"><li class="menu item"><a href="xpathxslt.html#xpath">XPath</a></li><li class="menu item"><a href="xpathxslt.html#xslt">XSLT</a></li></ul></li></ul><ul class="menu" id="objectify"><li class="menu title"><a href="objectify.html">lxml.objectify</a><ul class="submenu"><li class="menu item"><a href="objectify.html#setting-up-lxml-objectify">Setting up lxml.objectify</a></li><li class="menu item"><a href="objectify.html#creating-objectify-trees">Creating objectify trees</a></li><li class="menu item"><a href="objectify.html#element-access-through-object-attributes">Element access through object attributes</a></li><li class="menu item"><a href="objectify.html#namespace-handling">Namespace handling</a></li><li class="menu item"><a href="objectify.html#objectpath">ObjectPath</a></li><li class="menu item"><a href="objectify.html#python-data-types">Python data types</a></li><li class="menu item"><a href="objectify.html#how-data-types-are-matched">How data types are matched</a></li><li class="menu item"><a href="objectify.html#defining-additional-data-classes">Defining additional data classes</a></li><li class="menu item"><a href="objectify.html#recursive-string-representation-of-elements">Recursive string representation of elements</a></li><li class="menu item"><a href="objectify.html#what-is-different-from-elementtree?">What is different from ElementTree?</a></li></ul></li></ul></li></ul><ul id="Extending lxml"><li><span class="section title">Extending lxml</span><ul class="menu" id="resolvers"><li class="menu title"><a href="resolvers.html">Document loading and URL resolving</a><ul class="submenu"><li class="menu item"><a href="resolvers.html#document-loaders-in-context">Document loaders in context</a></li><li class="menu item"><a href="resolvers.html#i-o-access-control-in-xslt">I/O access control in XSLT</a></li></ul></li></ul><ul class="menu" id="extensions"><li class="menu title"><a href="extensions.html">Extension functions for XPath and XSLT</a><ul class="submenu"><li class="menu item"><a href="extensions.html#the-functionnamespace">The FunctionNamespace</a></li><li class="menu item"><a href="extensions.html#global-prefix-assignment">Global prefix assignment</a></li><li class="menu item"><a href="extensions.html#evaluators-and-xslt">Evaluators and XSLT</a></li><li class="menu item"><a href="extensions.html#evaluator-local-extensions">Evaluator-local extensions</a></li><li class="menu item"><a href="extensions.html#what-to-return-from-a-function">What to return from a function</a></li></ul></li></ul><ul class="menu" id="element_classes"><li class="menu title"><a href="element_classes.html">Using custom Element classes in lxml</a><ul class="submenu"><li class="menu item"><a href="element_classes.html#element-initialization">Element initialization</a></li><li class="menu item"><a href="element_classes.html#setting-up-a-class-lookup-scheme">Setting up a class lookup scheme</a></li><li class="menu item"><a href="element_classes.html#implementing-namespaces">Implementing namespaces</a></li></ul></li></ul><ul class="menu" id="sax"><li class="menu title"><a href="sax.html">Sax support</a><ul class="submenu"><li class="menu item"><a href="sax.html#building-a-tree-from-sax-events">Building a tree from SAX events</a></li><li class="menu item"><a href="sax.html#producing-sax-events-from-an-elementtree-or-element">Producing SAX events from an ElementTree or Element</a></li><li class="menu item"><a href="sax.html#interfacing-with-pulldom-minidom">Interfacing with pulldom/minidom</a></li></ul></li></ul><ul class="menu" id="capi"><li class="menu title"><a href="capi.html">The public C-API of lxml.etree</a><ul class="submenu"><li class="menu item"><a href="capi.html#writing-external-modules-in-pyrex">Writing external modules in Pyrex</a></li><li class="menu item"><a href="capi.html#writing-external-modules-in-c">Writing external modules in C</a></li></ul></li></ul></li></ul></div></div>
</body>
</html>