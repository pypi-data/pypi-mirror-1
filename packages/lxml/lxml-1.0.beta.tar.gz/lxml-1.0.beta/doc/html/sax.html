<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.4: http://docutils.sourceforge.net/" />
<title>Sax support</title>
<link rel="stylesheet" href="style.css" type="text/css" />
</head>
<body>
<div class="document" id="sax-support">
<h1 class="title">Sax support</h1>
<p>In this document we'll describe lxml's SAX support. lxml has support
for producing SAX events for an ElementTree or Element. lxml can also
turn SAX events into an ElementTree. The SAX API used by lxml is
compatible with that in the Python core (xml.sax), so is useful for
interfacing lxml with code that uses the Python core SAX facilities.</p>
<div class="section">
<h1><a id="producing-sax-events-from-an-elementtree-or-element" name="producing-sax-events-from-an-elementtree-or-element">Producing SAX events from an ElementTree or Element</a></h1>
<p>Let's make a tree we can generate SAX events for:</p>
<pre class="literal-block">
&gt;&gt;&gt; from StringIO import StringIO
&gt;&gt;&gt; import lxml
&gt;&gt;&gt; f = StringIO('&lt;a&gt;&lt;b&gt;Text&lt;/b&gt;&lt;/a&gt;')
&gt;&gt;&gt; doc = lxml.etree.parse(f)
</pre>
<p>To see whether the correct SAX events are produced, we'll write a
custom content handler:</p>
<pre class="literal-block">
&gt;&gt;&gt; from xml.sax.handler import ContentHandler
&gt;&gt;&gt; class MyContentHandler(ContentHandler):
...     def __init__(self):
...         self.a_amount = 0
...         self.b_amount = 0
...         self.text = None
...
...     def startElementNS(self, name, qname, attributes):
...         uri, localname = name
...         if localname == 'a':
...             self.a_amount += 1
...         if localname == 'b':
...             self.b_amount += 1
...
...     def characters(self, data):
...         self.text = data
</pre>
<p>Now let's produce some SAX events and handle them with this content
handler:</p>
<pre class="literal-block">
&gt;&gt;&gt; handler = MyContentHandler()
&gt;&gt;&gt; lxml.sax.saxify(doc, handler)
</pre>
<p>This is what we expect:</p>
<pre class="literal-block">
&gt;&gt;&gt; handler.a_amount
1
&gt;&gt;&gt; handler.b_amount
1
&gt;&gt;&gt; handler.text
'Text'
</pre>
</div>
<div class="section">
<h1><a id="building-a-tree-from-sax-events" name="building-a-tree-from-sax-events">Building a tree from SAX events</a></h1>
<p>lxml also has support for building a new tree given SAX events. To do
this, we use the special SAX content handler defined by lxml named
<cite>ElementTreeContentHandler</cite>.</p>
<p>Let's make this content handler:</p>
<pre class="literal-block">
&gt;&gt;&gt; handler = lxml.sax.ElementTreeContentHandler()
</pre>
<p>Now let's fire some SAX events at it:</p>
<pre class="literal-block">
&gt;&gt;&gt; handler.startElementNS((None, 'a'), 'a', {})
&gt;&gt;&gt; handler.startElementNS((None, 'b'), 'b', {(None, 'foo'): 'bar'})
&gt;&gt;&gt; handler.characters('Hello world')
&gt;&gt;&gt; handler.endElementNS((None, 'b'), 'b')
&gt;&gt;&gt; handler.endElementNS((None, 'a'), 'a')
</pre>
<p>We can now get the tree by accessing the <cite>etree</cite> property on the
handler:</p>
<pre class="literal-block">
&gt;&gt;&gt; tree = handler.etree
&gt;&gt;&gt; lxml.etree.tostring(tree.getroot())
'&lt;a&gt;&lt;b foo=&quot;bar&quot;&gt;Hello world&lt;/b&gt;&lt;/a&gt;'
</pre>
</div>
</div>
</body>
</html>
