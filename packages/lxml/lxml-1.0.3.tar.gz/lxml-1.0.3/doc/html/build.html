<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.4: http://docutils.sourceforge.net/" />
<title>How to build lxml from source</title>
<link rel="stylesheet" href="style.css" type="text/css" />
</head>
<body>
<div class="document" id="how-to-build-lxml-from-source">
<h1 class="title">How to build lxml from source</h1>
<p>To build lxml from source, you need libxml2 and libxslt properly installed.</p>
<div class="section">
<h1><a id="pyrex" name="pyrex">Pyrex</a></h1>
<p>The lxml.etree module is written in <a class="reference" href="http://www.cosc.canterbury.ac.nz/~greg/python/Pyrex/">Pyrex</a>.  To build lxml from source, you
therefore need a working Pyrex installation.  Pyrex now supports EasyInstall,
so you can install it by running the following command as super-user:</p>
<pre class="literal-block">
easy_install Pyrex
</pre>
<p>Note that Pyrex up to and including version 0.9.4 has known problems when
compiling lxml with gcc 4.0 or Python 2.4.  Do not use it.  If you want to
build lxml from non-release sources, please install Pyrex version 0.9.4.1 or
later.</p>
</div>
<div class="section">
<h1><a id="subversion" name="subversion">Subversion</a></h1>
<p>The lxml package is developed in a Subversion repository.  You can retrieve
the current developer version by calling:</p>
<pre class="literal-block">
svn co http://codespeak.net/svn/lxml/trunk lxml
</pre>
<p>This will create a directory <tt class="docutils literal"><span class="pre">lxml</span></tt> and download the source into it.  You
can also <a class="reference" href="http://codespeak.net/svn/lxml">browse the repository through the web</a> or use your favourite SVN
client to access it.</p>
</div>
<div class="section">
<h1><a id="the-distutils-approach" name="the-distutils-approach">The distutils approach</a></h1>
<p>Usually, building lxml is done through distutils.  Do a Subversion checkout
(or download the source tar-ball and unpack it) and then type:</p>
<pre class="literal-block">
python setup.py build
</pre>
<p>If you want to test lxml from the source directory, it is better to build it
in-place like this:</p>
<pre class="literal-block">
python setup.py  build_ext -i
</pre>
<p>or, in Unix-like environments:</p>
<pre class="literal-block">
make
</pre>
<p>If you then place lxml's <tt class="docutils literal"><span class="pre">src</span></tt> directory on your PYTHONPATH somehow, you can
import <tt class="docutils literal"><span class="pre">lxml.etree</span></tt> and play with it.</p>
<p>To recompile after changes, note that you may have to run <tt class="docutils literal"><span class="pre">make</span> <span class="pre">clean</span></tt> or
delete the file <tt class="docutils literal"><span class="pre">src/lxml/etree.c</span></tt>.  Distutils do not automatically pick up
changes that affect files other than the main file <tt class="docutils literal"><span class="pre">src/lxml/etree.pyx</span></tt>.</p>
</div>
<div class="section">
<h1><a id="running-the-tests-and-reporting-errors" name="running-the-tests-and-reporting-errors">Running the tests and reporting errors</a></h1>
<p>The source distribution (tgz) contains a test suite for lxml.  You can run it
from the top-level directory:</p>
<pre class="literal-block">
python test.py
</pre>
<p>Note that the test script only tests the in-place build (see distutils
building above), as it searches the <tt class="docutils literal"><span class="pre">src</span></tt> directory.  You can use the
following one-step command to trigger an in-place build and test it:</p>
<pre class="literal-block">
make clean test
</pre>
<p>To run the ElementTree and cElementTree compatibility tests, make sure
you have lxml on your PYTHONPATH first, then run:</p>
<pre class="literal-block">
python selftest.py
</pre>
<p>and:</p>
<pre class="literal-block">
python selftest2.py
</pre>
<p>If the tests give failures, errors, or worse, segmentation faults, we'd really
like to know. Please contact us on the <a class="reference" href="http://codespeak.net/mailman/listinfo/lxml-dev">mailing list</a>, and please specify the
version of lxml, libxml2, libxslt and Python you were using, as well as your
operating system type (Linux, Windows, MacOs, ...).</p>
</div>
<div class="section">
<h1><a id="static-linking-on-windows" name="static-linking-on-windows">Static linking on Windows</a></h1>
<p>Most operating systems have proper package management that makes installing
current versions of libxml2 and libxslt easy.  The most famous exception is
Microsoft Windows, which entirely lacks these capabilities.  It can therefore
be interesting to statically link the external libraries into lxml.etree to
avoid having to install them separately.  <a class="reference" href="http://codespeak.net/pipermail/lxml-dev/2006-May/001196.html">David Sankel</a> proposed the
following approach.</p>
<p>Download lxml and all required libraries to the same directory.  The iconv,
libxml2, libxslt, and zlib libraries are all available from the ftp site
<a class="reference" href="ftp://ftp.zlatkovic.com/pub/libxml/">ftp://ftp.zlatkovic.com/pub/libxml/</a>.</p>
<p>Your directory should now have the following files in it (although possibly
different versions):</p>
<pre class="literal-block">
iconv-1.9.1.win32.zip
libxml2-2.6.23.win32.zip
libxslt-1.1.15.win32.zip
lxml-1.0.0.tgz
zlib-1.2.3.win32.zip
</pre>
<p>Now extract each of those files in the <em>same</em> directory.  This should give you
something like this:</p>
<pre class="literal-block">
iconv-1.9.1.win32/
iconv-1.9.1.win32.zip
libxml2-2.6.23.win32/
libxml2-2.6.23.win32.zip
libxslt-1.1.15.win32/
libxslt-1.1.15.win32.zip
lxml-1.0.0/
lxml-1.0.0.tgz
zlib-1.2.3.win32/
zlib-1.2.3.win32.zip
</pre>
<p>Go to the lxml-1.0.0 directory and edit the file <tt class="docutils literal"><span class="pre">setup.py</span></tt>.  There should
be a section near the top that looks like this:</p>
<pre class="literal-block">
def setupStaticBuild():
    cflags = [
        ]
    xslt_libs = [
        ]
    result = (cflags, xslt_libs)
    # return result
    raise NotImplementedError, \
          &quot;Static build not configured, see doc/build.txt&quot;
</pre>
<p>Change this section to something like this, but take care to use the correct
version numbers:</p>
<pre class="literal-block">
def setupStaticBuild():
    cflags = [
       &quot;-I..\\libxml2-2.6.23.win32\\include &quot;,
       &quot;-I..\\libxslt-1.1.15.win32\\include&quot;,
       &quot;-I..\\zlib-1.2.3.win32\\include&quot;,
       &quot;-I..\\iconv-1.9.1.win32\\include&quot;
       ]
    xslt_libs = [
       &quot;..\\libxml2-2.6.23.win32\\lib\\libxml2_a.lib&quot;,
       &quot;..\\libxslt-1.1.15.win32\\lib\\libxslt_a.lib&quot;,
       &quot;..\\libxslt-1.1.15.win32\\lib\\libexslt_a.lib&quot;,
       &quot;..\\zlib-1.2.3.win32\\lib\\zlib.lib&quot;,
       &quot;..\\iconv-1.9.1.win32\\lib\\iconv_a.lib&quot;
       ]
    result = (cflags, xslt_libs)
    return result
</pre>
<p>The <tt class="docutils literal"><span class="pre">_a</span></tt> part of the library names means that we are linking statically
against the named library files.  If you want to use dynamic libraries, you
need to link against the DLL version of the libraries.</p>
<p>Now you should be able to pass the <tt class="docutils literal"><span class="pre">--static</span></tt> option to setup.py and
everything should work well.  Try calling:</p>
<pre class="literal-block">
python setup.py bdist_wininst --static
</pre>
<p>This will create a windows installer in the <tt class="docutils literal"><span class="pre">pkg</span></tt> directory.</p>
</div>
<div class="section">
<h1><a id="building-debian-packages-from-svn-sources" name="building-debian-packages-from-svn-sources">Building Debian packages from SVN sources</a></h1>
<p><a class="reference" href="http://codespeak.net/pipermail/lxml-dev/2006-May/001254.html">Andreas Pakulat</a> proposed the following approach.</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">apt-get</span> <span class="pre">source</span> <span class="pre">lxml</span></tt></li>
<li>remove the unpacked directory</li>
<li>tar.gz the lxml SVN version and replace the orig.tar.gz that lies in the
directory</li>
<li>do <tt class="docutils literal"><span class="pre">dpkg</span> <span class="pre">-x</span> <span class="pre">lxml-...dsc</span></tt> and cd into the newly created directory</li>
<li>run <tt class="docutils literal"><span class="pre">dch</span> <span class="pre">-i</span></tt> and add a comment like &quot;use trunk version&quot;, this will
increase the debian version number so apt/dpkg don't get confused</li>
<li>run <tt class="docutils literal"><span class="pre">dpkg-buildpackage</span> <span class="pre">-rfakeroot</span> <span class="pre">-us</span> <span class="pre">-uc</span></tt> to build the package</li>
</ul>
<p>Eventually dpkg-buildpackage will tell you that some dependecies are missing,
you can either install them manually or run apt-get build-dep lxml</p>
<p>That will give you .deb packages in the parent directory which can be
installed using <tt class="docutils literal"><span class="pre">dpkg</span> <span class="pre">-i</span></tt>.</p>
</div>
</div>
</body>
</html>
