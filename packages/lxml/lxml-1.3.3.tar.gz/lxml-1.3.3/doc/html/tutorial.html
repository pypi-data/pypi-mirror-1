<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.4.1: http://docutils.sourceforge.net/" />
<title>The lxml.etree Tutorial</title>
<meta name="author" content="Stefan Behnel" />
<link rel="stylesheet" href="style.css" type="text/css" />
</head>
<body>
<div class="document" id="the-lxml-etree-tutorial">
<div class="sidemenu"><ul id="lxml"><li><span class="section title">lxml</span><ul class="menu foreign" id="index"><li class="menu title"><a href="index.html">lxml</a><ul class="submenu"><li class="menu item"><a href="index.html#introduction">Introduction</a></li><li class="menu item"><a href="index.html#documentation">Documentation</a></li><li class="menu item"><a href="index.html#download">Download</a></li><li class="menu item"><a href="index.html#mailing-list">Mailing list</a></li><li class="menu item"><a href="index.html#license">License</a></li><li class="menu item"><a href="index.html#old-versions">Old Versions</a></li></ul></li></ul><ul class="menu foreign" id="intro"><li class="menu title"><a href="intro.html">Why lxml?</a><ul class="submenu"><li class="menu item"><a href="intro.html#motto">Motto</a></li><li class="menu item"><a href="intro.html#aims">Aims</a></li></ul></li></ul><ul class="menu foreign" id="FAQ"><li class="menu title"><a href="FAQ.html">Frequently Asked Questions (FAQ)</a><ul class="submenu"><li class="menu item"><a href="FAQ.html#general-questions">General Questions</a></li><li class="menu item"><a href="FAQ.html#installation">Installation</a></li><li class="menu item"><a href="FAQ.html#contributing">Contributing</a></li><li class="menu item"><a href="FAQ.html#bugs">Bugs</a></li><li class="menu item"><a href="FAQ.html#threading">Threading</a></li><li class="menu item"><a href="FAQ.html#parsing-and-serialisation">Parsing and Serialisation</a></li><li class="menu item"><a href="FAQ.html#xpath-and-document-traversal">XPath and Document Traversal</a></li></ul></li></ul><ul class="menu foreign" id="performance"><li class="menu title"><a href="performance.html">Benchmarks and Speed</a><ul class="submenu"><li class="menu item"><a href="performance.html#general-notes">General notes</a></li><li class="menu item"><a href="performance.html#how-to-read-the-timings">How to read the timings</a></li><li class="menu item"><a href="performance.html#parsing-and-serialising">Parsing and Serialising</a></li><li class="menu item"><a href="performance.html#the-elementtree-api">The ElementTree API</a></li><li class="menu item"><a href="performance.html#xpath">XPath</a></li><li class="menu item"><a href="performance.html#a-longer-example">A longer example</a></li><li class="menu item"><a href="performance.html#lxml-objectify">lxml.objectify</a></li></ul></li></ul><ul class="menu foreign" id="build"><li class="menu title"><a href="build.html">How to build lxml from source</a><ul class="submenu"><li class="menu item"><a href="build.html#pyrex">Pyrex</a></li><li class="menu item"><a href="build.html#subversion">Subversion</a></li><li class="menu item"><a href="build.html#setuptools">Setuptools</a></li><li class="menu item"><a href="build.html#running-the-tests-and-reporting-errors">Running the tests and reporting errors</a></li><li class="menu item"><a href="build.html#contributing-an-egg">Contributing an egg</a></li><li class="menu item"><a href="build.html#providing-newer-library-versions-on-mac-os-x">Providing newer library versions on Mac-OS X</a></li><li class="menu item"><a href="build.html#static-linking-on-windows">Static linking on Windows</a></li><li class="menu item"><a href="build.html#building-debian-packages-from-svn-sources">Building Debian packages from SVN sources</a></li></ul></li></ul></li></ul><ul id="Developing with lxml"><li><span class="section title">Developing with lxml</span><ul class="menu current" id="tutorial"><li class="menu title"><a href="tutorial.html">The lxml.etree Tutorial</a><ul class="submenu"><li class="menu item"><a href="tutorial.html#the-element-class">The Element class</a></li><li class="menu item"><a href="tutorial.html#elements-are-lists">Elements are lists</a></li><li class="menu item"><a href="tutorial.html#elements-carry-attributes">Elements carry attributes</a></li><li class="menu item"><a href="tutorial.html#elements-contain-text">Elements contain text</a></li><li class="menu item"><a href="tutorial.html#tree-iteration">Tree iteration</a></li></ul></li></ul><ul class="menu foreign" id="api"><li class="menu title"><a href="api.html">APIs specific to lxml.etree</a><ul class="submenu"><li class="menu item"><a href="api.html#lxml-etree">lxml.etree</a></li><li class="menu item"><a href="api.html#other-element-apis">Other Element APIs</a></li><li class="menu item"><a href="api.html#trees-and-documents">Trees and Documents</a></li><li class="menu item"><a href="api.html#iteration">Iteration</a></li><li class="menu item"><a href="api.html#error-handling-on-exceptions">Error handling on exceptions</a></li><li class="menu item"><a href="api.html#error-logging">Error logging</a></li><li class="menu item"><a href="api.html#serialisation">Serialisation</a></li><li class="menu item"><a href="api.html#xinclude-and-elementinclude">XInclude and ElementInclude</a></li><li class="menu item"><a href="api.html#write-c14n-on-elementtree">write_c14n on ElementTree</a></li></ul></li></ul><ul class="menu foreign" id="parsing"><li class="menu title"><a href="parsing.html">Parsing XML and HTML with lxml</a><ul class="submenu"><li class="menu item"><a href="parsing.html#parsers">Parsers</a></li><li class="menu item"><a href="parsing.html#iterparse-and-iterwalk">iterparse and iterwalk</a></li><li class="menu item"><a href="parsing.html#python-unicode-strings">Python unicode strings</a></li></ul></li></ul><ul class="menu foreign" id="validation"><li class="menu title"><a href="validation.html">Validation with lxml</a><ul class="submenu"><li class="menu item"><a href="validation.html#dtd">DTD</a></li><li class="menu item"><a href="validation.html#relaxng">RelaxNG</a></li><li class="menu item"><a href="validation.html#xmlschema">XMLSchema</a></li></ul></li></ul><ul class="menu foreign" id="xpathxslt"><li class="menu title"><a href="xpathxslt.html">XPath and XSLT with lxml</a><ul class="submenu"><li class="menu item"><a href="xpathxslt.html#xpath">XPath</a></li><li class="menu item"><a href="xpathxslt.html#xslt">XSLT</a></li></ul></li></ul><ul class="menu foreign" id="objectify"><li class="menu title"><a href="objectify.html">lxml.objectify</a><ul class="submenu"><li class="menu item"><a href="objectify.html#setting-up-lxml-objectify">Setting up lxml.objectify</a></li><li class="menu item"><a href="objectify.html#the-lxml-objectify-api">The lxml.objectify API</a></li><li class="menu item"><a href="objectify.html#objectpath">ObjectPath</a></li><li class="menu item"><a href="objectify.html#python-data-types">Python data types</a></li><li class="menu item"><a href="objectify.html#how-data-types-are-matched">How data types are matched</a></li><li class="menu item"><a href="objectify.html#what-is-different-from-lxml-etree?">What is different from lxml.etree?</a></li></ul></li></ul></li></ul><ul id="Extending lxml"><li><span class="section title">Extending lxml</span><ul class="menu foreign" id="resolvers"><li class="menu title"><a href="resolvers.html">Document loading and URL resolving</a><ul class="submenu"><li class="menu item"><a href="resolvers.html#resolvers">Resolvers</a></li><li class="menu item"><a href="resolvers.html#document-loading-in-context">Document loading in context</a></li><li class="menu item"><a href="resolvers.html#i-o-access-control-in-xslt">I/O access control in XSLT</a></li></ul></li></ul><ul class="menu foreign" id="extensions"><li class="menu title"><a href="extensions.html">Extension functions for XPath and XSLT</a><ul class="submenu"><li class="menu item"><a href="extensions.html#the-functionnamespace">The FunctionNamespace</a></li><li class="menu item"><a href="extensions.html#global-prefix-assignment">Global prefix assignment</a></li><li class="menu item"><a href="extensions.html#evaluators-and-xslt">Evaluators and XSLT</a></li><li class="menu item"><a href="extensions.html#evaluator-local-extensions">Evaluator-local extensions</a></li><li class="menu item"><a href="extensions.html#what-to-return-from-a-function">What to return from a function</a></li></ul></li></ul><ul class="menu foreign" id="element_classes"><li class="menu title"><a href="element_classes.html">Using custom Element classes in lxml</a><ul class="submenu"><li class="menu item"><a href="element_classes.html#element-initialization">Element initialization</a></li><li class="menu item"><a href="element_classes.html#setting-up-a-class-lookup-scheme">Setting up a class lookup scheme</a></li><li class="menu item"><a href="element_classes.html#implementing-namespaces">Implementing namespaces</a></li></ul></li></ul><ul class="menu foreign" id="sax"><li class="menu title"><a href="sax.html">Sax support</a><ul class="submenu"><li class="menu item"><a href="sax.html#building-a-tree-from-sax-events">Building a tree from SAX events</a></li><li class="menu item"><a href="sax.html#producing-sax-events-from-an-elementtree-or-element">Producing SAX events from an ElementTree or Element</a></li><li class="menu item"><a href="sax.html#interfacing-with-pulldom-minidom">Interfacing with pulldom/minidom</a></li></ul></li></ul><ul class="menu foreign" id="capi"><li class="menu title"><a href="capi.html">The public C-API of lxml.etree</a><ul class="submenu"><li class="menu item"><a href="capi.html#writing-external-modules-in-pyrex">Writing external modules in Pyrex</a></li><li class="menu item"><a href="capi.html#writing-external-modules-in-c">Writing external modules in C</a></li></ul></li></ul></li></ul></div><h1 class="title">The lxml.etree Tutorial</h1>
<table class="docinfo" frame="void" rules="none">
<col class="docinfo-name" />
<col class="docinfo-content" />
<tbody valign="top">
<tr><th class="docinfo-name">Author:</th>
<td>Stefan Behnel</td></tr>
</tbody>
</table>
<p>This tutorial briefly overviews the main concepts of the <a class="reference" href="http://effbot.org/zone/element-index.htm#documentation">ElementTree API</a> as
implemented by lxml.etree, and some simple enhancements that make your life as
a programmer easier.</p>
<div class="contents topic">
<p class="topic-title first"><a id="contents" name="contents">Contents</a></p>
<ul class="simple">
<li><a class="reference" href="#the-element-class" id="id1" name="id1">The Element class</a></li>
<li><a class="reference" href="#elements-are-lists" id="id2" name="id2">Elements are lists</a></li>
<li><a class="reference" href="#elements-carry-attributes" id="id3" name="id3">Elements carry attributes</a></li>
<li><a class="reference" href="#elements-contain-text" id="id4" name="id4">Elements contain text</a></li>
<li><a class="reference" href="#tree-iteration" id="id5" name="id5">Tree iteration</a></li>
</ul>
</div>
<p>A common way to import <tt class="docutils literal"><span class="pre">lxml.etree</span></tt> is as follows:</p>
<pre class="literal-block">
&gt;&gt;&gt; from lxml import etree
</pre>
<p>If your code only uses the ElementTree API and does not rely on any
functionality that is specific to <tt class="docutils literal"><span class="pre">lxml.etree</span></tt>, you can also use the
following import chain as a fall-back to the original ElementTree:</p>
<pre class="literal-block">
try:
  from lxml import etree
  print "running with lxml.etree"
except ImportError:
  try:
    # Python 2.5
    import xml.etree.cElementTree as etree
    print "running with cElementTree on Python 2.5+"
  except ImportError:
    try:
      # Python 2.5
      import xml.etree.ElementTree as etree
      print "running with ElementTree on Python 2.5+"
    except ImportError:
      try:
        # normal cElementTree install
        import cElementTree as etree
        print "running with cElementTree"
      except ImportError:
        try:
          # normal ElementTree install
          import elementtree.ElementTree as etree
          print "running with ElementTree"
        except ImportError:
          print "Failed to import ElementTree from any known place"
</pre>
<p>To aid in writing portable code, this tutorial makes it clear in the examples
which part of the presented API is an extension of lxml.etree over the
original <a class="reference" href="http://effbot.org/zone/element-index.htm#documentation">ElementTree API</a>, as defined by Fredrik Lundh's <a class="reference" href="http://effbot.org/zone/element-index.htm">ElementTree
library</a>.</p>
<div class="section">
<h1><a id="the-element-class" name="the-element-class">The Element class</a></h1>
<p>An <tt class="docutils literal"><span class="pre">Element</span></tt> is the main container object for the ElementTree API.  Most of
the XML tree functionality is accessed through this class.  Elements are
easily created through the <tt class="docutils literal"><span class="pre">Element</span></tt> factory:</p>
<pre class="literal-block">
&gt;&gt;&gt; root = etree.Element("root")
</pre>
<p>The XML tag name of elements is accessed through the <tt class="docutils literal"><span class="pre">tag</span></tt> property:</p>
<pre class="literal-block">
&gt;&gt;&gt; print root.tag
root
</pre>
<p>Elements are organised in an XML tree structure.  To create child elements and
add them to a parent element, you can use the <tt class="docutils literal"><span class="pre">append()</span></tt> method:</p>
<pre class="literal-block">
&gt;&gt;&gt; root.append( etree.Element("child1") )
</pre>
<p>However, a much more efficient and more common way to do this is through the
<tt class="docutils literal"><span class="pre">SubElement</span></tt> factory.  It accepts the same arguments as the <tt class="docutils literal"><span class="pre">Element</span></tt>
factory, but additionally requires the parent as first argument:</p>
<pre class="literal-block">
&gt;&gt;&gt; child2 = etree.SubElement(root, "child2")
&gt;&gt;&gt; child3 = etree.SubElement(root, "child3")
</pre>
<p>To see that this is really XML, you can serialise the tree you have created:</p>
<pre class="literal-block">
&gt;&gt;&gt; print etree.tostring(root, pretty_print=True)
&lt;root&gt;
  &lt;child1/&gt;
  &lt;child2/&gt;
  &lt;child3/&gt;
&lt;/root&gt;
</pre>
</div>
<div class="section">
<h1><a id="elements-are-lists" name="elements-are-lists">Elements are lists</a></h1>
<p>To make the access to these subelements as easy and straight forward as
possible, elements behave exactly like normal Python lists:</p>
<pre class="literal-block">
&gt;&gt;&gt; child = root[0]
&gt;&gt;&gt; print child.tag
child1

&gt;&gt;&gt; for child in root:
...     print child.tag
child1
child2
child3

&gt;&gt;&gt; if root:
...     print "root has children!"
root has children!

&gt;&gt;&gt; root.insert(0, etree.Element("child0"))
&gt;&gt;&gt; start = root[:1]
&gt;&gt;&gt; end   = root[-1:]

&gt;&gt;&gt; print start[0].tag
child0
&gt;&gt;&gt; print end[0].tag
child3

&gt;&gt;&gt; root[0] = root[-1]
&gt;&gt;&gt; for child in root:
...     print child.tag
child3
child1
child2
</pre>
<p>Note how the last element was <em>moved</em> to a different position in the last
example.  This is a difference from the original ElementTree (and from lists),
where elements can sit in multiple positions of any number of trees.  In
lxml.etree, elements can only sit in one position of one tree at a time.</p>
<p>If you want to <em>copy</em> an element to a different position, consider creating an
independent <em>deep copy</em> using the <tt class="docutils literal"><span class="pre">copy</span></tt> module from Python's standard
library:</p>
<pre class="literal-block">
&gt;&gt;&gt; from copy import deepcopy

&gt;&gt;&gt; element = etree.Element("neu")
&gt;&gt;&gt; element.append( deepcopy(root[1]) )

&gt;&gt;&gt; print element[0].tag
child1
&gt;&gt;&gt; print [ c.tag for c in root ]
['child3', 'child1', 'child2']
</pre>
<p>To retrieve a 'real' Python list of all children (or a <em>shallow copy</em> of the
element children list), you can call the <tt class="docutils literal"><span class="pre">getchildren()</span></tt> method:</p>
<pre class="literal-block">
&gt;&gt;&gt; children = root.getchildren()

&gt;&gt;&gt; print type(children) is type([])
True

&gt;&gt;&gt; for child in children:
...     print child.tag
child3
child1
child2
</pre>
<p>The way up in the tree is provided through the <tt class="docutils literal"><span class="pre">getparent()</span></tt> method:</p>
<pre class="literal-block">
&gt;&gt;&gt; root is root[0].getparent()  # lxml.etree only!
True
</pre>
<p>The siblings (or neighbours) of an element are accessed as next and previous
elements:</p>
<pre class="literal-block">
&gt;&gt;&gt; root[0] is root[1].getprevious() # lxml.etree only!
True
&gt;&gt;&gt; root[1] is root[0].getnext() # lxml.etree only!
True
</pre>
</div>
<div class="section">
<h1><a id="elements-carry-attributes" name="elements-carry-attributes">Elements carry attributes</a></h1>
<p>XML elements support attributes.  You can create them directly in the Element
factory:</p>
<pre class="literal-block">
&gt;&gt;&gt; root = etree.Element("root", interesting="totally")
&gt;&gt;&gt; print etree.tostring(root)
&lt;root interesting="totally"/&gt;
</pre>
<p>Fast and direct access to these attributes is provided by the <tt class="docutils literal"><span class="pre">set()</span></tt> and
<tt class="docutils literal"><span class="pre">get()</span></tt> methods of elements:</p>
<pre class="literal-block">
&gt;&gt;&gt; print root.get("interesting")
totally

&gt;&gt;&gt; root.set("interesting", "somewhat")
&gt;&gt;&gt; print root.get("interesting")
somewhat
</pre>
<p>However, a very convenient way of dealing with them is through the dictionary
interface of the <tt class="docutils literal"><span class="pre">attrib</span></tt> property:</p>
<pre class="literal-block">
&gt;&gt;&gt; attributes = root.attrib

&gt;&gt;&gt; print attributes["interesting"]
somewhat

&gt;&gt;&gt; print attributes.get("hello")
None

&gt;&gt;&gt; attributes["hello"] = "Guten Tag"
&gt;&gt;&gt; print attributes.get("hello")
Guten Tag
&gt;&gt;&gt; print root.get("hello")
Guten Tag
</pre>
</div>
<div class="section">
<h1><a id="elements-contain-text" name="elements-contain-text">Elements contain text</a></h1>
<p>Elements can contain text:</p>
<pre class="literal-block">
&gt;&gt;&gt; root = etree.Element("root")
&gt;&gt;&gt; root.text = "TEXT"

&gt;&gt;&gt; print root.text
TEXT

&gt;&gt;&gt; print etree.tostring(root)
&lt;root&gt;TEXT&lt;/root&gt;
</pre>
<p>In many XML documents (so-called <em>data-centric</em> documents), this is the only
place where text can be found.  It is encapsulated by a leaf tag at the very
bottom of the tree hierarchy.</p>
<p>However, if XML is used for tagged text documents such as (X)HTML, text can
also appear between different elements, right in the middle of the tree:</p>
<pre class="literal-block">
&lt;html&gt;&lt;body&gt;Hello&lt;br/&gt;World&lt;/body&gt;&lt;/html&gt;
</pre>
<p>Here, the <tt class="docutils literal"><span class="pre">&lt;br/&gt;</span></tt> tag is surrounded by text.  This is often referred to as
<em>document-style</em> XML.  Elements support this through their <tt class="docutils literal"><span class="pre">tail</span></tt> property.
It contains the text that directly follows the element, up to the next element
in the XML tree:</p>
<pre class="literal-block">
&gt;&gt;&gt; html = etree.Element("html")
&gt;&gt;&gt; body = etree.SubElement(html, "body")
&gt;&gt;&gt; body.text = "TEXT"

&gt;&gt;&gt; print etree.tostring(html)
&lt;html&gt;&lt;body&gt;TEXT&lt;/body&gt;&lt;/html&gt;

&gt;&gt;&gt; br = etree.SubElement(body, "br")
&gt;&gt;&gt; print etree.tostring(html)
&lt;html&gt;&lt;body&gt;TEXT&lt;br/&gt;&lt;/body&gt;&lt;/html&gt;

&gt;&gt;&gt; br.tail = "TAIL"
&gt;&gt;&gt; print etree.tostring(html)
&lt;html&gt;&lt;body&gt;TEXT&lt;br/&gt;TAIL&lt;/body&gt;&lt;/html&gt;
</pre>
<p>These two properties are enough to represent any text content in an XML
document.  If you want to read the text without the intermediate tags,
however, you have to recursively concatenate all <tt class="docutils literal"><span class="pre">text</span></tt> and <tt class="docutils literal"><span class="pre">tail</span></tt>
attributes in the correct order.  A simpler way to do this is <a class="reference" href="xpathxslt.html#xpath">XPath</a>:</p>
<pre class="literal-block">
&gt;&gt;&gt; print html.xpath("string()") # lxml.etree only!
TEXTTAIL
&gt;&gt;&gt; print html.xpath("//text()") # lxml.etree only!
['TEXT', 'TAIL']
</pre>
<p>If you want to use this more often, you can wrap it in a function:</p>
<pre class="literal-block">
&gt;&gt;&gt; buildTextList = etree.XPath("//text()") # lxml.etree only!
&gt;&gt;&gt; print buildTextList(html)
['TEXT', 'TAIL']
</pre>
</div>
<div class="section">
<h1><a id="tree-iteration" name="tree-iteration">Tree iteration</a></h1>
<p>For problems like the above, where you want to recursively traverse the tree
and do something with its elements, tree iteration is a very convenient
solution.  Elements provide a tree iterator for this purpose.  It yields
elements in <em>document order</em>, i.e. in the order their tags would appear if you
serialised the tree to XML:</p>
<pre class="literal-block">
&gt;&gt;&gt; root = etree.Element("root")
&gt;&gt;&gt; etree.SubElement(root, "child").text = "Child 1"
&gt;&gt;&gt; etree.SubElement(root, "child").text = "Child 2"
&gt;&gt;&gt; etree.SubElement(root, "another").text = "Child 3"

&gt;&gt;&gt; print etree.tostring(root, pretty_print=True)
&lt;root&gt;
  &lt;child&gt;Child 1&lt;/child&gt;
  &lt;child&gt;Child 2&lt;/child&gt;
  &lt;another&gt;Child 3&lt;/another&gt;
&lt;/root&gt;

&gt;&gt;&gt; for element in root.getiterator():
...     print element.tag, '-', element.text
root - None
child - Child 1
child - Child 2
another - Child 3
</pre>
<p>If you know you are only interested in a single tag, you can pass its name to
<tt class="docutils literal"><span class="pre">getiterator()</span></tt> to have it filter for you:</p>
<pre class="literal-block">
&gt;&gt;&gt; for element in root.getiterator("child"):
...     print element.tag, '-', element.text
child - Child 1
child - Child 2
</pre>
<p>In lxml.etree, elements provide <a class="reference" href="api.html#iteration">further iterators</a> for all directions in the
tree: children, parents (or rather ancestors) and siblings.</p>
</div>
</div>
<div class="footer">
<hr class="footer" />
Generated on: 2007-07-26.

</div>
</body>
</html>