<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
   "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <title>Template Loaders &mdash; Jinja Documentation</title>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <link rel="stylesheet" href="style.css" type="text/css">
  <style type="text/css">
    .syntax  { background: #ffffff; }
.syntax .c { color: #888888 } /* Comment */
.syntax .err { color: #a61717; background-color: #e3d2d2 } /* Error */
.syntax .k { color: #008800; font-weight: bold } /* Keyword */
.syntax .cm { color: #888888 } /* Comment.Multiline */
.syntax .cp { color: #cc0000; font-weight: bold } /* Comment.Preproc */
.syntax .c1 { color: #888888 } /* Comment.Single */
.syntax .cs { color: #cc0000; font-weight: bold; background-color: #fff0f0 } /* Comment.Special */
.syntax .gd { color: #000000; background-color: #ffdddd } /* Generic.Deleted */
.syntax .ge { font-style: italic } /* Generic.Emph */
.syntax .gr { color: #aa0000 } /* Generic.Error */
.syntax .gh { color: #999999 } /* Generic.Heading */
.syntax .gi { color: #000000; background-color: #ddffdd } /* Generic.Inserted */
.syntax .go { color: #888888 } /* Generic.Output */
.syntax .gp { color: #555555 } /* Generic.Prompt */
.syntax .gs { font-weight: bold } /* Generic.Strong */
.syntax .gu { color: #aaaaaa } /* Generic.Subheading */
.syntax .gt { color: #aa0000 } /* Generic.Traceback */
.syntax .kc { color: #008800; font-weight: bold } /* Keyword.Constant */
.syntax .kd { color: #008800; font-weight: bold } /* Keyword.Declaration */
.syntax .kp { color: #008800 } /* Keyword.Pseudo */
.syntax .kr { color: #008800; font-weight: bold } /* Keyword.Reserved */
.syntax .kt { color: #888888; font-weight: bold } /* Keyword.Type */
.syntax .m { color: #0000DD; font-weight: bold } /* Literal.Number */
.syntax .s { color: #dd2200; background-color: #fff0f0 } /* Literal.String */
.syntax .na { color: #336699 } /* Name.Attribute */
.syntax .nb { color: #003388 } /* Name.Builtin */
.syntax .nc { color: #bb0066; font-weight: bold } /* Name.Class */
.syntax .no { color: #003366; font-weight: bold } /* Name.Constant */
.syntax .nd { color: #555555 } /* Name.Decorator */
.syntax .ne { color: #bb0066; font-weight: bold } /* Name.Exception */
.syntax .nf { color: #0066bb; font-weight: bold } /* Name.Function */
.syntax .nl { color: #336699; font-style: italic } /* Name.Label */
.syntax .nn { color: #bb0066; font-weight: bold } /* Name.Namespace */
.syntax .py { color: #336699; font-weight: bold } /* Name.Property */
.syntax .nt { color: #bb0066; font-weight: bold } /* Name.Tag */
.syntax .nv { color: #336699 } /* Name.Variable */
.syntax .ow { color: #008800 } /* Operator.Word */
.syntax .mf { color: #0000DD; font-weight: bold } /* Literal.Number.Float */
.syntax .mh { color: #0000DD; font-weight: bold } /* Literal.Number.Hex */
.syntax .mi { color: #0000DD; font-weight: bold } /* Literal.Number.Integer */
.syntax .mo { color: #0000DD; font-weight: bold } /* Literal.Number.Oct */
.syntax .sb { color: #dd2200; background-color: #fff0f0 } /* Literal.String.Backtick */
.syntax .sc { color: #dd2200; background-color: #fff0f0 } /* Literal.String.Char */
.syntax .sd { color: #dd2200; background-color: #fff0f0 } /* Literal.String.Doc */
.syntax .s2 { color: #dd2200; background-color: #fff0f0 } /* Literal.String.Double */
.syntax .se { color: #0044dd; background-color: #fff0f0 } /* Literal.String.Escape */
.syntax .sh { color: #dd2200; background-color: #fff0f0 } /* Literal.String.Heredoc */
.syntax .si { color: #3333bb; background-color: #fff0f0 } /* Literal.String.Interpol */
.syntax .sx { color: #22bb22; background-color: #f0fff0 } /* Literal.String.Other */
.syntax .sr { color: #008800; background-color: #fff0ff } /* Literal.String.Regex */
.syntax .s1 { color: #dd2200; background-color: #fff0f0 } /* Literal.String.Single */
.syntax .ss { color: #aa6600; background-color: #fff0f0 } /* Literal.String.Symbol */
.syntax .bp { color: #003388 } /* Name.Builtin.Pseudo */
.syntax .vc { color: #336699 } /* Name.Variable.Class */
.syntax .vg { color: #dd7700 } /* Name.Variable.Global */
.syntax .vi { color: #3333bb } /* Name.Variable.Instance */
.syntax .il { color: #0000DD; font-weight: bold } /* Literal.Number.Integer.Long */
  </style>
</head>
<body>
  <div id="content">
    
      <h1 class="heading"><span>Jinja</span></h1>
      <h2 class="subheading">Template Loaders</h2>
    
    
    <div id="toc">
      <h2>Navigation</h2>
      <ul>
        <li><a href="index.html">back to index</a></li>
      </ul>
      
        <h2>Contents</h2>
        <ul class="contents">
        
          <li><a href="#builtin-loaders">Builtin Loaders</a></li>
        
          <li><a href="#developing-loaders">Developing Loaders</a></li>
        
        </ul>
      
    </div>
    
    <div id="contentwrapper">
      <p>This part of the documentation explains how to use and write a template loader.</p>
<div class="section">
<h3><a id="builtin-loaders" name="builtin-loaders">Builtin Loaders</a></h3>
<dl class="docutils">
<dt><cite>ChoiceLoader</cite></dt>
<dd><p class="first">A loader that tries multiple loaders in the order they are given to
the <cite>ChoiceLoader</cite>:</p>
<div class="last"><div class="syntax"><pre><span class="k">from</span> <span class="nn">jinja</span> <span class="k">import</span> <span class="n">ChoiceLoader</span><span class="p">,</span> <span class="n">FileSystemLoader</span>
<span class="n">loader1</span> <span class="o">=</span> <span class="n">FileSystemLoader</span><span class="p">(</span><span class="s">&quot;templates1&quot;</span><span class="p">)</span>
<span class="n">loader2</span> <span class="o">=</span> <span class="n">FileSystemLoader</span><span class="p">(</span><span class="s">&quot;templates2&quot;</span><span class="p">)</span>
<span class="n">loader</span> <span class="o">=</span> <span class="n">ChoiceLoader</span><span class="p">([</span><span class="n">loader1</span><span class="p">,</span> <span class="n">loader2</span><span class="p">])</span>
</pre></div>
</div></dd>
<dt><cite>DictLoader</cite></dt>
<dd><p class="first">Load templates from a given dict:</p>
<div class="last"><div class="syntax"><pre><span class="k">from</span> <span class="nn">jinja</span> <span class="k">import</span> <span class="n">Environment</span><span class="p">,</span> <span class="n">DictLoader</span>
<span class="n">e</span> <span class="o">=</span> <span class="n">Environment</span><span class="p">(</span><span class="n">loader</span><span class="o">=</span><span class="n">DictLoader</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span>
    <span class="n">layout</span><span class="o">=</span><span class="s">&#39;...&#39;</span><span class="p">,</span>
    <span class="n">index</span><span class="o">=</span><span class="s">&#39;{</span><span class="si">% e</span><span class="s">xtends &#39;</span><span class="n">layout</span><span class="s">&#39; %}...&#39;</span>
<span class="p">)))</span>
</pre></div>
</div></dd>
<dt><cite>FileSystemLoader</cite></dt>
<dd><p class="first">Loads templates from the filesystem:</p>
<div class="syntax"><pre><span class="k">from</span> <span class="nn">jinja</span> <span class="k">import</span> <span class="n">Environment</span><span class="p">,</span> <span class="n">FileSystemLoader</span>
<span class="n">e</span> <span class="o">=</span> <span class="n">Environment</span><span class="p">(</span><span class="n">loader</span><span class="o">=</span><span class="n">FileSystemLoader</span><span class="p">(</span><span class="s">&#39;templates/&#39;</span><span class="p">))</span>
</pre></div>
<p>You can pass the following keyword arguments to the loader on
initialisation:</p>
<table border="1" class="last docutils">
<colgroup>
<col width="28%" />
<col width="72%" />
</colgroup>
<tbody valign="top">
<tr><td><tt class="docutils literal"><span class="pre">searchpath</span></tt></td>
<td>String with the path to the templates on the
filesystem.</td>
</tr>
<tr><td><tt class="docutils literal"><span class="pre">use_memcache</span></tt></td>
<td>Set this to <tt class="docutils literal"><span class="pre">True</span></tt> to enable memory caching.
This is usually a good idea in production mode,
but disable it during development since it won't
reload template changes automatically.
This only works in persistent environments like
FastCGI.</td>
</tr>
<tr><td><tt class="docutils literal"><span class="pre">memcache_size</span></tt></td>
<td>Number of template instance you want to cache.
Defaults to <tt class="docutils literal"><span class="pre">40</span></tt>.</td>
</tr>
<tr><td><tt class="docutils literal"><span class="pre">cache_folder</span></tt></td>
<td>Set this to an existing directory to enable
caching of templates on the file system. Note
that this only affects templates transformed
into python code. Default is <tt class="docutils literal"><span class="pre">None</span></tt> which means
that caching is disabled.</td>
</tr>
<tr><td><tt class="docutils literal"><span class="pre">auto_reload</span></tt></td>
<td>Set this to <cite>False</cite> for a slightly better
performance. In that case Jinja won't check for
template changes on the filesystem.</td>
</tr>
</tbody>
</table>
</dd>
<dt><cite>FunctionLoader</cite></dt>
<dd><p class="first">Loads templates by calling a function which has to return a string
or <cite>None</cite> if an error occoured.</p>
<div class="syntax"><pre><span class="k">from</span> <span class="nn">jinja</span> <span class="k">import</span> <span class="n">Environment</span><span class="p">,</span> <span class="n">FunctionLoader</span>

<span class="k">def</span> <span class="nf">my_load_func</span><span class="p">(</span><span class="n">template_name</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">template_name</span> <span class="o">==</span> <span class="s">&#39;foo&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="s">&#39;...&#39;</span>

<span class="n">e</span> <span class="o">=</span> <span class="n">Environment</span><span class="p">(</span><span class="n">loader</span><span class="o">=</span><span class="n">FunctionLoader</span><span class="p">(</span><span class="n">my_load_func</span><span class="p">))</span>
</pre></div>
<p>Because the interface is limited there is no way to cache such
templates. Usually you should try to use a loader with a more
solid backend.</p>
<p>You can pass the following keyword arguments to the loader on
initialisation:</p>
<table border="1" class="last docutils">
<colgroup>
<col width="27%" />
<col width="73%" />
</colgroup>
<tbody valign="top">
<tr><td><tt class="docutils literal"><span class="pre">loader_func</span></tt></td>
<td>Function that takes the name of the template to
load. If it returns a string or unicode object
it's used to load a template. If the return
value is None it's considered missing.</td>
</tr>
<tr><td><tt class="docutils literal"><span class="pre">getmtime_func</span></tt></td>
<td>Function used to check if templates requires
reloading. Has to return the UNIX timestamp of
the last template change or <tt class="docutils literal"><span class="pre">-1</span></tt> if this template
does not exist or requires updates at any cost.</td>
</tr>
<tr><td><tt class="docutils literal"><span class="pre">use_memcache</span></tt></td>
<td>Set this to <tt class="docutils literal"><span class="pre">True</span></tt> to enable memory caching.
This is usually a good idea in production mode,
but disable it during development since it won't
reload template changes automatically.
This only works in persistent environments like
FastCGI.</td>
</tr>
<tr><td><tt class="docutils literal"><span class="pre">memcache_size</span></tt></td>
<td>Number of template instance you want to cache.
Defaults to <tt class="docutils literal"><span class="pre">40</span></tt>.</td>
</tr>
<tr><td><tt class="docutils literal"><span class="pre">cache_folder</span></tt></td>
<td>Set this to an existing directory to enable
caching of templates on the file system. Note
that this only affects templates transformed
into python code. Default is <tt class="docutils literal"><span class="pre">None</span></tt> which means
that caching is disabled.</td>
</tr>
<tr><td><tt class="docutils literal"><span class="pre">auto_reload</span></tt></td>
<td>Set this to <cite>False</cite> for a slightly better
performance. In that case of <cite>getmtime_func</cite>
not being provided this won't have an effect.</td>
</tr>
</tbody>
</table>
</dd>
<dt><cite>PackageLoader</cite></dt>
<dd><p class="first">Loads templates from python packages using setuptools.</p>
<div class="syntax"><pre><span class="k">from</span> <span class="nn">jinja</span> <span class="k">import</span> <span class="n">Environment</span><span class="p">,</span> <span class="n">PackageLoader</span>
<span class="n">e</span> <span class="o">=</span> <span class="n">Environment</span><span class="p">(</span><span class="n">loader</span><span class="o">=</span><span class="n">PackageLoader</span><span class="p">(</span><span class="s">&#39;yourapp&#39;</span><span class="p">,</span> <span class="s">&#39;template/path&#39;</span><span class="p">))</span>
</pre></div>
<p>You can pass the following keyword arguments to the loader on
initialisation:</p>
<table border="1" class="last docutils">
<colgroup>
<col width="28%" />
<col width="72%" />
</colgroup>
<tbody valign="top">
<tr><td><tt class="docutils literal"><span class="pre">package_name</span></tt></td>
<td>Name of the package containing the templates.</td>
</tr>
<tr><td><tt class="docutils literal"><span class="pre">package_path</span></tt></td>
<td>Path of the templates inside the package.</td>
</tr>
<tr><td><tt class="docutils literal"><span class="pre">use_memcache</span></tt></td>
<td>Set this to <tt class="docutils literal"><span class="pre">True</span></tt> to enable memory caching.
This is usually a good idea in production mode,
but disable it during development since it won't
reload template changes automatically.
This only works in persistent environments like
FastCGI.</td>
</tr>
<tr><td><tt class="docutils literal"><span class="pre">memcache_size</span></tt></td>
<td>Number of template instance you want to cache.
Defaults to <tt class="docutils literal"><span class="pre">40</span></tt>.</td>
</tr>
<tr><td><tt class="docutils literal"><span class="pre">cache_folder</span></tt></td>
<td>Set this to an existing directory to enable
caching of templates on the file system. Note
that this only affects templates transformed
into python code. Default is <tt class="docutils literal"><span class="pre">None</span></tt> which means
that caching is disabled.</td>
</tr>
<tr><td><tt class="docutils literal"><span class="pre">auto_reload</span></tt></td>
<td>Set this to <cite>False</cite> for a slightly better
performance. In that case Jinja won't check for
template changes on the filesystem. If the
templates are inside of an egg file this won't
have an effect.</td>
</tr>
</tbody>
</table>
</dd>
</dl>
</div>
<div class="section">
<h3><a id="developing-loaders" name="developing-loaders">Developing Loaders</a></h3>
<p>Template loaders are just normal Python classes that have to provide some
functions used to load and translate templates. Because some of the tasks
a loader has to do are redundant there are some classes that make loader
development easier.</p>
<p>Here the implementation of a simple loader based on the <cite>BaseLoader</cite> from
<cite>jinja.loaders</cite>:</p>
<div class="syntax"><pre><span class="k">import</span> <span class="nn">codecs</span>
<span class="k">from</span> <span class="nn">os.path</span> <span class="k">import</span> <span class="n">join</span>
<span class="k">from</span> <span class="nn">jinja.loaders</span> <span class="k">import</span> <span class="n">BaseLoader</span>
<span class="k">from</span> <span class="nn">jinja.exceptions</span> <span class="k">import</span> <span class="n">TemplateNotFound</span>

<span class="k">class</span> <span class="nc">SimpleLoader</span><span class="p">(</span><span class="n">BaseLoader</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">path</span>

    <span class="k">def</span> <span class="nf">get_source</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">environment</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">TemplateNotFound</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">,</span> <span class="n">environment</span><span class="o">.</span><span class="n">template_charset</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
<p>The functions <cite>load</cite> and <cite>parse</cite> which are a requirement for a loader are
added automatically by the <cite>BaseLoader</cite>.</p>
<p>Additionally to the <cite>BaseLoader</cite> there is a mixin class called
<cite>CachedLoaderMixin</cite> that implements memory and disk caching of templates.
Note that you have to give it a higher priority in the MRO than the
<cite>BaseLoader</cite> which means that's the first base class when inheriting from it:</p>
<div class="syntax"><pre><span class="k">import</span> <span class="nn">codecs</span>
<span class="k">from</span> <span class="nn">os.path</span> <span class="k">import</span> <span class="n">join</span><span class="p">,</span> <span class="n">getmtime</span><span class="p">,</span> <span class="n">exists</span>
<span class="k">from</span> <span class="nn">jinja.loaders</span> <span class="k">import</span> <span class="n">BaseLoaderCachedLoaderMixin</span>
<span class="k">from</span> <span class="nn">jinja.exceptions</span> <span class="k">import</span> <span class="n">TemplateNotFound</span>

<span class="k">class</span> <span class="nc">CachedLoader</span><span class="p">(</span><span class="n">CachedLoaderMixin</span><span class="p">,</span> <span class="n">BaseLoader</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">path</span>
        <span class="n">CachedLoaderMixin</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span>
            <span class="bp">True</span><span class="p">,</span>       <span class="c"># use memory caching</span>
            <span class="mi">40</span><span class="p">,</span>         <span class="c"># for up to 40 templates</span>
            <span class="s">&#39;/tmp&#39;</span><span class="p">,</span>     <span class="c"># additionally save the compiled templates in /tmp</span>
            <span class="bp">True</span>        <span class="c"># and reload cached templates automatically if changed</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_source</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">environment</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">TemplateNotFound</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">,</span> <span class="n">environment</span><span class="o">.</span><span class="n">template_charset</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">check_source_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">environment</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="n">fn</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">exists</span><span class="p">(</span><span class="n">fn</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">getmtime</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
</pre></div>
<p>You don't have to provide the <cite>check_source_changed</cite> method. If it doesn't
exist the option <cite>auto_reload</cite> won't have an effect. Also note that the
<cite>check_source_changed</cite> method must not raise an exception if the template
does not exist but return <tt class="docutils literal"><span class="pre">-1</span></tt>. The return value <tt class="docutils literal"><span class="pre">-1</span></tt> is considered
&quot;always reload&quot; whereas <tt class="docutils literal"><span class="pre">0</span></tt> means &quot;do not reload&quot;.</p>
</div>

    </div>
  </div>
</body>
<!-- generated on: 2007-03-23 17:14:57.802754
     file id: loaders -->
</html>