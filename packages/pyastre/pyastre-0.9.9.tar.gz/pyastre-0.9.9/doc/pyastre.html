<HTML>
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<!-- Created on May, 14  2005 by texi2html 1.64 -->
<!-- 
Written by: Lionel Cons <Lionel.Cons@cern.ch> (original author)
            Karl Berry  <karl@freefriends.org>
            Olaf Bachmann <obachman@mathematik.uni-kl.de>
            and many others.
Maintained by: Olaf Bachmann <obachman@mathematik.uni-kl.de>
Send bugs and suggestions to <texi2html@mathematik.uni-kl.de>
 
-->
<HEAD>
<TITLE>Pyastre Manual: </TITLE>

<META NAME="description" CONTENT="Pyastre Manual: ">
<META NAME="keywords" CONTENT="Pyastre Manual: ">
<META NAME="resource-type" CONTENT="document">
<META NAME="distribution" CONTENT="global">
<META NAME="Generator" CONTENT="texi2html 1.64">

</HEAD>

<BODY LANG="" BGCOLOR="#FFFFFF" TEXT="#000000" LINK="#0000FF" VLINK="#800080" ALINK="#FF0000">

<A NAME="SEC_Top"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="pyastre.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="pyastre.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[Index]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="pyastre.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H1>Pyastre Manual</H1></P><P>

<BLOCKQUOTE><TABLE BORDER=0 CELLSPACING=0> 
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="pyastre.html#SEC1">1. Introduction</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">What is Pyastre and what is it good for?</TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="pyastre.html#SEC2">2. Building and Installing Pyastre</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">How to compile Pyastre and get Asterisk to load it.</TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="pyastre.html#SEC6">3. Writing Scripts for Pyastre</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">How  to  write  scripts   in  Python  to  extend  the
                 capabilities of the Asterisk PBX</TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="pyastre.html#SEC10">4. Extending Pyastre</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">How to add new Python hooks to call C functions.</TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="pyastre.html#SEC11">5. Your Rights</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP">Terms and Conditions.</TD></TR>
</TABLE></BLOCKQUOTE>
<P>

<HR SIZE=1>
<A NAME="SEC1"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="pyastre.html#SEC_Top"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="pyastre.html#SEC2"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="pyastre.html#SEC_Top"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="pyastre.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="pyastre.html#SEC2"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="pyastre.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="pyastre.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[Index]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="pyastre.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<A NAME="Introduction"></A>
<H1> 1. Introduction </H1>
<!--docid::SEC1::-->
<P>

Pyastre is a module written in C and some helper classes in Python for
the Asterisk  PBX. It  allows one to  run a persistent  python process
within Asterisk, as well as to run python scripts from the dialplan.
</P><P>

Pyastre  started   out  with  frustration  at   the  Asterisk  Manager
Interface. The  AMI is a  TCP protocol that  makes it possible  to get
status   information  out  of,   and  to   send  control   messages  to
Asterisk. The authors  of the AMI were, it  seems, more concerned with
making the  PBX part of Asterisk  work right than  with designing a
proper remote  procedure protocol, so  they made it very  simple: some
key-value pairs  separated by newlines.  It is a  simplistic protocol,
sometimes ambiguous, but most of the time it works.
</P><P>

The particular task  at hand was to implement a  "Summon" macro on a
MoinMoin Wiki. The  macro would take two user  supplied arguments: two
telephone numbers. When a button is pressed on the web page, those two
phones ring  and get  bridged together. This  could be done  using the
AMI, but at  the time there was no Python library  for doing this, and
writing  such a  library  for an  underdesigned  protocol wasn't  very
interesting. 
</P><P>

There are, however several RPC protocols out there that are implemented
in a  variety of languages  that are much  more flexible. XMLRPC  is a
good example. Wouldn't it be nice to easily and painlessly make XMLRPC
calls to control Asterisk?
</P><P>

Browsing through  the Asterisk source code revealed  a function called
ast_originate that  did pretty much what  was needed. In  fact the AMI
uses this function under the hood.  But how to expose this to the Wiki
code most expediently? 
</P><P>

And so  PyAsterisk<A NAME="DOCF1" HREF="pyastre.html#FOOT1">(1)</A>   was  written  to  provide  a
persistent python process, and this process would run an XMLRPC server
and expose ast_originate  over the network. It is,  of course, trivial
to write  an XMLRPC  server in Python.  Doing the  same thing in  C is
quite a  bit more  complicated, and,  it turns out,  quite a  lot less
reuseable.
</P><P>

After running  this  for a while, the need came to  store more data in
call detail  records than  is available in  the standard  ones. Rather
than hack the  cdr_pgsql.c handler, and have to  keep applying patches
to new  releases of Asterisk,  better to write a  programmable handler
that can  get information from wherever  it wants and stuff  it in the
database,  no?  So a  CDR  handler was  written  that  passes off  the
information to a python function for processing.
</P><P>

It was  also about this time that  it started making sense  to use the
Twisted framework.  Twisted is a  bunch of python modules  for running
servers and  talking to databases.  It also does so  asynchronously --
which is a big bonus since you don't want your python scripts tying up
resources  unnecessarily or, worse,  causing something  important with
Asterisk to block.
</P><P>

So, now we  had two entry points into  the Python interpreter, running
in different threads: from the  outside world via whatever servers the
persistent  process was providing,  and via  the CDR  handler.  Adding
another,  to make  the  Python interpreter  accessible  from the  call
processing logic in the  dialplan was then straightforward. This makes
it easy to do things  like make complicated routing decisions based on
information in one (or even several!) databases without having to fork
a new process and make a fresh database connection as is the case with
the Application  Gateway Interface  or AGI, or  to do  complicated and
error-prone  operations in C  where the  bottleneck is  not processing
speed.
</P><P>

So  then,  there are  three  main  parts  to Pyastre:  the  Persistant
Process,   the   Call  Detail   Record   Handler   and  the   Dialplan
Application. There are also some convenient helper modules implemented
along  the way  in Python.  Respectively,  these allow  one to  expose
internal  Asterisk API functions  to 3rd  party applications  over the
network and  manage database  connections, flexibly process  and store
state  and  logging  information,   and  script  the  call  processing
behaviour of Asterisk itself.
</P><P>

<A NAME="Building"></A>
<HR SIZE="6">
<A NAME="SEC2"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="pyastre.html#SEC1"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="pyastre.html#SEC3"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="pyastre.html#SEC1"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="pyastre.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="pyastre.html#SEC3"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="pyastre.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="pyastre.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[Index]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="pyastre.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H1> 2. Building and Installing Pyastre </H1>
<!--docid::SEC2::-->
<P>

To  build Pyastre,  Python is  required. Version  2.4  is recommended,
though  it is  known to  work  with 2.3.  SWIG is  also required.  The
zope.interface module  is required for  some of the  supporting Python
code.  Installing the Twisted Framework is strongly suggested.
</P><P>

<BLOCKQUOTE><TABLE BORDER=0 CELLSPACING=0> 
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="pyastre.html#SEC3">2.1 Preparing Asterisk</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="pyastre.html#SEC4">2.2 Building Pyastre</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="pyastre.html#SEC5">2.3 Loading Pyastre</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
</TABLE></BLOCKQUOTE>
<P>

<A NAME="Preparing Asterisk"></A>
<HR SIZE="6">
<A NAME="SEC3"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="pyastre.html#SEC2"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="pyastre.html#SEC4"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="pyastre.html#SEC2"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="pyastre.html#SEC2"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="pyastre.html#SEC3"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="pyastre.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="pyastre.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[Index]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="pyastre.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H2> 2.1 Preparing Asterisk </H2>
<!--docid::SEC3::-->
<P>

Unfortunately,  since in  Python parlance  we are  both  extending and
embedding   the   interpreter,   the   module  that   this   produces,
<EM>_pyastre.so</EM>, is  not linked with libpython.  The standard build
infrastructure  does   not  support   doing  this  very   easily.  The
workaround, so that the basic  Python interpreter is made available to
the module, is to link Asterisk with libpython. This involves changing
the Asterisk Makefile and rebuilding it. The easiest way to do this is
to find the line that looks like this:
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>LIBS+=-lssl
</pre></td></tr></table></P><P>

and change it to read:
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>LIBS+=-lssl -lpython2.4
</pre></td></tr></table></P><P>

and then recompile and re-install Asterisk.
</P><P>

<A NAME="Building Pyastre"></A>
<HR SIZE="6">
<A NAME="SEC4"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="pyastre.html#SEC3"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="pyastre.html#SEC5"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="pyastre.html#SEC2"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="pyastre.html#SEC2"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="pyastre.html#SEC3"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="pyastre.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="pyastre.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[Index]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="pyastre.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H2> 2.2 Building Pyastre </H2>
<!--docid::SEC4::-->
<P>

Once you  have the  source distribution of  Pyastre, uncompress  it as
usual.  The main  installation step  is the  same as  for  most Python
programs and modules:
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>
% python setup.py install
</pre></td></tr></table></P><P>

<A NAME="Loading Pyastre"></A>
<HR SIZE="6">
<A NAME="SEC5"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="pyastre.html#SEC4"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="pyastre.html#SEC6"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="pyastre.html#SEC2"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="pyastre.html#SEC2"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="pyastre.html#SEC3"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="pyastre.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="pyastre.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[Index]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="pyastre.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H2> 2.3 Loading Pyastre </H2>
<!--docid::SEC5::-->
<P>

The previous step will have produced a C module in
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>${PYTHON_LIBDIR}/site-python/_pyastre.so
</pre></td></tr></table></P><P>

This is the Asterisk module. Asterisk has to be told to load it. There
are two ways  to do this. One is  to add a line with the  full path to
<EM>/etc/asterisk/modules.conf</EM>.
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>
load =&#62; ${PYTHON_LIBDIR}/site-python/_pyastre.so
</pre></td></tr></table></P><P>

The   other    is   to    make   a   symlink    to   this    file   in
<EM>/usr/lib/asterisk/modules</EM>, but this will  only work if you have
<EM>autoload =&#62; yes</EM> in modules.conf.
</P><P>

<A NAME="Scripts"></A>
<HR SIZE="6">
<A NAME="SEC6"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="pyastre.html#SEC5"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="pyastre.html#SEC7"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="pyastre.html#SEC2"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="pyastre.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="pyastre.html#SEC7"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="pyastre.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="pyastre.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[Index]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="pyastre.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H1> 3. Writing Scripts for Pyastre </H1>
<!--docid::SEC6::-->
<P>

Typically  Python  scripts for  Pyastre  will  live  in the  directory
<EM>/etc/asterisk/site-python</EM>,  though  they  may  live  anywhere  in  the
${PYTHONPATH}. There is  only one special script that  must exist, and
it is called <EM>softswitch.py</EM>. It contains the Python side of the glue to
the interpreter embedded in Asterisk.
</P><P>

<EM>softswitch.py</EM>   must  contain   three   functions:  <EM>run</EM>,
<EM>stop</EM>  and <EM>cdr</EM>.  <EM>run</EM> is  called with  no arguments
when Pyastre  is loaded. It is  the main thread and  should not return
until stop is  called upon unload. <EM>stop</EM> is  also called with no
arguments.   <EM>cdr</EM> is called  with an  opaque call  detail record
object. There exists a helper class to convert this opaque object into
something useful.
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>## A Skeletal softswitch.py with Twisted

from twisted.internet import reactor
def run():
    reactor.run()

def stop():
    reactor.stop()

def cdr(cdrobj):
    from pyastre.cdr import CallDetailRecord
    c = CallDetailRecord(cdrobj)
    ### do something with c

</pre></td></tr></table></P><P>

Typical   usage  also  will   have  either   the  top-level   code  in
<EM>softswitch.py</EM>  or  the <EM>run</EM>  method  make connections  to
databases and prepare other persistant resources that may be needed by
scripts, etc.
</P><P>

<BLOCKQUOTE><TABLE BORDER=0 CELLSPACING=0> 
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="pyastre.html#SEC7">3.1 Persistant Process</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="pyastre.html#SEC8">3.2 Call Detail Record Handler</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="pyastre.html#SEC9">3.3 Dialplan Application</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
</TABLE></BLOCKQUOTE>
<P>

<A NAME="Persistant Process"></A>
<HR SIZE="6">
<A NAME="SEC7"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="pyastre.html#SEC6"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="pyastre.html#SEC8"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="pyastre.html#SEC6"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="pyastre.html#SEC6"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="pyastre.html#SEC7"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="pyastre.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="pyastre.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[Index]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="pyastre.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H2> 3.1 Persistant Process </H2>
<!--docid::SEC7::-->
<P>

It  is crucially  important  to remember  that  the persistent  Python
process in Pyastre,  what can be thought of as the  main thread of the
program, does not  exit. If it exits, the  Python Interpreter will not
be  available to  the other  threads that  call into  it (such  as the
Dialplan Application and the Call Detail Record handler).
</P><P>

If you don't use Twisted, you will have to find some way of preventing
softswitch.run from returning. One idiom that has been used is:
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>## Kludge to keep the persistant process running

from threading import Event
kludgeE = Event()

def run():
    kludgeE.wait()

def stop():
    kludgeE.set()

</pre></td></tr></table></P><P>

This is not very elegant, but it will do the job if all you want to do
is something simple that doesn't  require any sort of persistance.  In
most cases it is much better to use Twisted.
</P><P>

<A NAME="Call Detail Record Handler"></A>
<HR SIZE="6">
<A NAME="SEC8"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="pyastre.html#SEC7"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="pyastre.html#SEC9"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="pyastre.html#SEC6"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="pyastre.html#SEC6"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="pyastre.html#SEC7"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="pyastre.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="pyastre.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[Index]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="pyastre.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H2> 3.2 Call Detail Record Handler </H2>
<!--docid::SEC8::-->
<P>

The CDR handler should collect what information it needs and return as
quickly as possible in order to free up channel resources. If possible
it  should   queue  the  data   for  storage  rather  than   store  it
immediately. 
</P><P>

As this handler  was written to get at and  save more information than
is normally  possible, naturally there  is a convenient  technique for
collecting  data during life  of a  call.  Asterisk  has a  concept of
<EM>channel variables</EM> which can be  set from the dialplan.  Say for
example you  wanted to store the  colour of a  caller's shoes, perhaps
based on some  sort of IVR system. You  might collect this information
from the user and then do something like:
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>;; Seting a Channel Variable in extensions.conf

exten =&#62; 1234,1,SetVar(SHOES=RED)
</pre></td></tr></table></P><P>

This information can then be retrieved in the CDR handler, except that
a   CDR  object   is  passed   to   the  handler,   not  the   channel
itself.  Fortunately the  CDR  object contains  the  channel name  and
Pyastre exposes a function to use this to get at the channel. Once you
have the channel object, the variables are accessible using dictionary
syntax.
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>## CDR Handler Example

def cdr(cdrobj):
    from pyastre.cdr import CallDetailRecord
    from pyastre.channel import Channel
    from asterisk import ast_channel_byname

    c = CallDetailRecord(cdrobj)
    ch = Channel(ast_channel_byname(c))

    c.shoes = ch["SHOES"]
</pre></td></tr></table></P><P>

<EM>TODO:  modify the CallDetailRecord  class to  automatically make
available the associated Channel class.</EM>
</P><P>

<A NAME="Dialplan Application"></A>
<HR SIZE="6">
<A NAME="SEC9"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="pyastre.html#SEC8"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="pyastre.html#SEC10"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="pyastre.html#SEC6"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="pyastre.html#SEC6"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="pyastre.html#SEC7"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="pyastre.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="pyastre.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[Index]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="pyastre.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H2> 3.3 Dialplan Application </H2>
<!--docid::SEC9::-->
<P>

Writing a dialplan  application is very similar to  writing a MoinMoin
Wiki macro. For example,
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>;; Calling Python from the Dialplan

exten =&#62; 1234,1,Python(myscript,arg1,arg2,arg3)
</pre></td></tr></table></P><P>

requires that there is a  module somewhere in the ${PYTHONPATH} called
<EM>myscript</EM>  which  has  an  <EM>execute</EM> method.  Usually  this
module will exist in <EM>/etc/asterisk/site-python/myscript.py</EM>, and
a trivial example might look like this:
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>## myscript.py

def execute(c, args):
    ## c is an opaque channel object representing the current channel
    from pyastre.channel import Channel
    chan = Channel(c)

    ## as with a normal Asterisk application, we need to parse the
    ## | separated arguments    
    args = args.split('|')[1:]

    ## write something to the console
    from pyastre.utils import verbose
    verbose("%s" % args)
</pre></td></tr></table></P><P>

Unlike the  CDR handler,  the Dialplan Application  is intended  to be
synchronous.  This means  that if  you intend  to use  an asynchronous
framework such as Twisted, you need to arrange that the execute method
does  not  return  until  the  work  is finished,  so  that  the  call
processing doesn't  continue prematurely.  The way to  do this  is the
same as you would when using Twisted from within a MoinMoinMacro:
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>## Twisted from the Dialplan

def _work(chan, event, *args):
    deferred = some.twisted.async.call(...)
    d.addCallback(lambda x: event.set())
    d.addErrback(lambda x: event.set())

def execute(c, args):
    chan = Channel(c)
    args = args.split('|')[1:]

    from threading import Event
    e = Event()
    reactor.callInThread(_work, chan, e, *args)
    e.wait()
</pre></td></tr></table></P><P>

<A NAME="Extending"></A>
<HR SIZE="6">
<A NAME="SEC10"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="pyastre.html#SEC9"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="pyastre.html#SEC11"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="pyastre.html#SEC6"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="pyastre.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="pyastre.html#SEC11"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="pyastre.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="pyastre.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[Index]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="pyastre.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H1> 4. Extending Pyastre </H1>
<!--docid::SEC10::-->
<P>

What happens if  you need to make  a call into the Asterisk  C API and
there's  no  Python  function   to  do  it?  Unfortunately  from  this
perspective  Pyastre is  incomplete; it  does not  contain all  of the
hooks to  every C function  in Asterisk. Some  of the more  common and
useful ones  are there, but  most are not.  To add a Python  hook, you
need to recompile Pyastre.
</P><P>

In the source code distribution of Pyastre there is a directory called
<EM>_pyastre/</EM> which is where C and  SWIG source code lives. It is a
very good idea  to read the SWIG documentation do  see how this works,
but  suppose there  is  a very  simple function,  <EM>ast_foo(struct
ast_channel *)</EM>  which returns an  integer.  Including a  reference to
this might be as simple as adding the line
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>int ast_foo(struct ast_channel *);
</pre></td></tr></table></P><P>

to the <EM>pyastre.i</EM> file in the appropriate place.
</P><P>

If you  need something more complicated  than just calling  into the C
API, you may need to inline a wrapper function. This is often the case
when the  C function would  block -- and  we certainly don't  want the
whole Python process and all of the interpreters to block when we call
a function.  A good example of this is <EM>pbx_exec()</EM>. In pyastre.i
you will find an inline section that defines <EM>ast_exec()</EM> as
</P><P>

<TABLE><tr><td>&nbsp;</td><td class=example><pre>/* ast_exec() -- reentrant wrapper around pbx_exec */
%inline %{
    int ast_exec(struct ast_channel *c, struct ast_app *app,
                 char *args, int flags) {
        int ret;
        Py_BEGIN_ALLOW_THREADS
            ret = pbx_exec(c, app, args, flags);
        Py_END_ALLOW_THREADS;
        return ret;
    }
%}
</pre></td></tr></table></P><P>

In this  case the Py_BEGIN/END_ALLOW_THREADS pair  allows other Python
threads to  run while we  are waiting for  pbx_exec to return,  so the
whole thing doesn't block while waiting for us.
</P><P>

Once the desired modifications  have been made, simply rebuild Pyastre
and restart Asterisk.
</P><P>

<A NAME="Your Rights"></A>
<HR SIZE="6">
<A NAME="SEC11"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="pyastre.html#SEC10"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="pyastre.html#SEC12"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="pyastre.html#SEC10"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="pyastre.html#SEC_Top"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="pyastre.html#SEC12"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="pyastre.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="pyastre.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[Index]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="pyastre.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H1> 5. Your Rights </H1>
<!--docid::SEC11::-->
<P>

Writing  Free  Software  for  telephony applications  is  a  licensing
minefield.  The root  of many  of the  problems is  the  prevalence of
patent-encumbered codecs that are nevertheless in wide use and must be
supported if there is any  hope of interoperating with other equipment
in the field. I have thought  long and hard about the most appropriate
license  for this  software to  be released  into that  environment in
order  to perserve  as  many rights  for  the user  and programmer  as
possible  and  yet to  allow  the use  of  certain  necessary bits  of
non-free software.
</P><P>

<BLOCKQUOTE><TABLE BORDER=0 CELLSPACING=0> 
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="pyastre.html#SEC12">5.1 This Manual</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
<TR><TD ALIGN="left" VALIGN="TOP"><A HREF="pyastre.html#SEC13">5.2 The Software</A></TD><TD>&nbsp;&nbsp;</TD><TD ALIGN="left" VALIGN="TOP"></TD></TR>
</TABLE></BLOCKQUOTE>
<P>

<A NAME="This Manual"></A>
<HR SIZE="6">
<A NAME="SEC12"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="pyastre.html#SEC11"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="pyastre.html#SEC13"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="pyastre.html#SEC11"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="pyastre.html#SEC11"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="pyastre.html#SEC12"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="pyastre.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="pyastre.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[Index]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="pyastre.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H2> 5.1 This Manual </H2>
<!--docid::SEC12::-->
<P>

This manual is released under  the terms of the GNU Free Documentation
License (FDL). A  copy of the GNU FDL is  available in the <EM>doc/</EM>
subdirectory of the source distribution.
</P><P>

While the license itself  contains the canonical terms of distribution
and modification and should be deferred to in all cases where there is
a conflict or  ambiguity between it and this  text, loosely this means
that:
</P><P>

<UL>
<LI>
You may read, copy and distribute this manual without modification.
<LI>
You may  modify this manual so  long as the  original copyright notice
remains intact.
<LI>
You may  distribute modified  versions of this  manual so long  as you
make available the modified Texinfo source and so long as the modified
version is also distributed under terms of the GNU FDL.
<LI>
You  may  translate this  manual  into any  language.
<LI>
You may distribute  translated versions of this manual  under terms of
the GNU FDL.
<LI>
Any distribution  of a modified  or translated version of  this manual
must contain  either the  Texinfo source or  instructions on  where to
obtain  the  Texinfo  source  so  that  others  may  likewise  modify,
translate and redistribute it.
</UL>
<P>

<A NAME="The Software"></A>
<HR SIZE="6">
<A NAME="SEC13"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="pyastre.html#SEC12"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[ &gt; ]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="pyastre.html#SEC11"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="pyastre.html#SEC11"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="pyastre.html#SEC12"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="pyastre.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="pyastre.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[Index]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="pyastre.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H2> 5.2 The Software </H2>
<!--docid::SEC13::-->
<P>

Originally, the  intent was to  distribute the Pyastre  software under
the GNU General Public License  (GPL).  Because of the issues relating
to  patent-encumbered  codecs  alluded  to above,  it  quickly  became
apparent that  this was  impractical. Rather than  add clauses  to the
GPL, it was decided to release  it under the GNU Lesser or Library GPL
(LGPL), which is  designed specifically for the situation  where it is
impractical to forbid linking of Free Software with Non-Free Software.
</P><P>

As with  the documentation, in the  case of any  ambiguity or conflict
between this text and the LGPL, the text of the LGPL shall prevail.
</P><P>

Loosely the distribution terms of the LGPL mean
</P><P>

<UL>
<LI>
You may use, compile, copy and distribute the software.
<LI>
You may modify the software to suit your purposes.
<LI>
You  may distribute modified  copies of  the software  as long  as the
source code is made available, and  as long as the modified copies are
likewise released under the terms of the LGPL.
</UL>
<P>

You are encouraged to notify the author of any changes you make to the
software so  that, if appropriate,  they may be incorporated  into new
versions. 
<HR SIZE="6">
<A NAME="pyastre.html"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="pyastre.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="pyastre.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[Index]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="pyastre.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H1>Footnotes</H1>
<H3><A NAME="FOOT1" HREF="pyastre.html#DOCF1">(1)</A></H3>
<P>As PyAsterisk  was being written,  we were
made aware of  another project called py-asterisk to  write a bunch of
classes implementing the  AMI in Python. In order  to avoid ambiguity,
PyAsterisk  was  renamed  to  Pyastre.
<HR SIZE=1>
<A NAME="SEC_Contents"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="pyastre.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="pyastre.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[Index]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="pyastre.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H1>Table of Contents</H1>
<UL>
<A NAME="TOC1" HREF="pyastre.html#SEC1">1. Introduction</A>
<BR>
<A NAME="TOC2" HREF="pyastre.html#SEC2">2. Building and Installing Pyastre</A>
<BR>
<UL>
<A NAME="TOC3" HREF="pyastre.html#SEC3">2.1 Preparing Asterisk</A>
<BR>
<A NAME="TOC4" HREF="pyastre.html#SEC4">2.2 Building Pyastre</A>
<BR>
<A NAME="TOC5" HREF="pyastre.html#SEC5">2.3 Loading Pyastre</A>
<BR>
</UL>
<A NAME="TOC6" HREF="pyastre.html#SEC6">3. Writing Scripts for Pyastre</A>
<BR>
<UL>
<A NAME="TOC7" HREF="pyastre.html#SEC7">3.1 Persistant Process</A>
<BR>
<A NAME="TOC8" HREF="pyastre.html#SEC8">3.2 Call Detail Record Handler</A>
<BR>
<A NAME="TOC9" HREF="pyastre.html#SEC9">3.3 Dialplan Application</A>
<BR>
</UL>
<A NAME="TOC10" HREF="pyastre.html#SEC10">4. Extending Pyastre</A>
<BR>
<A NAME="TOC11" HREF="pyastre.html#SEC11">5. Your Rights</A>
<BR>
<UL>
<A NAME="TOC12" HREF="pyastre.html#SEC12">5.1 This Manual</A>
<BR>
<A NAME="TOC13" HREF="pyastre.html#SEC13">5.2 The Software</A>
<BR>
</UL>
</UL>
<HR SIZE=1>
<A NAME="SEC_OVERVIEW"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="pyastre.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="pyastre.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[Index]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="pyastre.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H1>Short Table of Contents</H1>
<BLOCKQUOTE>
<A NAME="TOC1" HREF="pyastre.html#SEC1">1. Introduction</A>
<BR>
<A NAME="TOC2" HREF="pyastre.html#SEC2">2. Building and Installing Pyastre</A>
<BR>
<A NAME="TOC6" HREF="pyastre.html#SEC6">3. Writing Scripts for Pyastre</A>
<BR>
<A NAME="TOC10" HREF="pyastre.html#SEC10">4. Extending Pyastre</A>
<BR>
<A NAME="TOC11" HREF="pyastre.html#SEC11">5. Your Rights</A>
<BR>

</BLOCKQUOTE>
<HR SIZE=1>
<A NAME="SEC_About"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="pyastre.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="pyastre.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[Index]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="pyastre.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<H1>About this document</H1>
This document was generated by <I>William Waites</I> on <I>May, 14  2005</I>
using <A HREF="http://www.mathematik.uni-kl.de/~obachman/Texi2html
"><I>texi2html</I></A>
<P></P>  
The buttons in the navigation panels have the following meaning:
<P></P>
<table border = "1">
<TR>
<TH> Button </TH>
<TH> Name </TH>
<TH> Go to </TH>
<TH> From 1.2.3 go to</TH>
</TR>
<TR>
<TD ALIGN="CENTER">
 [ &lt; ] </TD>
<TD ALIGN="CENTER">
Back
</TD>
<TD>
previous section in reading order
</TD>
<TD>
1.2.2
</TD>
</TR>
<TR>
<TD ALIGN="CENTER">
 [ &gt; ] </TD>
<TD ALIGN="CENTER">
Forward
</TD>
<TD>
next section in reading order
</TD>
<TD>
1.2.4
</TD>
</TR>
<TR>
<TD ALIGN="CENTER">
 [ &lt;&lt; ] </TD>
<TD ALIGN="CENTER">
FastBack
</TD>
<TD>
previous or up-and-previous section 
</TD>
<TD>
1.1
</TD>
</TR>
<TR>
<TD ALIGN="CENTER">
 [ Up ] </TD>
<TD ALIGN="CENTER">
Up
</TD>
<TD>
up section
</TD>
<TD>
1.2
</TD>
</TR>
<TR>
<TD ALIGN="CENTER">
 [ &gt;&gt; ] </TD>
<TD ALIGN="CENTER">
FastForward
</TD>
<TD>
next or up-and-next section
</TD>
<TD>
1.3
</TD>
</TR>
<TR>
<TD ALIGN="CENTER">
 [Top] </TD>
<TD ALIGN="CENTER">
Top
</TD>
<TD>
cover (top) of document
</TD>
<TD>
 &nbsp; 
</TD>
</TR>
<TR>
<TD ALIGN="CENTER">
 [Contents] </TD>
<TD ALIGN="CENTER">
Contents
</TD>
<TD>
table of contents
</TD>
<TD>
 &nbsp; 
</TD>
</TR>
<TR>
<TD ALIGN="CENTER">
 [Index] </TD>
<TD ALIGN="CENTER">
Index
</TD>
<TD>
concept index
</TD>
<TD>
 &nbsp; 
</TD>
</TR>
<TR>
<TD ALIGN="CENTER">
 [ ? ] </TD>
<TD ALIGN="CENTER">
About
</TD>
<TD>
this page
</TD>
<TD>
 &nbsp; 
</TD>
</TR>
</TABLE>
<P></P>
where the <STRONG> Example </STRONG> assumes that the current position 
is at <STRONG> Subsubsection One-Two-Three </STRONG> of a document of 
the following structure:
<UL>
<LI> 1. Section One  </LI>
<UL>
<LI>1.1 Subsection One-One</LI>
<UL>
<LI> ... </LI>
</UL>
<LI>1.2 Subsection One-Two</LI>
<UL>
<LI>1.2.1 Subsubsection One-Two-One
</LI><LI>1.2.2 Subsubsection One-Two-Two
</LI><LI>1.2.3 Subsubsection One-Two-Three &nbsp; &nbsp; <STRONG>
&lt;== Current Position </STRONG>
</LI><LI>1.2.4 Subsubsection One-Two-Four
</LI></UL>
<LI>1.3 Subsection One-Three</LI>
<UL>
<LI> ... </LI>
</UL>
<LI>1.4 Subsection One-Four</LI>
</UL>
</UL>

<HR SIZE=1>
<BR>  
<FONT SIZE="-1">
This document was generated
by <I>William Waites</I> on <I>May, 14  2005</I>
using <A HREF="http://www.mathematik.uni-kl.de/~obachman/Texi2html
"><I>texi2html</I></A>

</BODY>
</HTML>
