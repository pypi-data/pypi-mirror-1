<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      lang="en"
      metal:use-macro="context/main_template/macros/master"
      i18n:domain="plone">

<metal:head fill-slot="top_slot"
            tal:define="dummy python:request.set('disable_border',1)" />

    <div metal:fill-slot="main">
                         
        <table class="week-calendar calendar listing"
               tal:define="dates          context/zme_datesForWeek;
                           firstDate      python: dates[0];
                           eventsForWeek  python: context.zme_eventsForWeek(firstDate);
                          ">


            <thead>
                <tr class="weekdays">
                    <th id="time" i18:translate="time" class="nosort">Time</th>
                    <th id="mon" i18:translate="" class="nosort">Monday</th>
                    <th id="tue" i18:translate="" class="nosort">Tuesday</th>
                    <th id="wed" i18:translate="" class="nosort">Wednesday</th>
                    <th id="thu" i18:translate="" class="nosort">Thursday</th>
                    <th id="fri" i18:translate="" class="nosort">Friday</th>
                    <th id="sat" i18:translate="" class="nosort">Saturday</th>
                    <th id="son" i18:translate="" class="nosort">Sunday</th>
                </tr>
                <tr class="weekdays">
                    <th class="nosort" />
    
                    <th class="nosort"
                        tal:repeat="date dates">
                        <span tal:content="python: context.toLocalizedTime(date)" />
                    </th>
                </tr>
            </thead>

            <tbody>
                <tr>
                    <td i18n:translate="whole day">Whole day</td>
                    <tal:loop repeat="i  python: range(0, 7)">
                        <td tal:define="eventsForDay   python: eventsForWeek[i];
                                        eventsForHour  python: context.zme_eventsWholeDay(eventsForDay, dates[i])">
                            <ul tal:condition="eventsForHour">
                                <li tal:repeat="event eventsForHour">
                                    <a tal:attributes="href string:${event/getURL}"
                                       tal:content="event/Title"
                                    />
                                </li>
                            </ul>
                        </td>
                    </tal:loop>
                </tr>
    
                <tal:loop repeat="hour python: range(0, 24)">
                    <tr tal:attributes="class python:test(repeat['hour'].even(), 'even', 'odd')">
                        <td>
                            <span tal:content="python: '%02d:00' % hour" />
                            <span i18n:translate="hour_abbreviation">h</span>
                        </td>

                        <tal:loop repeat="i  python: range(0, 7)">

                            <td tal:define="eventsForDay   python: eventsForWeek[i];
                                            eventsForHour  python: context.zme_eventsForHour(eventsForDay, dates[i], hour)">

                                <ul tal:condition="eventsForHour">
                                    <li tal:repeat="event eventsForHour">
                                        <a tal:attributes="href string:${event/getURL}"
                                           tal:define="startStr python: event.start.strftime('%H:%Mh') ;
                                                       endStr   python: event.end.strftime('%H:%Mh')"
                                           tal:content="string:$startStr-$endStr: ${event/Title}"
                                        />
                                    </li>
                                </ul>
                            </td>
                        </tal:loop>
                    </tr>

                </tal:loop>


            </tbody>
        </table> 

    </div>
</html>

