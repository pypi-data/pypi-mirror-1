<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-us" xml:lang="en-us" >
<head>
<title>Django Live | Manager</title>
<meta name="robots" content="NONE,NOARCHIVE" />
   <style type="text/css">
html{
    height: 100%;
}

body{
    background-color: #9ddcab;
    font-family: Verdana, Arial;
    padding: 10px;
    font-size: 14px;
    height: 100%;
}

#status{
    background-color: #ddf5e2;
    overflow-y: scroll;
    height: 80%;
    padding: 10px;
    color: #4444;
}


    </style>

    <script src="http://{{ ORBITED_HOST }}:{{ ORBITED_PORT }}/static/Orbited.js"></script>
    <script>
      document.domain = document.domain;
      Orbited.settings.port = "{{ ORBITED_PORT }}";
      Orbited.settings.hostname = "{{ORBITED_HOST }}";
      TCPSocket = Orbited.TCPSocket;
    </script>
    <script src="http://{{ ORBITED_HOST }}:{{ ORBITED_PORT }}/static/protocols/stomp/stomp.js"></script>
    <script src="http://{{ ORBITED_HOST }}:{{ ORBITED_PORT }}/static/JSON.js"></script>

    <script>

var manage_channel = "{{ manage_channel }}";

var channels = [];

var add_channel = function(user, channel){
    if (channels.indexOf(channel)<0){
        channels = channels.concat([channel]);
        document.getElementById('status').innerHTML += 
            "<a href='/live/chat/"+ channel +"/YourHost' target='_blank'>new channel: "+ channel +"</a><br/>";
    }
}

    </script>

    <script>
        onload = function() {
            // set up stomp client.
            stomp = new STOMPClient();
            stomp.onopen = function() {
            };
            stomp.onclose = function(code) {
                shell.print("Transport closed (code: " + code + ")");
            };
            stomp.onerror = function(error) {
                alert("onerror: " + error);
            };
            stomp.onerrorframe = function(frame) {
                alert("onerrorframe: " + frame.body);
            };
            stomp.onconnectedframe = function() {
            };
            stomp.onmessageframe = function(frame) {
                var m = JSON.parse(frame.body);
                add_channel(m.user, m.channel)
            };

            stomp.connect(document.domain, {{ STOMP_PORT }}, 'UNIQUE_ID_PER_CLIENT', '');
            setTimeout("stomp.subscribe(manage_channel, {exchange:''})",2000);

        };
        onunload = function() {
            stomp.reset();
        }
    </script>


</head>

<body>
    <div id="status"><p>current channels:</p></div>
</body>
</html>
