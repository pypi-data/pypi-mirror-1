<!-- A demo configuration file for configuring a changeset -->

<config xmlns:xi="http://www.w3.org/2001/XInclude">

<!--
  A global change namespace, used to define commonly used items.
  You can use this to define variables that can be substituted in
  common places below. This provides a mechanism for templating changes.

  All values are strings. If you need to convert to a python number,
  do this in the python code, via int(), float() etc.
  
-->
<!-- include change templates I want to use -->
<xi:include href="netapp-create-volume.change-template.xml"/>

<!-- define my provisioner -->
<provisioner
  name='netapp_zapi_provisioner'
  module='modipy.netapp'
  type='ZAPIProvisioner'
  command_timeout='30'>
</provisioner>

<!-- define some devices I want to provision to -->
<device name='wibble'>
  <ipaddress>10.232.8.71</ipaddress>
</device>

<device name='localhost'>
  <ipaddress>127.0.0.1</ipaddress>
</device>

<!-- Define iterators used by changes -->
<iterator name="primary_volumes">
  <dict>
    <entry name="volname">prim_root</entry>
    <entry name="volaggr">aggr01</entry>
    <entry name="volsize">25m</entry>
  </dict>

  <dict>
    <entry name="volname">prim_vol01</entry>
    <entry name="volaggr">aggr01</entry>
    <entry name="volsize">25m</entry>
  </dict>

</iterator>

<iterator name="secondary_volumes">
  <dict>
    <entry name="volname">sec_root</entry>
    <entry name="volaggr">aggr01</entry>
    <entry name="volsize">25m</entry>
  </dict>

  <dict>
    <entry name="volname">sec_vol01</entry>
    <entry name="volaggr">aggr01</entry>
    <entry name="volsize">25m</entry>
  </dict>

</iterator>

<!-- Set up the change list I want to apply -->

<change name="test_change_1" module='modipy.netapp' type="ZAPIChange">
  <target>wibble</target>

  <impl>
    <command>
      <send>uptime</send>
    </command>
  </impl>

</change>

<change name="test_change_2" module='modipy.netapp' type="ZAPIChange">

  <target>wibble</target>

  <impl>
    <zapicommand>
      <system-get-info/>
    </zapicommand>
  </impl>

</change>

<change name="test_change_3" module='modipy.netapp' type="ZAPIChange">
  <depends on="test_change_2"/>
  <target>wibble</target>

  <impl>
    <zapicommand>
      <vfiler-list-info/>
    </zapicommand>

    <condition>results.tree.xpath("/netapp/results/vfilers/vfiler-info/name = 'vf_jpw'") == True</condition>

  </impl>

</change>

</config>