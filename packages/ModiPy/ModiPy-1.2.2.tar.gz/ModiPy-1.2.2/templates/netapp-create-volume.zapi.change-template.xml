<!-- 
     This change template can be used to create volumes on a NetApp filer.
     It expects an iterator called 'netapp_volume_iter' to be defined,
     which can be used to create multiple volumes.
-->

<changetemplate name="create_netapp_volume"
  module='modipy.netapp' type="ZAPIChange">

  <preimpl>
    <zapicommand>
      <volume-list-info>
	<volume>%(volname)s</volume>
      </volume-list-info>
    </zapicommand>

    <condition>results.errno == 13040</condition>

  </preimpl>

  <impl>

    <zapicommand>
      <volume-create>
	<volume>%(volname)s</volume>
	<containing-aggr-name>%(volaggr)s</containing-aggr-name>
	<size>%(volsize)s</size>
	<space-reserve>none</space-reserve>
      </volume-create>
    </zapicommand>
  </impl>

  <backout>
    <zapicommand>
      <volume-offline>
        <name>%(volname)s</name>
      </volume-offline>
    </zapicommand>

    <zapicommand>
      <volume-destroy>
        <name>%(volname)s</name>
      </volume-destroy>
    </zapicommand>
  </backout>

</changetemplate>

