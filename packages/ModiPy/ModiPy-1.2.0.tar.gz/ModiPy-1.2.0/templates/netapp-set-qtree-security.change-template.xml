<!-- 
     Set a qtree's security mode on a NetApp
-->

<changetemplate name="netapp_set_qtree_security" module='modipy.change_command' type="CommandChange">
<!-- Not sure how to check qtree yet
  <preimpl>
    <command>
      <send>vol status %(volname)s</send>
    </command>

    <condition>results.cmdoutput.find("No volume named '%(volname)s' exists.") >= 0</condition>

  </preimpl>
-->

  <impl>
    <command>
      <send>qtree security /vol/%(volname)s/%(qtree_name)s %(qtree_security)s</send>
    </command>

    <!-- Make sure the qtree didn't already exist -->
    <condition>results.cmdoutput.find("Can't find path") == -1</condition>

  </impl>

</changetemplate>

