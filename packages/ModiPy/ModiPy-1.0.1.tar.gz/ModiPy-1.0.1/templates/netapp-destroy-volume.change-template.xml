<!-- 
     Destroy a volume on a NetApp. Dangerous.
-->

<changetemplate name="netapp_destroy_volume" module='modipy.change_command' type="CommandChange">

<!--
  <preimpl>
    <command>
      <send>vol status %(volname)s</send>
    </command>

    <condition>results.cmdoutput.find("No volume named '%(volname)s' exists.") >= 0</condition>

  </preimpl>
-->
  <impl>
    <command>
      <send>vol offline %(volname)s</send>
    </command>

    <command>
      <expect>Volume '%(volname)s' has been set temporarily offline</expect>
      <send>vol destroy %(volname)s -f</send>
    </command>

    <condition>results.cmdoutput.find("Volume '%(volname)s' destroyed") >= 0</condition>

  </impl>

</changetemplate>

