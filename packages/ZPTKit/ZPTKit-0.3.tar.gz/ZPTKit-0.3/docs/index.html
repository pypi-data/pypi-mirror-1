<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.3.8: http://docutils.sourceforge.net/" />
<title>ZPTKit 0.3</title>
<link rel="stylesheet" href="default.css" type="text/css" />
</head>
<body>
<div class="document" id="zptkit-0-3">
<h1 class="title">ZPTKit 0.3</h1>
<div class="contents topic" id="contents">
<p class="topic-title first"><a name="contents">Contents</a></p>
<ul class="simple">
<li><a class="reference" href="#downloads-and-websites" id="id5" name="id5">Downloads and Websites</a></li>
<li><a class="reference" href="#license-and-prerequesites" id="id6" name="id6">License and Prerequesites</a></li>
<li><a class="reference" href="#status-news" id="id7" name="id7">Status &amp; News</a><ul>
<li><a class="reference" href="#changes-in-zptkit-0-3" id="id8" name="id8">Changes in ZPTKit 0.3</a></li>
<li><a class="reference" href="#changes-in-zptkit-0-2" id="id9" name="id9">Changes in ZPTKit 0.2</a></li>
</ul>
</li>
<li><a class="reference" href="#features" id="id10" name="id10">Features</a></li>
<li><a class="reference" href="#to-do" id="id11" name="id11">To-Do</a></li>
<li><a class="reference" href="#using-zptkit" id="id12" name="id12">Using ZPTKit</a></li>
<li><a class="reference" href="#templates" id="id13" name="id13">Templates</a></li>
<li><a class="reference" href="#providing-template-with-eggs" id="id14" name="id14">Providing Template With Eggs</a></li>
<li><a class="reference" href="#resourcecomponent" id="id15" name="id15">ResourceComponent</a></li>
</ul>
</div>
<p>ZPTKit is copyright 2005 <a class="reference" href="http://imagescape.com">Imaginary Landscape, LLC</a>.</p>
<div class="section" id="downloads-and-websites">
<h1><a name="downloads-and-websites">Downloads and Websites</a></h1>
<ul class="simple">
<li>Homepage: <a class="reference" href="http://imagescape.com/software/ZPTKit/">http://imagescape.com/software/ZPTKit/</a></li>
<li>Download: <a class="reference" href="http://imagescape.com/software/ZPTKit/ZPTKit-0.2.tar.gz">http://imagescape.com/software/ZPTKit/ZPTKit-0.2.tar.gz</a></li>
<li>Source repository: <a class="reference" href="http://svn.webwareforpython.org/ZPTKit/trunk">http://svn.webwareforpython.org/ZPTKit/trunk</a></li>
<li>Discussion: <a class="reference" href="http://lists.sourceforge.net/lists/listinfo/webware-discuss">webware-discuss&#64;lists.sourceforge.net</a></li>
</ul>
<p>The repository is a <a class="reference" href="http://subversion.tigris.org/">Subversion</a> repository.  To check out a copy:</p>
<pre class="literal-block">
$ svn co http://svn.webwareforpython.org/ZPTKit/trunk ZPTKit
</pre>
</div>
<div class="section" id="license-and-prerequesites">
<h1><a name="license-and-prerequesites">License and Prerequesites</a></h1>
<p>ZPTKit is licensed under an <a class="reference" href="http://www.opensource.org/licenses/mit-license.php">MIT-style license</a>.  This gives you
permission to most anything you want with ZPTKit.</p>
<p>ZPTKit is a toolkit for <a class="reference" href="http://webwareforpython.org">Webware For Python</a>.  It builds upon several
other pieces of code:</p>
<ul class="simple">
<li><a class="reference" href="http://webwareforpython.org">Webware</a>.  This should be compatible at least to 0.8.1 and probably
earlier.  This is also compatible with <a class="reference" href="http://pythonpaste.org">Paste</a> (both <tt class="docutils literal"><span class="pre">paste.webkit</span></tt> and
<tt class="docutils literal"><span class="pre">paste.wareweb</span></tt>).</li>
<li><a class="reference" href="http://www.zope.org/DevHome/Wikis/DevSite/Projects/ZPT/FrontPage">Zope Page Templates</a>.  Right now there's several implementations
of ZPT That have been either reimplemented from the spec or split
from Zope.  ZPTKit uses the package from <a class="reference" href="http://zpt.sourceforge.net/">http://zpt.sourceforge.net/</a>
-- in the future it may move to a package derived from the Zope 3
tree.</li>
<li><a class="reference" href="http://svn.webwareforpython.org/Component">Component</a>.  This is a subclass of <tt class="docutils literal"><span class="pre">WebKit.Page</span></tt>, and adds extra
features for integrating new features into your servlet (like a
template manager).  You must subclass your servlets from
<tt class="docutils literal"><span class="pre">Component.CPage</span></tt> to use ZPTKit.</li>
</ul>
</div>
<div class="section" id="status-news">
<h1><a name="status-news">Status &amp; News</a></h1>
<p>ZPTKit is used in production environments, but has not had a wide base
of users.  As such, it should probably be considered beta quality --
while in a certain use case it performs well, it's likely that new
users will provide new use cases.</p>
<p>Also, ZPTKit builds on Component, and Component is still at a beta
quality.  By the <a class="reference" href="http://c2.com/cgi/wiki?StableDependenciesPrinciple">Stable Dependencies Principle</a>, ZPTKit can not be
more stable than Component.</p>
<div class="section" id="changes-in-zptkit-0-3">
<h2><a name="changes-in-zptkit-0-3">Changes in ZPTKit 0.3</a></h2>
<ul class="simple">
<li>Improve support for templates in subdirectories of the search path</li>
<li>Removed special handling of RFC-822 headers in emails; now only the
markup form of headers is allowed</li>
<li>Improved rendering of tables with htmlrender</li>
<li>Make more compatible with setuptools (setuptools is not required)</li>
<li>Added <a class="reference" href="http://pythonpaste.org/script/">Paste Script</a> package 
template</li>
<li>Added <tt class="docutils literal"><span class="pre">.renderTemplate()</span></tt> method, that does normal rendering
but returning the result instead of writing it to the output stream</li>
<li>Added <tt class="docutils literal"><span class="pre">add_template_path()</span></tt> method to servlet, which allows 
per-request addition of items to the path</li>
<li>Added <tt class="docutils literal"><span class="pre">egg/PackageName/template_name.pt</span></tt>, which allows you to load
templates out of other packages (based on <a class="reference" href="http://peak.telecommunity.com/DevCenter/PythonEggs">Eggs</a>)</li>
</ul>
</div>
<div class="section" id="changes-in-zptkit-0-2">
<h2><a name="changes-in-zptkit-0-2">Changes in ZPTKit 0.2</a></h2>
<p>(Note: no public APIs were changed.)</p>
<ul class="simple">
<li>Fixed problem where macro templates were not being cached.</li>
<li>Caches all templates more aggressively.  These two fixes should have 
a considerable impact on performance.</li>
<li>Cleanup and simplification.</li>
<li>Distutils-based distribution.</li>
<li>Some small improvements to the HTML-&gt;text renderer.</li>
</ul>
</div>
</div>
<div class="section" id="features">
<h1><a name="features">Features</a></h1>
<ul class="simple">
<li>Compiles templates as needed.</li>
<li>Caches and pools compiled templates.</li>
<li>Can find templates in several directories (typically used so that
you can shadow individual templates to change the look of an
application).</li>
<li>Send emails from ZPT templates, including a text form of an email.
Conversion to text is done after the template is rendered, and does
word wrapping on the rendered form.</li>
<li>Serves static files from several directories (so that static files
like CSS can be put alongside templates, and also shadowed).</li>
<li>Shows exceptions with extended ZPT information.</li>
<li>Model-View-Controller style (where the ZPT template is the view).</li>
</ul>
</div>
<div class="section" id="to-do">
<h1><a name="to-do">To-Do</a></h1>
<ul class="simple">
<li>Better configuration, for sending ZPT-based emails outside of a
servlet or web request (e.g., from TaskKit based on a schedule).</li>
<li>There's always improvements to be made in the HTML-&gt;text converter.</li>
<li><tt class="docutils literal"><span class="pre">If-Modified-Since</span></tt> support in ResourceComponent (though this
file might simply go away at some point).</li>
</ul>
</div>
<div class="section" id="using-zptkit">
<h1><a name="using-zptkit">Using ZPTKit</a></h1>
<p>First, make sure you are subclassing from <tt class="docutils literal"><span class="pre">Component.CPage</span></tt>;
typically you change your <tt class="docutils literal"><span class="pre">SitePage</span></tt>:</p>
<pre class="literal-block">
from Component import CPage
from ZPTKit import ZPTComponent

class SitePage(CPage):
    components = [ZPTComponent(zpt_paths)]
    def writeHTML(self):
        self.writeTemplate()
    # Needed for Webware 0.8.1 and earlier:
    def handleAction(self, action):
        CPage.handleAction(self, action)
        self.defaultAction()
</pre>
<p><tt class="docutils literal"><span class="pre">CPage</span></tt> is compatible with <tt class="docutils literal"><span class="pre">WebKit.Page</span></tt>.  You must fill in
<tt class="docutils literal"><span class="pre">zpt_paths</span></tt> on your own, using whatever configuration mechanism you
choose.  This can be a single path (where all templates are found) or
a list of paths; if a list, then the paths will be searched in order
for each template.</p>
<p>Your template will now have several new methods and attributes:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">writeTemplate()</span></tt>:</dt>
<dd>Renders and writes the template that you've set with <tt class="docutils literal"><span class="pre">setView</span></tt>,
and writes it to the response.</dd>
<dt><tt class="docutils literal"><span class="pre">template(filename)</span></tt>:</dt>
<dd>Retrieve the named template.  You can render it by calling it.</dd>
<dt><tt class="docutils literal"><span class="pre">sendMail(filename,</span> <span class="pre">to_address,</span> <span class="pre">from_address,</span> <span class="pre">**options)</span></tt>:</dt>
<dd>Send an email with the given to and from address, and <tt class="docutils literal"><span class="pre">options</span></tt>.</dd>
<dt><tt class="docutils literal"><span class="pre">options</span></tt>:</dt>
<dd>A dictionary of <tt class="docutils literal"><span class="pre">options</span></tt>.  You can also set and get values from
this custom dictionary with attributes.  The values will be made
available in your template under <tt class="docutils literal"><span class="pre">options/attribute_name</span></tt>.  In
Zope you typically pass values into a template as keyword
arguments, and they show up as <tt class="docutils literal"><span class="pre">options</span></tt>; this way top-level
attributes remain fairly fixed.  This is empty until you add
values to it.</dd>
<dt><tt class="docutils literal"><span class="pre">context</span></tt>:</dt>
<dd>Another custom dictionary, which has all the values available to
the template, including <tt class="docutils literal"><span class="pre">options</span></tt>.  This also includes
<tt class="docutils literal"><span class="pre">request</span></tt>, a dictionary-like object that holds values from the
request, <tt class="docutils literal"><span class="pre">test(cond,</span> <span class="pre">if_true,</span> <span class="pre">if_false=None)</span></tt> for inline
conditionals, and <tt class="docutils literal"><span class="pre">here</span></tt>, which represents the current directory
(for use when calling macros in a template).</dd>
</dl>
<p><tt class="docutils literal"><span class="pre">CPage</span></tt> adds the concept of &quot;view&quot;, which ZPTKit interprets as the
name of a template (by default <tt class="docutils literal"><span class="pre">CPage</span></tt> interprets it as the name of
a servlet method).  This way you can have multiple templates for a
single servlet, with each template as a view.  E.g.:</p>
<pre class="literal-block">
class Register(SitePage):
    def actions(self):
        return ['save']
    def save(self):
        ... process form ...
        if successful:
            self.setView('RegisterSuccessful.pt')
</pre>
<p>By default the view matches the servlet's name, so <tt class="docutils literal"><span class="pre">Register.pt</span></tt> is
called.  In this case if the form is successfully submitted we instead
use <tt class="docutils literal"><span class="pre">RegisterSuccessful.pt</span></tt>.</p>
</div>
<div class="section" id="templates">
<h1><a name="templates">Templates</a></h1>
<p>ZPTKit templates are normal Zope Page Templates.  In most cases they
will look very similar.  You can use macros as normal, for instance.</p>
<p>One difference is that there is no <tt class="docutils literal"><span class="pre">container</span></tt> variable.  You can
use <tt class="docutils literal"><span class="pre">here</span></tt> to refer to other templates (like
<tt class="docutils literal"><span class="pre">here/standard_template.pt</span></tt>), but only to templates (in Zope you can
access scripts and functions the same way).</p>
<p>Instead the variable <tt class="docutils literal"><span class="pre">servlet</span></tt> is added, which is a reference to the
calling servlet.  So if you have a complicated callback, you can refer
to <tt class="docutils literal"><span class="pre">python:</span> <span class="pre">servlet.method(arg1,</span> <span class="pre">...)</span></tt> and the value will be
substituted in (be sure to use <tt class="docutils literal"><span class="pre">structure</span></tt> if that value includes
markup).</p>
</div>
<div class="section" id="providing-template-with-eggs">
<h1><a name="providing-template-with-eggs">Providing Template With Eggs</a></h1>
<p>You must add something like to your <tt class="docutils literal"><span class="pre">setup.py</span></tt> file:</p>
<pre class="literal-block">
setup(....
    entry_points=&quot;&quot;&quot;
    [zptkit.template_dir]
    main = mypackage.templates:template_location
    &quot;&quot;&quot;, ...)
</pre>
<p>Then in <tt class="docutils literal"><span class="pre">mypackage/templates.py</span></tt> put something like:</p>
<pre class="literal-block">
template_location = 'mypackage/templates/'
</pre>
<p>Then when someone tries to load <tt class="docutils literal"><span class="pre">egg/MyPackage/foo.pt</span></tt> it will look
in <tt class="docutils literal"><span class="pre">mypackage/templates/foo.pt</span></tt>.  Also <tt class="docutils literal"><span class="pre">egg/MyPackage/main/foo.pt</span></tt>
will work (using the name you used in <tt class="docutils literal"><span class="pre">entry_points</span></tt>) -- <tt class="docutils literal"><span class="pre">main</span></tt> is
the default.</p>
</div>
<div class="section" id="resourcecomponent">
<h1><a name="resourcecomponent">ResourceComponent</a></h1>
<p><tt class="docutils literal"><span class="pre">ResourceComponent</span></tt> is also provided to allow static files (like CSS
or images) to go alongside templates.  You must turn <tt class="docutils literal"><span class="pre">ExtraPathInfo</span></tt>
on in <tt class="docutils literal"><span class="pre">Application.config</span></tt>, and add a component <em>just</em> to your
<tt class="docutils literal"><span class="pre">index.py</span></tt> (or <tt class="docutils literal"><span class="pre">Main.py</span></tt>) servlet:</p>
<pre class="literal-block">
from ZPTKit.resourcecomponent import ResourceComponent

class index(SitePage):
    components = SitePage.components + [
        ResourceComponent(zpt_paths)]
</pre>
<p>Then <tt class="docutils literal"><span class="pre">zpt_paths</span></tt> will be searched for files if no servlet is found
by a given name (and it will produce 404s if no file is found either).
The normal processing of the <tt class="docutils literal"><span class="pre">index</span></tt> servlet will be aborted in
either case, so long as there is any <tt class="docutils literal"><span class="pre">request.extraURLPath()</span></tt>.</p>
</div>
</div>
</body>
</html>
