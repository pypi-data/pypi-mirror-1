<?xml version="1.0" encoding="utf-8"?> 
<rss version="2.0" 
     xmlns:tal="http://xml.zope.org/namespaces/tal"
     xmlns:metal="http://xml.zope.org/namespaces/metal"  
     xmlns:content="http://purl.org/rss/1.0/modules/content/"
     xmlns:itunes="http://www.itunes.com/dtds/podcast-1.0.dtd"
     xmlns:media="http://search.yahoo.com/mrss/"
     xmlns:cc="http://web.resource.org/cc/"

     tal:define="results view/getRSSObjects;"
>
<tal:x define="dummy python:request.RESPONSE.setHeader('Content-Type', 'text/xml');" />
    <channel tal:define="author python:here.getObjectCreator(here.Creator());
                         author_email python:author and author.getProperty('email','') or '';
                         author_fullname python:author and author.getProperty('fullname','') or here.Creator();
                         		syInfo python: here.getSynProp();
			             channel_logo python:here.absolute_url() + '/logo02.gif';
                         ">
	
        <title tal:define="portal_title here/portal_properties/title;
            here_title here/title_or_id;
            template_title template/title_or_id;"
		tal:condition="python: author_fullname!='Plumi'"
            tal:content="string:$author_fullname's $portal_title Channel">Title of page</title>
	<title tal:define="portal_title here/portal_properties/title;
            here_title here/title_or_id;
            template_title template/title_or_id;"
		tal:condition="python: author_fullname=='Plumi'"
            tal:content="string:$author_fullname $here_title Channel">Title of page</title>

        <link tal:content="here/absolute_url"></link>
        <description tal:content="here/Description"></description>
        <language>en-us</language>
        <generator>Plone + Plumi (www.plumi.org)</generator>
        <managingEditor tal:condition="author_email" 
                tal:content="author_email"></managingEditor>

        <image> 
		<url tal:content="channel_logo"></url> 
		<title>Plumi Logo</title> 
		<link tal:content="here/absolute_url"></link>
	</image>

	<copyright>Copyright 2007</copyright>
        <ttl>240</ttl>
   	<itunes:author tal:condition="author_fullname" tal:content="author_fullname"></itunes:author>
        <itunes:owner tal:condition="author">
           <itunes:name tal:condition="author_fullname" tal:content="author_fullname"></itunes:name>
           <itunes:email tal:condition="author_email" tal:content="author_email"></itunes:email>
        </itunes:owner>
        <itunes:image href="" 
                      tal:attributes="href channel_logo"  />
        <itunes:summary tal:condition="here/Description|nothing" tal:content="here/Description"></itunes:summary>

        <tal:block repeat="res results">
            <tal:block condition="python: res.isPublishableATEngageVideoObj is not None">

            <tal:block define="macros nocall: python:here.getItemMacros(res.portal_type); 
                               item_url res/isPublishableATEngageVideoObj/item_url;
			                   item_link python:item_url+'/view';
  			                   "
                               >
                  <item>
                       <title tal:content="res/isPublishableATEngageVideoObj/item_title"></title>
                       <link tal:content="item_link"></link>
                       <description tal:content="res/Description">
                       </description>
			<itunes:summary tal:condition="res/Description|nothing" tal:content="res/Description"></itunes:summary>

                       <author tal:condition="res/isPublishableATEngageVideoObj/item_creator_email"
                               tal:content="res/isPublishableATEngageVideoObj/item_creator_email"></author>
                            <tal:repeat repeat="subj res/isPublishableATEngageVideoObj/subject">
                                    <category tal:content="subj">
                                    </category>
                            </tal:repeat>
                       <pubDate tal:content="res/isPublishableATEngageVideoObj/item_rfc822_datetime"> </pubDate>
                       <metal:block use-macro="macros"/>
                   </item>

            </tal:block>
            </tal:block>
	</tal:block>
        <tal:block repeat="res results">

	    <tal:block condition="python: res.isPublishableATEngageVideoObj is None">

            <tal:block define="macros nocall: python:here.getItemMacros(res.portal_type); 
			       res_item res/getObject|nocall:brain;	
                               item_link python:res_item.absolute_url();
			       item_creator python:here.portal_membership.getMemberById(res_item.Creator());"
                               >
                  <item>
                       <title tal:content="res/Title"></title>
                       <link tal:content="item_link"></link>
                       <description tal:content="res/Description">
                       </description>
			<itunes:summary tal:condition="res/Description|nothing" tal:content="res/Description"></itunes:summary>

                       <author tal:condition="item_creator"
                               tal:content="python:item_creator.getProperty('email','')"></author>

                            <tal:repeat repeat="subj res_item/Subject">
                                    <category tal:content="subj">
                                    </category>
                            </tal:repeat>
                       <pubDate tal:content="python: res_item.modified().HTML4()"> </pubDate>
                       <metal:block use-macro="macros"/>
                   </item>

            </tal:block>
            </tal:block>

        </tal:block>
    </channel>
</rss>

