<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="plone">

  <body>

    <div metal:fill-slot="main">
    <metal:main-macro define-macro="main">

    <tal:block define="userinfo view/getUserInfo;
                       portal_types portal/portal_types;">

      <h1 tal:content="string: ${userinfo/login}'s Profile" />

      <div style="width: 95%">
      <!-- page left container -->
      <div style="float:left; width: 70%; min-width: 26em">

        <!-- portrait + text -->
        <div style="float: left">

          <!-- portrait -->
          <div style="float: left; padding-right: 10px;">
            <!-- if they have a portrait -->
            <span tal:condition="userinfo/portraiturl">
              <img tal:attributes="src userinfo/portraiturl" />
            </span>
            <!-- if they don't have a portrait -->
            <!-- but they can add one -->
            <span tal:condition="python: not userinfo['portraiturl'] and userinfo['editpermission']">
              <a tal:attributes="href userinfo/prefsurl">
                <img tal:attributes="src string:defaultUser-edit.gif">
              </a>
            </span>
            <!-- can't add one -->
            <span tal:condition="python: not userinfo['portraiturl'] and not userinfo['editpermission']">
              <img tal:attributes="src string:defaultUser.gif">
            </span>
          </div> <!-- end portrait -->

          <!-- text -->
          <div style="vertical-align: top">
            <div tal:condition="userinfo/fullname" tal:content="userinfo/fullname" style="font-weight: bold"></div>
            <div style="margin-bottom: 1em">
              <span tal:condition="userinfo/location" tal:content="userinfo/location" />
            </div>
            <div tal:condition="not: userinfo/isme">
              <a href="" 
                 tal:attributes="href string:${portal_url}/author/${userinfo/login}">Contact this person.</a>
            </div>

            <!-- projects listing -->
            <div tal:condition="userinfo/projects" style="padding: 5px; margin-top: 20px">
              <div style="font-weight: bold">projects</div>
              <ul>
                <tal:repeat repeat="proj userinfo/projects">
                  <li style="display: inline">
                    <a href="" tal:attributes="href proj/absolute_url"><span tal:replace="python: proj.getFull_name() or proj.getId()" /></a>
                  </li>
                </tal:repeat>
              </ul>
            </div> <!-- end projects listing -->
          </div> <!-- end text -->

        </div> <!-- end portrait + text -->

        <!-- wiki -->
        <div style="padding: 5px; margin-top: 20px; float: left">

          <!-- edit link -->
          <div style="border-top: thin solid gray; margin-bottom: 10px">
            <div tal:condition="userinfo/editpermission" style="text-align: right">
              <a href="edit">edit</a>
            </div>
          </div> <!-- end edit link -->

          <div tal:content="structure userinfo/wiki" />

        </div> <!-- end of wiki -->

      </div> <!-- end page left container -->


      <!-- latest content -->
      <!-- TODO only show "pages" and "openprojects" (and just call them "projects") -->
      <div style="width: 25%; float: right; padding-left: 20px; text-align: center; ">
        <tal:authorContent define="author_content python:view.getLatestContent();"
                           condition="author_content">

          <div metal:define-macro="user_content_listing" >

          <h2 i18n:translate="heading_author_content">
            Latest content
          </h2>

            <table class="listing" summary="Lists content written by an author grouped by content type" 
                   i18n:attributes="summary summary_author_content_list;">
              <tal:repeat repeat="content_by_type author_content">
                <tal:grouping define="getTypeInfo nocall:portal_types/getTypeInfo;
                                      content_type_ content_by_type/portal_type;
                                      type_title python: getTypeInfo(content_type_) or None"
                              condition="type_title">
                  <tr>
                    <th colspan="2"
                        i18n:translate=""
                        tal:define="getTypeInfo nocall:portal_types/getTypeInfo;
                                    content_type_ content_by_type/portal_type;
                                    type_title python: getTypeInfo(content_type_) or None"
                        tal:content="python:type_title and type_title.Title() or content_type_ + ' is not available'">
                      Type
                    </th>
                  </tr>
                  <tal:repeat repeat="item content_by_type/content_items">
                    <tr>
                      <td>
                        <a href="" tal:attributes="href item/getURL"
                           tal:content="item/pretty_title_or_id">title</a>
                      </td>
                      <td tal:content="python:here.toLocalizedTime(item.Date)">
                        Date
                      </td>
                    </tr>
                  </tal:repeat>
                </tal:grouping>
              </tal:repeat>
            </table>
          </div>

          <div style="text-align: right">
            <a href=""
               tal:attributes="href string:$here_url/search?Creator=${userinfo/login}&amp;sort_on=Date&amp;sort_order=reverse"
               i18n:translate="go_to_search_author_content">All content...</a>
          </div>

        </tal:authorContent>
      </div> <!-- end latest content -->
      </div>
    </tal:block>

    </metal:main-macro>
    </div> <!-- main metal fill slot -->

  </body>
</html>
