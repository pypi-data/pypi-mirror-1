#!/bin/sh

VERSION=$(dpkg-parsechangelog | grep Version | sed 's,^Version: \(.*\)\-.*$,\1,g')
CURRENT_BRANCH=$(svn info | grep URL | cut -d' ' -f 3)
    
if [ ! -f ../cleverbox_${VERSION}.orig.tar.gz ]; then
    (cd .. ; svn export http://www.clever-age.org/svn/cleverbox/tags/${VERSION} cleverbox-${VERSION} && \
        tar -czf cleverbox_${VERSION}.orig.tar.gz cleverbox-${VERSION} && \
        echo "Created cleverbox_${VERSION}.orig.tar.gz")
fi

cd ..
rm -rf ../cleverbox-${VERSION}
tar -xzf cleverbox_${VERSION}.orig.tar.gz
svn export --force $CURRENT_BRANCH cleverbox-${VERSION}
cd cleverbox-${VERSION}
dpkg-buildpackage -us -uc -rfakeroot