<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <title>Responses and Presentation</title>
  <meta name="generator"
 content="amaya 8.1a, see http://www.w3.org/Amaya/" />
  <link href="styles.css" rel="stylesheet" type="text/css" />
</head>
<body>
<h1>Responses and Presentation</h1>
<p>After performing some kind of
processing on input information, an
application will then want to produce some kind of response to indicate
what
went on. Here are some examples of responses:</p>
<ul>
  <li>Returning the contents of a
requested file.</li>
  <li>Showing a message telling
the user that the requested operation succeeded or failed.</li>
  <li>Presenting a view onto the
application with the results of the recent activity shown in a Web page.</li>
</ul>
<h2>Generating Responses</h2>
<p>The procedure involved in
generating a response usually involves the
following steps:</p>
<ol>
  <li>Setting a response code to
signal whether the application performed the requested operation
successfully.</li>
  <li>Setting a content type and a <a>character encoding</a>.</li>
  <li>Producing content and
sending it to the user.</li>
</ol>
<p>The kind of code involved may
well resemble the following:</p>
<pre>from WebStack.Generic import ContentType<br /><br />class MyResource:<br />    def respond(self, trans):<br />        [Perform the requested operations.]<br /><br />        if [the operation was successful]:<br />            trans.set_response_code(200)<br />            trans.set_content_type(ContentType("text/html", encoding="utf-8"))<br />            out = trans.get_response_stream()<br />            out.write([some data either as a plain string suitably encoded or as Unicode])<br />        else:<br />            trans.set_response_code(500) # or some other code<br />            trans.set_content_type(ContentType("text/html", encoding="utf-8"))<br />            out = trans.get_response_stream()<br />            out.write([some other data either as a plain string suitably encoded or as Unicode])</pre>
<p>As discussed in <a href="encodings.html">"Character Encodings"</a>,
care
must be taken generating the response so that it meets any expectations
that
browsers and other Web clients may have.</p>
<div class="WebStack">
<h3>WebStack API -
Response-Related Methods</h3>
<p>Transaction objects have
various methods that can be used in generating
responses:</p>
<dl>
  <dt><code>set_response_code</code></dt>
  <dd>This accepts an integer
value denoting the response condition as described in the HTTP
specification. If this method is not used, WebStack sets a <code>200</code>
status condition on the response, meaning that the request was
processed successfully.</dd>
  <dt><code>set_content_type</code></dt>
  <dd>This accepts a content type
object (typically <code>WebStack.Generic.ContentType</code>)
which specifies both the media type and the character encoding (if
relevant) of the data sent to the user. The media type describes the
format of the data (eg. <code>text/html</code>
- a Web page), whereas the character encoding describes how any
character information on the page is encoded - see <a
 href="encodings.html">"Character Encodings"</a>
for more information.</dd>
  <dt><code>get_response_stream</code></dt>
  <dd>This returns the output
stream through which data may be sent to the user.</dd>
</dl>
</div>
<h2>Ending the Response Explicitly</h2>
<p>Although it is possible to produce some output and then to let
the&nbsp;<code>respond</code> function complete normally, sometimes it
is appropriate to terminate the response and to hand control straight
back to the server environment; in other words, to decide that no more
activity will be performed within the application and to send the
response immediately. Whilst just using a&nbsp;<code>return</code>
statement might be adequate in many applications...</p>
<pre>        # In the respond method...<br />        if some_condition:<br />            [Produce a response.]<br />            return<br />        [Produce a different response.]</pre>
<p>...sometimes a resource's&nbsp;<code>respond</code> method is being
called from another resource, and it may be the case that this other
resource may produce additional output if control is returned to it.</p>
<p>To provide a definitive end of response signal, a special exception
is available:</p>
<pre>from WebStack.Generic import EndOfResponse<br /><br />[The usual declarations for the resource and the respond method...]<br /><br />        # In the respond method (possibly called by another resource)...<br />        if some_condition:<br />            [Produce a response.]<br />            raise EndOfResponse</pre>
<p>This exception, when raised, ensures that the response is sent
exactly as the resource intended upon raising the exception. Note that
although <code>WebStack.Generic.EndOfResponse</code> is an exception,
it will not cause an error condition or change the response code in any
way.</p>
<h2>Integrating with Content Generators</h2>
<p>Just as applications might need to integrate with other systems in
order to fetch information or to perform operations on behalf of the
user, the generation of response content can also be made a lot easier
by using external libraries. In the above example code, the process of
obtaining and formatting the actual data to be written out has been
left unspecified, but for anything more complicated than "hello world"
it is usually advisable to consider using templating systems which
combine raw data and templates to produce formatted output that can be
displayed as a Web page (amongst other things).</p>
<p>See&nbsp;<a href="integrating.html">"Integration with Other Systems"</a>
for more information on the principles of using such external libraries.</p>
</body>
</html>
