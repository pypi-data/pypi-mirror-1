<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta content="text/html;charset=ISO-8859-1" http-equiv="Content-Type" />
  <title>Selectors - Components for Dispatching to Resources</title>
  <link href="styles.css" rel="stylesheet" type="text/css" /></head>
<body>
<h1>Selectors - Components for Dispatching to Resources</h1>
<p>The <code>Selectors</code> module provides classes (although
currently only one class is supplied) which act as standard WebStack
resources, but which attempt to "select" other resources, dispatch each
request to those resources, and to cause various side-effects, mostly
on the attributes stored on the transaction object. These "selector"
classes behave those in the <code>ResourceMap</code> module, but aspire to be more generally applicable.</p><h2>Selecting Path Roots with PathSelector</h2><p>In
non-trivial applications, it is often desirable to know the path or URL
to a particular resource, especially the "root" resource under which
the application or one of its components may reside. The <code>PathSelector</code>
class can be instantiated and be made to refer to a resource, recording
such path or URL details in an attribute for later inspection.</p><div class="WebStack">
<h3>WebStack API - The PathSelector Class</h3>

<p>The <code>PathSelector</code>
class (found in the
<code>WebStack.Resources.Selectors</code> module) wraps resource
objects whose location (as indicated by a path or URL) should be
recorded as an attribute on the current transaction. The most common
use of the class is to record the "root" resource's location,
and this would be done as follows:</p><pre>def get_site_map():<br />    return PathSelector(MyResource())</pre><p>Here, the <code>get_site_map</code>
function (as described in the <a href="deploying.html">"Deploying a WebStack Application"</a> document) would provide a <code>PathSelector</code> object instead of an instance of the <code>MyResource</code> class. However, the side-effect of combining these two resources would be the availability of an attribute named <code>root</code> on the transaction object. Thus, the "root" <code>MyResource</code>
object and, indeed, all resource objects visited after this side-effect
has occurred will have access to the "root" path or URL information.</p><h4>Further Reading</h4><p>The <a href="../apidocs/public/WebStack.Resources.Selectors.PathSelector-class.html">API documentation</a> for the <code>PathSelector</code>
class provides additional information.</p></div><h2>Defining Encodings using EncodingSelector</h2><p>One
frequently bothersome aspect of writing Web applications involves the
processing and production of text in different encodings. Whilst the
WebStack API lets applications explicitly state the character encoding
for various operations, one often wants to be able to ignore such
details since they start to clutter up application code. The <code>EncodingSelector</code> class offers a basic solution which is compatible with the mechanisms in transaction objects: by wrapping WebStack resources with instances of <code>EncodingSelector</code>,
an application-wide default encoding (or character set) will be
defined; this will result in request information being processed
according to the stated encoding and response information being
produced according to that encoding (see below for more details of the
latter activity).</p><div class="WebStack">
<h3>WebStack API - The EncodingSelector Class</h3>

<p>The <code>EncodingSelector</code>
class (found in the
<code>WebStack.Resources.Selectors</code> module) wraps resource
objects whilst changing the default encoding of the current transaction object. The class can be applied like this:</p><pre>def get_site_map():<br />    return EncodingSelector(MyResource(), "utf-8")</pre><p>Here, the <code>get_site_map</code>
function (as described in the <a href="deploying.html">"Deploying a WebStack Application"</a> document) would provide a <code>EncodingSelector</code> object instead of an instance of the <code>MyResource</code> class. However, the <code>EncodingSelector</code> will forward requests on to <code>MyResource</code> (since it "selects" that resource), whilst setting the default encoding to be <code>"utf-8"</code>.</p><h4>Request Streams and Encodings</h4><p>Although a default encoding affects the processing of request parameters, direct access to the request stream using the <code>get_request_stream</code>
method will only produce plain strings. This behaviour is justified by
the observation that, if conversion from an encoding to Unicode were to
take place, the resulting character values may be unsuitable
substitutes for the original byte values in applications intending to
make use of the raw incoming (possibly binary) data. A recipe for
making a Unicode stream is provided in the <a href="encodings.html">"Character Encodings"</a> document.</p><h4>Response Encodings and Content Types</h4><p>Although <code>EncodingSelector</code> sets
a default encoding, responses will generally be written in that
encoding, at least if textual data is written to the response stream as
Unicode objects. However, the content type must typically be set either
to match the encoding in use or to not specify an encoding. It may
become necessary to find out what the response stream encoding is when
creating a <code>ContentType</code> object. For this and other purposes, the <code>get_response_stream_encoding</code> method is available on the transaction object<code></code>:</p><pre>from WebStack.Generic import ContentType<br /><br />def respond(self, trans):<br /><br />    # Some code...<br /><br />    trans.set_content_type(ContentType("text/html", trans.get_response_stream_encoding()))<br />    out = trans.get_response_stream()<br />    out.write(some_unicode_object)</pre><p>However, it is completely acceptable to omit the encoding information where a default encoding has been set:</p><pre>    trans.set_content_type(ContentType("text/html")) # no encoding/charset specified<br /></pre><h4>Reading the Default Directly</h4><p>For
some activities, such as making a Unicode stream from the request
stream, it is desirable to find out the encoding set by the selector.
This information is made available on transaction objects as the <code>default_charset</code> attribute.</p><h4>Further Reading</h4><p>The <a href="../apidocs/public/WebStack.Resources.Selectors.EncodingSelector-class.html">API documentation</a> for the <code>EncodingSelector</code>
class provides additional information, along with the <a href="responses.html">"Responses and Presentation"</a> document.</p></div><p></p><br /></body></html>
