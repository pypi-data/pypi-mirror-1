<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US"
      lang="en-US"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="eXtremeManagement">

  <body>
    <div metal:fill-slot="main">
      <div metal:define-macro="body"
           tal:define="view context/@@project;
                       main view/main;
                       finished_iterations view/finished_iterations;
                       current_iterations view/current_iterations;
                       open_iterations view/open_iterations;">

        <div tal:condition="context/@@chart/has_data">
            <img tal:attributes="src context/@@chart/velocity_chart"
                 alt="velocity chart"
                 i18n:attributes="alt" />
        </div>

        <p class="documentDescription">
          <metal:field use-macro="python:here.widget('description', mode='view')">
            Description
          </metal:field>
        </p>

        <p class="documentDescription"
           tal:condition="context/getBudgetHours">
          <span i18n:translate="label_budgetHours">Budget (hours)</span>:
          <metal:field use-macro="python:here.widget('budgetHours', mode='view')">
            Budget Hours
          </metal:field>
        </p>

        <tal:block tal:condition="view/offers">
        <ul class="offers_listing">
           <li tal:repeat="offer view/offers">
             <a tal:attributes="href offer/url">
               <img tal:replace="structure offer/icon"/>
               <span tal:replace="offer/title">My Offer</span></a></li>
        </ul>
        </tal:block>

        <tal:block tal:condition="current_iterations">
          <h1 i18n:translate="heading_current_iterations">Current Iterations</h1>
          <div class="iterations"
               tal:repeat="curIteration current_iterations">
            <tal:block tal:define="obj curIteration/brain/getObject;">
              <tal:stories
                  tal:define="iteration_view obj/@@iteration;
                              iteration_object nocall:obj;
                              iteration_dict iteration_view/main;
                              realstories iteration_view/stories;
                              iteration_number repeat/curIteration/number;
                              show_task_count python:True;
                              show_progress python:True;
                              show_totals python:False;
                              show_iteration python:True">
                <div tal:replace="structure provider:xm.storylist.simple" />

              </tal:stories>
            </tal:block>
          </div>
        </tal:block>

        <dl id="open_iterations"
            class="collapsible inline collapsedOnLoad"
            tal:condition="open_iterations">
          <dt i18n:translate="heading_open_iterations"
              class="collapsibleHeader">
          Open Iterations</dt>

          <dd class="iterations collapsibleContent"
              tal:repeat="iteration open_iterations">

            <metal:block
                use-macro="context/project_view/macros/simple_iteration_list" />

          </dd>
        </dl>

        <br />
        <br />

        <dl id="finished_iterations"
            class="collapsible inline collapsedOnLoad"
            tal:condition="finished_iterations">
          <dt i18n:translate="heading_finished_iterations"
              class="collapsibleHeader">
          Finished Iterations</dt>

          <dd class="iterations collapsibleContent"
              tal:repeat="iteration finished_iterations">

            <metal:block metal:define-macro="simple_iteration_list">

              <table class="listing"
                     width="100%"
                     cellpadding="0"
                     cellspacing="0"
                     style="font-size:100%">

                <tr>
                  <th width="60%"
                      height="30"
                      align="left"
                      class="header_iteration">
                    <a  class="header_iteration_project_overview"
                        tal:attributes="href iteration/url">

                      <img tal:attributes="src string:${here/portal_url}/${iteration/icon}"
                           alt="project overview"
                           i18n:attributes="alt project_overview"/>
                      <span tal:replace="iteration/title" />
                    </a>
                  </th>
                  <th width="20%"
                      height="30"
                      align="left"
                      class="header_iteration">
                    <span tal:replace="iteration/man_hours" /> <span i18n:translate="hours">hours</span>
                    ( <span tal:replace="iteration/actual" /> <span i18n:translate="actual">actual</span>)
                  </th>
                  <th width="20%"
                      class="iteration-state">
                    <span i18n:translate="status">status</span>:
                    <span tal:content="structure iteration/review_state"/>
                    <img tal:attributes="src string:${iteration/review_state}.gif;
                                         alt iteration/review_state" />
                  </th>
                </tr>
              </table>

            </metal:block>
          </dd>
        </dl>

        <br />
        <br />

        <dl id="non_iterations"
            class="collapsible inline"
            tal:condition="view/attachments">
          <dt i18n:translate="heading_attachments"
              class="collapsibleHeader">
          Attachments</dt>
          <dd tal:attributes="class python:'visualIcon contenttype-' + ni.portal_type.lower() + ' collapsibleContent';"
              tal:repeat="ni view/attachments">
            <div class="visualIconPadding">
              <a tal:attributes="href ni/id;"
                 tal:content="ni/Title"/>
            </div>
          </dd>
        </dl>

      </div>

      <metal:block metal:define-macro="folderlisting" />
    </div>
  </body>
</html>
