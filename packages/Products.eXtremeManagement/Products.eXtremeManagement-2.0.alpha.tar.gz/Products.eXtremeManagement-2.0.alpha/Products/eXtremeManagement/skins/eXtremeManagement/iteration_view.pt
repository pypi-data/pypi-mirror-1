<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US"
      lang="en-US"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="eXtremeManagement">

  <body>

    <div metal:fill-slot="main">
      <div metal:define-macro="body"
           tal:define="view context/@@iteration;
                       iteration view/main;
                       stories view/stories;">

        <div class="xm-details">
          <dl class="not-startable"
              tal:condition="not:context/startable"
              tal:define="stories_not_startable view/story_titles_not_startable">
            <dt i18n:translate="cannot_activate">Cannot Activate</dt>
            <dd tal:condition="stories_not_startable">There are stories which cannot be activated, please see: <span tal:replace="stories_not_startable"></span>.</dd>
          </dl>

          <table class="listing"
                 width="100%"
                 cellpadding="0"
                 cellspacing="0">
            <tr>
              <th class="customer_info_header"
                  i18n:translate="listingheader_man_uren">Man hours</th>
              <td>
                <tal:manhours tal:condition="iteration/man_hours">
                  <span tal:replace="iteration/man_hours" />
                  <span tal:define="hours_per_day portal/portal_properties/xm_properties/hours_per_day"
                        tal:replace="python: '(%s days)' % str(iteration['man_hours']/hours_per_day)" />
                </tal:manhours>
                <span tal:condition="not:iteration/man_hours"
                      i18n:translate="man_hours_empty">N/A</span>
              </td>
            </tr>
            <tr>
              <th class="customer_info_header"
                  i18n:translate="listingheader_startdate">Start date</th>
              <td tal:content="python:here.toLocalizedTime(here.startDate,long_format=0)" />
            </tr>
            <tr>
              <th class="customer_info_header"
                  i18n:translate="listingheader_enddate">End date</th>
              <td tal:content="python:here.toLocalizedTime(here.endDate,long_format=0)" />
            </tr>

          </table>

          <div class="visualClear"><!-- --></div>
        </div>

        <p class="documentDescription">
          <metal:field use-macro="python:here.widget('description', mode='view')">
            Description
          </metal:field>
        </p>


        <div id="break-before-stories" class="visualClear"><!-- --></div>

        <tal:subitems tal:condition="stories"
                      tal:define="show_task_count python:False;
                                  show_progress python:False;
                                  show_totals python:True">
          <h1 i18n:translate="heading-stories">Stories</h1>
          
          <table class="listing"
                 id="story-listing"
                 width="97%"
                 border="1"
                 cellpadding="0"
                 cellspacing="0">
             <tal:block
              tal:define="iteration_dict iteration;
                          iteration_object nocall:context;
                          realstories stories;"
              tal:replace="structure provider:xm.storylist.simple" />
             <tr class="totalOfProject"
                 tal:condition="iteration/budget_left">
                 <th colspan="4"
                    i18n:translate="label_remaining_budget">Remaining budget (hours)</th>
                 <th tal:content="iteration/budget_left" />
              </tr>
          </table>

          <p class="discreet" i18n:translate="help_stories_table">
            The Initial estimate of the story is a rough estimate in
            days.  The Tasks estimate is the total estimate in hours
            for all tasks.  If there is a big difference there could
            be a logical explanation.  You should investigate that to
            be sure.
          </p>


          <tal:membertasks
              tal:define="membertasks context/@@employee_totals/totals;"
              tal:condition="membertasks">
            <h1 i18n:translate="heading-hours-per-employee">
            Hours per employee</h1>
            <table class="listing hours-per-employee"
                   border="1"
                   cellpadding="0"
                   cellspacing="0">

              <tr>
                <th i18n:translate="listingheader_employee">Employee</th>
                <th i18n:translate="listingheader_total_estimate">
                Total Estimate</th>
                <th i18n:translate="listingheader_total_actual">
                Total Actual</th>
                <th i18n:translate="listingheader_total_difference">
                Total Difference</th>
              </tr>

              <tr tal:repeat="info membertasks"
                  tal:attributes="class string:list-in-iteration">
                <tal:member>
                  <td tal:content="info/memberid"
                      class="td-memberid" />
                  <td tal:content="info/estimate" />
                  <td tal:content="info/actual" />
                  <td tal:content="info/difference" />
                </tal:member>
              </tr>
            </table>
          </tal:membertasks>

          <tal:tasks define="show_story python:True;">
            <tal:todo tal:define="info view/todo_tasks;">
              <tal:items tal:condition="info/tasks"
                         tal:define="items info/tasks;
                                     totals info/totals;">
                <h1 i18n:translate="heading-in-progress-tasks">My to-do
                tasks</h1>
                <p i18n:translate="description-overview-my-tasks">
                  Overview of tasks that belong to me.  The totals
                  mentioned are the total time for myself, so they will
                  usually differ from adding the numbers of the column
                  above it.
                </p>
                <tal:block
                    define="realtasks info"
                    replace="structure provider:xm.tasklist.simple" />
              </tal:items>
            </tal:todo>


            <tal:open tal:define="info view/open_tasks;">
              <tal:items tal:condition="info/tasks"
                         tal:define="items info/tasks;
                                     totals info/totals;">
                <h1 i18n:translate="heading-open-tasks">My open tasks</h1>
                <tal:block
                    define="realtasks info"
                    replace="structure provider:xm.tasklist.simple" />
              </tal:items>
            </tal:open>
          </tal:tasks>
        </tal:subitems>

        <p class="discreet"
           tal:condition="python: not stories"
           i18n:translate="no_stories_published">
          No stories published yet!
        </p>
      </div>

      <metal:block metal:define-macro="folderlisting" />
    </div>
  </body>
</html>
