<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US"
      lang="en-US"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="eXtremeManagement">

  <body>
    <div metal:fill-slot="main">
      <div metal:define-macro="body"
           tal:define="view context/@@project;
                       main view/main;
                       finished_iterations view/finished_iterations;
                       current_iterations view/current_iterations;
                       open_iterations view/open_iterations;">

        <div tal:condition="context/@@chart/has_data">
          <img tal:attributes="src context/@@chart/velocity_chart"
               alt="velocity chart"
               i18n:attributes="alt" />
        </div>

        <p class="documentDescription">
          <metal:field use-macro="python:here.widget('description', mode='view')">
            Description
          </metal:field>
        </p>

        <p class="documentDescription"
           tal:condition="context/getBudgetHours">
          <span i18n:translate="label_budgetHours">Budget (hours)</span>:
          <metal:field use-macro="python:here.widget('budgetHours', mode='view')">
            Budget Hours
          </metal:field>
        </p>

        <tal:block tal:condition="view/offers">
          <ul class="offers_listing">
            <li tal:repeat="offer view/offers">
              <a tal:attributes="href offer/url">
                <img tal:replace="structure offer/icon"/>
            <span tal:replace="offer/title">My Offer</span></a></li>
          </ul>
        </tal:block>

        <tal:block tal:condition="current_iterations">
          <h1 i18n:translate="heading_current_iterations">Current Iterations</h1>
          <div class="iterations"
               tal:repeat="curIteration current_iterations">
            <tal:block tal:define="obj curIteration/brain/getObject;">
              <tal:stories
                  tal:define="iteration_view obj/@@iteration;
                              iteration_object nocall:obj;
                              iteration_dict iteration_view/main;
                              realstories iteration_view/stories;
                              iteration_number repeat/curIteration/number;
                              show_task_count python:True;
                              show_progress python:True;
                              show_totals python:False;
                              show_iteration python:True">
                <div tal:replace="structure provider:xm.storylist.simple" />

              </tal:stories>
            </tal:block>
          </div>
        </tal:block>

      </div>

      <metal:block metal:define-macro="folderlisting" />
    </div>
  </body>
</html>
