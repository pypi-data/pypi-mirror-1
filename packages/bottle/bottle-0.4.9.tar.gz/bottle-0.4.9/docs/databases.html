<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd" >
<html>
  <head>
    <title>Databases - Bottle Dokumentation</title>
    <style  type="text/css">
      h1 {border-bottom: 5px solid #ddd;}
      pre {
        background: #eee;
        border: 1px dashed #ddd;
        padding: 0 1em;
        margin: 1em 10em 1em 1em;
      }
      #navigation {
        float: right;
        border: 1px solid #ddd;
        border-width: 0 0 1px 1px;
        background: #fff;
        padding: 1em;
        margin-left: 1em;
      }
    </style>
  </head>
<body>
  <div id='navigation'>
    <h3>Navigation</h3>
    <ul>
      <li><a href='./templates.html'>Templates</a></li>
      <li><a href='./databases.html'>Databases</a></li>
      <li><a href='./routes.html'>Routes</a></li>
      <li><a href='./home.html'>Home</a></li>
    </ul>
  </div>
  <h1>Databases</h1>
  <p>Bottle (>0.4.6) offers a persistent key/value database accessible through the <code>bottle.db</code> module variable. You can use key or attribute syntax to store or fetch any pickle-able object to the database. Both <code>bottle.db.bucket_name.key_name</code> and <code>bottle.db[bucket_name][key_name]</code> will work.</p>


	<p>Missing buckets are created on demand. You don&#8217;t have to check for their existence before using them. Just be sure to use alphanumeric bucket-names.</p>


	<p>The bucket objects behave like mappings (dictionaries), except that only strings are allowed for keys and values must be pickle-able. Printing a bucket object doesnâ€™t print the keys and values, and the items() and values() methods are not supported. Missing keys will raise KeyError as expected.</p>


	<h3>Persistence</h3>


	<p>During a request live-cycle, all changes are cached in thread-local memory. At the end of the request, the changes are saved automatically so the next request will have access to the updated values. Each bucket is stored in a separate file in `bottle.DB_PATH`. Be sure to allow write-access to this path and use bucket names that are allowed in filenames.</p>


	<h3>Race conditions</h3>


	<p>You don&#8217;t have do worry about file corruption but race conditions are still a problem in multi-threaded or forked environments. You can call <code>bottle.db.save()</code> or <code>botle.db.bucket_name.save()</code> to flush the thread-local memory cache to disk, but there is no way to detect database changes made in other threads until these threads call <code>bottle.db.save()</code> or leave the current request cycle.</p>


	<h2>Example</h2>


<pre>
from bottle import route, db
@route('/db/counter')
def db_counter():
    if 'hits' not in db.counter:
        db.counter.hits = 0
    db['counter']['hits'] += 1
    return "Total hits: %d!" % db.counter.hits
</pre>
</body>
