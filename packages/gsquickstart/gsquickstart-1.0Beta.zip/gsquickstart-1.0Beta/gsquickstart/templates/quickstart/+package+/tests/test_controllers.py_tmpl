#if $identity != "none"
import turbogears
from nose import with_setup
#end if
from turbogears import testutil
from ${package}.controllers import Root
import cherrypy

#if $identity != "none"
def teardown_func():
    """Tests for apps using identity need to stop CP/TG after each test to
    stop the VisitManager thread. See http://trac.turbogears.org/turbogears/ticket/1217
    for details.
    """
    turbogears.startup.stopTurboGears()
#end if

cherrypy.root = Root()

def test_method():
    "the index method should return a string called now"
    import types
    result = testutil.call(cherrypy.root.index)
    assert type(result["now"]) == types.StringType
#if $identity != "none"
test_method = with_setup(teardown=teardown_func)(test_method)
#end if

def test_indextitle():
    "The indexpage should have the right title"
    testutil.createRequest("/")
    response = cherrypy.response.body[0].lower() 
    assert "<title>welcome to turbogears</title>" in response
#if $identity != "none"
test_indextitle = with_setup(teardown=teardown_func)(test_indextitle)
#end if

#if $identity != "none"
def test_logintitle():
    "login page should have the right title"
    testutil.createRequest("/login")
    response = cherrypy.response.body[0].lower()
    assert "<title>login</title>" in response
test_logintitle = with_setup(teardown=teardown_func)(test_logintitle)
#end if
