<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      i18n:domain="plone">

<head>
    <title></title>
</head>

<body>

    <!-- Selection Widgets -->

    <metal:define define-macro="edit">

        <metal:use use-macro="field_macro|context/widgets/field/macros/edit">

            <metal:fill fill-slot="widget_body"
                        tal:define="view context/@@typestools;
                                    req_kind python: request.get('kind');
                                    req_source python: request.get('source');
                                    vocab python:view.get_vocabulary_for('area_sources', here, req_kind=req_kind, req_source=req_source, include_current=True);
                                    allowed_sources python:view.get_vocabulary_for('area_sources', here);
                                    vlen python:len(vocab);
                                    selectionview context/@@at_selection_widget;
                                    selection python:selectionview.getSelected(vocab, value);
                                    format python:widget.format">

                    <select tal:attributes="name fieldName;
                                            id fieldName;
                                            class string:sourceorkind">

                        <option tal:repeat="item vocab"
                                tal:attributes="value item;
                                                selected python:item in selection and 'selected' or None"
                                tal:content="python:vocab.getValue(item)"
                                i18n:translate=""
                                />

                    </select>

                <div id="deletedsource">
                    <tal:deletedsource tal:define="source python:req_source or context.getSource()" tal:condition="python: source and source not in vocab">
                    <p tal:content="string: Current source is: ${source}, and it does not belong to this area">
                    </p>
                    </tal:deletedsource>

                    <tal:sourcecantprovide tal:define="source python:req_source or context.getSource()" tal:condition="python: source in vocab and not source in allowed_sources">
                    <p tal:content="string: Current source is: ${source}, and it cannot provide current kind">
                    </p>
                    </tal:sourcecantprovide>
                </div>

            </metal:fill>

        </metal:use>

    </metal:define>


</body>

</html>
