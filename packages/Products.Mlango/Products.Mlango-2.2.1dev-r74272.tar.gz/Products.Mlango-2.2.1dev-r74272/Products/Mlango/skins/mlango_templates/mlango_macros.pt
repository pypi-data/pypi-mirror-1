<!--
 Copyright (C) 2008  Goldmund, Wyldebeast & Wunderliebe

 This program is free software; you can redistribute it and/or modify
 it under the terms of the GNU General Public License as published by
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version.

 This program is distributed in the hope that it will be useful,
 but WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 GNU General Public License for more details.

 You should have received a copy of the GNU General Public License
 along with this program; if not, write to the Free Software
 Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA
-->

<html xmlns="http://www.w3.org/1999/xhtml"
      xml:lang="en"
      lang="en"
      i18n:domain="mlango"
>

  <head>
    <title></title>
  </head>

  <body>

    <!-- Render mlango-dashboard. variable 'active_viewlets' should contain a map -->
    <!-- of active portlets and their position. 'cols' must be defined. -->
    <div metal:define-macro="mlango-dashboard"
      tal:define="
	getToolByName nocall:modules/Products.CMFCore.utils/getToolByName;
	tool python: getToolByName(context, 'portal_mlangotool');
        viewlets   tool/listViewletIds;
        settings python: tool.getUserSettings(member.getId(),context.id, prefix='col_') or {'col_0':'','col_1':''};
        minimized python: tool.getUserSettings(member.getId(),context.id, prefix='min') or {'min':''};
        activeViewlets python: [];">
	
	<div id="mlango-dashboard" name="" tal:attributes="name context/id">
	<ul id="hiddenlist" style="display:none"></ul>
        <div class="mlango-dashboard-col"
		tal:attributes="style python: 'width: %s%%' % int(95/cols)"
		tal:repeat="i python: range(cols)">
          <ul tal:attributes="id python: 'col_%s' % i"
              class="sortable boxy mlango-col"
              tal:define="fixed_viewlets python: tool.listViewletIdsByFixedProperty(i);">
            <tal:repeat repeat="viewlet_id python: fixed_viewlets + settings.get('col_%s' % i, '').split('--')">
              <tal:block tal:condition="python: viewlet_id in viewlets and not viewlet_id in activeViewlets">
                <tal:block tal:define="foo python: activeViewlets.append(viewlet_id)"/>
		    <div tal:omit-tag="" tal:define="dummy python: context.REQUEST.set('minimized',minimized);">
			<div metal:use-macro="here/mlango_macros/macros/viewlet"/>
		    </div>
              </tal:block>
            </tal:repeat>
          </ul>
        </div>
        <div metal:use-macro="here/mlango_macros/macros/menupane">MENUPANE HERE</div>
      </div>
    </div>


    <!-- Create menu pane -->
    <!-- activeViewlets and viewlets should be defined -->
    <div metal:define-macro="menupane">
    
      <div id="menuinfo">
	<div style="width:75%">
	  <div tal:omit-tag="" i18n:translate="menuinfo_help">Click here to add more viewlets"</div>
	</div>
      </div>
    
      <div id="menupane">
	<div id="menu">
    
	<div id="menugrabbing">
	    <img id="hide-menu" class="clickable-icon" src="hide.png"/><br/>
	    <img src="grabber.png"/><br/>
	    <img id="show-menu" class="clickable-icon" src="show.png"/>
	</div>
    
	<div id="menutitle">
	  <span tal:content="string:Viewlets"/>
	</div>
	<ul id="col_listing" class="sortable viewlet-listing">
	  <tal:repeat repeat="viewlet_id python: [v for v in viewlets if not v in activeViewlets]">
	    <span tal:omit-tag="" tal:define="viewlet python: tool.getViewlet(viewlet_id);">
	      <div tal:replace="structure viewlet/renderviewlet"/>
	    </span>
	  </tal:repeat>
	</ul>
      </div>
      </div>
    </div>
    
    <!-- Render a single viewlet. 'viewlet_id' must be defined, and unique -->
    <div tal:omit-tag ="" metal:define-macro="viewlet"
	  tal:define="  getToolByName nocall:modules/Products.CMFCore.utils/getToolByName;
			tool python:getToolByName(context, 'portal_mlangotool');
			viewletobject python: tool.getViewlet(viewlet_id)">
	 <div tal:replace="structure viewletobject/renderviewlet">Viewlet</div>
    </div>
	
    
    
    <div metal:define-macro="copyright">
      <div class="copyright">
	Mlango &copy;<span tal:omit-tag="" tal:content="python:DateTime().year()"/> Goldmund, Wyldebeast &amp; Wunderliebe
      </div>
    </div>    
    <div metal:define-macro="legend">
      <div class="legend">
	<table class="listing">
	<tr>
	  <th colspan="2" i18n:translate="legend_title">Legend</th>
	<tr>
	  <td><img tal:attributes="src string:fullscreencollapse_icon.gif"/></td>
	  <td i18n:translate="legend_fullscreen">Toggle fullscreen (bare) mode</td>
	</tr>
	<tr>
	  <td><img tal:attributes="src string:luckyluke.png"/></td>
	  <td i18n:translate="legend_borders">Toggle borders mode</td>
	</tr>
	<tr>
	  <td><img tal:attributes="src string:options.gif"/></td>
	  <td i18n:translate="legend_options">Viewlet settings</td>
	</tr>
	<tr>
	  <td><img tal:attributes="src string:help.gif"/></td>
	  <td i18n:translate="legend_help">Viewlet information</td>
	</tr>
	<tr>
	  <td><img tal:attributes="src string:collapse-expand.gif"/></td>
	  <td i18n:translate="legend_minmax">Minimize / maximize viewlet</td>
	</tr>
	<tr>
	  <td><img tal:attributes="src string:close.gif"/></td>
	  <td i18n:translate="legend_close">Close viewlet</td>
	</tr>
	<tr>
	  <td><img tal:attributes="src string:lock.gif"/></td>
	  <td i18n:translate="legend_lock">Viewlet cannot be closed</td>
	</tr>
      </div>
    </div>
    
	<!-- Javascript headers -->
    <div metal:define-macro="scripts">
      <script type="text/javascript" src="jquery.js"></script>
      <script type="text/javascript" src="jquery.dimensions.js"></script>
      <script type="text/javascript" src="ui.mouse.js"></script>
      <script type="text/javascript" src="ui.draggable.js"></script>
      <script type="text/javascript" src="ui.draggable.ext.js"></script>  
      <script type="text/javascript" src="ui.droppable.js"></script>
      <script type="text/javascript" src="ui.droppable.ext.js"></script>
      <script type="text/javascript" src="mlango.js"></script> 
    </div>

  </body>

</html>
