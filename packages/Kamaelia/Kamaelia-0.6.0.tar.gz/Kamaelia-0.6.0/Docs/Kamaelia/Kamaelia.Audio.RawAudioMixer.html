<html>
<head>
<title> Components/pydoc/Kamaelia.Audio.RawAudioMixer </title>

<style>
a {
    text-decoration: none;
}
*.thinborder {
    border-style: solid;
    border-width: thin;
}
.boxright {
    float: right;
    width: 20em;
    padding: 0.5em;
    margin: 1em;
    clear: right;
    border: 1px solid;
    text-align: left;
}
.leftbar {
    float: left;
    width: 10em;
    padding-left: 1.0em;
    padding-right: 0.5em;
    padding-top: 0em;
    margin-top: 0em;
    margin-bottom: 1em;
    margin-left: 0em;
    margin-right: 1em;
    clear: left;
    text-align: left;
}
.boxleft{
    float: left;
    width: 9.5em;
    padding-top: 0.5em;
    padding-bottom: 0.5em;
    padding-left: 1.0em;
    padding-right: 1.0em;
    margin-top: 1em;
    margin-bottom: 1em;
    margin-left: 0em;
    margin-right: 1em;
    clear: left;
    border-top: 5px solid;
    border-bottom: 5px solid;
    text-align: left;
}
.none { width: 100%;
        clear: both;
}

.subsection { }
.sectionheader {
                 text-align: center;
                 font-weight: bold;
                 padding-bottom: 1em;
               }
.sectioncontent { font-size: 0.9em;
                  margin-left: 2em;
                  line-height: 1.5;
                  text-align: left;
                }
.verticaldivider { float: bottom;
                   width: 100%;
                 }

 .rbroundbox_green { background: url(/t/green.corners-top.png) repeat-x; 
               width: 50%;
               float: right;
               }
 .rbtop_green div { background: url(/t/green.corners-topleft.png) no-repeat top left; }
 .rbtop_green { background: url(/t/green.corners-topright.png) no-repeat top right; }

 .rbcontent_green div { background: url(/t/green.corners-right.png) repeat-y right; 
                }
 .rbcontent_green { background: url(/t/green.corners-left.png) repeat-y left; 
              padding-left: 1.5em;
            }

 .rbbot_green div { background: url(/t/green.corners-bottomleft.png) no-repeat bottom left; }
 .rbbot_green { background: url(/t/green.corners-bottomright.png) no-repeat bottom right; }
 .rbbottom_green { background: url(/t/green.corners-bottom.png) repeat-x; }
 .rbtop_green div, .rbtop_green, .rbbot_green div, .rbbot_green {
 width: 100%;
 height: 23px;
 font-size: 1px;
 }
body {
   text-align: justify;
}

.sidebar {
    width: 10em;
    float: left;
    padding-left: 1em;
    padding-right: 1em;

}
.bodytext {

    margin: 0 5em 0em 5em;
    float: auto;
    padding-left: 1em;
    padding-right: 1em;
}
.topnav {
    padding-top: 0em;
    margin-top: 0em;
    float: right;
}
</style>

</head>
<body style="font-size: 10pt; font-family: verdana,arial,helvetica,sans-serif; line-height: 1.8;">
</div>

</span></p>
<div class="bodytext">
<html>
<head>
<title>Kamaelia docs : Kamaelia.Audio.RawAudioMixer</title>
<style type="test/css">
pre.literal-block, pre.doctest-block {
  margin-left: 2em ;
  margin-right: 2em ;
  background-color: #eeeeee }
</style>
</head>
<body>
<div class="container">
<div class="section">
<h1><a class="reference" href="Kamaelia.html">Kamaelia</a>.<a class="reference" href="Kamaelia.Audio.html">Audio</a>.<a class="reference" href="Kamaelia.Audio.RawAudioMixer.html">RawAudioMixer</a></h1>
</div>
<div class="section">
<div class="container">
<ul class="simple">
<li><strong>component <a class="reference" href="Kamaelia.Audio.RawAudioMixer.RawAudioMixer.html">RawAudioMixer</a></strong></li>
</ul>
</div>
<ul class="simple">
<li><a class="reference" href="#523">Multi-source Raw Audio Mixer</a><ul>
<li><a class="reference" href="#524">Example Usage</a><ul>
</ul>
</li>
<li><a class="reference" href="#525">How does it work?</a><ul>
</ul>
</li>
</ul>
</li>
<li><a class="reference" href="#526">Test documentation</a><ul>
</ul>
</li>
</ul>
</div>
<div class="section">
<h1 id="523">Multi-source Raw Audio Mixer</h1>
<p>A component that mixes raw audio data from an unknown number of sources, that
can change at any time. Audio data from each source is buffered until a minimum
threshold amount, before it is included in the mix. The mixing operation is a
simple addition. Values are not scaled down.</p>
<div class="section">
<h2 id="524"><a id="example-usage" name="example-usage">Example Usage</a></h2>
<p>Mixing up to 3 sources of audio (sometimes a source is active, sometimes it
isn't):</p>
<pre class="literal-block">
Graphline(
    MIXER = RawAudioMixer( sample_rate=8000,
                           channels=1,
                           format=&quot;S16_LE&quot;,
                           readThreshold=1.0,
                           bufferingLimit=2.0,
                           readInterval=0.1),
                         ),
    A = pipeline( SometimesOn_RawAudioSource(), Entuple(prefix=&quot;A&quot;) ),
    B = pipeline( SometimesOn_RawAudioSource(), Entuple(prefix=&quot;B&quot;) ),
    C = pipeline( SometimesOn_RawAudioSource(), Entuple(prefix=&quot;C&quot;) ),

    OUTPUT = RawSoundOutput( sample_rate=8000,
                             channels=1
                             format=&quot;S16_LE&quot;,
                           ),
           linkages = {
               (A, &quot;outbox&quot;) : (MIXER, &quot;inbox&quot;),
               (B, &quot;outbox&quot;) : (MIXER, &quot;inbox&quot;),
               (C, &quot;outbox&quot;) : (MIXER, &quot;inbox&quot;),

               (MIXER, &quot;outbox&quot;) : (OUTPUT, &quot;inbox&quot;),
           },
         ).run()
</pre>
<p>Each source is buffered for 1 second before it is output. If more than 2 seconds
of audio are buffered, then samples are dropped.</p>
</div>
<div class="section">
<h2 id="525"><a id="how-does-it-work" name="how-does-it-work">How does it work?</a></h2>
<p>Send (id, raw-audio) tuples to RawAudioMixer's inbox. Where 'id' is any value
that uniquely distinguishes each source of audio.</p>
<p>RawAudioMixer buffers each source of audio, and mixes them together additively,
outputting the resulting stream of audio data.</p>
<p>Constructor arguments:</p>
<blockquote>
<ul class="simple">
<li>sample_rate, channels, format
The format of audio to be mixed. The only format understood at the moment
is &quot;S16_LE&quot;</li>
<li>readThreshold
number of seconds of audio that will be buffered before RawAudioMixer
starts mixing it into its output.</li>
<li>bufferingLimit
maximum number of seconds of audio that will be buffered. If more piles up
then some audio will be lost.</li>
<li>readInterval
number of seconds between each time RawAudioMixer outputs a chunk of audio
data.</li>
</ul>
</blockquote>
<p>RawAudioMixer buffers each source of audio separately. If the amount of audio in
any buffer exceeds the 'buffering limit' then the oldest samples buffered will
be lost.</p>
<p>When one or more buffered sources reaches the 'read threshold' then they are
mixed together and output. How often audio is output is determined by setting
the 'read Interval'.</p>
<p>Mixing is done additively and is <em>not</em> scaled down (ie. it is a sum() function,
not an average() ). Therefore, ensure that the sum of the sources being mixed
does not exceed the range of values that samples can take.</p>
<p>Why the buffering, thresholds, and read intervals? It is done this way so that
RawAudioMixer can mix without needing to know what sources of audio there are,
and whether they are running or stopped. It also enables RawAudioMixer to cope
with audio data arriving from different sources at different times.</p>
<p>You may introduce new audio sources at any time - simply send audio data tagged
with a new, unique identifier.</p>
<p>You may stop an audio source at any time too - simply stop sending audio data.
The existing buffered data will be output, until there is not left.</p>
<p>If there is not enough audio in any of the buffers (or perhaps there are no
sources of audio) then RawAudioMixer will not output anything, not even
'silence'.</p>
<p>If a shutdownMicroprocess or producerFinished message is received on this
component's &quot;control&quot; inbox this component will cease reading in data from any
audio sources. If it is currently outputting audio from any of its buffers, it
will continue to do so until these are empty. The component will then forward
on the shutdown message it was sent, out of its &quot;signal&quot; outbox and immediately
terminate.</p>
<p>TODO:</p>
<blockquote>
<ul class="simple">
<li>Needs a timeout mechanism to discard very old data (otherwise this is
effectively a memory leak!)<ul>
<li>If an audio source sends less than the readThreshold amount of audio
data, then stops; then this data never gets flushed out.</li>
</ul>
</li>
</ul>
</blockquote>
</div>
<h1 id="526">Test documentation</h1>
<p>Tests passed:</p>
<ul class="simple">
<li>Multiple sources of audio will be mixed</li>
<li>If there is no input (no incoming audio data), there will be no output (no outgoing audio data)</li>
<li>A single source of audio will pass through</li>
</ul>
</div>
<hr class="docutils" />
<div class="section">
<h1><a class="reference" href="Kamaelia.html">Kamaelia</a>.<a class="reference" href="Kamaelia.Audio.html">Audio</a>.<a class="reference" href="Kamaelia.Audio.RawAudioMixer.html">RawAudioMixer</a>.<a class="reference" href="Kamaelia.Audio.RawAudioMixer.RawAudioMixer.html">RawAudioMixer</a></h1>
<div class="section">
<h2 id="symbol-RawAudioMixer">class RawAudioMixer(<a class="reference" href="Axon.ThreadedComponent.threadedcomponent.html">Axon.ThreadedComponent.threadedcomponent</a>)</h2>
<p>RawAudioMixer([sample_rate][,channels][,format][,readThreshold][,bufferingLimit][,readInterval]) -&gt; new RawAudioMixer component.</p>
<p>Mixes raw audio data from an unknown number of sources, that
can change at any time. Audio data from each source is buffered until a minimum
threshold amount, before it is included in the mix. The mixing operation is a
simple addition. Values are not scaled down.</p>
<p>Send (uniqueSourceIdentifier, audioData) tuples to the &quot;inbox&quot; inbox and
mixed audio data will be sent out of the &quot;outbox&quot; outbox.</p>
<p>Keyword arguments:</p>
<ul class="simple">
<li>sample_rate     -- The sample rate of the audio in Hz (default=8000)</li>
<li>channels        -- Number of channels in the audio (default=1)</li>
<li>format          -- Sample format of the audio (default=&quot;S16_LE&quot;)</li>
<li>readThreshold   -- Duration to buffer audio before it starts being used in seconds (default=1.0)</li>
<li>bufferingLimit  -- Maximum buffer size for each audio source in seconds (default=2.0)</li>
<li>readInterval    -- Time between each output chunk in seconds (default=0.1)</li>
</ul>
<div class="section">
<h3><a id="symbol-RawAudioMixer.Inboxes" name="symbol-RawAudioMixer.Inboxes">Inboxes</a></h3>
<ul class="simple">
</ul>
</div>
<div class="section">
<h3><a id="symbol-RawAudioMixer.Outboxes" name="symbol-RawAudioMixer.Outboxes">Outboxes</a></h3>
<ul class="simple">
</ul>
</div>
<div class="section">
<h3>Methods defined here</h3>
<div class="container">
</div>
<div class="section">
<h4><a id="symbol-RawAudioMixer.__init__" name="symbol-RawAudioMixer.__init__">__init__(self[, sample_rate][, channels][, format][, readThreshold][, bufferingLimit][, readInterval])</a></h4>
</div>
<div class="section">
<h4><a id="symbol-RawAudioMixer.checkForShutdown" name="symbol-RawAudioMixer.checkForShutdown">checkForShutdown(self)</a></h4>
</div>
<div class="section">
<h4><a id="symbol-RawAudioMixer.fillBuffer" name="symbol-RawAudioMixer.fillBuffer">fillBuffer(self, buffers, data)</a></h4>
</div>
<div class="section">
<h4><a id="symbol-RawAudioMixer.main" name="symbol-RawAudioMixer.main">main(self)</a></h4>
</div>
<div class="section">
<h4><a id="symbol-RawAudioMixer.mix_S16_LE" name="symbol-RawAudioMixer.mix_S16_LE">mix_S16_LE(self, sources, amount)</a></h4>
</div>
</div>
<div class="section">
</div>
</div>
</div>
</div>





<div class="section">
<h1>Feedback</h1>
<p>Got a problem with the documentation? Something unclear that could be clearer?
Want to help improve it? Constructive criticism is very welcome - especially if you can suggest a better rewording!</p>
<p>Please leave you feedback
<a class="reference" href="../../../cgi-bin/blog/blog.cgi?rm=viewpost&amp;nodeid=1142023701">here</a>
in reply to the documentation thread in the Kamaelia blog.</p>
</div>


<p><i>-- Automatic documentation generator, 19 Oct 2008 at 14:29:09 UTC/GMT</i>
</body></html>


</div>
<div style="float: left; width: 5em; text-align: center"><img src='/Kamaelia.gif'></div>
<div class="bodytext">
This is a page from the Kamaelia website. You can find the original here:
<ul><li><a href="http://www.kamaelia.org/Components/pydoc/Kamaelia.Audio.RawAudioMixer.html">
http://www.kamaelia.org/Components/pydoc/Kamaelia.Audio.RawAudioMixer
</a></ul>

</div>
</body>
</html>
