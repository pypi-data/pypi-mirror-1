<html>
<head>
<title> Components/pydoc/Kamaelia.File.UnixProcess2 </title>

<style>
a {
    text-decoration: none;
}
*.thinborder {
    border-style: solid;
    border-width: thin;
}
.boxright {
    float: right;
    width: 20em;
    padding: 0.5em;
    margin: 1em;
    clear: right;
    border: 1px solid;
    text-align: left;
}
.leftbar {
    float: left;
    width: 10em;
    padding-left: 1.0em;
    padding-right: 0.5em;
    padding-top: 0em;
    margin-top: 0em;
    margin-bottom: 1em;
    margin-left: 0em;
    margin-right: 1em;
    clear: left;
    text-align: left;
}
.boxleft{
    float: left;
    width: 9.5em;
    padding-top: 0.5em;
    padding-bottom: 0.5em;
    padding-left: 1.0em;
    padding-right: 1.0em;
    margin-top: 1em;
    margin-bottom: 1em;
    margin-left: 0em;
    margin-right: 1em;
    clear: left;
    border-top: 5px solid;
    border-bottom: 5px solid;
    text-align: left;
}
.none { width: 100%;
        clear: both;
}

.subsection { }
.sectionheader {
                 text-align: center;
                 font-weight: bold;
                 padding-bottom: 1em;
               }
.sectioncontent { font-size: 0.9em;
                  margin-left: 2em;
                  line-height: 1.5;
                  text-align: left;
                }
.verticaldivider { float: bottom;
                   width: 100%;
                 }

 .rbroundbox_green { background: url(/t/green.corners-top.png) repeat-x; 
               width: 50%;
               float: right;
               }
 .rbtop_green div { background: url(/t/green.corners-topleft.png) no-repeat top left; }
 .rbtop_green { background: url(/t/green.corners-topright.png) no-repeat top right; }

 .rbcontent_green div { background: url(/t/green.corners-right.png) repeat-y right; 
                }
 .rbcontent_green { background: url(/t/green.corners-left.png) repeat-y left; 
              padding-left: 1.5em;
            }

 .rbbot_green div { background: url(/t/green.corners-bottomleft.png) no-repeat bottom left; }
 .rbbot_green { background: url(/t/green.corners-bottomright.png) no-repeat bottom right; }
 .rbbottom_green { background: url(/t/green.corners-bottom.png) repeat-x; }
 .rbtop_green div, .rbtop_green, .rbbot_green div, .rbbot_green {
 width: 100%;
 height: 23px;
 font-size: 1px;
 }
body {
   text-align: justify;
}

.sidebar {
    width: 10em;
    float: left;
    padding-left: 1em;
    padding-right: 1em;

}
.bodytext {

    margin: 0 5em 0em 5em;
    float: auto;
    padding-left: 1em;
    padding-right: 1em;
}
.topnav {
    padding-top: 0em;
    margin-top: 0em;
    float: right;
}
</style>

</head>
<body style="font-size: 10pt; font-family: verdana,arial,helvetica,sans-serif; line-height: 1.8;">
</div>

</span></p>
<div class="bodytext">
<html>
<head>
<title>Kamaelia docs : Kamaelia.File.UnixProcess2</title>
<style type="test/css">
pre.literal-block, pre.doctest-block {
  margin-left: 2em ;
  margin-right: 2em ;
  background-color: #eeeeee }
</style>
</head>
<body>
<div class="container">
<div class="section">
<h1><a class="reference" href="Kamaelia.html">Kamaelia</a>.<a class="reference" href="Kamaelia.File.html">File</a>.<a class="reference" href="Kamaelia.File.UnixProcess2.html">UnixProcess2</a></h1>
</div>
<div class="section">
<div class="container">
<ul class="simple">
<li><strong>component <a class="reference" href="Kamaelia.File.UnixProcess2.UnixProcess2.html">UnixProcess2</a></strong></li>
</ul>
</div>
<ul class="simple">
<li><a class="reference" href="#667">Unix sub processes with communication through pipes</a><ul>
<li><a class="reference" href="#668">How is this different to UnixProcess?</a><ul>
</ul>
</li>
<li><a class="reference" href="#669">Example Usage</a><ul>
</ul>
</li>
<li><a class="reference" href="#670">Behaviour</a><ul>
</ul>
</li>
<li><a class="reference" href="#671">How does it work?</a><ul>
</ul>
</li>
<li><a class="reference" href="#672">XXX Fix Me</a><ul>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="section">
<h1 id="667">Unix sub processes with communication through pipes</h1>
<p>UnixProcess2 allows you to start a separate process and send data to it and
receive data from it using the standard input/output/error pipes and optional
additional named pipes.</p>
<p>This component works on *nix platforms only. It is almost certainly not Windows
compatible. Tested only under Linux.</p>
<div class="section">
<h2 id="668"><a id="how-is-this-different-to-unixprocess" name="how-is-this-different-to-unixprocess">How is this different to UnixProcess?</a></h2>
<p>UnixProcess2 differs from UnixProcess in the following ways:</p>
<ul class="simple">
<li>UnixProcess2 does not drop data if there is a backlog.</li>
<li>UnixProcess2 allows you to set up extra named input and output pipes.</li>
<li>UnixProcess2 supports sending data to size limited inboxes. The subprocess
will be blocked if its output is going into an inbox that is full. This
enables you to use size limited inboxes to regulate the subprocess.</li>
<li>UnixProcess2 does not take data from its inboxes until it is able to deliver
it to the subprocess. If the inboxes are set to be size limiting, this can
therefore be used to limit the rate of execution of upstream components.</li>
</ul>
</div>
<div class="section">
<h2 id="669"><a id="example-usage" name="example-usage">Example Usage</a></h2>
<p>Using the 'wc' word count GNU util to count the number of lines in some data:</p>
<pre class="literal-block">
Pipeline( RateControlledFileReader(filename, ... ),
          UnixProcess2(&quot;wc -l&quot;),
          ConsoleEchoer(),
        ).run()
</pre>
<p>Feeding separate audio and video streams to ffmpeg, and taking the encoded
output:</p>
<pre class="literal-block">
Graphline(
    ENCODER = UnixProcess2( &quot;ffmpeg -i audpipe -i vidpipe -&quot;,
                           inpipes = { &quot;audpipe&quot;:&quot;audio&quot;,
                                       &quot;vidpipe&quot;:&quot;video&quot;,
                                     },
                           boxsizes = { &quot;audio&quot;:2, &quot;video&quot;:2 }
                         ),
    VIDSOURCE = MaxSpeedFileReader(...),
    AUDSOURCE = MaxSpeFileReader(...),
    SINK = SimpleFileWriter(&quot;encodedvideo&quot;),
    linkages = {
        (&quot;VIDSOURCE&quot;,&quot;outbox&quot;) : (&quot;ENCODER&quot;,&quot;video&quot;),
        (&quot;AUDSOURCE&quot;,&quot;outbox&quot;) : (&quot;ENCODER&quot;,&quot;audio&quot;),
        (&quot;ENCODER&quot;,&quot;outbox&quot;) : (&quot;SINK&quot;, &quot;inbox&quot;),
        }
    ).run()
</pre>
</div>
<div class="section">
<h2 id="670"><a id="behaviour" name="behaviour">Behaviour</a></h2>
<p>At initialisation, specify:</p>
<blockquote>
<ul class="simple">
<li>the command to invoke the sub process</li>
<li>the size limit for internal buffers</li>
<li>additional named input and output pipes</li>
<li>box size limits for any input pipe's inbox, including &quot;inbox&quot; for STDIN</li>
</ul>
</blockquote>
<p>Named input pipes must all use different inbox names. They must not use &quot;inbox&quot;
or &quot;control&quot;. Named output pipes may use any outbox name they wish. More than
one named ouput pipe can use the same outbox, including &quot;outbox&quot;.</p>
<p>The pipe files needed for named pipes are created automatically at activation
and are deleted at termination.</p>
<p>Activate UnixProcess2 and the sub process will be started. Use the inboxes and
outboxes of UnixProcess2 to communicate with the sub process. For example:</p>
<pre class="literal-block">
UnixProcess2( &quot;ffmpeg -i /tmp/inpipe -f wav /tmp/outpipe&quot;,
             inpipes  = { &quot;/tmp/inpipe&quot; :&quot;in&quot;  },
             outpipes = { &quot;/tmp/outpipe&quot;:&quot;out&quot; },
           )
        ________________________________________________
       |                UnixProcess2                     |
       |             _______________________            |
       |            |   &quot;ffmpeg -i ...&quot;     |           |
---&gt; &quot;inbox&quot; ---&gt; STDIN                  STDOUT ---&gt; &quot;outbox&quot; ---&gt;
       |            |                    STDERR ---&gt; &quot;error&quot;  ---&gt;
       |            |                       |           |
---&gt; &quot;in&quot;    ---&gt; &quot;/tmp/inpipe&quot;  &quot;/tmp/outpipe&quot; ---&gt; &quot;out&quot;    ---&gt;
       |            |_______________________|           |
       |________________________________________________|
</pre>
<p>Send binary string data to the &quot;inbox&quot; inbox and it will be sent to STDIN of
the proces.</p>
<p>Binary string data from STDOUT and STDERR is sent out of the &quot;outbox&quot; and
&quot;error&quot; outboxes respectively.</p>
<p>To send to a named pipe, send binary string data to the respective inbox you
specified.</p>
<p>Data written by the sub process to a named output pipe will be sent out of the
respective outbox.</p>
<p>The specified buffering size sets a maximum limit on the amount of data that
can be buffered on the inputs and outputs to and from the sub process. It also
determines the chunk size in which data coming from the sub process will emerge.
Note therefore that data may languish in an output buffer indefinitely until
the process terminates. Do not assume that data coming from a sub process will
emerge the moment it is generated.</p>
<p>UnixProcess2 will leave data in its inboxes until it is able to send it to the
required pipe. If a destination box is full (noSpaceInBox exception) then
UnixProces will wait and retry until it succeeds in sending the data.</p>
<p>If the sub process closes its pipes (STDIN, STDOUT, STDERR) then UnixProcess2
will close its named input and output pipes too, and will send a
producerFinished message out of its &quot;signal&quot; outbox then immediately terminate.</p>
<p>If a producerFinished message is received on the &quot;control&quot; inbox, UnixProcess2
will finish passing any pending data waiting in inboxes into the sub process and
will finish passing on any pending data waiting to come from the sub process
onto destination outboxes. Once this is complete, UnixProcess2 will close all
pipes and send a producerFinished message out of its &quot;signal&quot; outbox and
immediately terminate.</p>
<p>If a shutdownMicroprocess message is received on the &quot;control&quot; inbox,
UnixProcess2 will close all pipes as soon as possible and send the message on
out of its &quot;signal&quot; outbox and immediately terminate.</p>
</div>
<div class="section">
<h2 id="671"><a id="how-does-it-work" name="how-does-it-work">How does it work?</a></h2>
<p>The UnixProcess2 component itself is primarily just the initiator of the sub
process and a container for other child components that handle the actual I/O
with pipes. It uses _ToFileHandle and _FromFileHandle components for each input
and output pipe respectively.</p>
<p>For each specified named pipe, the specified pipe file is created if required
(using mkfifo).</p>
<p>The shutdown signalling boxes of all child components are daisy chained.
Shutdown messages sent to the &quot;control&quot; inbox of UnixProcess2 are routed to the
&quot;control&quot; inbox of the component handling STDIN. The shutdown message is then
propagated to named output pipes and then named input pipes.</p>
<p>If STDOUT close it causes STDERR to close. If STDERR closes then the shutdown
message is propagated to STDIN and then onto named pipes as described above.</p>
<p>When the process exits, it is assumed the STDIN, STDOUT and STDERR will close by
themselves in due course. However an explicit shutdown message is sent to the
named pipes.</p>
</div>
<div class="section">
<h2 id="672"><a id="xxx-fix-me" name="xxx-fix-me">XXX Fix Me</a></h2>
<p>If UnixProcess2 is terminated by receiving shutdown messages, it doesn't
currently explicitly terminate the sub process.</p>
</div>
</div>
<hr class="docutils" />
<div class="section">
<h1><a class="reference" href="Kamaelia.html">Kamaelia</a>.<a class="reference" href="Kamaelia.File.html">File</a>.<a class="reference" href="Kamaelia.File.UnixProcess2.html">UnixProcess2</a>.<a class="reference" href="Kamaelia.File.UnixProcess2.UnixProcess2.html">UnixProcess2</a></h1>
<div class="section">
<h2 id="symbol-UnixProcess2">class UnixProcess2(<a class="reference" href="Axon.Component.component.html">Axon.Component.component</a>)</h2>
<p>UnixProcess2(command[,buffersize][,outpipes][,inpipes][,boxsizes]) -&gt; new UnixProcess2 component.</p>
<p>Starts the specified command as a separate process. Data can be sent to
stdin and received from stdout. Named pipes can also be created for extra
channels to get data to and from the process.</p>
<p>Keyword arguments:</p>
<pre class="literal-block">
- command     -- command line string that will invoke the subprocess
- buffersize  -- bytes size of buffers on the pipes to and from the process (default=32768)
- outpipes    -- dict mapping named-pipe-filenames to outbox names (default={})
- inpipes     -- dict mapping named-pipe-filenames to inbox names (default={})
- boxsizes    -- dict mapping inbox names to box sizes (default={})
</pre>
<div class="section">
<h3><a id="symbol-UnixProcess2.Inboxes" name="symbol-UnixProcess2.Inboxes">Inboxes</a></h3>
<ul class="simple">
<li><strong>control</strong> : Shutdown signalling</li>
<li><strong>inbox</strong> : Binary string data to go to STDIN of the process.</li>
</ul>
</div>
<div class="section">
<h3><a id="symbol-UnixProcess2.Outboxes" name="symbol-UnixProcess2.Outboxes">Outboxes</a></h3>
<ul class="simple">
<li><strong>outbox</strong> : Binary string data from STDOUT of the process</li>
<li><strong>signal</strong> : Shutdown signalling</li>
<li><strong>_shutdownPipes</strong> : For shutting down any named pipes used for output</li>
<li><strong>error</strong> : Binary string data from STDERR of the process</li>
</ul>
</div>
<div class="section">
<h3>Methods defined here</h3>
<div class="container">
</div>
<div class="section">
<h4><a id="symbol-UnixProcess2.__init__" name="symbol-UnixProcess2.__init__">__init__(self, command[, buffersize][, outpipes][, inpipes][, boxsizes])</a></h4>
<p>x.__init__(...) initializes x; see x.__class__.__doc__ for signature</p>
</div>
<div class="section">
<h4><a id="symbol-UnixProcess2.childrenDone" name="symbol-UnixProcess2.childrenDone">childrenDone(self)</a></h4>
<p>Unplugs any children that have terminated, and returns true if there are no
running child components left (ie. their microproceses have finished)</p>
</div>
<div class="section">
<h4><a id="symbol-UnixProcess2.main" name="symbol-UnixProcess2.main">main(self)</a></h4>
<p>main loop</p>
</div>
<div class="section">
<h4><a id="symbol-UnixProcess2.setupNamedInPipes" name="symbol-UnixProcess2.setupNamedInPipes">setupNamedInPipes(self, pipeshutdown)</a></h4>
</div>
<div class="section">
<h4><a id="symbol-UnixProcess2.setupNamedOutPipes" name="symbol-UnixProcess2.setupNamedOutPipes">setupNamedOutPipes(self, pipeshutdown)</a></h4>
</div>
</div>
<div class="section">
</div>
</div>
</div>
</div>





<div class="section">
<h1>Feedback</h1>
<p>Got a problem with the documentation? Something unclear that could be clearer?
Want to help improve it? Constructive criticism is very welcome - especially if you can suggest a better rewording!</p>
<p>Please leave you feedback
<a class="reference" href="../../../cgi-bin/blog/blog.cgi?rm=viewpost&amp;nodeid=1142023701">here</a>
in reply to the documentation thread in the Kamaelia blog.</p>
</div>


<p><i>-- Automatic documentation generator, 19 Oct 2008 at 14:29:09 UTC/GMT</i>
</body></html>


</div>
<div style="float: left; width: 5em; text-align: center"><img src='/Kamaelia.gif'></div>
<div class="bodytext">
This is a page from the Kamaelia website. You can find the original here:
<ul><li><a href="http://www.kamaelia.org/Components/pydoc/Kamaelia.File.UnixProcess2.html">
http://www.kamaelia.org/Components/pydoc/Kamaelia.File.UnixProcess2
</a></ul>

</div>
</body>
</html>
