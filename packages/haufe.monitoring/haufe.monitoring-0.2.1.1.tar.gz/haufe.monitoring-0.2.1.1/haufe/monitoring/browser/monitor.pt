<html>
    <head>
        <link rel="stylesheet" href="/++resource++haufe.monitoring/styles.css" type="text/css" >
        <script type="text/javascript" src="/++resource++haufe.monitoring/jquery.tools.min.js"></script>
        <script type="text/javascript">
            function doSubmit(url) {
                var form = $('#form');
                form.attr('action', url);
                form.submit();
                }


            isSelected = false;
              
            function toggleSelect() {
              if (isSelected == false) {
                  isSelected = true;
                  $('.checkbox').attr('checked', true);
                  $('#selectAll').attr('value', 'Delect all');
              }
              else {
                  isSelected = false;
                  $('.checkbox').attr('checked', false);
                  $('#selectAll').attr('value', 'Select all');
              }
            }
        </script>
    </head>
    <body>
        <h1>Monitoring for ZEO clients</h1>
        <form method="post" action="@@error_log_view" id="form">
            <table tal:define="stats view/getStats">
                <thead>
                    <tr>   
                        <th>&nbsp;</th>
                        <th>Instance</th>
                        <th>Started</th>
                        <th>Threads</th>
                        <th>Load</th>
                        <th>VMDataSize</th>
                        <th>Temporay storage</th>
                    </tr>   
                </thead>
                <tbody>
                    <tal:loop repeat="server view/getServers">
                        <tr tal:define="key python: (server.hostname, server.port);
                                        server_stats python: stats[key]">
                            <td class="checkbox-spec">
                                <input type="checkbox"
                                    class="checkbox"
                                    name="hosts:list"
                                    tal:attributes="value string:${server/hostname}:${server/port}"
                                />
                            </td>
                            <td class="host-spec">
                                <a tal:attributes="href string:${server/url}/manage_main"
                                   tal:content="string:${server/hostname}:${server/port}"
                                />
                                <span class="error" tal:condition="not: server_stats">(Error)</span>
                            </td>
                            <td class="started-spec" tal:content="server/started_str" />
                            <td class="threads-spec" tal:content="server_stats/zserver_threads | string: n/a" />
                            <td class="load-spec" tal:content="server_stats/load | string: n/a" />
                            <td class="vmdatasize-spec" tal:content="server_stats/vmdata_size | string: n/a" />
                            <td class="tempstorage-spec" tal:content="server_stats/temporary_storage | string: n/a" />
                        </tr>
                    </tal:loop>
                <tbody>
            </table>
            <input type="button" onclick="doSubmit('@@show_error_log')" value="Error Log" title="Show an aggregated error_log view of all selected hosts" />
            &nbsp;
            <input type="button" onclick="doSubmit('@@remove_hosts')" value="Remove hosts" title="Remove selected host(s) from view" />
            &nbsp;
            <!--
            <input type="button" onclick="doSubmit('@@restart')" value="Restart" />
            <input type="button" onclick="doSubmit('@@shutdown')" value="Shutdown" />
            -->
            &nbsp;
            <input type="button" onclick="toggleSelect()" value="Select all" id="selectAll" />
        </form>
    </body>
</html>
