<html>

<head>
 <title>QueryTool</title>
 <link rel="stylesheet" type="text/css" href="/manage_page_style.css" />

 <style>
    pre {
         overflow-x: auto; /* Use horizontal scroller if needed; for Firefox 2, not needed in Firefox 3 */
         white-space: pre-wrap; /* css-3 */
         white-space: -moz-pre-wrap !important; /* Mozilla, since 1999 */
         white-space: -pre-wrap; /* Opera 4-6 */
         white-space: -o-pre-wrap; /* Opera 7 */
         /* width: 99%; */
         word-wrap: break-word; /* Internet Explorer 5.5+ */
         color: #424242;
         font-family: Arial, Verdana, sans-serif;
         font-size:0.88em;
         border: 1px solid #89BED0;
         background-color:#F5F5F1;
         margin-right:1em;
         padding:1em;
         height:auto !important;
         height:30em;
    }
 </style>

</head>

<body bgcolor="#ffffff" link="#000099" alink="#000099" vlink="#000099">
<span tal:replace="structure here/manage_tabs" />

<div style="padding: 5px 10px 0px 20px;">
<tal:if condition="not:exists:request/showhelp">
<br/><b>&raquo;&nbsp;<a href="?showhelp=1">Show examples</a></b>
</tal:if>

<tal:if condition="exists:request/showhelp">
<p>Here you can define predefined queries. These queries are saved in here and can be executed
by calling <pre><code>query_tool.executePredefinedQuery(name, **parameters)</code></pre>
</p>
Example of a parametrized query including predefined constants (TODAY=DateTime()) and conditionals (if and ifnot usable) you can use:<br/>
<pre>
And(
    Eq('SearchableText', '$text'),
    ~Generic('path', {'query':'Members', 'level':-1}),

    [[if($allowed_types)]]
        In('portal_types', $allowed_types),
    [[endif]]

    Ge('start_date', TODAY)
)
</pre>
</tal:if>
<p>List of predefined queries</p>
<table width="80%">
<form name="editqueries" action="." method="POST">
<tal:for repeat="qq here/getAllPredefinedQueries">
<tr>
    <td>
        <table>
        <tr>
        <td>
        ID: <input type="text" name="names:string:list" tal:attributes="value qq/getName"/>
        </td>
        </tr>
        <tr>
        <td>CT: <input type="text" name="catalogs:string:list" tal:attributes="value qq/getCatalog"/></td>
        </tr>
        <tr>
        <td>Wrap-Security: <input type="checkbox" name="checks:boolean:list" tal:attributes="checked python:test(qq.getWrapSecurity(), 'checked', None)"/><br/>
        <a tal:attributes="href string:deletePredefinedQuery?name=${qq/getName}"><img src="delete_icon.gif" border="0"/>Delete</a>
        </td>
        </tr>
        </table>
    </td>
    <td><textarea cols="70" rows="9" name="querystrings:text" tal:content="python:qq.getRawQueryString()"></textarea></td>
</tr>
</tal:for>
<tr colspan="2">
    <td><input type="submit" name="savePredefinedQueries:method" value="Save"/></td>
</tr>
</form>
<tr><td>&nbsp;</td><td>&nbsp;</td></tr>
<form name="querymaker" action="." method="POST">
<tr>
    <td>
        <table>
        <tr>
        <td>
        ID: <input type="text" name="name:string"/>
        </td>
        </tr>
        <tr>
        <td>CT: <input type="text" name="catalog:string" value="portal_catalog"/></td>
        </tr>
        <tr>
        <td>Wrap-Security: <input type="checkbox" name="check:boolean" checked="checked"/><br/>
        </td>
        </tr>
        </table>
    </td>
    <td><textarea cols="70" rows="9" name="querystring:string"></textarea></td>
</tr>
<tr colspan="2">
    <td><input type="submit" name="createPredefinedQueryFromString:method" value="Save new query"/></td>
</tr>
</form>
</table>

</div>

</body>
</html>
