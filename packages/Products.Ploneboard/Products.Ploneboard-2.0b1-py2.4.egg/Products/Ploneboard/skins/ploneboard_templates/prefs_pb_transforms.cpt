<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      xml:lang="en" lang="en" i18n:domain="ploneboard"
      metal:use-macro="here/prefs_main_template/macros/master">
  <metal:block fill-slot="top_slot"
               tal:define="dummy python:request.set('disable_border',1)" />

  <body>
    <div metal:fill-slot="prefs_configlet_main">
      <h1 i18n:translate="heading_pref_transforms">Ploneboard transforms</h1>

      <a href=""
         class="link-parent"
         tal:attributes="href string: $portal_url/prefs_ploneboard_form"
         i18n:translate="label_up_to_ploneboard_setup">
        Up to Ploneboard Setup
      </a>

      <div class="documentDescription" i18n:translate="description_pref_transforms">
        Configure Ploneboard comment text transformations.
      </div>

      <form action=""
            name="ploneboard"
            method="post"
            tal:define="pbtool context/portal_ploneboard;
                         known_transforms pbtool/getTransforms;
                         enabled_transforms pbtool/getEnabledTransforms"
            tal:attributes="action string:${here_url}/${template_id}">
        <fieldset>
          <legend i18n:translate="legend_pref_ploneboard_transforms">
            Text transformations
          </legend>

          <div class="field"
               tal:define="error errors/transforms|nothing"
               tal:attributes="class python:test(error, 'field error', 'field')">
            <label for="transforms" i18n:translate="label_transforms">Transforms</label>

            <div class="formHelp" i18n:translate="help_transforms">
              Select the text transformations that should be used for comments
              posted in Ploneboard conversations. Text transformations alter
              the text entered by the user, either to remove potentially 
              malicious HTML tags, or to add additional functionality, such as
              making links clickable.
            </div>

            <div tal:content="error">Validation error output</div>

            <ul class="configlets">
              <li tal:repeat="transform known_transforms">
                <input class="noborder"
                       type="checkbox"
                       name="transforms:list"
                       tal:attributes="value transform;
                                       id python:normalizeString(transform);
                                       checked python:test(transform in enabled_transforms, 'checked', None)"/>
                <label for=""
                       i18n:translate=""
                       tal:attributes="for python:normalizeString(transform)"
                       tal:content="python:pbtool.getTransformFriendlyName(transform)">label</label>
              </li>
            </ul>
          </div>

          <div class="visualClear"><!-- --></div>

          <div class="formControls">
            <input class="context"
                   type="submit"
                   name="form.button.Save"
                   value="Save"
                   i18n:attributes="value label_save;"/>
          </div>
        </fieldset>
        <input type="hidden" name="form.submitted" value="1" />
      </form>
    </div>
  </body>
</html>
