<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="plone">

  <metal:block fill-slot="top_slot"
               tal:define="dummy python:request.set('disable_border',1)" />

  <body>

    <div metal:fill-slot="main">
      <div metal:define-macro="main">

	<h1 class="documentFirstHeading"
            i18n:translate="heading_select_default_view">
	  Select default view
	</h1>

	<tal:parts 
	   define="contextoptions python: isContextDefaultPage and 
		   [context.aq_inner.aq_parent, context] or 
		   [context, ]"
	   repeat="thecontext contextoptions">

	  <h3 tal:condition="python: len(contextoptions) > 1"
	      tal:content="thecontext/Type" />

	  <p i18n:translate="description_select_default_view">
            Please select which template should be used as the 
	    default view of the
            <span 
	       i18n:name="contenttype"
	       tal:content="thecontext/Type" />.
	  </p>

          <p tal:define="vocab thecontext/getAvailableLayouts;
			 actualLayout thecontext/getLayout|nothing;
			 selectedLayout python:
			 ((not isContextDefaultPage) and actualLayout) or ''">
	    
            <tal:item repeat="layout vocab">
              <tal:vars define="value python:layout[0];
				display python:layout[1];">
		<a tal:attributes="href string:${thecontext/absolute_url}/selectViewTemplate?templateId=${value}">
		  <b tal:content="display" 
		     tal:omit-tag="python: value != selectedLayout"
		     i18n:translate="" />
		</a>
		<br />
              </tal:vars>
            </tal:item>
	  </p>
	  
          <div tal:condition="thecontext/canSetDefaultPage">
            <tal:hasItems 
	       define="availableTypes site_properties/default_page_types 
		       | python:[];
		       items python:
		       [item for item in thecontext.getFolderContents() if
		       not item.is_folderish or 
		       item.portal_type in availableTypes];
		       cur_page thecontext/getDefaultPage|nothing"
	       condition="items">
              <p>
		<span i18n:translate="label_or">or</span>
		<b class="selected"
		   i18n:translate="label_choose_content_item">
		  Choose a content item&hellip;
		</b>
	      </p>
	      
	      <p>
		<tal:item repeat="item items">
		  <span tal:define="item_typeinfo python: 
				    here.portal_types.getTypeInfo(item.portal_type);
                                    item_icon 
				    string:$portal_url/${item_typeinfo/getIcon};">
                    <img src="" alt=""
			 tal:attributes="src item_icon;
					 alt item_typeinfo/Title" />
		    <a tal:attributes="href string:${thecontext/absolute_url}/saveDefaultPage?objectId=${item/getId}">
		      <b tal:content="item/pretty_title_or_id"
			 tal:omit-tag="python: item.getId != cur_page" />
		    </a>
		    <br />
		  </span>
		</tal:item>
	      </p>
	    </tal:hasItems>
	    
	  </div>
	</tal:parts>
      </div>
    </div>
    
  </body>
</html>
