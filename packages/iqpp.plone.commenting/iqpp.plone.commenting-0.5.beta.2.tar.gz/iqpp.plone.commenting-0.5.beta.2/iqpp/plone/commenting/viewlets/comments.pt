<metal:block i18n:domain="iqpp.plone.commenting"
             tal:define="comment_id options/comment_id | nothing">
             
    <tal:block tal:condition="view/available"
               tal:repeat="comment python:view.getComments(comment_id)">

        <div tal:attributes="class comment/class"
             tal:define="comment_id comment/id | nothing">

             <a tal:attributes="name comment_id"></a>
             
             <h3 class="private"
                  tal:content="comment/subject"
                  tal:attributes="class string:state-${comment/review_state}" />

             <div class="documentByLine">
                <span i18n:translate="label_comment_by">Posted by</span>             
                 <span tal:content="comment/name" />            
                 <span tal:content="comment/created_local" />         
             </div>
     
             <div tal:content="structure comment/transformed_message" />

             <tal:comment tal:replace="nothing">
                 <!-- 
                     Separate forms to differ between edit and reply 
                     (both uses the same form) 
             
                     Note: It is not clean to differ this via the values 
                     of the buttons, because they are translated.
                  -->
             </tal:comment>

            <div class="commenting-buttons">
                 <form class="commenting-buttons"
                       tal:condition="comment/show_reply_button"
                       style="display:inline"
                       action="."
                       tal:attributes="action context/absolute_url" 
                       method="post">

                     <input type="hidden"
                            name="action" 
                            value="add" />
                
                     <input type="hidden"
                            name="comment_id"
                            tal:attributes="value comment_id" />

                     <input class="standalone"
                            type="submit"
                            name="add_comment_form:method"
                            value="Reply"
                            i18n:attributes="value reply_label;" />

                 </form> 
                 <form style="display:inline"
                       action="."
                       tal:attributes="action context/absolute_url" 
                       method="post">

                     <input type="hidden"
                            name="action" 
                            value="edit" />

                     <input type="hidden"
                            name="comment_id"
                            tal:attributes="value comment_id" />
     
                     <input tal:condition="comment/show_edit_button"
                            class="context"
                            type="submit"
                            name="edit_comment_form:method"
                            value="Edit" 
                            i18n:attributes="value edit_label"/>

                     <input tal:condition="comment/show_manage_button"
                            class="context"
                            type="submit"
                            name="manage_comment_form:method"
                            value="Manage"
                            i18n:attributes="value manage_label;" />
            
                     <input tal:condition="comment/show_delete_button"
                            class="destructive"
                            type="submit"
                            name="delete_comment:method"
                            value="delete"
                            i18n:attributes="value delete_label;" />

                     <input tal:condition="comment/show_publish_button"
                            class="destructive"
                            type="submit"
                            name="publish_comment:method"
                            value="publish"
                            i18n:attributes="value publish_label;" />

                     <input tal:condition="comment/show_reject_button"
                            class="destructive"
                            type="submit"
                            name="reject_comment:method"
                            value="reject"
                            i18n:attributes="value reject_label;" />

                 </form>
            </div>
        </div>
        
        <div style="margin-left:2em">
            <div tal:replace="structure python:view.render(comment_id = comment['id'])" />
        </div>
    </tal:block>

</metal:block>
