<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>cli — command line tools &mdash; pyCLI v1.0 documentation</title>
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '#',
        VERSION:     '1.0',
        COLLAPSE_MODINDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="pyCLI v1.0 documentation" href="#" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="modindex.html" title="Global Module Index"
             accesskey="M">modules</a> |</li>
        <li><a href="#">pyCLI v1.0 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="module-cli">
<h1><tt class="xref docutils literal"><span class="pre">cli</span></tt> &#8212; command line tools<a class="headerlink" href="#module-cli" title="Permalink to this headline">¶</a></h1>
<p><tt class="xref docutils literal"><span class="pre">cli</span></tt> provides a suite of tools that simplify the process of
developing testable, robust and easy-to-use command line applications.
With <tt class="xref docutils literal"><span class="pre">cli</span></tt>, your scripts (and larger applications) can use Python&#8217;s
extensive standard library to parse configuration files and command line
parameters, log messages and even daemonize. All of these services are
made available through the <a title="cli.app.Application" class="reference internal" href="#cli.app.Application"><tt class="xref docutils literal"><span class="pre">cli.app.Application</span></tt></a> class, an instance of
which is passed to your script at run time. Even though it is
featureful, <tt class="xref docutils literal"><span class="pre">cli</span></tt> is decidedly unmagical.</p>
<div class="section" id="installing-cli">
<h2>Installing <tt class="xref docutils literal"><span class="pre">cli</span></tt><a class="headerlink" href="#installing-cli" title="Permalink to this headline">¶</a></h2>
<p>You can install the latest stable version of <tt class="xref docutils literal"><span class="pre">cli</span></tt> using <strong>pip</strong>:</p>
<div class="highlight-none"><div class="highlight"><pre>$ pip install pyCLI
</pre></div>
</div>
<p>You can also browse the project&#8217;s <a class="reference external" href="http://mercurial.selenic.com/">Mercurial</a> <a class="reference external" href="http://code.lfod.us/cli">repository</a>. If you&#8217;d
like to contribute changes, start by cloning the repository:</p>
<div class="highlight-none"><div class="highlight"><pre>$ hg clone http://code.lfod.us/cli
</pre></div>
</div>
</div>
<div class="section" id="a-quick-tour-of-cli-s-features">
<h2>A quick tour of <tt class="xref docutils literal"><span class="pre">cli</span></tt>&#8216;s features<a class="headerlink" href="#a-quick-tour-of-cli-s-features" title="Permalink to this headline">¶</a></h2>
<p>Command line parsing:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">#!/usr/bin/env python</span>
<span class="kn">import</span> <span class="nn">cli</span>

<span class="nd">@cli.CommandLineApp</span>
<span class="k">def</span> <span class="nf">ls</span><span class="p">(</span><span class="n">app</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="n">ls</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s">&quot;-l&quot;</span><span class="p">,</span> <span class="s">&quot;--long&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&quot;list in long format&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&quot;store_true&quot;</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">ls</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
<p>When run, this script produces the following output:</p>
<div class="highlight-none"><div class="highlight"><pre>$ python ls.py -h
usage: ls [-h] [-l]

optional arguments:
  -h, --help  show this help message and exit
  -l, --long  list in long format
</pre></div>
</div>
<p>Logging:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">#!/usr/bin/env python</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">cli</span>
<span class="nd">@cli.LoggingApp</span>
<span class="k">def</span> <span class="nf">sleep</span><span class="p">(</span><span class="n">app</span><span class="p">):</span>
    <span class="n">app</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;About to sleep for </span><span class="si">%d</span><span class="s"> seconds&quot;</span> <span class="o">%</span> <span class="n">app</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">seconds</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">app</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">seconds</span><span class="p">)</span>

<span class="n">sleep</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s">&quot;seconds&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&quot;time to sleep&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">sleep</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
<p>Which produces the following:</p>
<div class="highlight-none"><div class="highlight"><pre>$ python sleep.py -h
usage: sleep [-h] [-l] [-q] [-s] [-v] seconds

positional arguments:
  seconds        time to sleep

optional arguments:
  -h, --help     show this help message and exit
  -l, --logfile  log to file (default: log to stdout)
  -q, --quiet    decrease the verbosity
  -s, --silent   only log warnings
  -v, --verbose  raise the verbosity
$ python sleep.py -vv 3
About to sleep for 3 seconds
</pre></div>
</div>
<p>Daemonizing:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">#!/usr/bin/env python</span>
<span class="kn">import</span> <span class="nn">cli</span>
<span class="nd">@cli.DaemonizingApp</span>
<span class="k">def</span> <span class="nf">daemon</span><span class="p">(</span><span class="n">app</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">app</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">daemonize</span><span class="p">:</span>
        <span class="n">app</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;About to daemonize&quot;</span><span class="p">)</span>
        <span class="n">app</span><span class="o">.</span><span class="n">daemonize</span><span class="p">()</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">daemon</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
<p>And on the command line:</p>
<div class="highlight-none"><div class="highlight"><pre>$ python daemon.py -h
usage: daemon [-h] [-l] [-q] [-s] [-v] [-d] [-u USER] [-p PIDFILE]

optional arguments:
  -h, --help            show this help message and exit
  -l, --logfile         log to file (default: log to stdout)
  -q, --quiet           decrease the verbosity
  -s, --silent          only log warnings
  -v, --verbose         raise the verbosity
  -d, --daemonize       run the application in the background
  -u USER, --user USER  change to USER[:GROUP] after daemonizing
  -p PIDFILE, --pidfile PIDFILE
                        write PID to PIDFILE after daemonizing
$ python daemon.py -d -vv
About to daemonize
</pre></div>
</div>
</div>
<div class="section" id="basic-usage">
<h2>Basic usage<a class="headerlink" href="#basic-usage" title="Permalink to this headline">¶</a></h2>
<p>While the <tt class="xref docutils literal"><span class="pre">cli</span></tt> modules provide a simple API for designing your own
applications, the default implementations are intended to be flexible
enough to cover most use cases. No matter which <a title="cli.app.Application" class="reference internal" href="#cli.app.Application"><tt class="xref docutils literal"><span class="pre">cli.app.Application</span></tt></a> you
use, the basic pattern is the same: create a callable that does the
work, wrap it in an <a title="cli.app.Application" class="reference internal" href="#cli.app.Application"><tt class="xref docutils literal"><span class="pre">cli.app.Application</span></tt></a>, add some parameters and call
its <tt class="xref docutils literal"><span class="pre">run()</span></tt> method.</p>
<p>Your callable may be a simple function or a more complex class that
implements the <tt class="xref docutils literal"><span class="pre">__call__()</span></tt> protocol. Either way, it should accept a
single <tt class="xref docutils literal"><span class="pre">app</span></tt> instance as its only argument. It will use this
object to interact with the application framework, find out what
arguments were passed on the command line, log messages, etc.</p>
<p>You can wrap the callable in one of two ways. First,
<a title="cli.app.Application" class="reference internal" href="#cli.app.Application"><tt class="xref docutils literal"><span class="pre">cli.app.Application</span></tt></a> can be thought of as a decorator (see <span class="target" id="index-0"></span><a class="reference external" href="http://www.python.org/dev/peps/pep-0318"><strong>PEP 318</strong></a>
for more information). For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nd">@cli.Application</span>
<span class="k">def</span> <span class="nf">yourapp</span><span class="p">(</span><span class="n">app</span><span class="p">):</span>
    <span class="n">do_stuff</span><span class="p">()</span>
</pre></div>
</div>
<p>If you need to pass keyword arguments to the application, you can still
use the decorator pattern:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nd">@cli.CommandLineApp</span><span class="p">(</span><span class="n">argv</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;-v&quot;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">yourapp</span><span class="p">(</span><span class="n">app</span><span class="p">):</span>
    <span class="n">do_stuff</span><span class="p">()</span>
</pre></div>
</div>
<p>If you don&#8217;t like decorators (or your interpreter doesn&#8217;t support them),
you can also simply pass your application callable to the
<a title="cli.app.Application" class="reference internal" href="#cli.app.Application"><tt class="xref docutils literal"><span class="pre">cli.app.Application</span></tt></a>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">yourapp</span><span class="p">(</span><span class="n">app</span><span class="p">):</span>
    <span class="n">do_stuff</span><span class="p">()</span>

<span class="n">yourapp</span> <span class="o">=</span> <span class="n">cli</span><span class="o">.</span><span class="n">CommandLineApp</span><span class="p">(</span><span class="n">yourapp</span><span class="p">)</span>
</pre></div>
</div>
<p>Most of the supplied <a title="cli.app.Application" class="reference internal" href="#cli.app.Application"><tt class="xref docutils literal"><span class="pre">cli.app.Application</span></tt></a> implementations support
parameters. Parameters determine how your users interact with your
program on the command line. To add parameters to your application, call
<tt class="xref docutils literal"><span class="pre">add_param()</span></tt> after you&#8217;ve wrapped your callable:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">yourapp</span><span class="o">.</span><span class="n">add_param</span><span class="p">(</span><span class="s">&quot;-v&quot;</span><span class="p">,</span> <span class="s">&quot;--verbose&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&quot;increase the verbosity&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&quot;count&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>The interface here is the same as that implemented by
<tt class="xref docutils literal"><span class="pre">argparse.ArgumentParser</span></tt>. In this case, an <tt class="xref docutils literal"><span class="pre">verbose</span></tt>
attribute will be created on the <tt class="xref docutils literal"><span class="pre">app.params</span></tt> object with an
integer representing the desired verbosity level.</p>
<p>Once you&#8217;ve added all the parameters you need (if any &#8211; the default
implementations include sensible defaults), simply call the <tt class="xref docutils literal"><span class="pre">run()</span></tt>
method on the wrapped callable. It&#8217;s best to do this only if your script
is actually being run, so shield it with a conditional:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">yourapp</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
<p>This will allow you to import your application and tweak it
programmatically from another script without actually invoking it.</p>
</div>
<div class="section" id="command-line-best-practices">
<h2>Command line best practices<a class="headerlink" href="#command-line-best-practices" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="extending-cli-app-application">
<h2>Extending <a title="cli.app.Application" class="reference internal" href="#cli.app.Application"><tt class="xref docutils literal"><span class="pre">cli.app.Application</span></tt></a><a class="headerlink" href="#extending-cli-app-application" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="module-cli.daemon">
<h2>API<a class="headerlink" href="#module-cli.daemon" title="Permalink to this headline">¶</a></h2>
<div class="section" id="cli-app-basic-applications">
<h3><tt class="xref docutils literal"><span class="pre">cli.app</span></tt> &#8211; basic applications<a class="headerlink" href="#cli-app-basic-applications" title="Permalink to this headline">¶</a></h3>
<p>The <tt class="xref docutils literal"><span class="pre">cli.app</span></tt> module establishes the basis for all of the other
applications and is a good place to start when looking to extend
<a title="cli.app.Application" class="reference internal" href="#cli.app.Application"><tt class="xref docutils literal"><span class="pre">Application</span></tt></a> functionality or to understand the basic API.</p>
</div>
<dl class="class">
<dt id="cli.app.Application">
<em class="property">class </em><tt class="descclassname">cli.app.</tt><tt class="descname">Application</tt><big>(</big><em>main=None</em>, <em>name=None</em>, <em>exit_after_main=True</em>, <em>stdin=None</em>, <em>stdout=None</em>, <em>stderr=None</em>, <em>version=None</em>, <em>description=None</em>, <em>argv=None</em>, <em>profiler=None</em><big>)</big><a class="headerlink" href="#cli.app.Application" title="Permalink to this definition">¶</a></dt>
<dd><p>An application.</p>
<p><a title="cli.app.Application" class="reference internal" href="#cli.app.Application"><tt class="xref docutils literal"><span class="pre">Application</span></tt></a> constructors should always be called with
keyword arguments, though the <em>main</em> argument may be passed
positionally (as when <a title="cli.app.Application" class="reference internal" href="#cli.app.Application"><tt class="xref docutils literal"><span class="pre">Application</span></tt></a> or its subclasses are
instantiated as decorators). Arguments are:</p>
<p><em>main</em> is the callable object that performs the main work of the
application. The callable must accept an <a title="cli.app.Application" class="reference internal" href="#cli.app.Application"><tt class="xref docutils literal"><span class="pre">Application</span></tt></a>
instance as its sole argument. If <em>main</em> is <tt class="xref docutils literal"><span class="pre">None</span></tt>, it is assumed that
a valid callable will be passed to the <tt class="xref docutils literal"><span class="pre">__call__()</span></tt> method (when
using an <a title="cli.app.Application" class="reference internal" href="#cli.app.Application"><tt class="xref docutils literal"><span class="pre">Application</span></tt></a> instance as a decorator). If <em>main</em> is
not None, the <a title="cli.app.Application.setup" class="reference internal" href="#cli.app.Application.setup"><tt class="xref docutils literal"><span class="pre">setup()</span></tt></a> method will be called, allowing
subclasses to customize the order in which certain setup steps are
executed.</p>
<p><em>name</em> is the name of the application itself. If <em>name</em> is not <tt class="xref docutils literal"><span class="pre">None</span></tt>,
the <a title="cli.app.Application.name" class="reference internal" href="#cli.app.Application.name"><tt class="xref docutils literal"><span class="pre">name</span></tt></a> property will inspect the <tt class="xref docutils literal"><span class="pre">main</span></tt> callable and
use its function or class name.</p>
<p><em>exit_after_main</em> determines whether the application will call
<tt class="xref docutils literal"><span class="pre">sys.exit()</span></tt> after <tt class="xref docutils literal"><span class="pre">main</span></tt> completes.</p>
<p><em>stdin</em>, <em>stderr</em> and <em>stdout</em> are file objects that represent the 
usual application input and outputs. If they are <tt class="xref docutils literal"><span class="pre">None</span></tt>, they will
be replaced with <tt class="xref docutils literal"><span class="pre">sys.stdin</span></tt>, <tt class="xref docutils literal"><span class="pre">sys.stderr</span></tt> and
<tt class="xref docutils literal"><span class="pre">sys.stdout</span></tt>, respectively.</p>
<p><em>version</em> is a string representing the application&#8217;s version.</p>
<p><em>description</em> is a string describing the application. If
<em>description</em> is <tt class="xref docutils literal"><span class="pre">None</span></tt>, the <a title="cli.app.Application.description" class="reference internal" href="#cli.app.Application.description"><tt class="xref docutils literal"><span class="pre">description</span></tt></a> property will use
the <tt class="xref docutils literal"><span class="pre">main</span></tt> callable&#8217;s <tt class="xref docutils literal"><span class="pre">__doc__</span></tt> attribute instead.</p>
<p><em>argv</em> is a list of strings representing the options passed on the
command line. If <em>argv</em> is <tt class="xref docutils literal"><span class="pre">None</span></tt>, <tt class="xref docutils literal"><span class="pre">sys.argv</span></tt> will be used
instead.</p>
<p><em>profiler</em> is a <tt class="xref docutils literal"><span class="pre">Profiler</span></tt> instance. If not <tt class="xref docutils literal"><span class="pre">None</span></tt>, the
profiler will be available to the running application.</p>
<p>In all but a very few cases, subclasses that override the constructor
should call <tt class="xref docutils literal"><span class="pre">Application.__init__()</span></tt> at the end of the
overridden method to ensure that the <a title="cli.app.Application.setup" class="reference internal" href="#cli.app.Application.setup"><tt class="xref docutils literal"><span class="pre">setup()</span></tt></a> method is
called.</p>
<dl class="attribute">
<dt id="cli.app.Application.description">
<tt class="descname">description</tt><a class="headerlink" href="#cli.app.Application.description" title="Permalink to this definition">¶</a></dt>
<dd><p>A string describing the application.</p>
<p>Unless specified when the <a title="cli.app.Application" class="reference internal" href="#cli.app.Application"><tt class="xref docutils literal"><span class="pre">Application</span></tt></a> was created, this
property will examine the <tt class="xref docutils literal"><span class="pre">main</span></tt> callable and use its
docstring (<tt class="xref docutils literal"><span class="pre">__doc__</span></tt> attribute).</p>
</dd></dl>

<dl class="attribute">
<dt id="cli.app.Application.name">
<tt class="descname">name</tt><a class="headerlink" href="#cli.app.Application.name" title="Permalink to this definition">¶</a></dt>
<dd><p>A string identifying the application.</p>
<p>Unless specified when the <a title="cli.app.Application" class="reference internal" href="#cli.app.Application"><tt class="xref docutils literal"><span class="pre">Application</span></tt></a> was created, this
property will examine the <tt class="xref docutils literal"><span class="pre">main</span></tt> callable and use its
name (<tt class="xref docutils literal"><span class="pre">__name__</span></tt> or <tt class="xref docutils literal"><span class="pre">func_name</span></tt> for classes or
functions, respectively).</p>
</dd></dl>

<dl class="method">
<dt id="cli.app.Application.post_run">
<tt class="descname">post_run</tt><big>(</big><em>returned</em><big>)</big><a class="headerlink" href="#cli.app.Application.post_run" title="Permalink to this definition">¶</a></dt>
<dd><p>Clean up after the application.</p>
<p>After <tt class="xref docutils literal"><span class="pre">main</span></tt> has been called, <a title="cli.app.Application.run" class="reference internal" href="#cli.app.Application.run"><tt class="xref docutils literal"><span class="pre">run()</span></tt></a> passes the
return value to this method. By default, <a title="cli.app.Application.post_run" class="reference internal" href="#cli.app.Application.post_run"><tt class="xref docutils literal"><span class="pre">post_run()</span></tt></a>
decides whether to call <tt class="xref docutils literal"><span class="pre">sys.exit()</span></tt> (based on the
value of the <tt class="xref docutils literal"><span class="pre">exit_after_main</span></tt> attribute) or pass the
value back to <a title="cli.app.Application.run" class="reference internal" href="#cli.app.Application.run"><tt class="xref docutils literal"><span class="pre">run()</span></tt></a>. Subclasses should probably preserve
this behavior.</p>
</dd></dl>

<dl class="method">
<dt id="cli.app.Application.pre_run">
<tt class="descname">pre_run</tt><big>(</big><big>)</big><a class="headerlink" href="#cli.app.Application.pre_run" title="Permalink to this definition">¶</a></dt>
<dd><p>Perform any last-minute configuration.</p>
<p>The <a title="cli.app.Application.pre_run" class="reference internal" href="#cli.app.Application.pre_run"><tt class="xref docutils literal"><span class="pre">pre_run()</span></tt></a> method is called by the <a title="cli.app.Application.run" class="reference internal" href="#cli.app.Application.run"><tt class="xref docutils literal"><span class="pre">run()</span></tt></a> method
before <tt class="xref docutils literal"><span class="pre">main</span></tt> is executed. This is a good time to do
things like read a configuration file or parse command line
arguments. The base implementation does nothing.</p>
</dd></dl>

<dl class="method">
<dt id="cli.app.Application.run">
<tt class="descname">run</tt><big>(</big><big>)</big><a class="headerlink" href="#cli.app.Application.run" title="Permalink to this definition">¶</a></dt>
<dd><p>Run the application, returning its return value.</p>
<p>This method first calls <a title="cli.app.Application.pre_run" class="reference internal" href="#cli.app.Application.pre_run"><tt class="xref docutils literal"><span class="pre">pre_run()</span></tt></a> and then calls
<tt class="xref docutils literal"><span class="pre">main</span></tt>, passing it an instance of the <a title="cli.app.Application" class="reference internal" href="#cli.app.Application"><tt class="xref docutils literal"><span class="pre">Application</span></tt></a>
itself as its only argument. The return value is then passed to
<a title="cli.app.Application.post_run" class="reference internal" href="#cli.app.Application.post_run"><tt class="xref docutils literal"><span class="pre">post_run()</span></tt></a> which may modify it (or terminate the
application entirely).</p>
</dd></dl>

<dl class="method">
<dt id="cli.app.Application.setup">
<tt class="descname">setup</tt><big>(</big><big>)</big><a class="headerlink" href="#cli.app.Application.setup" title="Permalink to this definition">¶</a></dt>
<dd><p>Configure the <a title="cli.app.Application" class="reference internal" href="#cli.app.Application"><tt class="xref docutils literal"><span class="pre">Application</span></tt></a>.</p>
<p>This method is provided so that subclasses can easily customize
the configuration process without having to reimplement the base
constructor. <a title="cli.app.Application.setup" class="reference internal" href="#cli.app.Application.setup"><tt class="xref docutils literal"><span class="pre">setup()</span></tt></a> is called once, either by the base
constructor or <tt class="xref docutils literal"><span class="pre">__call__()</span></tt>.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="cli.app.CommandLineApp">
<em class="property">class </em><tt class="descclassname">cli.app.</tt><tt class="descname">CommandLineApp</tt><big>(</big><em>main=None</em>, <em>usage=None</em>, <em>epilog=None</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#cli.app.CommandLineApp" title="Permalink to this definition">¶</a></dt>
<dd><p>A command line application.</p>
<p>Command line applications extend the basic <a title="cli.app.Application" class="reference internal" href="#cli.app.Application"><tt class="xref docutils literal"><span class="pre">Application</span></tt></a>
framework to support command line parsing using the <tt class="xref docutils literal"><span class="pre">argparse</span></tt>
module. As with <a title="cli.app.Application" class="reference internal" href="#cli.app.Application"><tt class="xref docutils literal"><span class="pre">Application</span></tt></a> itself, <em>main</em> should be a
callable. Other arguments are:</p>
<p><em>usage</em> is a string describing command line usage of the
application. If it is not supplied, <tt class="xref docutils literal"><span class="pre">argparse</span></tt> will
automatically generate a usage statement based on the application&#8217;s
parameters.</p>
<p><em>epilog</em> is text appended to the argument descriptions.</p>
<p>The rest of the arguments are passed to the <a title="cli.app.Application" class="reference internal" href="#cli.app.Application"><tt class="xref docutils literal"><span class="pre">Application</span></tt></a>
constructor.</p>
<dl class="method">
<dt id="cli.app.CommandLineApp.add_param">
<tt class="descname">add_param</tt><big>(</big><em>*args</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#cli.app.CommandLineApp.add_param" title="Permalink to this definition">¶</a></dt>
<dd><p>Add a parameter.</p>
<p><a title="cli.app.CommandLineApp.add_param" class="reference internal" href="#cli.app.CommandLineApp.add_param"><tt class="xref docutils literal"><span class="pre">add_param()</span></tt></a> wraps
<tt class="xref docutils literal"><span class="pre">argparse.ArgumentParser.add_argument()</span></tt>, storing the
parameter options in a dictionary. This information can be used
later by other subclasses when deciding whether to override
parameters.</p>
</dd></dl>

<dl class="attribute">
<dt id="cli.app.CommandLineApp.argparser_factory">
<tt class="descname">argparser_factory</tt><a class="headerlink" href="#cli.app.CommandLineApp.argparser_factory" title="Permalink to this definition">¶</a></dt>
<dd>alias of <tt class="xref docutils literal"><span class="pre">ArgumentParser</span></tt></dd></dl>

<dl class="attribute">
<dt id="cli.app.CommandLineApp.formatter">
<tt class="descname">formatter</tt><a class="headerlink" href="#cli.app.CommandLineApp.formatter" title="Permalink to this definition">¶</a></dt>
<dd>alias of <tt class="xref docutils literal"><span class="pre">HelpFormatter</span></tt></dd></dl>

<dl class="attribute">
<dt id="cli.app.CommandLineApp.params">
<tt class="descname">params</tt><a class="headerlink" href="#cli.app.CommandLineApp.params" title="Permalink to this definition">¶</a></dt>
<dd>The <a title="cli.app.CommandLineApp.params" class="reference internal" href="#cli.app.CommandLineApp.params"><tt class="xref docutils literal"><span class="pre">params</span></tt></a> attribute is an object with attributes
containing the values of the parsed command line arguments.
Specifically, its an instance of <tt class="xref docutils literal"><span class="pre">argparse.Namespace</span></tt>,
but only the mapping of attributes to argument values should be
relied upon.</dd></dl>

<dl class="method">
<dt id="cli.app.CommandLineApp.pre_run">
<tt class="descname">pre_run</tt><big>(</big><big>)</big><a class="headerlink" href="#cli.app.CommandLineApp.pre_run" title="Permalink to this definition">¶</a></dt>
<dd><p>Parse command line.</p>
<p>During <a title="cli.app.CommandLineApp.pre_run" class="reference internal" href="#cli.app.CommandLineApp.pre_run"><tt class="xref docutils literal"><span class="pre">pre_run()</span></tt></a>, <a title="cli.app.CommandLineApp" class="reference internal" href="#cli.app.CommandLineApp"><tt class="xref docutils literal"><span class="pre">CommandLineApp</span></tt></a>
passes the application&#8217;s <tt class="xref docutils literal"><span class="pre">argv</span></tt> attribute to
<tt class="xref docutils literal"><span class="pre">argparse.ArgumentParser.parse_args()</span></tt>. The results are
stored in <a title="cli.app.CommandLineApp.params" class="reference internal" href="#cli.app.CommandLineApp.params"><tt class="xref docutils literal"><span class="pre">params</span></tt></a>.</p>
</dd></dl>

<dl class="method">
<dt id="cli.app.CommandLineApp.setup">
<tt class="descname">setup</tt><big>(</big><big>)</big><a class="headerlink" href="#cli.app.CommandLineApp.setup" title="Permalink to this definition">¶</a></dt>
<dd><p>Configure the <a title="cli.app.CommandLineApp" class="reference internal" href="#cli.app.CommandLineApp"><tt class="xref docutils literal"><span class="pre">CommandLineApp</span></tt></a>.</p>
<p>During setup, the application instantiates the
<tt class="xref docutils literal"><span class="pre">argparse.ArgumentParser</span></tt> and adds a version parameter
(<em class="xref">-V</em>, to avoid clashing with <em class="xref">-v</em>
verbose).</p>
</dd></dl>

<dl class="method">
<dt id="cli.app.CommandLineApp.update_params">
<tt class="descname">update_params</tt><big>(</big><em>**params</em><big>)</big><a class="headerlink" href="#cli.app.CommandLineApp.update_params" title="Permalink to this definition">¶</a></dt>
<dd><p>Update the parameter namespace.</p>
<p>The keys and values in <em>params</em> will become the names and values
of attributes in the <a title="cli.app.CommandLineApp.params" class="reference internal" href="#cli.app.CommandLineApp.params"><tt class="xref docutils literal"><span class="pre">params</span></tt></a> attribute.</p>
</dd></dl>

</dd></dl>

<div class="section" id="cli-log-logging-applications">
<h3><tt class="xref docutils literal"><span class="pre">cli.log</span></tt> &#8211; logging applications<a class="headerlink" href="#cli-log-logging-applications" title="Permalink to this headline">¶</a></h3>
<p>Logging applications use the standard library <tt class="xref docutils literal"><span class="pre">logging</span></tt> module to
handle log messages.</p>
</div>
<dl class="class">
<dt id="cli.log.LoggingApp">
<em class="property">class </em><tt class="descclassname">cli.log.</tt><tt class="descname">LoggingApp</tt><big>(</big><em>main=None</em>, <em>stream=&lt;open file '&lt;stdout&gt;'</em>, <em>mode 'w' at 0x812be070&gt;</em>, <em>logfile=None</em>, <em>message_format='%(message)s'</em>, <em>date_format='%(asctime)s %(message)s'</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#cli.log.LoggingApp" title="Permalink to this definition">¶</a></dt>
<dd><p>A command-line application that knows how to log.</p>
<p>The <a title="cli.log.LoggingApp" class="reference internal" href="#cli.log.LoggingApp"><tt class="xref docutils literal"><span class="pre">LoggingApp</span></tt></a> further extends the <a title="cli.app.CommandLineApp" class="reference internal" href="#cli.app.CommandLineApp"><tt class="xref docutils literal"><span class="pre">cli.app.CommandLineApp</span></tt></a>,
allowing command line configuration of the application logger. In
addition to those supported by the standard <a title="cli.app.Application" class="reference internal" href="#cli.app.Application"><tt class="xref docutils literal"><span class="pre">cli.app.Application</span></tt></a> and
<a title="cli.app.CommandLineApp" class="reference internal" href="#cli.app.CommandLineApp"><tt class="xref docutils literal"><span class="pre">cli.app.CommandLineApp</span></tt></a>, arguments are:</p>
<p><em>stream</em> is an open file object to which the log messages will be
written. By default, this is standard output (not standard error, as
might be expected).</p>
<p><em>logfile</em> is the name of a file which will be opened by the
<tt class="xref docutils literal"><span class="pre">logging.FileHandler</span></tt>.</p>
<p><em>message_format</em> and <em>date_format</em> are passed directly to the 
<a title="cli.log.CommandLineLogger" class="reference internal" href="#cli.log.CommandLineLogger"><tt class="xref docutils literal"><span class="pre">CommandLineLogger</span></tt></a> and are interpreted as in the 
<tt class="xref docutils literal"><span class="pre">logging</span></tt> package.</p>
<dl class="method">
<dt id="cli.log.LoggingApp.pre_run">
<tt class="descname">pre_run</tt><big>(</big><big>)</big><a class="headerlink" href="#cli.log.LoggingApp.pre_run" title="Permalink to this definition">¶</a></dt>
<dd><p>Set the verbosity level and configure the logger.</p>
<p>The application passes the <tt class="xref docutils literal"><span class="pre">params</span></tt> object to the
<a title="cli.log.CommandLineLogger" class="reference internal" href="#cli.log.CommandLineLogger"><tt class="xref docutils literal"><span class="pre">CommandLineLogger</span></tt></a>&#8216;s special <tt class="xref docutils literal"><span class="pre">setLevel()</span></tt> method to
set the logger&#8217;s verbosity and then initializes the logging
handlers. If the <tt class="xref docutils literal"><span class="pre">logfile</span></tt> attribute is not <tt class="xref docutils literal"><span class="pre">None</span></tt>, it
is passed to a <tt class="xref docutils literal"><span class="pre">logging.FileHandler</span></tt> instance and that is
added to the handler list. Otherwise, if the <tt class="xref docutils literal"><span class="pre">stream</span></tt>
attribute is not <tt class="xref docutils literal"><span class="pre">None</span></tt>, it is passed to a
<tt class="xref docutils literal"><span class="pre">logging.StreamHandler</span></tt> instance and that becomes the
main handler.</p>
</dd></dl>

<dl class="method">
<dt id="cli.log.LoggingApp.setup">
<tt class="descname">setup</tt><big>(</big><big>)</big><a class="headerlink" href="#cli.log.LoggingApp.setup" title="Permalink to this definition">¶</a></dt>
<dd><p>Configure the <a title="cli.log.LoggingApp" class="reference internal" href="#cli.log.LoggingApp"><tt class="xref docutils literal"><span class="pre">LoggingApp</span></tt></a>.</p>
<p>This method adds the <em class="xref">-l</em>, <em class="xref">q</em>,
<em class="xref">-s</em> and <em class="xref">-v</em> parameters to the
application and instantiates the <tt class="xref docutils literal"><span class="pre">log</span></tt> attribute.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="cli.log.CommandLineLogger">
<em class="property">class </em><tt class="descclassname">cli.log.</tt><tt class="descname">CommandLineLogger</tt><big>(</big><em>name</em>, <em>level=0</em><big>)</big><a class="headerlink" href="#cli.log.CommandLineLogger" title="Permalink to this definition">¶</a></dt>
<dd><p>Provide extra configuration smarts for loggers.</p>
<p>In addition to the powers of a regular logger, a CommandLineLogger can
set its verbosity levels based on a populated argparse.Namespace.</p>
<dl class="attribute">
<dt id="cli.log.CommandLineLogger.default_level">
<tt class="descname">default_level</tt><a class="headerlink" href="#cli.log.CommandLineLogger.default_level" title="Permalink to this definition">¶</a></dt>
<dd><p>An integer representing the default logging level.</p>
<p>Default: <tt class="xref docutils literal"><span class="pre">logging.WARN</span></tt> (only warning messages will be
shown).</p>
</dd></dl>

<dl class="method">
<dt id="cli.log.CommandLineLogger.setLevel">
<tt class="descname">setLevel</tt><big>(</big><em>ns</em><big>)</big><a class="headerlink" href="#cli.log.CommandLineLogger.setLevel" title="Permalink to this definition">¶</a></dt>
<dd><p>Set the logger verbosity level.</p>
<p><em>ns</em> is an object with <tt class="xref docutils literal"><span class="pre">verbose</span></tt>, <tt class="xref docutils literal"><span class="pre">quiet</span></tt> and
<tt class="xref docutils literal"><span class="pre">silent</span></tt> attributes. <tt class="xref docutils literal"><span class="pre">verbose</span></tt> and <tt class="xref docutils literal"><span class="pre">quiet</span></tt> may
be positive integers or zero; <tt class="xref docutils literal"><span class="pre">silent</span></tt> is <tt class="xref docutils literal"><span class="pre">True</span></tt> or <tt class="xref docutils literal"><span class="pre">False</span></tt>.
If <tt class="xref docutils literal"><span class="pre">silent</span></tt> is True, the logger&#8217;s level will be set to
<a title="cli.log.CommandLineLogger.silent_level" class="reference internal" href="#cli.log.CommandLineLogger.silent_level"><tt class="xref docutils literal"><span class="pre">silent_level</span></tt></a>. Otherwise, the difference between
<tt class="xref docutils literal"><span class="pre">quiet</span></tt> and <tt class="xref docutils literal"><span class="pre">verbose</span></tt> will be multiplied by 10 so it
fits on the standard logging scale and then added to
<a title="cli.log.CommandLineLogger.default_level" class="reference internal" href="#cli.log.CommandLineLogger.default_level"><tt class="xref docutils literal"><span class="pre">default_level</span></tt></a>.</p>
</dd></dl>

<dl class="attribute">
<dt id="cli.log.CommandLineLogger.silent_level">
<tt class="descname">silent_level</tt><a class="headerlink" href="#cli.log.CommandLineLogger.silent_level" title="Permalink to this definition">¶</a></dt>
<dd><p>An integer representing the silent logging level.</p>
<p>Default: <tt class="xref docutils literal"><span class="pre">logging.CRITICAL</span></tt> (only critical messages will
be shown).</p>
</dd></dl>

</dd></dl>

<div class="section" id="cli-daemon-daemonizing-applications">
<h3><tt class="xref docutils literal"><span class="pre">cli.daemon</span></tt> &#8211; daemonizing applications<a class="headerlink" href="#cli-daemon-daemonizing-applications" title="Permalink to this headline">¶</a></h3>
<p>Daemonizing applications run in the background, forking themselves off.</p>
</div>
<dl class="class">
<dt id="cli.daemon.DaemonizingApp">
<em class="property">class </em><tt class="descclassname">cli.daemon.</tt><tt class="descname">DaemonizingApp</tt><big>(</big><em>main=None</em>, <em>pidfile=None</em>, <em>chdir='/'</em>, <em>null='/dev/null'</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#cli.daemon.DaemonizingApp" title="Permalink to this definition">¶</a></dt>
<dd><p>A command-line application that knows how to daemonize.</p>
<p>The <a title="cli.daemon.DaemonizingApp" class="reference internal" href="#cli.daemon.DaemonizingApp"><tt class="xref docutils literal"><span class="pre">DaemonizingApp</span></tt></a> extends the <tt class="xref docutils literal"><span class="pre">LoggingApp</span></tt> (for
it&#8217;s not very helpful to daemonize without being able to log
messages somewhere). In addition to those supported by the
standard <tt class="xref docutils literal"><span class="pre">Application</span></tt>, <tt class="xref docutils literal"><span class="pre">CommandLineApp</span></tt> and
<tt class="xref docutils literal"><span class="pre">LoggingApp</span></tt>, arguments are:</p>
<p><em>pidfile</em> is a string pointing to a file where the application will
write its process ID after it daemonizes. If it is <tt class="xref docutils literal"><span class="pre">None</span></tt>, no such
file will be created.</p>
<p><em>chdir</em> is a string pointing to a directory to which the application
will change after it daemonizes.</p>
<p><em>null</em> is a string representing a file that will be opened to
replace stdin, stdout and stderr when the application daemonizes. By
default, this <tt class="xref docutils literal"><span class="pre">os.path.devnull</span></tt>.</p>
<dl class="method">
<dt id="cli.daemon.DaemonizingApp.daemonize">
<tt class="descname">daemonize</tt><big>(</big><big>)</big><a class="headerlink" href="#cli.daemon.DaemonizingApp.daemonize" title="Permalink to this definition">¶</a></dt>
<dd><p>Run in the background.</p>
<p><a title="cli.daemon.DaemonizingApp.daemonize" class="reference internal" href="#cli.daemon.DaemonizingApp.daemonize"><tt class="xref docutils literal"><span class="pre">daemonize()</span></tt></a> must be called explicitly by the application
when it&#8217;s ready to fork into the background. It forks, flushes
and replaces stdin, stderr and stdout with the open <tt class="xref docutils literal"><span class="pre">null</span></tt>
file and, if requested on the command line, writes its PID to a
file and changes user/group.</p>
</dd></dl>

<dl class="method">
<dt id="cli.daemon.DaemonizingApp.setup">
<tt class="descname">setup</tt><big>(</big><big>)</big><a class="headerlink" href="#cli.daemon.DaemonizingApp.setup" title="Permalink to this definition">¶</a></dt>
<dd><p>Configure the <a title="cli.daemon.DaemonizingApp" class="reference internal" href="#cli.daemon.DaemonizingApp"><tt class="xref docutils literal"><span class="pre">DaemonizingApp</span></tt></a>.</p>
<p>This method adds the <em class="xref">-d</em>, <em class="xref">u</em>,
and <em class="xref">-p</em> parameters to the application.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="testing-cli">
<h2>Testing <tt class="xref docutils literal"><span class="pre">cli</span></tt><a class="headerlink" href="#testing-cli" title="Permalink to this headline">¶</a></h2>
<p>cli ships with a number of unit tests that help ensure that the code run
correctly. The tests live in the <tt class="docutils literal"><span class="pre">tests</span></tt> package and can be run by
<tt class="docutils literal"><span class="pre">setup.py</span></tt>:</p>
<div class="highlight-python"><pre>$ python setup.py test</pre>
</div>
<p>You can get a sense for how completely the unit tests exercise cli by
running the <a class="reference external" href="http://nedbatchelder.com/code/coverage/">coverage</a> tool:</p>
<div class="highlight-python"><pre>$ coverage run --branch setup.py test</pre>
</div>
<p><tt class="docutils literal"><span class="pre">coverage</span></tt> tracks the code statements and branches that the test suite
touches and can generate a report listing the lines of code that are
missed:</p>
<div class="highlight-python"><pre>$ coverage report -m --omit "tests,/home/will/lib,lib/cli/ext,setup"</pre>
</div>
<p>It&#8217;s useful to omit the third party code directory (<tt class="docutils literal"><span class="pre">ext</span></tt>) as well as
the path to the Python standard library as well as <tt class="docutils literal"><span class="pre">setup.py</span></tt> and the
tests themselves.</p>
<p>All new code in cli should be accompanied by unit tests. Eventually,
the unit tests should be complemented by a set of functional tests
(especially to stress things like the daemon code).</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <h3><a href="#">Table Of Contents</a></h3>
            <ul>
<li><a class="reference external" href="#"><tt class="docutils literal"><span class="pre">cli</span></tt> &#8212; command line tools</a><ul>
<li><a class="reference external" href="#installing-cli">Installing <tt class="docutils literal"><span class="pre">cli</span></tt></a></li>
<li><a class="reference external" href="#a-quick-tour-of-cli-s-features">A quick tour of <tt class="docutils literal"><span class="pre">cli</span></tt>&#8216;s features</a></li>
<li><a class="reference external" href="#basic-usage">Basic usage</a></li>
<li><a class="reference external" href="#command-line-best-practices">Command line best practices</a></li>
<li><a class="reference external" href="#extending-cli-app-application">Extending <tt class="docutils literal"><span class="pre">cli.app.Application</span></tt></a></li>
<li><a class="reference external" href="#module-cli.daemon">API</a><ul>
<li><a class="reference external" href="#cli-app-basic-applications"><tt class="docutils literal"><span class="pre">cli.app</span></tt> &#8211; basic applications</a></li>
<li><a class="reference external" href="#cli-log-logging-applications"><tt class="docutils literal"><span class="pre">cli.log</span></tt> &#8211; logging applications</a></li>
<li><a class="reference external" href="#cli-daemon-daemonizing-applications"><tt class="docutils literal"><span class="pre">cli.daemon</span></tt> &#8211; daemonizing applications</a></li>
</ul>
</li>
<li><a class="reference external" href="#testing-cli">Testing <tt class="docutils literal"><span class="pre">cli</span></tt></a></li>
</ul>
</li>
</ul>

            <h3>This Page</h3>
            <ul class="this-page-menu">
              <li><a href="_sources/index.txt"
                     rel="nofollow">Show Source</a></li>
            </ul>
          <div id="searchbox" style="display: none">
            <h3>Quick search</h3>
              <form class="search" action="search.html" method="get">
                <input type="text" name="q" size="18" />
                <input type="submit" value="Go" />
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
              </form>
              <p class="searchtip" style="font-size: 90%">
              Enter search terms or a module, class or function name.
              </p>
          </div>
          <script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="modindex.html" title="Global Module Index"
             >modules</a> |</li>
        <li><a href="#">pyCLI v1.0 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
      &copy; Copyright 2009-2010 Will Maier &lt;will@m.aier.us&gt;.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 0.6.4.
    </div>
  </body>
</html>