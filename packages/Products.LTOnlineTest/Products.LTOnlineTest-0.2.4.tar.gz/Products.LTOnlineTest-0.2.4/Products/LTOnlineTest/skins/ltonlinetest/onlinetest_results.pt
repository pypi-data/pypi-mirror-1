<html metal:use-macro="here/main_template/macros/master">
  <head>
    <title tal:content="template/title">The title</title>
  </head>
  <body>
    

<div metal:fill-slot="header">

  <h3> Results </h3>
</div><!-- header slot -->

<div metal:fill-slot="main">

  <div tal:define="submission here/getSubmissionRecord;
                   answers python:submission['answers'];
                   auth_filter nocall: modules/ZTUtils/LazyFilter;
                   default_types python:( 'Question'
                                        );
                   types types | here/show_content_types | default_types;
                   raw_items python: here.contentValues(
                                     filter={'portal_type': types } );
                   items python: auth_filter( raw_items, skip='View' );
                  ">
  <tal:block tal:condition="items">

  <h4 tal:content="string:Score: ${submission/mark}%" />

  <p>Your answers are highlighted
  <span style="border-bottom: 1px dashed red; font-weight: bold">like this.</span></p>
  
   <ol>
     <div tal:omit-tag="" tal:repeat="item items">
     <li  tal:define="field python:item.Schema()['choices'];
                      accessor python:getattr(item, field.accessor);
                      cfield python:item.Schema()['answer'];
                      caccessor python:getattr(item, cfield.accessor);
                      cindex python:caccessor()-1;
                      correct python:accessor()[cindex];
                      mark python:int(correct == answers[item.id])">
       
       <b tal:content="item/Title" />
       <br /><br />
       <div tal:omit-tag="" 
            tal:define="field python:item.Schema()['question-text'];
                        accessor python:getattr(item, field.accessor)" >
         <span tal:replace="structure python:accessor()" />
       </div>
       <blockquote>
         <div tal:omit-tag="" tal:repeat="choice python:accessor()">
             <img src="onlinetest_correct.gif" 
                       tal:condition="python:choice == correct" />
             <img src="onlinetest_wrong.gif"
                       tal:condition="python:choice != correct" />
             <span style="border-bottom: 1px dashed red; font-weight: bold"
                   tal:condition="python:choice == answers[item.id]"
                   tal:content="choice" />
             <span tal:omit-tag=""
                   tal:condition="python:choice != answers[item.id]"
                   tal:content="choice" />
           <br />
         </div>
       </blockquote>
       <div tal:omit-tag="" 
            tal:define="field python:item.Schema()['explanation'];
                        accessor python:getattr(item, field.accessor)" >
         <p>Explanation:<i tal:content="python:accessor()" /></p>
       </div> 
     </li>
     </div>
   </ol>

  </tal:block>
  </div>

</div><!-- main slot -->

  </body>
</html>