<html metal:use-macro="here/main_template/macros/master">
  <head>
    <title tal:content="template/title">The title</title>
  </head>
  <body>

<div metal:fill-slot="main">

 <h1 tal:content="structure here/title_or_id" class="documentFirstHeading">
          Title or id
        </h1>
    
        <div class="documentDescription">
            <h3>Test Report</h3>
        </div>
        <div>
         <form action="."
          name="clear_subsmissions"
          method="post" 
          tal:attributes="action string:${here/absolute_url}/onlinetest_report">
             <input type="hidden" name="doclear" value="1" />
             <input type="submit" name="Clear Submissions" value="Clear Submissions"/>
	 </form>
        <span tal:omit-tag="" tal:define="doclear request/doclear|nothing">
        <p tal:define="dummy python:here.deleteSubmission()" tal:condition="doclear">Submissions cleared.</p></span>
        </div>        
        <h5>Average Mark: <span tal:replace="python:here.average_mark()" />%
        </h5>
        
        <br />
        <h5>Individual Marks:</h5>
		<table class="listing" tal:define="userIds python:here.submittedIds()"
                               tal:condition="userIds">
			<tr>
				<th>Userid</th>
				<th>Mark (%)</th>
                                <th>Started</th>
                                <th>Finished</th>
                                <th>Time taken (mins)</th>
			</tr>

			<tal:block tal:repeat="userid userIds">
			<tr tal:define="oddrow repeat/userid/odd"
                tal:attributes="class python:test(oddrow,'odd','even')">
	       <tal:userid tal:define="submission python:here.getSubmissionRecord(userid)">
				<td tal:content="userid">User ID</td>
				<td tal:condition="python:submission.has_key('mark')">
                    <span tal:replace="python:submission['mark']" /></td>
				<td tal:condition="not:python:submission.has_key('mark')">0</td>
				<td tal:condition="python:submission.has_key('submitted')">
                    <span tal:replace="python:DateTime(submission['started']).strftime('%d-%B-%y %H:%M')" /></td>
				<td tal:condition="python:submission.has_key('submitted')">
                    <span tal:replace="python:DateTime(submission['submitted']).strftime('%d-%B-%y %H:%M')" /></td>
                                <td tal:condition="python:submission.has_key('submitted')">
                    <tal:timetaken tal:define="timetaken python:submission['submitted']-submission['started'];
                                               mtaken python: 1440 * timetaken;
                                               staken python: (mtaken * 60) - int(mtaken) * 60;
                                               ">
                    <span tal:replace="python:'%d:%02d' % (mtaken, staken)" /></tal:timetaken></td>
                                <td tal:condition="not:python:submission.has_key('submitted')">-</td>
	       </tal:userid>
			</tr>
			</tal:block>
		</table>

		<p tal:condition="not:python:here.submittedIds()">There have been no submissions yet</p>

</div><!-- main slot -->

  </body>
</html>
