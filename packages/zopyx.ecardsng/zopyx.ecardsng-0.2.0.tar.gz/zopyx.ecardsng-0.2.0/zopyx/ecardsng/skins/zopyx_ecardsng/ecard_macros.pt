<html i18n:domain="plone">

<metal:div define-macro="image_gallery"
           tal:define="wfStateFor python: lambda obj: obj.portal_workflow.getInfoFor(obj, 'review_state');
                       show_details show_details | python: 1">

  <tal:if condition="python: images or (not images and show_empty)">

      <table class="ecard-gallery" 
             tal:condition="images">
        <tbody tal:define="image_matrix python: context.ecard_matrix(images, cols)" >        
      
          <tr tal:repeat="lst image_matrix" >
            <td tal:repeat="image lst"  valign="top">
                <tal:if tal:condition="nocall: image">
                  <div>
                    <a tal:attributes="href string:${image/absolute_url}/view">
                      <img tal:attributes="src string:${image/absolute_url}/image_mini" />
                    </a>
                    <tal:if condition="show_details">
                      <br/>
                      <span class="ecard-image-id" tal:content="image/getId" />
                      <br/>
                      <span class="ecard-image-size" tal:content="string:${image/getObjSize} (${image/getWidth}x${image/getHeight})" />
                      <br/>
                    </tal:if>
            
                  </div>
                  <div class="ecard-title" tal:condition="image/Title" tal:content="image/Title" />
                  <div class="ecard-description" tal:content="image/Description" />

                  <a tal:attributes="href string:ecard_selection?image_id=${image/getId}">Send</a>

                </tal:if>
            </td>
          </tr>
        </tbody>
      </table>

      <div class="no-results" tal:condition="not: images" i18n:translate="no images">No images available</div>
  </tal:if>
</metal:div>


<metal:div define-macro="image_gallery_selection">

  <tal:if condition="python: images or (not images and show_empty)">

    <div class="field">

      <table class="mediaDbGallery" 
             tal:condition="images">

        <tbody tal:define="image_matrix python: context.ecard_matrix(images, cols);">

          <tr tal:repeat="lst image_matrix" >
            <td tal:repeat="image lst" >

                <tal:if tal:condition="nocall: image"
                        tal:define="current_index python: repeat['lst'].index*cols + repeat['image'].index">
                  <div tal:define="selected python: test(current_index == selected_image, 'selected_ecard', '')">

                    <a tal:attributes="href string:${context/absolute_url}/ecard_selection?index:int=$current_index">
                      <img tal:attributes="src   string:${image/absolute_url}/image_preview;
                                           class selected" />
                    </a>               
                    <br/>
                  </div>
                  <div class="documentTitle" tal:condition="image/Title" tal:content="image/Title" />
                  <div class="documentDescription" tal:content="image/Description" />
                </tal:if>

            </td>
          </tr>
        </tbody>
      </table>

      <div class="no-results" tal:condition="not: images" i18n:translate="no images">No images available</div>
    </div>
  </tal:if>
</metal:div>

<metal:macro define-macro="showValidationErrors">
    <tal:def define="errors options/state/getErrors">

          <div class="errors" tal:condition="errors">
            <div tal:content="request/portal_status_message|nothing" />
            <div tal:content="request/portal_error_message|nothing" />
            <ul>
              <li tal:repeat="error errors/values" tal:content="error" />
            </ul>
          </div>

    </tal:def>
</metal:macro>

</html>
