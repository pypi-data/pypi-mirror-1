<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.2.9: http://docutils.sourceforge.net/" />
<title>Upgrading to newer versions of Roundup</title>
<link rel="stylesheet" href="default.css" type="text/css" />
</head>
<body>
<div class="document" id="upgrading-to-newer-versions-of-roundup">
<h1 class="title">Upgrading to newer versions of Roundup</h1>
<p>Please read each section carefully and edit your tracker home files
accordingly.</p>
<div class="contents topic" id="contents">
<p class="topic-title"><a name="contents">Contents</a></p>
<ul class="simple">
<li><a class="reference" href="#migrating-from-0-6-x-to-0-6-3" id="id9" name="id9">Migrating from 0.6.x to 0.6.3</a><ul>
<li><a class="reference" href="#configuration" id="id10" name="id10">0.6.3 Configuration</a></li>
</ul>
</li>
<li><a class="reference" href="#migrating-from-0-5-to-0-6" id="id11" name="id11">Migrating from 0.5 to 0.6</a><ul>
<li><a class="reference" href="#id1" id="id12" name="id12">0.6.0 Configuration</a></li>
<li><a class="reference" href="#templating-changes" id="id13" name="id13">0.6.0 Templating changes</a></li>
<li><a class="reference" href="#form-handling-changes" id="id14" name="id14">0.6.0 Form handling changes</a></li>
<li><a class="reference" href="#multilingual-character-set-support" id="id15" name="id15">0.6.0 Multilingual character set support</a></li>
<li><a class="reference" href="#user-timezone-support" id="id16" name="id16">0.6.0 User timezone support</a></li>
<li><a class="reference" href="#search-page-structure" id="id17" name="id17">0.6.0 Search page structure</a></li>
<li><a class="reference" href="#notes-for-metakit-backend-users" id="id18" name="id18">0.6.0 Notes for metakit backend users</a></li>
</ul>
</li>
<li><a class="reference" href="#migrating-from-0-4-x-to-0-5-0" id="id19" name="id19">Migrating from 0.4.x to 0.5.0</a><ul>
<li><a class="reference" href="#id4" id="id20" name="id20">0.5.0 Configuration</a></li>
<li><a class="reference" href="#schema-specification" id="id21" name="id21">0.5.0 Schema Specification</a><ul>
<li><a class="reference" href="#database-backend-changes" id="id22" name="id22">0.5.0 Database backend changes</a></li>
<li><a class="reference" href="#journalling-changes" id="id23" name="id23">0.5.0 Journalling changes</a></li>
<li><a class="reference" href="#user-schema-changes" id="id24" name="id24">0.5.0 User schema changes</a></li>
<li><a class="reference" href="#security-settings" id="id25" name="id25">0.5.0 Security Settings</a></li>
<li><a class="reference" href="#user-changes" id="id26" name="id26">0.5.0 User changes</a></li>
</ul>
</li>
<li><a class="reference" href="#cgi-interface-changes" id="id27" name="id27">0.5.0 CGI interface changes</a></li>
<li><a class="reference" href="#html-templating" id="id28" name="id28">0.5.0 HTML templating</a></li>
<li><a class="reference" href="#detectors" id="id29" name="id29">0.5.0 Detectors</a></li>
</ul>
</li>
<li><a class="reference" href="#migrating-from-0-4-1-to-0-4-2" id="id30" name="id30">Migrating from 0.4.1 to 0.4.2</a><ul>
<li><a class="reference" href="#id5" id="id31" name="id31">0.4.2 Configuration</a></li>
<li><a class="reference" href="#changes-to-detectors" id="id32" name="id32">0.4.2 Changes to detectors</a></li>
<li><a class="reference" href="#html-templating-changes" id="id33" name="id33">0.4.2 HTML templating changes</a></li>
</ul>
</li>
<li><a class="reference" href="#migrating-from-0-4-0-to-0-4-1" id="id34" name="id34">Migrating from 0.4.0 to 0.4.1</a><ul>
<li><a class="reference" href="#files-storage" id="id35" name="id35">0.4.1 Files storage</a></li>
<li><a class="reference" href="#id6" id="id36" name="id36">0.4.1 Configuration</a></li>
<li><a class="reference" href="#alternate-e-mail-addresses" id="id37" name="id37">0.4.1 Alternate E-Mail Addresses</a></li>
</ul>
</li>
<li><a class="reference" href="#migrating-from-0-3-x-to-0-4-0" id="id38" name="id38">Migrating from 0.3.x to 0.4.0</a><ul>
<li><a class="reference" href="#message-id-and-in-reply-to-addition" id="id39" name="id39">0.4.0 Message-ID and In-Reply-To addition</a></li>
<li><a class="reference" href="#id7" id="id40" name="id40">0.4.0 Configuration</a></li>
<li><a class="reference" href="#cgi-script-roundup-cgi" id="id41" name="id41">0.4.0 CGI script roundup.cgi</a></li>
<li><a class="reference" href="#nosy-reactor" id="id42" name="id42">0.4.0 Nosy reactor</a></li>
<li><a class="reference" href="#id8" id="id43" name="id43">0.4.0 HTML templating</a></li>
</ul>
</li>
<li><a class="reference" href="#migrating-from-0-2-x-to-0-3-x" id="id44" name="id44">Migrating from 0.2.x to 0.3.x</a><ul>
<li><a class="reference" href="#x-cookie-authentication-changes" id="id45" name="id45">0.3.x Cookie Authentication changes</a></li>
<li><a class="reference" href="#x-password-encoding" id="id46" name="id46">0.3.x Password encoding</a></li>
<li><a class="reference" href="#x-configuration" id="id47" name="id47">0.3.x Configuration</a></li>
<li><a class="reference" href="#x-cgi-script-roundup-cgi" id="id48" name="id48">0.3.x CGI script roundup.cgi</a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="migrating-from-0-6-x-to-0-6-3">
<h1><a class="toc-backref" href="#id9" name="migrating-from-0-6-x-to-0-6-3">Migrating from 0.6.x to 0.6.3</a></h1>
<div class="section" id="configuration">
<h2><a class="toc-backref" href="#id10" name="configuration">0.6.3 Configuration</a></h2>
<p>You will need to copy the file:</p>
<pre class="literal-block">
templates/classic/detectors/__init__.py
</pre>
<p>to your tracker's <tt class="literal"><span class="pre">detectors</span></tt> directory, replacing the one already there.
This fixes a couple of bugs in that file.</p>
</div>
</div>
<div class="section" id="migrating-from-0-5-to-0-6">
<h1><a class="toc-backref" href="#id11" name="migrating-from-0-5-to-0-6">Migrating from 0.5 to 0.6</a></h1>
<div class="section" id="id1">
<h2><a class="toc-backref" href="#id12" name="id1">0.6.0 Configuration</a></h2>
<p>Introduced EMAIL_FROM_TAG config variable. This value is inserted into
the From: line of nosy email. If the sending user is &quot;Foo Bar&quot;, the
From: line is usually:</p>
<pre class="literal-block">
&quot;Foo Bar&quot; &lt;issue_tracker&#64;tracker.example&gt;
</pre>
<p>the EMAIL_FROM_TAG goes inside the &quot;Foo Bar&quot; quotes like so:</p>
<pre class="literal-block">
&quot;Foo Bar EMAIL_FROM_TAG&quot; &lt;issue_tracker&#64;tracker.example&gt;
</pre>
<p>I've altered the mechanism in the detectors __init__.py module so that it
doesn't cross-import detectors from other trackers (if you run more than one
in a single roundup-server). This change means that you'll need to copy the
__init__.py from roundup/templates/classic/detectors/__init__.py to your
&lt;tracker home&gt;/detectors/__init__.py. Don't worry, the &quot;classic&quot; __init__ is a
one-size-fits-all, so it'll work even if you've added/removed detectors.</p>
</div>
<div class="section" id="templating-changes">
<h2><a class="toc-backref" href="#id13" name="templating-changes">0.6.0 Templating changes</a></h2>
<p>The <tt class="literal"><span class="pre">user.item</span></tt> template (in the tracker home &quot;templates&quot; directory)
needs to have the following hidden variable added to its form (between the
<tt class="literal"><span class="pre">&lt;form...&gt;</span></tt> and <tt class="literal"><span class="pre">&lt;/form&gt;</span></tt> tags:</p>
<pre class="literal-block">
&lt;input type=&quot;hidden&quot; name=&quot;:template&quot; value=&quot;item&quot;&gt;
</pre>
</div>
<div class="section" id="form-handling-changes">
<h2><a class="toc-backref" href="#id14" name="form-handling-changes">0.6.0 Form handling changes</a></h2>
<p>Roundup's form handling capabilities have been significantly expanded. This
should not affect users of 0.5 installations - but if you find you're
getting errors from form submissions, please ask for help on the Roundup
users mailing list:</p>
<blockquote>
<a class="reference" href="http://lists.sourceforge.net/lists/listinfo/roundup-users">http://lists.sourceforge.net/lists/listinfo/roundup-users</a></blockquote>
<p>See the customisation doc section on <a class="reference" href="customizing.html#form-values">Form Values</a> for documentation of the
new form variables possible.</p>
</div>
<div class="section" id="multilingual-character-set-support">
<h2><a class="toc-backref" href="#id15" name="multilingual-character-set-support">0.6.0 Multilingual character set support</a></h2>
<p>Added internationalization support. This is done via encoding all data
stored in roundup database to utf-8 (unicode encoding). To support utf-8 in
web interface you should add the folowing line to your tracker's html/page
and html/_generic.help files inside &lt;head&gt; tag:</p>
<pre class="literal-block">
&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=utf-8&quot;&gt;
</pre>
<p>Since latin characters in utf-8 have the same codes as in ASCII table, this
modification is optional for users who use only plain latin characters.</p>
<p>After this modification, you will be able to see and enter any world
character via web interface. Data received via mail interface also converted
to utf-8, however only new messages will be converted. If your roundup
database contains some of non-ASCII characters in one of 8-bit encoding,
they will not be visible in new unicode environment. Some of such data (e.g.
user names, keywords, etc)  can be edited by administrator, the others
(e.g. messages' contents) is not editable via web interface. Currently there
is no tool for converting such data, the only solution is to close
appropriate old issues and create new ones with the same content.</p>
</div>
<div class="section" id="user-timezone-support">
<h2><a class="toc-backref" href="#id16" name="user-timezone-support">0.6.0 User timezone support</a></h2>
<p>From version 0.6.0 roundup supports displaying of Date data in user' local
timezone if he/she has provided timezone information. To make it possible
some modification to tracker's schema and HTML templates are required.
First you must add string property 'timezone' to user class in dbinit.py
like this:</p>
<pre class="literal-block">
user = Class(db, &quot;user&quot;, 
                username=String(),   password=Password(),
                address=String(),    realname=String(), 
                phone=String(),      organisation=String(),
                alternate_addresses=String(),
                queries=Multilink('query'), roles=String(),
                timezone=String())
</pre>
<p>And second - html interface. Add following lines to
$TRACKER_HOME/html/user.item template:</p>
<pre class="literal-block">
&lt;tr&gt;
 &lt;th&gt;Timezone&lt;/th&gt;
 &lt;td tal:content=&quot;structure context/timezone/field&quot;&gt;timezone&lt;/td&gt;
&lt;/tr&gt;
</pre>
<p>After that all users should be able to provide their timezone information.
Timezone should be a positive or negative integer - offset from GMT.</p>
<p>After providing timezone, roundup will show all dates values, found in web
and mail interfaces in local time. It will also accept any Date info in
local time, convert and store it in GMT.</p>
</div>
<div class="section" id="search-page-structure">
<h2><a class="toc-backref" href="#id17" name="search-page-structure">0.6.0 Search page structure</a></h2>
<p>In order to accomodate query editing the search page has been restructured. If
you want to provide your users with query editing, you should update your
search page using the macros detailed in the customisation doc section
<a class="reference" href="customizing.html#searching-on-categories">Searching on categories</a>.</p>
<p>Also, the url field in the query class no longer starts with a '?'. You'll need
to remove this question mark from the url field to support queries. There's
a script in the &quot;tools&quot; directory called <tt class="literal"><span class="pre">migrate-queries.py</span></tt> that should
automatically change any existing queries for you. As always, make a backup
of your database before running such a script.</p>
</div>
<div class="section" id="notes-for-metakit-backend-users">
<h2><a class="toc-backref" href="#id18" name="notes-for-metakit-backend-users">0.6.0 Notes for metakit backend users</a></h2>
<p>Roundup 0.6.0 introduced searching on ranges of dates and intervals. To
support it, some modifications to interval storing routine were made. So if
your tracker uses metakit backend and your db schema contains intervals
property, searches on that property will not be accurate for db items that
was stored before roundup' upgrade. However all new records should be
searchable on intervals.</p>
<p>It is possible to convert your database to new format: you can export and
import back all your data (consult &quot;Migrating backends&quot; in &quot;Maintenance&quot;
documentation). After this operation all your interval properties should
become searchable.</p>
<p>Users of backends others than metakit should not worry about this issue.</p>
</div>
</div>
<div class="section" id="migrating-from-0-4-x-to-0-5-0">
<h1><a class="toc-backref" href="#id19" name="migrating-from-0-4-x-to-0-5-0">Migrating from 0.4.x to 0.5.0</a></h1>
<p>This has been a fairly major revision of Roundup:</p>
<ol class="arabic simple">
<li>Brand new, much more powerful, flexible, tasty and nutritious templating.
Unfortunately, this means all your current templates are useless. Hopefully
the new documentation and examples will be enough to help you make the
transition. Please don't hesitate to ask on roundup-users for help (or
complete conversions if you're completely stuck)!</li>
<li>The database backed got a lot more flexible, allowing Metakit and SQL
databases! The only decent SQL database implemented at present is sqlite,
but others shouldn't be a whole lot more work.</li>
<li>A brand new, highly flexible and much more robust security system including
a system of Permissions, Roles and Role assignments to users. You may now
define your own Permissions that may be checked in CGI transactions.</li>
<li>Journalling has been made less storage-hungry, so has been turned on
by default <em>except</em> for author, recipient and nosy link/unlink events. You
are advised to turn it off in your trackers too.</li>
<li>We've changed the terminology from &quot;instance&quot; to &quot;tracker&quot;, to ease the
learning curve/impact for new users.</li>
<li>Because of the above changes, the tracker configuration has seen some
major changes. See below for the details.</li>
</ol>
<p>Please, <strong>back up your database</strong> before you start the migration process. This
is as simple as copying the &quot;db&quot; directory and all its contents from your
tracker to somewhere safe.</p>
<div class="section" id="id4">
<h2><a class="toc-backref" href="#id20" name="id4">0.5.0 Configuration</a></h2>
<p>First up, rename your <tt class="literal"><span class="pre">instance_config.py</span></tt> file to just <tt class="literal"><span class="pre">config.py</span></tt>.</p>
<p>Then edit your tracker's <tt class="literal"><span class="pre">__init__.py</span></tt> module. It'll currently look
like this:</p>
<pre class="literal-block">
from instance_config import *
try:
    from dbinit import *
except ImportError:
    pass # in installdir (probably :)
from interfaces import *
</pre>
<p>and it needs to be:</p>
<pre class="literal-block">
import config
from dbinit import open, init
from interfaces import Client, MailGW
</pre>
<p>Due to the new templating having a top-level <tt class="literal"><span class="pre">page</span></tt> that defines links for
searching, indexes, adding items etc, the following variables are no longer
used:</p>
<ul class="simple">
<li>HEADER_INDEX_LINKS</li>
<li>HEADER_ADD_LINKS</li>
<li>HEADER_SEARCH_LINKS</li>
<li>SEARCH_FILTERS</li>
<li>DEFAULT_INDEX</li>
<li>UNASSIGNED_INDEX</li>
<li>USER_INDEX</li>
<li>ISSUE_FILTER</li>
</ul>
<p>The new security implementation will require additions to the dbinit module,
but also removes the need for the following tracker config variables:</p>
<ul class="simple">
<li>ANONYMOUS_ACCESS</li>
<li>ANONYMOUS_REGISTER</li>
</ul>
<p>but requires two new variables which define the Roles assigned to users who
register through the web and e-mail interfaces:</p>
<ul class="simple">
<li>NEW_WEB_USER_ROLES</li>
<li>NEW_EMAIL_USER_ROLES</li>
</ul>
<p>in both cases, 'User' is a good initial setting. To emulate
<tt class="literal"><span class="pre">ANONYMOUS_ACCESS='deny'</span></tt>, remove all &quot;View&quot; Permissions from the
&quot;Anonymous&quot; Role. To emulate <tt class="literal"><span class="pre">ANONYMOUS_REGISTER='deny'</span></tt>, remove the &quot;Web
Registration&quot; and/or the &quot;Email Registration&quot; Permission from the &quot;Anonymous&quot;
Role. See the section on customising security in the <a class="reference" href="customizing.html">customisation
documentation</a> for more information.</p>
<p>Finally, the following config variables have been renamed to make more sense:</p>
<ul class="simple">
<li>INSTANCE_HOME -&gt; TRACKER_HOME</li>
<li>INSTANCE_NAME -&gt; TRACKER_NAME</li>
<li>ISSUE_TRACKER_WEB -&gt; TRACKER_WEB</li>
<li>ISSUE_TRACKER_EMAIL -&gt; TRACKER_EMAIL</li>
</ul>
</div>
<div class="section" id="schema-specification">
<h2><a class="toc-backref" href="#id21" name="schema-specification">0.5.0 Schema Specification</a></h2>
<div class="section" id="database-backend-changes">
<h3><a class="toc-backref" href="#id22" name="database-backend-changes">0.5.0 Database backend changes</a></h3>
<p>Your select_db module in your tracker has changed a fair bit. Where it used
to contain:</p>
<pre class="literal-block">
# WARNING: DO NOT EDIT THIS FILE!!!
from roundup.backends.back_anydbm import Database
</pre>
<p>it must now contain:</p>
<pre class="literal-block">
# WARNING: DO NOT EDIT THIS FILE!!!
from roundup.backends.back_anydbm import Database, Class, FileClass, IssueClass
</pre>
<p>Yes, I realise the irony of the &quot;DO NOT EDIT THIS FILE&quot; statement :)
Note the addition of the Class, FileClass, IssueClass imports. These are very
important, as they're going to make the next change work too. You now need to
modify the top of the dbinit module in your tracker from:</p>
<pre class="literal-block">
import instance_config
from roundup import roundupdb
from select_db import Database

from roundup.roundupdb import Class, FileClass

class Database(roundupdb.Database, select_db.Database):
    ''' Creates a hybrid database from:
         . the selected database back-end from select_db
         . the roundup extensions from roundupdb
    '''
    pass

class IssueClass(roundupdb.IssueClass):
    ''' issues need the email information
    '''
    pass
</pre>
<p>to:</p>
<pre class="literal-block">
import config
from select_db import Database, Class, FileClass, IssueClass
</pre>
<p>Yes, remove the Database and IssueClass definitions and those other imports.
They're not needed any more!</p>
<p>Look for places in dbinit.py where <tt class="literal"><span class="pre">instance_config</span></tt> is used too, and
rename them <tt class="literal"><span class="pre">config</span></tt>.</p>
</div>
<div class="section" id="journalling-changes">
<h3><a class="toc-backref" href="#id23" name="journalling-changes">0.5.0 Journalling changes</a></h3>
<p>Journalling has been optimised for storage. Journalling of links has been
turned back on by default. If your tracker has a large user base, you may wish
to turn off journalling of nosy list, message author and message recipient
link and unlink events. You do this by adding <tt class="literal"><span class="pre">do_journal='no'</span></tt> to the Class
initialisation in your dbinit. For example, your <em>msg</em> class initialisation
probably looks like this:</p>
<pre class="literal-block">
msg = FileClass(db, &quot;msg&quot;,
                author=Link(&quot;user&quot;), recipients=Multilink(&quot;user&quot;),
                date=Date(),         summary=String(),
                files=Multilink(&quot;file&quot;),
                messageid=String(),  inreplyto=String())
</pre>
<p>to turn off journalling of author and recipient link events, add
<tt class="literal"><span class="pre">do_journal='no'</span></tt> to the <tt class="literal"><span class="pre">author=Link(&quot;user&quot;)</span></tt> part of the statement,
like so:</p>
<pre class="literal-block">
msg = FileClass(db, &quot;msg&quot;,
                author=Link(&quot;user&quot;, do_journal='no'),
                recipients=Multilink(&quot;user&quot;, do_journal='no'),
                date=Date(),         summary=String(),
                files=Multilink(&quot;file&quot;),
                messageid=String(),  inreplyto=String())
</pre>
<p>Nosy list link event journalling is actually turned off by default now. If you
want to turn it on, change to your issue class' nosy list, change its
definition from:</p>
<pre class="literal-block">
issue = IssueClass(db, &quot;issue&quot;,
                assignedto=Link(&quot;user&quot;), topic=Multilink(&quot;keyword&quot;),
                priority=Link(&quot;priority&quot;), status=Link(&quot;status&quot;))
</pre>
<p>to:</p>
<pre class="literal-block">
issue = IssueClass(db, &quot;issue&quot;, nosy=Multilink(&quot;user&quot;, do_journal='yes'),
                assignedto=Link(&quot;user&quot;), topic=Multilink(&quot;keyword&quot;),
                priority=Link(&quot;priority&quot;), status=Link(&quot;status&quot;))
</pre>
<p>noting that your definition of the nosy Multilink will override the normal one.</p>
</div>
<div class="section" id="user-schema-changes">
<h3><a class="toc-backref" href="#id24" name="user-schema-changes">0.5.0 User schema changes</a></h3>
<p>Users have two more properties, &quot;queries&quot; and &quot;roles&quot;. You'll have something
like this in your dbinit module now:</p>
<pre class="literal-block">
user = Class(db, &quot;user&quot;,
                username=String(),   password=Password(),
                address=String(),    realname=String(),
                phone=String(),      organisation=String(),
                alternate_addresses=String())
user.setkey(&quot;username&quot;)
</pre>
<p>and you'll need to add the new properties and the new &quot;query&quot; class to it
like so:</p>
<pre class="literal-block">
query = Class(db, &quot;query&quot;,
                klass=String(),     name=String(),
                url=String())
query.setkey(&quot;name&quot;)

# Note: roles is a comma-separated string of Role names
user = Class(db, &quot;user&quot;,
                username=String(),   password=Password(),
                address=String(),    realname=String(),
                phone=String(),      organisation=String(),
                alternate_addresses=String(),
                queries=Multilink('query'), roles=String())
user.setkey(&quot;username&quot;)
</pre>
<p>The &quot;queries&quot; property is used to store off the user's favourite database
queries. The &quot;roles&quot; property is explained below in <a class="reference" href="#security-settings">0.5.0 Security
Settings</a>.</p>
</div>
<div class="section" id="security-settings">
<h3><a class="toc-backref" href="#id25" name="security-settings">0.5.0 Security Settings</a></h3>
<p>See the <a class="reference" href="security.html">security documentation</a> for an explanation of how the new security
system works. In a nutshell though, the security is handled as a four step
process:</p>
<ol class="arabic simple">
<li>Permissions are defined as having a name and optionally a hyperdb class
they're specific to,</li>
<li>Roles are defined that have one or more Permissions,</li>
<li>Users are assigned Roles in their &quot;roles&quot; property, and finally</li>
<li>Roundup checks that users have appropriate Permissions at appropriate times
(like editing issues).</li>
</ol>
<p>Your tracker dbinit module's <em>open</em> function now has to define any
Permissions that are specific to your tracker, and also the assignment
of Permissions to Roles. At the moment, your open function
ends with:</p>
<pre class="literal-block">
import detectors
detectors.init(db)

return db
</pre>
<p>and what we need to do is insert some commands that will set up the security
parameters. Right above the <tt class="literal"><span class="pre">import</span> <span class="pre">detectors</span></tt> line, you'll want to insert
these lines:</p>
<pre class="literal-block">
#
# SECURITY SETTINGS
#
# new permissions for this schema
for cl in 'issue', 'file', 'msg', 'user':
    db.security.addPermission(name=&quot;Edit&quot;, klass=cl,
        description=&quot;User is allowed to edit &quot;+cl)
    db.security.addPermission(name=&quot;View&quot;, klass=cl,
        description=&quot;User is allowed to access &quot;+cl)

# Assign the access and edit permissions for issue, file and message
# to regular users now
for cl in 'issue', 'file', 'msg':
    p = db.security.getPermission('View', cl)
    db.security.addPermissionToRole('User', p)
    p = db.security.getPermission('Edit', cl)
    db.security.addPermissionToRole('User', p)
# and give the regular users access to the web and email interface
p = db.security.getPermission('Web Access')
db.security.addPermissionToRole('User', p)
p = db.security.getPermission('Email Access')
db.security.addPermissionToRole('User', p)

# May users view other user information? Comment these lines out
# if you don't want them to
p = db.security.getPermission('View', 'user')
db.security.addPermissionToRole('User', p)

# Assign the appropriate permissions to the anonymous user's Anonymous
# Role. Choices here are:
# - Allow anonymous users to register through the web
p = db.security.getPermission('Web Registration')
db.security.addPermissionToRole('Anonymous', p)
# - Allow anonymous (new) users to register through the email gateway
p = db.security.getPermission('Email Registration')
db.security.addPermissionToRole('Anonymous', p)
# - Allow anonymous users access to the &quot;issue&quot; class of data
#   Note: this also grants access to related information like files,
#         messages, statuses etc that are linked to issues
#p = db.security.getPermission('View', 'issue')
#db.security.addPermissionToRole('Anonymous', p)
# - Allow anonymous users access to edit the &quot;issue&quot; class of data
#   Note: this also grants access to create related information like
#         files and messages etc that are linked to issues
#p = db.security.getPermission('Edit', 'issue')
#db.security.addPermissionToRole('Anonymous', p)

# oh, g'wan, let anonymous access the web interface too
p = db.security.getPermission('Web Access')
db.security.addPermissionToRole('Anonymous', p)
</pre>
<p>Note in the comments there the places where you might change the permissions
to restrict users or grant users more access. If you've created additional
classes that users should be able to edit and view, then you should add them
to the &quot;new permissions for this schema&quot; section at the start of the security
block. Then add them to the &quot;Assign the access and edit permissions&quot; section
too, so people actually have the new Permission you've created.</p>
<p>One final change is needed that finishes off the security system's
initialisation. We need to add a call to <tt class="literal"><span class="pre">db.post_init()</span></tt> at the end of the
dbinit open() function. Add it like this:</p>
<pre class="literal-block">
import detectors
detectors.init(db)

# schema is set up - run any post-initialisation
db.post_init()
return db
</pre>
<p>You may verify the setup of Permissions and Roles using the new
&quot;<tt class="literal"><span class="pre">roundup-admin</span> <span class="pre">security</span></tt>&quot; command.</p>
</div>
<div class="section" id="user-changes">
<h3><a class="toc-backref" href="#id26" name="user-changes">0.5.0 User changes</a></h3>
<p>To support all those schema changes, you'll need to massage your user database
a little too, to:</p>
<ol class="arabic simple">
<li>make sure there's an &quot;anonymous&quot; user - this user is mandatory now and is
the one that unknown users are logged in as.</li>
<li>make sure all users have at least one Role.</li>
</ol>
<p>If you don't have the &quot;anonymous&quot; user, create it now with the command:</p>
<pre class="literal-block">
roundup-admin create user username=anonymous roles=Anonymous
</pre>
<p>making sure the capitalisation is the same as above. Once you've done that,
you'll need to set the roles property on all users to a reasonable default.
The admin user should get &quot;Admin&quot;, the anonymous user &quot;Anonymous&quot;
and all other users &quot;User&quot;. The <tt class="literal"><span class="pre">fixroles.py</span></tt> script in the tools directory
will do this. Run it like so (where python is your python 2+ binary):</p>
<pre class="literal-block">
python tools/fixroles.py -i &lt;tracker home&gt; fixroles
</pre>
</div>
</div>
<div class="section" id="cgi-interface-changes">
<h2><a class="toc-backref" href="#id27" name="cgi-interface-changes">0.5.0 CGI interface changes</a></h2>
<p>The CGI interface code was completely reorganised and largely rewritten. The
end result is that this section of your tracker interfaces module will need
changing from:</p>
<pre class="literal-block">
from roundup import cgi_client, mailgw
from roundup.i18n import _

class Client(cgi_client.Client):
    ''' derives basic CGI implementation from the standard module,
        with any specific extensions
    '''
    pass
</pre>
<p>to:</p>
<pre class="literal-block">
from roundup import mailgw
from roundup.cgi import client

class Client(client.Client): 
    ''' derives basic CGI implementation from the standard module,
        with any specific extensions
    '''
    pass
</pre>
<p>You will also need to install the new version of roundup.cgi from the source
cgi-bin directory if you're using it.</p>
</div>
<div class="section" id="html-templating">
<h2><a class="toc-backref" href="#id28" name="html-templating">0.5.0 HTML templating</a></h2>
<p>You'll want to make a backup of your current tracker html directory. You
should then copy the html directory from the Roundup source &quot;classic&quot; template
and modify it according to your local schema changes.</p>
<p>If you need help with the new templating system, please ask questions on the
roundup-users mailing list (available through the roundup project page on
sourceforge, <a class="reference" href="http://roundup.sf.net/">http://roundup.sf.net/</a>)</p>
</div>
<div class="section" id="detectors">
<h2><a class="toc-backref" href="#id29" name="detectors">0.5.0 Detectors</a></h2>
<p>The nosy reactor has been updated to handle the tracker not having an
&quot;assignedto&quot; property on issues. You may want to copy it into your tracker's
detectors directory. Chances are you've already fixed it though :)</p>
</div>
</div>
<div class="section" id="migrating-from-0-4-1-to-0-4-2">
<h1><a class="toc-backref" href="#id30" name="migrating-from-0-4-1-to-0-4-2">Migrating from 0.4.1 to 0.4.2</a></h1>
<div class="section" id="id5">
<h2><a class="toc-backref" href="#id31" name="id5">0.4.2 Configuration</a></h2>
<p>The USER_INDEX definition introduced in 0.4.1 was too restrictive in its
allowing replacement of 'assignedto' with the user's userid. Users must change
the None value of 'assignedto' to 'CURRENT USER' (the string, in quotes) for
the replacement behaviour to occur now.</p>
<p>The new configuration variables are:</p>
<ul class="simple">
<li>EMAIL_KEEP_QUOTED_TEXT</li>
<li>EMAIL_LEAVE_BODY_UNCHANGED</li>
<li>ADD_RECIPIENTS_TO_NOSY</li>
</ul>
<p>See the sample configuration files in:</p>
<pre class="literal-block">
&lt;roundup source&gt;/roundup/templates/classic/instance_config.py
</pre>
<p>and:</p>
<pre class="literal-block">
&lt;roundup source&gt;/roundup/templates/extended/instance_config.py
</pre>
<p>and the <a class="reference" href="customizing.html">customisation documentation</a> for information on how they're used.</p>
</div>
<div class="section" id="changes-to-detectors">
<h2><a class="toc-backref" href="#id32" name="changes-to-detectors">0.4.2 Changes to detectors</a></h2>
<p>You will need to copy the detectors from the distribution into your instance
home &quot;detectors&quot; directory. If you used the classic schema, the detectors
are in:</p>
<pre class="literal-block">
&lt;roundup source&gt;/roundup/templates/classic/detectors/
</pre>
<p>If you used the extended schema, the detectors are in:</p>
<pre class="literal-block">
&lt;roundup source&gt;/roundup/templates/extended/detectors/
</pre>
<p>The change means that schema-specific code has been removed from the
mail gateway and cgi interface and made into auditors:</p>
<ul class="simple">
<li>nosyreactor.py has now got an updatenosy auditor which updates the nosy
list with author, recipient and assignedto information.</li>
<li>statusauditor.py makes the unread or resolved -&gt; chatting changes and
presets the status of an issue to unread.</li>
</ul>
<p>There's also a bug or two fixed in the nosyreactor code.</p>
</div>
<div class="section" id="html-templating-changes">
<h2><a class="toc-backref" href="#id33" name="html-templating-changes">0.4.2 HTML templating changes</a></h2>
<p>The link() htmltemplate function now has a &quot;showid&quot; option for links and
multilinks. When true, it only displays the linked item id as the anchor
text. The link value is displayed as a tooltip using the title anchor
attribute. To use in eg. the superseder field, have something like this:</p>
<pre class="literal-block">
&lt;td&gt;
 &lt;display call=&quot;field('superseder', showid=1)&quot;&gt;
 &lt;display call=&quot;classhelp('issue', 'id,title', label='list', width=500)&quot;&gt;
 &lt;property name=&quot;superseder&quot;&gt;
  &lt;br&gt;View: &lt;display call=&quot;link('superseder', showid=1)&quot;&gt;
 &lt;/property&gt;
&lt;/td&gt;
</pre>
<p>The stylesheets have been cleaned up too. You may want to use the newer
versions in:</p>
<pre class="literal-block">
&lt;roundup source&gt;/roundup/templates/&lt;template&gt;/html/default.css
</pre>
</div>
</div>
<div class="section" id="migrating-from-0-4-0-to-0-4-1">
<h1><a class="toc-backref" href="#id34" name="migrating-from-0-4-0-to-0-4-1">Migrating from 0.4.0 to 0.4.1</a></h1>
<div class="section" id="files-storage">
<h2><a class="toc-backref" href="#id35" name="files-storage">0.4.1 Files storage</a></h2>
<p>Messages and files from newly created issues will be put into subdierectories
in thousands e.g. msg123 will be put into files/msg/0/msg123, file2003
will go into files/file/2/file2003. Previous messages are still found, but
could be put into this structure.</p>
</div>
<div class="section" id="id6">
<h2><a class="toc-backref" href="#id36" name="id6">0.4.1 Configuration</a></h2>
<p>To allow more fine-grained access control, the variable used to check
permission to auto-register users in the mail gateway is now called
ANONYMOUS_REGISTER_MAIL rather than overloading ANONYMOUS_REGISTER. If the
variable doesn't exist, then ANONYMOUS_REGISTER is tested as before.</p>
<p>Configuring the links in the web header is now easier too. The following
variables have been added to the classic instance_config.py:</p>
<pre class="literal-block">
HEADER_INDEX_LINKS   - defines the &quot;index&quot; links to be made available
HEADER_ADD_LINKS     - defines the &quot;add&quot; links
DEFAULT_INDEX        - specifies the index view for DEFAULT
UNASSIGNED_INDEX     - specifies the index view for UNASSIGNED
USER_INDEX           - specifies the index view for USER
</pre>
<p>See the &lt;roundup source&gt;/roundup/templates/classic/instance_config.py for more
information - including how the variables are to be set up. Most users will
just be able to copy the variables from the source to their instance home. If
you've modified the header by changing the source of the interfaces.py file in
the instance home, you'll need to remove that customisation and move it into
the appropriate variables in instance_config.py.</p>
<p>The extended schema has similar variables added too - see the source for more
info.</p>
</div>
<div class="section" id="alternate-e-mail-addresses">
<h2><a class="toc-backref" href="#id37" name="alternate-e-mail-addresses">0.4.1 Alternate E-Mail Addresses</a></h2>
<p>If you add the property &quot;alternate_addresses&quot; to your user class, your users
will be able to register alternate email addresses that they may use to
communicate with roundup as. All email from roundup will continue to be sent
to their primary address.</p>
<p>If you have not edited the dbinit.py file in your instance home directory,
you may simply copy the new dbinit.py file from the core code. If you used
the classic schema, the interfaces file is in:</p>
<pre class="literal-block">
&lt;roundup source&gt;/roundup/templates/classic/dbinit.py
</pre>
<p>If you used the extended schema, the file is in:</p>
<pre class="literal-block">
&lt;roundup source&gt;/roundup/templates/extended/dbinit.py 
</pre>
<p>If you have modified your dbinit.py file, you need to edit the dbinit.py
file in your instance home directory. Find the lines which define the user
class:</p>
<pre class="literal-block">
user = Class(db, &quot;msg&quot;,
                username=String(),   password=Password(),
                address=String(),    realname=String(), 
                phone=String(),      organisation=String(),
                alternate_addresses=String())
</pre>
<p>You will also want to add the property to the user's details page. The
template for this is the &quot;user.item&quot; file in your instance home &quot;html&quot;
directory. Similar to above, you may copy the file from the roundup source if
you haven't modified it. Otherwise, add the following to the template:</p>
<pre class="literal-block">
&lt;display call=&quot;multiline('alternate_addresses')&quot;&gt;
</pre>
<p>with appropriate labelling etc. See the standard template for an idea.</p>
</div>
</div>
<div class="section" id="migrating-from-0-3-x-to-0-4-0">
<h1><a class="toc-backref" href="#id38" name="migrating-from-0-3-x-to-0-4-0">Migrating from 0.3.x to 0.4.0</a></h1>
<div class="section" id="message-id-and-in-reply-to-addition">
<h2><a class="toc-backref" href="#id39" name="message-id-and-in-reply-to-addition">0.4.0 Message-ID and In-Reply-To addition</a></h2>
<p>0.4.0 adds the tracking of messages by message-id and allows threading
using in-reply-to. Most e-mail clients support threading using this
feature, and we hope to add support for it to the web gateway. If you
have not edited the dbinit.py file in your instance home directory, you may
simply copy the new dbinit.py file from the core code. If you used the
classic schema, the interfaces file is in:</p>
<pre class="literal-block">
&lt;roundup source&gt;/roundup/templates/classic/dbinit.py
</pre>
<p>If you used the extended schema, the file is in:</p>
<pre class="literal-block">
&lt;roundup source&gt;/roundup/templates/extended/dbinit.py 
</pre>
<p>If you have modified your dbinit.py file, you need to edit the dbinit.py
file in your instance home directory. Find the lines which define the msg
class:</p>
<pre class="literal-block">
msg = FileClass(db, &quot;msg&quot;,
                author=Link(&quot;user&quot;), recipients=Multilink(&quot;user&quot;),
                date=Date(),         summary=String(),
                files=Multilink(&quot;file&quot;))
</pre>
<p>and add the messageid and inreplyto properties like so:</p>
<pre class="literal-block">
msg = FileClass(db, &quot;msg&quot;,
                author=Link(&quot;user&quot;), recipients=Multilink(&quot;user&quot;),
                date=Date(),         summary=String(),
                files=Multilink(&quot;file&quot;),
                messageid=String(),  inreplyto=String())
</pre>
<p>Also, configuration is being cleaned up. This means that your dbinit.py will
also need to be changed in the open function. If you haven't changed your
dbinit.py, the above copy will be enough. If you have, you'll need to change
the line (round line 50):</p>
<pre class="literal-block">
db = Database(instance_config.DATABASE, name)
</pre>
<p>to:</p>
<pre class="literal-block">
db = Database(instance_config, name)
</pre>
</div>
<div class="section" id="id7">
<h2><a class="toc-backref" href="#id40" name="id7">0.4.0 Configuration</a></h2>
<p><tt class="literal"><span class="pre">TRACKER_NAME</span></tt> and <tt class="literal"><span class="pre">EMAIL_SIGNATURE_POSITION</span></tt> have been added to the
instance_config.py. The simplest solution is to copy the default values
from template in the core source.</p>
<p>The mail gateway now checks <tt class="literal"><span class="pre">ANONYMOUS_REGISTER</span></tt> to see if unknown users
are to be automatically registered with the tracker. If it is set to &quot;deny&quot;
then unknown users will not have access. If it is set to &quot;allow&quot; they will be
automatically registered with the tracker.</p>
</div>
<div class="section" id="cgi-script-roundup-cgi">
<h2><a class="toc-backref" href="#id41" name="cgi-script-roundup-cgi">0.4.0 CGI script roundup.cgi</a></h2>
<p>The CGI script has been updated with some features and a bugfix, so you should
copy it from the roundup cgi-bin source directory again. Make sure you update
the ROUNDUP_INSTANCE_HOMES after the copy.</p>
</div>
<div class="section" id="nosy-reactor">
<h2><a class="toc-backref" href="#id42" name="nosy-reactor">0.4.0 Nosy reactor</a></h2>
<p>The nosy reactor has also changed - copy the nosyreactor.py file from the core
source:</p>
<pre class="literal-block">
&lt;roundup source&gt;/roundup/templates/&lt;template&gt;/detectors/nosyreactor.py
</pre>
<p>to your instance home &quot;detectors&quot; directory.</p>
</div>
<div class="section" id="id8">
<h2><a class="toc-backref" href="#id43" name="id8">0.4.0 HTML templating</a></h2>
<p>The field() function was incorrectly implemented - links and multilinks now
display as text fields when rendered using field(). To display a menu (drop-
down or select box) you need to use the menu() function.</p>
</div>
</div>
<div class="section" id="migrating-from-0-2-x-to-0-3-x">
<h1><a class="toc-backref" href="#id44" name="migrating-from-0-2-x-to-0-3-x">Migrating from 0.2.x to 0.3.x</a></h1>
<div class="section" id="x-cookie-authentication-changes">
<h2><a class="toc-backref" href="#id45" name="x-cookie-authentication-changes">0.3.x Cookie Authentication changes</a></h2>
<p>0.3.0 introduces cookie authentication - you will need to copy the
interfaces.py file from the roundup source to your instance home to enable
authentication. If you used the classic schema, the interfaces file is in:</p>
<pre class="literal-block">
&lt;roundup source&gt;/roundup/templates/classic/interfaces.py
</pre>
<p>If you used the extended schema, the file is in:</p>
<pre class="literal-block">
&lt;roundup source&gt;/roundup/templates/extended/interfaces.py
</pre>
<p>If you have modified your interfaces.Client class, you will need to take
note of the login/logout functionality provided in roundup.cgi_client.Client
(classic schema) or roundup.cgi_client.ExtendedClient (extended schema) and
modify your instance code apropriately.</p>
</div>
<div class="section" id="x-password-encoding">
<h2><a class="toc-backref" href="#id46" name="x-password-encoding">0.3.x Password encoding</a></h2>
<p>This release also introduces encoding of passwords in the database. If you
have not edited the dbinit.py file in your instance home directory, you may
simply copy the new dbinit.py file from the core code. If you used the
classic schema, the interfaces file is in:</p>
<pre class="literal-block">
&lt;roundup source&gt;/roundup/templates/classic/dbinit.py
</pre>
<p>If you used the extended schema, the file is in:</p>
<pre class="literal-block">
&lt;roundup source&gt;/roundup/templates/extended/dbinit.py
</pre>
<p>If you have modified your dbinit.py file, you may use encoded passwords:</p>
<ol class="arabic">
<li><p class="first">Edit the dbinit.py file in your instance home directory
a. At the first code line of the open() function:</p>
<pre class="literal-block">
 from roundup.hyperdb import String, Date, Link, Multilink

alter to include Password, as so::

 from roundup.hyperdb import String, Password, Date, Link, Multilink
</pre>
<ol class="loweralpha" start="2">
<li><p class="first">Where the password property is defined (around line 66):</p>
<pre class="literal-block">
user = Class(db, &quot;user&quot;, 
                username=String(),   password=String(),
                address=String(),    realname=String(), 
                phone=String(),      organisation=String())
user.setkey(&quot;username&quot;)
</pre>
<p>alter the &quot;password=String()&quot; to &quot;password=Password()&quot;:</p>
<pre class="literal-block">
user = Class(db, &quot;user&quot;, 
                username=String(),   password=Password(),
                address=String(),    realname=String(), 
                phone=String(),      organisation=String())
user.setkey(&quot;username&quot;)
</pre>
</li>
</ol>
</li>
<li><p class="first">Any existing passwords in the database will remain cleartext until they
are edited. It is recommended that at a minimum the admin password be
changed immediately:</p>
<pre class="literal-block">
roundup-admin -i &lt;instance home&gt; set user1 password=&lt;new password&gt;
</pre>
</li>
</ol>
</div>
<div class="section" id="x-configuration">
<h2><a class="toc-backref" href="#id47" name="x-configuration">0.3.x Configuration</a></h2>
<p>FILTER_POSITION, ANONYMOUS_ACCESS, ANONYMOUS_REGISTER have been added to
the instance_config.py. Simplest solution is to copy the default values from
template in the core source.</p>
<p>MESSAGES_TO_AUTHOR has been added to the IssueClass in dbinit.py. Set to 'yes'
to send nosy messages to the author. Default behaviour is to not send nosy
messages to the author. You will need to add MESSAGES_TO_AUTHOR to your
dbinit.py in your instance home.</p>
</div>
<div class="section" id="x-cgi-script-roundup-cgi">
<h2><a class="toc-backref" href="#id48" name="x-cgi-script-roundup-cgi">0.3.x CGI script roundup.cgi</a></h2>
<p>There have been some structural changes to the roundup.cgi script - you will
need to install it again from the cgi-bin directory of the source
distribution. Make sure you update the ROUNDUP_INSTANCE_HOMES after the
copy.</p>
</div>
</div>
</div>
<hr class="footer"/>
<div class="footer">
Generated on: 2004-02-25.
</div>
</body>
</html>
