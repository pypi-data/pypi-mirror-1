<tal:block condition="view/default_css">
  <link rel="stylesheet" type="text/css"
	tal:define="site modules/zope/app/component/hooks/getSite"
	tal:attributes="href site/++resource++ice.adverlet.resources/manage.css" />
</tal:block>

<div class="manage-adverlets" i18n:domain="ice.adverlet">

  <!-- form -->
  <form class="main-form" enctype="multipart/form-data" method="post"
	tal:attributes="action request/URL"
	tal:condition="view/context"> 
    <fieldset>
      <legend tal:content="view/title" />
      <div class="summary"
	   tal:condition="view/status"
	   tal:content="view/status" />  
      <div tal:repeat="widget view/widgets"
	   tal:attributes="class string:ice-adverlet-form-${widget/type} row">
	<div class="label">
	  <label tal:attributes="for widget/name;
				 title widget/hint"
		 tal:content="widget/label" />
	</div>
	<div tal:condition="widget/error"
	     tal:content="structure widget/error" />
	<div class="field">
	  <input tal:replace="structure widget" />
	</div>
      </div>
      <span class="actionButtons"
	    tal:condition="view/availableActions">
	<input tal:repeat="action view/actions"
	       tal:replace="structure action/render" />
      </span>
      <input type="hidden" name="custom"
	     tal:attributes="value python:request.get('custom')" />
      <input type="hidden" name="settings"
	     tal:attributes="value python:request.get('settings')" />
      <input type="hidden" name="images"
	     tal:attributes="value python:request.get('images')" />
    </fieldset>
  </form>

  <!-- preview -->
  <div class="preview-adverlet"
       tal:condition="view/preview"
       tal:content="structure adverlet:${view/adverlet_name}" />

  <!-- info -->
  <div class="info-adverlets"
       tal:condition="python:request.get('info')">

    <span i18n:translate="">Size of sources:</span>
    <span tal:content="view/info/sources_size" />
    <span i18n:translate="">bytes.</span><br />

    <span i18n:translate="">Size of images:</span>
    <span tal:content="view/info/images_size" />
    <span i18n:translate="">bytes.</span><br />

  </div>

  <!-- images listing -->
  <div class="adverlets-list adverlets-files"
       tal:define="formatter python:request.locale.dates.getFormatter('dateTime')"
       tal:condition="python:request.get('images')">
    <table width="100%">
      <tr>
	<th i18n:translate="">Description</th>
	<th i18n:translate="">Link</th>
	<th i18n:translate="">Size</th>
	<th i18n:translate="">Type</th>
	<th i18n:translate="">Last upload</th>
	<th i18n:translate="">Delete</th>
      </tr>
      <tr tal:repeat="item view/getFiles">
	<td tal:content="item/dc/title" />
	<td class="centred">
	  <a tal:attributes="href item/ob/@@absolute_url">
	    &raquo;&raquo;&raquo;
	  </a>
	</td>
	<td class="centred">
	  <span tal:content="item/ob/getSize" />
	  <span i18n:translate="">bytes</span>&nbsp;&nbsp;&nbsp;
	  <span tal:content="python:item['ob'].getImageSize()[0]" />
	  x
	  <span tal:content="python:item['ob'].getImageSize()[1]" />
	</td>
	<td class="centred" tal:content="item/ob/contentType" />
	<td tal:content="python:formatter.format(item['dc'].modified)" />
	<td class="centred">
	  <a tal:attributes="href string:${request/URL}?delete=${item/id}">x</a>
	</td>
      </tr>
    </table>
  </div>
  
  <!-- undo -->
  <tal:block
     tal:condition="python:request.get('undo')"
     tal:content="structure provider:ice.adverlet.undo"
     />

  <!-- help -->
  <tal:block condition="python:request.get('help')"
	     content="structure context/@@ice.adverlet-help" />
  
  <!-- adverlets listing -->
  <div class="adverlets-list">
    <table width="100%">
      <tr>
	<th i18n:translate="">Name</th>
	<th i18n:translate="">Description</th>
	<th i18n:translate="">Edit</th>
	<th i18n:translate="">Preview</th>
      </tr>
      <tal:block repeat="item view/adverlets">

	<tr tal:condition="python:item.__name__ != request.get('custom') and\
			   item.__name__ != request.get('preview')">
	  <td tal:content="item/__name__" />
	  <td tal:content="item/description" />
	  <td class="centred">
	    <a tal:attributes="href string:${request/URL}?custom=${item/__name__}">
	      &raquo;&raquo;&raquo;
	    </a>
	  </td>
	  <td class="centred">
	    <a tal:attributes="href string:${request/URL}?preview=${item/__name__}">
	      &raquo;&raquo;&raquo;
	    </a>
	  </td>
	</tr>

	<tr tal:condition="python:item.__name__ == request.get('custom') or\
			   item.__name__ == request.get('preview')"
	    class="current">
	  <td tal:content="item/__name__" />
	  <td tal:content="item/description" />
	  <td class="centred">
	    <a tal:attributes="href string:${request/URL}?custom=${item/__name__}">
	      &raquo;&raquo;&raquo;
	    </a>
	  </td>
	  <td class="centred">
	    <a tal:attributes="href string:${request/URL}?preview=${item/__name__}">
	      &raquo;&raquo;&raquo;
	    </a>
	  </td>
	</tr>

      </tal:block>

      <tr>
	<td class="adverlets-menu" colspan="4">
	  <a tal:attributes="href string:${request/URL}?settings=yes" i18n:translate="">
	    Settings
	  </a>&nbsp;&nbsp;&nbsp;
	  <a tal:attributes="href string:${request/URL}?info=yes" i18n:translate="">
	    Info
	  </a>&nbsp;&nbsp;&nbsp;
	  <a tal:attributes="href string:${request/URL}?images=yes" i18n:translate="">
	    Images
	  </a>&nbsp;&nbsp;&nbsp;
	  <a tal:attributes="href string:${request/URL}?undo=yes" i18n:translate="">
	    Undo
	  </a>&nbsp;&nbsp;&nbsp;
	  <a tal:attributes="href string:${request/URL}?help=yes" i18n:translate="">
	    Help
	  </a>
	</td>
      </tr>

      <tr>
	<td class="product-copyright" colspan="4">
	  <a href="http://launchpad.net/ice.adverlet">ice.adverlet</a>
	  <span  i18n:translate="">management product for</span>
	  <a href="http://zope.org">Zope3</a>
	  <span  i18n:translate="">distributed under</span>
	  <a href="http://www.gnu.org/licenses">GNU General Public License.</a>&nbsp;&nbsp;&nbsp;
	  <a href="http://www.mozilla.org">FireFox</a> <span  i18n:translate="">required</span>&nbsp;&nbsp;&nbsp;
	</td>
      </tr>

    </table>
  </div>
</div>
