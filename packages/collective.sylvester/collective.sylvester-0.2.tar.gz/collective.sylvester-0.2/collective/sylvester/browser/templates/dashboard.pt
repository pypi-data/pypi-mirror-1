<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      lang="en"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="collective.sylvester">

<body>

<metal:main fill-slot="main" >

  <link tal:attributes="href string:$portal_url/++resource++sylvester.css"
        type="text/css"
        rel="stylesheet" />

  <link tal:attributes="href string:$portal_url/++resource++sylvester.kss"
        type="text/css"
        rel="k-stylesheet" />

  <script tal:attributes="src string:$portal_url/++resource++sylvester.js"
          type="text/javascript"></script>

  <tal:comment condition="nothing">
    Plone has decided that kss is not by default available to anonymous users.
    This does not help us much, so detect whether kss is loaded, and if not 
    pull it in. Note that the import is inefficient if the user is 
    authenticated.
  </tal:comment>
  <tal:def define="aview nocall:context/@@kss_devel_mode">
    <script tal:condition="aview/isoff"
            tal:attributes="src string:$portal_url/++resource++kukit.js"
            type="text/javascript"></script>
    <script tal:condition="aview/ison"
            tal:attributes="src string:$portal_url/++resource++kukit-devel.js"
            type="text/javascript"></script>
  </tal:def>

  <tal:comment condition="nothing">
    Load css, kss and javascript resources for pluggable viewlets
    todo: check exists, load js
  </tal:comment>
  <tal:viewlets repeat="viewlet view/getPluggableViewlets">
    <link tal:attributes="href string:$portal_url/++resource++${viewlet/name}.css"
          type="text/css"
          rel="stylesheet" />
    <link tal:attributes="href string:$portal_url/++resource++${viewlet/name}.kss"
          type="text/css"
          rel="k-stylesheet" />
  </tal:viewlets>

  <div id="collective-sylvester-dashboard-messages">
  </div>
 
  <div id="collective-sylvester-dashboard-cache-warmer">
  </div>

  <div id="collective-sylvester-what-are-you-doing"
       i18n:translate="what-are-you-doing">
    What are you doing?
  </div>

  <div id="collective-sylvester-characters-remaining">
    140
  </div>

  <metal:macro define-macro="update_form">
  <form name="tweet"
        method="post"
        id="collective-sylvester-dashboard-tweet-form">
    <textarea name="message" rows="2"
              onKeyUp="sylvester.onUpdateKeyUp(this);"></textarea>

    <div class="latest">    
      <strong><span i18n:translate="latest">Latest</span>:</strong>
      <tal:def define="latest view/latest"
               condition="latest">
        <span tal:replace="structure python:view.linkify(latest.text)"/>

        <span tal:replace="python:view.format_ago(latest.created_at)"/> 
        <span i18n:translate="about">ago</span>
      </tal:def>      
    </div>

    <div class="buttons">
      <input type="submit" value="Update"
             id="collective-sylvester-dashboard-tweet-submit"/>
    </div>

    <div class="visualClear">&nbsp;</div>
  </form>
  </metal:macro>

  <div class="collective-sylvester-dashboard-navigation">   
    <a class="selected mainfeed"
       viewletname="statuses"
       i18n:translate="main_feed"
       tal:attributes="href string:${context/absolute_url}/@@${view/name};
                       id string:collective-sylvester-dashboard-navigation-statuses">
      Main feed
    </a>
   
    <tal:viewlets repeat="viewlet view/getPluggableViewlets">
      <a href="#"
         tal:attributes="class python:viewlet.name().replace('.', '-');
                         viewletname viewlet/name;
                         id string:collective-sylvester-dashboard-navigation-${viewlet/name}"
         tal:content="viewlet/title|viewlet/name">
        Viewlet Title
      </a>
    </tal:viewlets>

  </div>

  <div class="visualClear">&nbsp;</div>

  <div id="collective-sylvester-dashboard-content">
    <metal:use use-macro="view/index/macros/statuses"/>
  </div>

  <tal:norender condition="nothing">
  <metal:statuses define-macro="statuses">
    <ul class="collective-sylvester-statuses">
      <li tal:repeat="status view/GetFriendsTimeline"
          onMouseOver="sylvester.rollover(this);"
          onMouseOut="sylvester.rollover(this);">
        <span tal:define="dummy python:request.set('status', status)"
              tal:replace="structure provider:collective.sylvester.statusletmanager"/>
      </li>
    </ul>
  </metal:statuses>
  </tal:norender>
 
</metal:main>

</body>
</html>
