<tal:comment condition="nothing">
This viewlet is potentially slow due to the calls that are made to twitter. 
This is overcome by setting up an asynchronous loader. The viewlet looks for a 
variable 'deferred' and reacts accordingly.
</tal:comment>

<metal:main define-macro="main">
<tal:def define="friend friend|request/friend;">

  <div tal:define="dashboardview nocall:context/@@collective.sylvester.dashboard"
       tal:attributes="id string:collective-sylvester-friendlet-friend${friend/id};
                       friend_id friend/id"
       class="collective-sylvester-friendlet">
    <dl class="portlet">

    <dt class="portletHeader">
      <span tal:replace="friend/name"/>
    </dt>

    <dd class="portletItem">
      <img tal:attributes="src friend/profile_image_url;
                           alt friend/screen_name"/>
    </dd>
  
    <dd class="portletItem">
      <ul>
      <tal:statuses repeat="status statuses|request/statuses">
        <li>
          <span tal:replace="structure python:dashboardview.linkify(status.text)"/>

          <div class="collective-sylvester-tweet-time-and-source">        
            <span i18n:translate="about">about</span> 
            <span tal:replace="python:dashboardview.format_ago(status.created_at)"/> 
            <span i18n:translate="about">ago</span>
          <div>
        </li>
      </tal:statuses>
      </ul>
    </dd>
    </dl>
  </div>

</tal:def>
</metal:main>
