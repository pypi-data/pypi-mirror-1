<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
  <title>Doing an AJAX Yahoo image search</title>
  <script type="text/javascript" src="../AJS.js"></script>
  <script type="text/javascript" src="../static/script.js"></script>
  <link href="../static/style.css" rel="stylesheet" type="text/css" media="all" />

  <script type="text/javascript">
  var tmpl_image = AJS.join('', 
      ['<p><a href="%(url_big)" target="_blank">',
         '<img src="%(url_small)" />',
       '</a></p>']);

  function doSearch() {
    var cnt = AJS.$('image_container');
    AJS.RCN(cnt, AJS.TN("Doing search..."));

    var d = AJS.loadJSONDoc("http://api.search.yahoo.com/ImageSearchService/V1/imageSearch")

    d.addCallback(function(o) {
      showResults(cnt, o);
    })

    var form = AJS.$('formy');
    var q = AJS.$f(form, 'q').value;
    var r = AJS.$f(form, 'r').value;
    d.sendReq({appid: "YahooDemo", query: q, results: r, output: "json"})
    return false;
  }

  function showResults(cnt, o) {
    AJS.RCN(cnt, null);
    AJS.map(o.ResultSet.Result, function(img) {
      var img = AJS.RND(tmpl_image, {url_big: img.Url, url_small: img.Thumbnail.Url});
      img = AJS.HTML2DOM(img);
      AJS.ACN(cnt, img);
    });
  }
  </script>
</head>
<body>

<h2>Doing an AJAX Yahoo image search</h2>
<form onsubmit="return doSearch()" id="formy">
  <dl>
    <dt>Query</dt>
    <dd><input type="text" name="q" value="ninja" /></dd>

    <dt>Max number of results</dt>
    <dd><input type="text" name="r" value="10" /></dd>

    <dt><input type="submit" value="Just do it!" />
  </dl>
</form>

<h2>Results</h2>
<p>
  <div id="image_container">
    No search made.
  </div>
</p>

</body>
</html>
