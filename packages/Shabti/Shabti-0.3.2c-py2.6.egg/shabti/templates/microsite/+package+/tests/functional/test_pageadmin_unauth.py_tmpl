from datetime import datetime, timedelta
import time
import hashlib
from pylons import url, config
from {{package}}.model import *
from {{package}}.tests import *

class TestPageAdminController(TestController):

    def setUp(self):
        TestModel.setUp(self)
    
    
    def tearDown(self):
        TestModel.tearDown(self)
        Session.close()
    
    
    def test_unauthorised_page_state_retrieval_prohibited(self):
        """Unauthorised page GET access is prohibited."""
        response = self.app.get(url('edit_page', id='1'))
        
        assert response.status_int == 302
        
        assert response.location == 'http://localhost/login/index'
        
        response = self.app.get(
                        url=url(
                            controller='pages', action='new'))
        
        assert response.status_int == 302
        
        assert response.location == 'http://localhost/login/index'
        
        response = self.app.get(
                        url=url(
                            controller='pages', action='update', id='1'),
                        params={'email': 'newemail@example.com',
                                    '_method':u'PUT'})
        
        assert response.status_int == 302
        
        assert response.location == 'http://localhost/login/index'
        
        response = self.app.get(
                        url=url(
                            controller='pages', action='delete', id='1'),
                        params={'_method':'DELETE'})
        
        assert response.status_int == 302
        
        assert response.location == 'http://localhost/login/index'
    

    def test_unauthorised_page_state_change_prohibited(self):
        """Unauthorised page PUTs and DELETEs are prohibited"""
        response = self.app.put(url('save_page', id='1'),
                                params={'title': 'Foobar',
                                        '_method':'PUT'})
        
        assert response.status_int == 302
        
        assert response.location == 'http://localhost/login/index'
        
        response = self.app.delete(
                        url=url(
                            controller='pages', action='delete', id='1'))
        
        assert response.status_int == 302
        
        assert response.location == 'http://localhost/login/index'
    
