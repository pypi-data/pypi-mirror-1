<dl class="portlet portletGoogleAppsPortlet portletGoogleMailPortlet"
    i18n:domain="collective.portlet.googleapps.portlets">

    <dt class="portletHeader">
        <span class="portletTopLeft"></span>
        <a class="link-plain" tal:attributes="href view/google_url; target python:(view.data.new_window and '_blank') or None;" tal:condition="view/data/show_more">
            <span tal:content="view/data/header" />
        </a>
        
        <span tal:content="view/data/header" tal:condition="not:view/data/show_more"/>
        <span class="portletTopRight"></span>
    </dt>

    <dd class="portletItem odd">
      <tal:googlemail tal:define="all_mail view/results">
       <tal:mailpresent tal:condition="python:all_mail != None">
	<div class="gm-mail-details">
 	<span tal:replace="view/data/true_mail_total" /> new messages<br />Updated: <span tal:replace="python:context.toLocalizedTime(all_mail.extension_elements[len(all_mail.extension_elements)-1].text)" />
	</div>

        <table class="grid listing">
            <thead>
              <tr>
               <th title="Sort by ID">#</th>
               <th tal:condition="view/data/show_icons"><div class="gd-icon gd-icon-generic" title="Sort by sender"> </div></th>
               <th title="Sort by message title">Details</th>
              </tr>
            </thead>
            <tbody>
            <tal:googleapps tal:repeat="mail all_mail/entry">
              <tr tal:define="oddrow repeat/mail/odd" tal:attributes="class python:(oddrow and 'odd') or 'even';" >
		  <td tal:content="repeat/mail/number">
			Msg #
		  </td>
                  <td class="gd-icon-cell" tal:condition="view/data/show_icons">
                     <div class="gd-icon gd-icon-mail" tal:attributes="title python:'From: '+mail.author[0].name.text+' <'+mail.author[0].email.text+'>';" tal:content="python:mail.author[0].name.text[0]"> </div>
                  </td>
                  <td>
                     <a class="gd-doc-link" tal:attributes="
                         href python:(view.data.secure_links and mail.GetHtmlLink().href.replace('http:', 'https:')) or mail.GetHtmlLink().href; 
                         target python:(view.data.new_window and '_blank') or None;
			 title python:view.build_contributor_title(mail);" 
			tal:content="mail/title/text"
                        >
                         Title
                     </a>
		     <tal:showsummary tal:condition="view/data/show_summary">
			  <div class="portletItemDetails gm-mail-summary"
			 	tal:content="mail/summary/text" />
		     </tal:showsummary>
                     <tal:showdates tal:condition="view/data/show_dates">
                     <div class="portletItemDetails"
                            tal:content="python:context.toLocalizedTime(mail.extension_elements[0].text)">May 5</div>
                     </tal:showdates>
                  </td>
             </tr>
            </tal:googleapps>
            <tr tal:condition="python:len(all_mail.entry) == 0">
              <td>
                  You have no Google Mail available to you.
              </td>
            </tr>
            </tbody>
       </table>
       </tal:mailpresent>
      <div tal:condition="python: all_mail == None and 'googleauth_portlets' not in request.cookies" tal:replace="structure view/not_logged_in">
      </div>

     </tal:googlemail>
    </dd>
 
    <dd class="portletFooter" tal:condition="view/data/show_more">
        <span class="portletBottomLeft"></span>
        <span>
	<tal:notauthed tal:condition="python: 'googleauth_portlets' in request.cookies">
        <a id="gm-new-mail-link" href="#" i18n:translate="new_mail">
             Create <div class="gd-icon gd-icon-dropdown"> </div>
        </a>
	<div id="gm-new-mail-menu" class="googleapps-menu">
	    <div><div class="gd-icon gd-icon-mail"> </div> Send Mail to:<br />
		<input size="10" />	
	    </div>
	</div>
        </tal:notauthed>
        <a class="link-plain" tal:attributes="href view/google_url; target python:(view.data.new_window and '_blank') or None;" i18n:translate="more_url">
             More Â»
        </a>
        </span>
        <span class="portletBottomRight"></span>
    </dd>
</dl>
