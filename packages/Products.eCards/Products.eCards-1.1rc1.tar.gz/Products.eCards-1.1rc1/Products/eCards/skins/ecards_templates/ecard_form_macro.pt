<tal:macros metal:define-macro="popup_form">
  <div id="popup-form">
   <form method="POST" 
         tal:attributes="action string:${here/absolute_url}/${template/id};">  
        <input type="hidden" name="subject" 
               tal:attributes="value here/emailSubject" />
        <input type="hidden" name="emailAppendedMessage" 
               tal:attributes="value here/getEmailAppendedMessage" />
        <input type="hidden" name="credits" 
               tal:attributes="value here/credits" />
        <input type="hidden" name="image_url" 
               tal:attributes="value python:here.absolute_url()" />

        <div class="field"
             tal:define="error errors/sender_first_name|nothing;"
             tal:attributes="class python:test(error, 'field error', 'field')">
            <label for="sender_first_name" i18n:translate="label_sender_first">First Name</label>

            <span class="fieldRequired" title="Required"
                  i18n:attributes="title title_required;"
                  i18n:translate="label_required">(Required)</span>

                  <div class="formHelp" i18n:translate="help_sender_first">
                    Your first name.
                  </div>

                  <div tal:content="error">Validation error output</div>

                  <input type="text"
                         id="sender_first_name"
                         name="sender_first_name"
                         size="25"
                         tabindex=""
                         tal:attributes="value python: request.get('sender_first_name','');
                                         tabindex tabindex/next;"
                         />
         </div>

         <div class="field"
              tal:define="error errors/sender_last_name|nothing;"
              tal:attributes="class python:test(error, 'field error', 'field')">
             <label for="sender_last_name" i18n:translate="label_sender_last">Last Name</label>

             <span class="fieldRequired" title="Required"
                   i18n:attributes="title title_required;"
                   i18n:translate="label_required">(Required)</span>

                   <div class="formHelp" i18n:translate="help_sender_last">
                     Your last name.
                   </div>

                   <div tal:content="error">Validation error output</div>

                   <input type="text"
                          id="sender_last_name"
                          name="sender_last_name"
                          size="25"
                          tabindex=""
                          tal:attributes="value python: request.get('sender_last_name','');
                                          tabindex tabindex/next;"
                          />
          </div>
         
         <div class="field"
              tal:define="error errors/send_from_address|nothing;"
              tal:attributes="class python:test(error, 'field error', 'field')">
             <label for="send_from_address" i18n:translate="label_send_from">From</label>

             <span class="fieldRequired" title="Required"
                   i18n:attributes="title title_required;"
                   i18n:translate="label_required">(Required)</span>

                   <div class="formHelp" i18n:translate="help_send_from">
                     Your email address.
                   </div>

                   <div tal:content="error">Validation error output</div>

                   <input type="text"
                          id="send_from_address"
                          name="send_from_address"
                          size="25"
                          tabindex=""
                          tal:attributes="value python: request.get('send_from_address', member.getProperty('email',''));
                                          tabindex tabindex/next;"
                          />
         </div>

         <div class="field"
              tal:define="error errors/friend_first_name|nothing;"
              tal:attributes="class python:test(error, 'field error', 'field')">
             <label for="friend_first_name" i18n:translate="label_friend_first">Friend's First Name</label>

             <span class="fieldRequired" title="Required"
                   i18n:attributes="title title_required;"
                   i18n:translate="label_required">(Required)</span>

                   <div class="formHelp" i18n:translate="help_friend_first">
                     The first name of the friend you'd like to send this eCard to.
                   </div>

                   <div tal:content="error">Validation error output</div>

                   <input type="text"
                          id="friend_first_name"
                          name="friend_first_name"
                          size="25"
                          tabindex=""
                          tal:attributes="value python: request.get('friend_first_name','');
                                          tabindex tabindex/next;"
                          />
          </div>

          <div class="field"
               tal:define="error errors/friend_last_name|nothing;"
               tal:attributes="class python:test(error, 'field error', 'field')">
              <label for="friend_last_name" i18n:translate="label_friend_last">Friend's Last Name</label>

              <span class="fieldRequired" title="Required"
                    i18n:attributes="title title_required;"
                    i18n:translate="label_required">(Required)</span>

                    <div class="formHelp" i18n:translate="help_friend_last">
                        The last name of the friend you'd like to send this eCard to.
                    </div>

                    <div tal:content="error">Validation error output</div>

                    <input type="text"
                           id="friend_last_name"
                           name="friend_last_name"
                           size="25"
                           tabindex=""
                           tal:attributes="value python: request.get('friend_last_name','');
                                           tabindex tabindex/next;"
                           />
           </div>

           <div class="field"
                tal:define="error errors/send_to_address|nothing;"
                tal:attributes="class python:test(error, 'field error', 'field')">

             <label for="send_to_address" i18n:translate="label_send_to_mail">Send to</label>

             <span class="fieldRequired" title="Required"
                   i18n:attributes="title title_required;"
                   i18n:translate="label_required">(Required)</span>

                   <div class="formHelp" i18n:translate="help_send_to_mail">
                     The recipient's email address
                   </div>

                   <div tal:content="error">Validation error output</div>

                   <input type="text"
                          id="send_to_address"
                          name="send_to_address"
                          size="25"
                          tabindex=""
                          tal:attributes="value request/send_to_address | nothing;
                                          tabindex tabindex/next;"
                          />
           </div>

           <div class="field"
                tal:define="error errors/comment|nothing;"
                tal:attributes="class python:test(error, 'field error', 'field')">
             <label for="comment" i18n:translate="label_comment">Message</label>

             <span class="fieldRequired" title="Required"
                   i18n:attributes="title title_required;"
                   i18n:translate="label_required">(Required)</span>

             <div class="formHelp" i18n:translate="help_comment_to_link">
               Your eCard message.
             </div>

             <textarea cols="80"
                       rows="5"
                       tabindex=""
                       id="comment"
                       name="comment"
                       tal:content="request/comment | nothing"
                       tal:attributes="tabindex tabindex/next;"
                       >
               Comment
             </textarea>
           </div>

           <div class="formControls">
             <input class="context"
                    tabindex=""
                    type="submit"
                    name="form.button.Send"
                    value="Send"
                    i18n:attributes="value label_send;"
                    tal:attributes="tabindex tabindex/next;"
                    />
           </div>

           <input type="hidden" name="form.submitted" value="1" />
   </form>
  </div>
</tal:macros>
