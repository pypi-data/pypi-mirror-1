<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>pavement.py in depth &mdash; Paver v0.7 documentation</title>
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:   '',
        VERSION:    '0.7'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/interface.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="contents" title="Global table of contents" href="contents.html" />
    <link rel="index" title="Global index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="top" title="Paver v0.7 documentation" href="index.html" />
    <link rel="next" title="The Paver Standard Library" href="paverstdlib.html" />
    <link rel="prev" title="Getting Started with Paver" href="getting_started.html" />
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px"><a href="genindex.html" title="General Index" accesskey="I">index</a></li>
        <li class="right"><a href="modindex.html" title="Global Module Index" accesskey="M">modules</a> |</li>
          <li class="right"><a href="paverstdlib.html" title="The Paver Standard Library" accesskey="N">next</a> |</li>
          <li class="right"><a href="getting_started.html" title="Getting Started with Paver" accesskey="P">previous</a> |</li>
        <li><a href="index.html">Paver v0.7 documentation</a> &raquo;</li>
      </ul>
    </div>
    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  
  <div class="section">
<h1 id="pavement-py-in-depth"><span id="pavement"></span>pavement.py in depth<a class="headerlink" href="#pavement-py-in-depth" title="Permalink to this headline">¶</a></h1>
<p>Paver is meant to be a hybrid declarative/imperative system for getting stuff done.
You declare things via the options in pavement.py. And, in fact, many projects
can get away with nothing but options in pavement.py. Consider, for example,
Paver&#8217;s own pavement file:</p>
<div class="highlight"><pre><span class="k">import</span> <span class="nn">paver.doctools</span>

<span class="n">options</span><span class="p">(</span>
    <span class="n">setup</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s">&#39;paver&#39;</span><span class="p">,</span>
    <span class="n">version</span><span class="o">=</span><span class="s">&quot;0.3&quot;</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s">&#39;Python build tool&#39;</span><span class="p">,</span>
    <span class="n">author</span><span class="o">=</span><span class="s">&#39;Kevin Dangoor&#39;</span><span class="p">,</span>
    <span class="n">author_email</span><span class="o">=</span><span class="s">&#39;dangoor+paver@gmail.com&#39;</span><span class="p">,</span>
    <span class="c">#url=&#39;&#39;,</span>
    <span class="n">packages</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;paver&#39;</span><span class="p">],</span>
    <span class="n">package_data</span><span class="o">=</span><span class="n">setuputils</span><span class="o">.</span><span class="n">find_package_data</span><span class="p">(</span><span class="s">&quot;paver&quot;</span><span class="p">,</span> <span class="n">package</span><span class="o">=</span><span class="s">&quot;paver&quot;</span><span class="p">,</span>
                                            <span class="n">only_in_packages</span><span class="o">=</span><span class="bp">False</span><span class="p">),</span>
    <span class="n">install_requires</span><span class="o">=</span><span class="p">[],</span>
    <span class="n">test_suite</span><span class="o">=</span><span class="s">&#39;nose.collector&#39;</span><span class="p">,</span>
    <span class="n">zip_safe</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
    <span class="n">entry_points</span><span class="o">=</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">    [console_scripts]</span>
<span class="s">    paver = paver.command:main</span>
<span class="s">    &quot;&quot;&quot;</span><span class="p">,</span>
    <span class="p">),</span>

    <span class="n">sphinx</span><span class="o">=</span><span class="n">Bunch</span><span class="p">(</span>
        <span class="n">builddir</span><span class="o">=</span><span class="s">&quot;build&quot;</span><span class="p">,</span>
        <span class="n">sourcedir</span><span class="o">=</span><span class="s">&quot;source&quot;</span>
    <span class="p">)</span>

<span class="p">)</span>

<span class="nd">@task</span>
<span class="nd">@needs</span><span class="p">(</span><span class="s">&#39;paver.doctools.html&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">html</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Build Paver&#39;s documentation and install it into paver/docs&quot;&quot;&quot;</span>
    <span class="n">builtdocs</span> <span class="o">=</span> <span class="n">path</span><span class="p">(</span><span class="s">&quot;docs&quot;</span><span class="p">)</span> <span class="o">/</span> <span class="n">options</span><span class="o">.</span><span class="n">sphinx</span><span class="o">.</span><span class="n">builddir</span> <span class="o">/</span> <span class="s">&quot;html&quot;</span>
    <span class="n">destdir</span> <span class="o">=</span> <span class="n">path</span><span class="p">(</span><span class="s">&quot;paver&quot;</span><span class="p">)</span> <span class="o">/</span> <span class="s">&quot;docs&quot;</span>
    <span class="n">destdir</span><span class="o">.</span><span class="n">rmtree</span><span class="p">()</span>
    <span class="n">builtdocs</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">destdir</span><span class="p">)</span>
</pre></div>
<p>This file has both declarative and imperative aspects. The options define
enough information for distutils, setuptools and Sphinx to do their
respective jobs. This would function just fine without requiring you
to define any tasks.</p>
<p>However, for Paver&#8217;s &#8216;paverdoc&#8217; built-in task to work, we need
Sphinx&#8217;s generated HTML to end up inside of Paver&#8217;s package tree.
So, we override the html task to move the generated files.</p>
<div class="section">
<h2 id="defining-tasks">Defining Tasks<a class="headerlink" href="#defining-tasks" title="Permalink to this headline">¶</a></h2>
<p>Tasks are just simple functions. You designate a function as being a
task by using the &#64;task decorator. Interesting tidbit: unlike
many decorators you find in Python, Paver&#8217;s decorators do not actually
replace the function with a new object. They just put marker data on the
function object and also keep track of things in a companion
paver.runtime.Task object.</p>
<p>You can also specify that a task depends on another task running
first with the &#64;needs decorator. As long as the options don&#8217;t change,
a given task will run only once regardless of how many times it&#8217;s
specified in &#64;needs or whether the task shows up on the command line.</p>
</div>
<div class="section">
<h2 id="manually-calling-tasks">Manually Calling Tasks<a class="headerlink" href="#manually-calling-tasks" title="Permalink to this headline">¶</a></h2>
<p>Sometimes, you need to do something <cite>before</cite> running another task, so
the &#64;needs decorator doesn&#8217;t quite do the job.</p>
<p>Of course, tasks are just Python functions. So, you can just call the
other task! However, this is not ideal, because Python functions
don&#8217;t do things like keeping track of their dependencies or whether
they&#8217;ve been called already.</p>
<p>paver.runtime provides a call_task function. It&#8217;s very simple to use:</p>
<dl class="function">
<dt id="call_task">
<!--#call_task#--><tt class="descname">call_task</tt><big>(</big><em>task_name</em><big>)</big><a class="headerlink" href="#call_task" title="Permalink to this definition">¶</a></dt>
<dd><p>Calls the desired task, including any tasks upon which that task
depends.</p>
<p>You can always call a task directly by calling the function directly.
But, if you do so the dependencies aren&#8217;t called. call_task ensures
that these are called.</p>
<p>Note that call_task will only call the task <cite>once</cite> during a given
build as long as the options remain the same. If the options are
changed, the task will be called again.</p>
</dd></dl>

</div>
<div class="section">
<h2 id="how-task-names-work">How Task Names Work<a class="headerlink" href="#how-task-names-work" title="Permalink to this headline">¶</a></h2>
<p>Tasks have both a long name and a short name. The short name is just
the name of the function. The long name is the fully qualified Python
name for the function object.</p>
<p>For example, the Sphinx support includes a task function called &#8220;html&#8221;.
That task&#8217;s long name is &#8220;paver.sphinx.html&#8221;.</p>
<p>If you <tt class="docutils literal"><span class="pre">`import</span> <span class="pre">paver.sphinx`</span></tt> in your pavement.py, you&#8217;ll be able
to use either name to refer to that task.</p>
<p>The <cite>last</cite> task that is defined with a given short name is the one that
gets the name. Generally, this will be <cite>your</cite> pavement.py file. So,
in the example at the front of this chapter, the html task in
pavement.py is the one that the &#8220;html&#8221; short name refers to.</p>
<p>Tasks are always available unambiguously via their long names.</p>
</div>
<div class="section">
<h2 id="the-magic">The Magic<a class="headerlink" href="#the-magic" title="Permalink to this headline">¶</a></h2>
<p>When you run Paver it looks for &#8216;pavement.py&#8217; in the current directory.
pavement.py is standard Python, with two small bits of magic:</p>
<ol class="arabic simple">
<li>Everything in paver.defaults is available as if you had done
<tt class="docutils literal"><span class="pre">from</span> <span class="pre">paver.defaults</span> <span class="pre">import</span> <span class="pre">*</span></tt>. In fact, if you&#8217;re using an IDE that does
code completion you might want to manually add that statement to the
top of your file.</li>
<li>When your pavement is being processed, options() is a function that updates
runtime.options. When processing is done, options is replaced by runtime.options
for convenience.</li>
</ol>
<p>It is purposefully not a lot of magic, and the implementation of that &#8220;magic&#8221; isn&#8217;t
magical at all. Your pavement file is actually executed in the namespace of
paver.defaults. After that, paver.defaults.options = runtime.options, and then
the tasks are run.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sidebar">
        <div class="sidebarwrapper">
            <h3>Table Of Contents</h3>
            <ul>
<li><a class="reference" href="">pavement.py in depth</a><ul>
<li><a class="reference" href="#defining-tasks">Defining Tasks</a></li>
<li><a class="reference" href="#manually-calling-tasks">Manually Calling Tasks</a></li>
<li><a class="reference" href="#how-task-names-work">How Task Names Work</a></li>
<li><a class="reference" href="#the-magic">The Magic</a></li>
</ul>
</li>
</ul>

            <h4>Previous topic</h4>
            <p class="topless"><a href="getting_started.html" title="previous chapter">Getting Started with Paver</a></p>
            <h4>Next topic</h4>
            <p class="topless"><a href="paverstdlib.html" title="next chapter">The Paver Standard Library</a></p>
            <h3>This Page</h3>
            <ul class="this-page-menu">
              <li><a href="_sources/pavement.txt">Show Source</a></li>
            </ul>
            <h3>Quick search</h3>
            <form class="search" action="search.html" method="get">
              <input type="text" name="q" size="18" /> <input type="submit" value="Go" />
              <input type="hidden" name="check_keywords" value="yes" />
              <input type="hidden" name="area" value="default" />
            </form>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px"><a href="genindex.html" title="General Index" accesskey="I">index</a></li>
        <li class="right"><a href="modindex.html" title="Global Module Index" accesskey="M">modules</a> |</li>
          <li class="right"><a href="paverstdlib.html" title="The Paver Standard Library" accesskey="N">next</a> |</li>
          <li class="right"><a href="getting_started.html" title="Getting Started with Paver" accesskey="P">previous</a> |</li>
        <li><a href="index.html">Paver v0.7 documentation</a> &raquo;</li>
      </ul>
    </div>
    <div class="footer">
      &copy; Copyright 2008, SitePen, Inc..
      Last updated on May 07, 2008.
    </div>
  </body>
</html>