<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      lang="en"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="plone">
<body>
    <div metal:fill-slot="main"
                 tal:define="results python: view.search();
                 Batch python:modules['Products.CMFPlone'].Batch;
                 b_size python:30;
                 b_start python:0;
                 b_start request/b_start | b_start;" id="classifieds">
        
            <div tal:replace="structure provider:plone.abovecontenttitle" />
            
        	<div class="classifiedsinfo" i18n:translate="classifieds_introtext">
                Search for a classified within this category, browse the classifieds or click on a specific subcategory to view the classifieds.
			</div>
    
            <br />
        
            <form class="enableAutoFocus" method="post" name="frmsearch" id="frmsearch">
                    <!-- start search box -->
                    <div id="searchContainer">
                        <input type="text" id="frm_searchString" name="frm_searchString" tal:attributes="value request/frm_searchString | nothing" />
                        <input class="searchButton"
                               id="btnSearch"
                               type="submit"
                               value="Search"
                               i18n:attributes="value label_search;"/>      
                    </div>
                    <!-- end search box -->
                    <hr />
                    
                    <!-- latest classifieds -->
                    <span tal-omit-tag="" tal:condition="not:results">
                        <span tal-omit-tag="" tal:condition="python: view.getLatestClassifieds(10)">
                            <h3 i18n:translate="classifieds_latest_classifieds">Latest classifieds</h3>
                                
                            <table border="0" width="100%" class="listing">
                                <th i18n:translate="classifieds_classifiedsclassified_label_image">
                                        Image
                                </th>
                                <th>
                                    <span i18n:translate="classifieds_classifieds">Classifieds</span>    
                                </th>
                                <th>
                                        <span tal:omit-tag="" i18n:translate="classifieds_classifiedsclassified_label_price">Price</span>
                                        
                                </th>        
                                
                                <tbody>
                                    
                                    
                                    
                                    <tr tal:repeat="item python: view.getLatestClassifieds(10)" tal:attributes="class python:repeat['item'].odd()==1 and 'odd' or 'even'">
                                        
                                        <span tal:omit-tag="" tal:condition="python:not portal.isExpired(item)">
                                                <td>
                                                        <span tal:condition="item/hasImage">
                                                                
																<img class="image_tile" tal:attributes="src python:item.getImageTile" />
                                                                        
																
																
                                                        </span>
                                                        <span tal:condition="not: item/hasImage">
                                                                <img class="image_tile" src="++resource++collective.classifieds.images/no_photo.jpg" />
                                                                <span i18n:translate="marketplace_no_image_tile_label">No Image</span>
                                                        </span>
                                                </td>
                                                <td>
                                                        <a tal:attributes="href string:${item/getURL}" tal:content="item/Title">Name</a>
                                                </td>
                                                <td>
                                                        <span tal:content="item/price">price</span>
                                                </td>
                                        </span>
                                    </tr>
                                </tbody>
                            </table>
                        </span>
                        <a href="all_classifiedsclassifieds_view" i18n:translate="classifieds_view_all_classifieds">View all classifieds</a>
                        <span tal:omit-tag="" i18n:translate="classifieds_within">within</span>
                        <span tal:omit-tag="" tal:content="context/Title">Classifieds</span>
                        
                        <br />
                    </span>
                    <!-- end latest classifieds -->
                    
                    <br />
                    
                    <!-- list categories, no search -->
                    <span tal:condition="not:results">
                        <span tal:condition="python: context.getFolderContents(contentFilter={'meta_type':['ClassifiedsCategory']})">
                            <h3 i18n:translate="classifieds_browse_categories">Browse</h3>
                                <table border="0" width="100%" class="listing">
                                        <tr>
                                                <th>
                                                    <span i18n:translate="classifieds_classifiedscategories_label">ClassifiedsCategory</span>
                                                     
                                                     <a tal:condition="python:(context.REQUEST.get('sort_order')) != 'reverse' or not context.REQUEST.has_key('sort_order')"
                                                          tal:attributes="href string:${here/absolute_url}?sort_order=reverse">
                                                         [<span i18n:translate="classifieds_sorting">sort</span>]
                                                     </a>
                                                     <a tal:condition="python:(context.REQUEST.get('sort_order')=='reverse')"
                                                          tal:attributes="href string:${here/absolute_url}">
                                                         [<span i18n:translate="classifieds_sorting">sort</span>]
                                                     </a>
                                                 </th>
                                        </tr>
                                        <tbody>
                                                <tr tal:repeat="item python: context.getFolderContents(contentFilter={'meta_type':['ClassifiedsCategory'], 'sort_on':'sortable_title', 'sort_order':context.REQUEST.get('sort_order')})" tal:attributes="class python:repeat['item'].odd()==1 and 'odd' or 'even'">
                                                        <td>
                                                                <img tal:attributes="src string:${item/getIcon}" />
                                                                <a tal:attributes="href string:${item/getURL}" tal:content="item/Title">Name</a>
                                                           (<span id="classifieds_classified_amount" tal:content="python: view.getNumberOfClassifieds(item)" />)
                                                           
                                                           
                                                        </td>
                                                </tr>
                                        </tbody>
                                </table>
                        </span>
                    </span>
                    <!-- end categories -->
                    
                    
                    <!-- search -->
                    <div tal:condition="results">
                        <h3 i18n:translate="classifieds_results">Results</h3>
                        <span i18n:translate="classifieds_you_searched_on">You searched on</span>: 
                        <b>"<span tal:content="request/frm_searchString">searchstring</span>"</b>,
                        <span tal:content="python:len(results)">0</span>
                        <span i18n:translate="classifieds_resultsfound">results found</span>
                        
                        
                        
                        
                        <div tal:condition="results" 
                             tal:define="batch python:Batch(results, b_size, int(b_start), orphan=1);">                
                            <table border="0" width="100%" class="listing">
                                
                                <tr>
                                    <th i18n:translate="classifieds_classifiedsclassified_label_image">
                                            Image
                                    </th>
                                    
                                    <!-- Classifieds classified -->
                                    <th tal:condition="python:not context.REQUEST.has_key('frm_searchString')">
                                        <span i18n:translate="classifieds_classifieds_label">Classified</span>
                                        
                                        <a  tal:condition="python:(context.REQUEST.get('sort_order')) != 'reverse' or not context.REQUEST.has_key('sort_order')"
                                             tal:attributes="href string:${here/absolute_url}?sort_order=reverse">
                                            [<span i18n:translate="classifieds_sorting">sort</span>]
                                            
                                        </a>
                                        <a tal:condition="python:(context.REQUEST.get('sort_order')=='reverse')"
                                             tal:attributes="href string:${here/absolute_url}">
                                            
                                            [<span i18n:translate="classifieds_sorting">sort</span>]
                                        </a>
                                    </th>
                                    
                                    <th tal:condition="python:context.REQUEST.has_key('frm_searchString')">
                                        <span i18n:translate="classifieds_classifieds_label">Classified</span>
                                        <a tal:condition="python:(context.REQUEST.get('sort_order')) != 'reverse' or not context.REQUEST.has_key('sort_order')"
                                        tal:attributes="href string:${here/absolute_url}?sort_order=reverse&frm_searchString=${request/frm_searchString}">
                                            [<span i18n:translate="classifieds_sorting">sort</span>]
                                        </a>
                                        <a tal:condition="python:(context.REQUEST.get('sort_order')=='reverse')"
                                             tal:attributes="href string:${here/absolute_url}?frm_searchString=${request/frm_searchString}">
                                            [<span i18n:translate="classifieds_sorting">sort</span>]
                                        </a>
                                    </th>
                                    <!-- end Classifieds classified -->
                                    
                                    <!-- price -->
                                    <th tal:condition="python:not context.REQUEST.has_key('frm_searchString')">
                                        <span i18n:translate="classifieds_classifiedsclassified_label_price">Price</span>
                                        
                                        <a  tal:condition="python:(context.REQUEST.get('sort_order')) != 'reverse' or not context.REQUEST.has_key('sort_order')"
                                             tal:attributes="href string:${here/absolute_url}?sort_order=reverse&sort_on=price">
                                            [<span i18n:translate="classifieds_sorting">sort</span>]
                                            
                                        </a>
                                        <a tal:condition="python:(context.REQUEST.get('sort_order')=='reverse')"
                                             tal:attributes="href string:${here/absolute_url}?sort_on=price">
                                            
                                            [<span i18n:translate="classifieds_sorting">sort</span>]
                                        </a>
                                    </th>
                                    
                                    <th tal:condition="python:context.REQUEST.has_key('frm_searchString')">
                                        <span i18n:translate="classifieds_classifiedsclassified_label_price">Price</span>
                                        <a tal:condition="python:(context.REQUEST.get('sort_order')) != 'reverse' or not context.REQUEST.has_key('sort_order')"
                                             tal:attributes="href string:${here/absolute_url}?sort_order=reverse&frm_searchString=${request/frm_searchString}&sort_on=price">
                                            [<span i18n:translate="classifieds_sorting">sort</span>]
                                        </a>
                                        <a tal:condition="python:(context.REQUEST.get('sort_order')=='reverse')"
                                             tal:attributes="href string:${here/absolute_url}?frm_searchString=${request/frm_searchString}&sort_on=price">
                                            [<span i18n:translate="classifieds_sorting">sort</span>]
                                        </a>
                                    </th>
                                    <!-- end price -->
                                </tr>
                                <tbody>
                                    <!-- content -->
                                    <tr tal:repeat="item batch" tal:attributes="class python:repeat['item'].odd()==1 and 'odd' or 'even'">
                                        <span tal:omit-tag="" tal:condition="python:not portal.isExpired(item)">
                                            <td>
                                                <span tal:condition="item/hasImage">
													<img class="image_tile" tal:attributes="src python:item.getImageTile" />
                                                                
                                                    
                                                </span>
                                                <span tal:condition="not: item/hasImage">
                                                        <img class="image_tile" src="++resource++collective.classifieds.images/no_photo.jpg" />
                                                        <span i18n:translate="marketplace_no_image_tile_label">No Image</span>
                                                </span>                                     
                                            </td>
                                            <td>
                                                <a tal:attributes="href string:${item/getURL}" tal:content="item/Title">Name</a>
                                            </td>
                                            <td>
                                                <span tal:content="item/price">Price</span>    
                                            </td>
                                        </span>
                                    </tr>
                                    <!-- end content -->
                                </tbody>
                            </table>
                            <!-- show batch/paging navigation -->
                            <span metal:use-macro="here/batch_macros/macros/navigation" />
                            
                        </div>
                    </div>
                    <!-- end search -->
            </form>
    </div>
</body>
</html>
