<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      lang="en"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="plone">
<body>

<div metal:fill-slot="main"
             tal:define="results python: view.search();
             Batch python:modules['Products.CMFPlone'].Batch;
             b_size python:30;
             b_start python:0;
             b_start request/b_start | b_start;"  id="classifieds">
        
        <div tal:replace="structure provider:plone.abovecontenttitle" />
        

        <div class="message"
             i18n:domain="plone" 
             metal:define-macro="portal_message" 
             tal:define="portal_message request/portal_status_message | nothing;
                         classified_title request/classified_title | nothing"
             tal:condition="portal_message"> 
    
            <dl class="portalMessage info" id="kssPortalMessage" style="display: block;">
                    <dt>info</dt>
                    <dd>
                            <span i18n:translate="Classified">Classified </span> 
                            <span tal:content="classified_title" i18n:translate=""></span> 
                            <span i18n:translate="classifieds_classified_has_been_deleted">has been deleted.</span>
                    </dd>
            </dl>
            
        </div>

        <span i18n:translate="classifieds_goto" class="classifieds_goto">Go to </span>
        <a tal:attributes="href python: context.getParentNode().absolute_url()" tal:content="python: context.getParentNode().Title()">Category</a>
        <br />
        <br />
        
       
        <div class="classifiedsinfo"  i18n:translate="classifieds_introtext">
                Search for a classified within this category, browse the classifieds or click on a specific subcategory to view the classifieds.
        </div>
        
        <br />
        

        
        <form class="enableAutoFocus" method="post" name="frmsearch" id="frmsearch">
                <!-- start search area -->
                <div id="searchContainer">
                    <input type="text" id="frm_searchString" name="frm_searchString" tal:attributes="value request/frm_searchString | nothing" />
                    <input class="searchButton"
                           id="btnSearch"
                           type="submit"
                           value="Search"
                           i18n:attributes="value label_search;"/>      
                </div>
                <!-- end search area -->
                <hr />
                
                <!-- search results -->
                <div tal:condition="view/search">
                        <div tal:condition="results" 
                             tal:define="batch python:Batch(results, b_size, int(b_start), orphan=1);">
                                
                                <span tal:condition="python:context.REQUEST.has_key('frm_searchString')">
                                        <h3 i18n:translate="classifieds_results">Results</h3>
                                        <span i18n:translate="classifieds_you_searched_on">You searched on</span>: 
                                        <b>"<span tal:content="request/frm_searchString">searchstring</span>"</b>,
                                        <span tal:content="python:len(results)">0</span>
                                        <span i18n:translate="classifieds_resultsfound">results found</span>
                                </span>                                
                                
                                <table border="0" width="100%" class="listing">
                                        <tr>
                                                <th i18n:translate="classifieds_classifiedsclassified_label_image">
                                                        Image
                                                </th>
                                                <th>
                                                        <span i18n:translate="classifieds_classifieds_label">Results</span>
                                                        
                                                        <span tal:condition="python:not context.REQUEST.has_key('frm_searchString')">
                                                                <a tal:condition="python:(context.REQUEST.get('sort_order')) != 'reverse' or not context.REQUEST.has_key('sort_order')"
                                                                     tal:attributes="href string:${here/absolute_url}?sort_order=reverse">
                                                                    [<span>sort</span>]
                                                                </a>
                                                                <a tal:condition="python:(context.REQUEST.get('sort_order')=='reverse')"
                                                                     tal:attributes="href string:${here/absolute_url}">
                                                                    [<span>sort</span>]
                                                                </a>
                                                        </span>
                                                        <span tal:condition="python:context.REQUEST.has_key('frm_searchString')">
                                                                <a tal:condition="python:(context.REQUEST.get('sort_order')) != 'reverse' or not context.REQUEST.has_key('sort_order')"
                                                                     tal:attributes="href string:${here/absolute_url}?sort_order=reverse&frm_searchString=${request/frm_searchString}">
                                                                    [<span>sort</span>]
                                                                </a>
                                                                <a tal:condition="python:(context.REQUEST.get('sort_order')=='reverse')"
                                                                     tal:attributes="href string:${here/absolute_url}?frm_searchString=${request/frm_searchString}">
                                                                    [<span>sort</span>]
                                                                </a>
                                                        </span>                                                
                                                </th>
                                                <th>
                                                        <span i18n:translate="classifieds_classifiedsclassified_label_price">Price</span>
                                                        <span tal:condition="python:not context.REQUEST.has_key('frm_searchString')">
                                                                <a tal:condition="python:(context.REQUEST.get('sort_order')) != 'reverse' or not context.REQUEST.has_key('sort_order')"
                                                                     tal:attributes="href string:${here/absolute_url}?sort_order=reverse&sort_on=price">
                                                                    [<span>sort</span>]
                                                                </a>
                                                                <a tal:condition="python:(context.REQUEST.get('sort_order')=='reverse')"
                                                                     tal:attributes="href string:${here/absolute_url}?sort_on=price">
                                                                    [<span>sort</span>]
                                                                </a>
                                                        </span>
                                                        <span tal:condition="python:context.REQUEST.has_key('frm_searchString')">
                                                                <a tal:condition="python:(context.REQUEST.get('sort_order')) != 'reverse' or not context.REQUEST.has_key('sort_order')"
                                                                     tal:attributes="href string:${here/absolute_url}?sort_order=reverse&frm_searchString=${request/frm_searchString}&sort_on=price">
                                                                    [<span>sort</span>]
                                                                </a>
                                                                <a tal:condition="python:(context.REQUEST.get('sort_order')=='reverse')"
                                                                     tal:attributes="href string:${here/absolute_url}?frm_searchString=${request/frm_searchString}&sort_on=price">
                                                                    [<span>sort</span>]
                                                                </a>
                                                        </span>                                                  
                                                </th>
                                        </tr>
                                        <tbody>
                                                <tr tal:repeat="item batch" tal:attributes="class python:repeat['item'].odd()==1 and 'odd' or 'even'">
                                                        <span tal:omit-tag="" tal:condition="python:not portal.isExpired(item)">
                                                                <td>
                                                                        <span tal:condition="item/hasImage">
                                                                                <img class="image_tile" tal:attributes="src python:item.getImageTile" />
                                                                
                                                                        </span>
                                                                        <span tal:condition="not: item/getImageTile">
                                                                                <img class="image_tile" src="++resource++collective.classifieds.images/no_photo.jpg" />
                                                                                <span i18n:translate="marketplace_no_image_tile_label">No Image</span>
                                                                        </span>                                                        
                                                                </td>
                                                                <td>
                
                                                                        <a tal:attributes="href string:${item/getURL}" tal:content="item/Title">Name</a>
                                                                </td>
                                                                <td>
                                                                        <span tal:content="python:'%0.2f' % context.price" />
                                                                </td>
                                                        </span>
                                                </tr>
                                        </tbody>
                                </table>
                                
                                <!-- show batch/paging navigation -->
                                <span metal:use-macro="here/batch_macros/macros/navigation" />
        
                        </div>
                </div>
                <!-- end search results -->
                
                
                <br />
                <!-- list (sub)categories, if there is no search -->
                <span tal:condition="not:view/search">
                        <span tal:condition="python:context.REQUEST.has_key('frm_searchString')">
                                <h3 i18n:translate="classifieds_results">Results</h3>
                                <span i18n:translate="classifieds_you_searched_on">You searched on</span>: 
                                <b>"<span tal:content="request/frm_searchString">searchstring</span>"</b>,
                                0
                                <span i18n:translate="classifieds_resultsfound">results found</span>
                        </span>
                        
                        <span tal:condition="python: context.getFolderContents(contentFilter={'meta_type':['ClassifiedsCategory']})">
                                <h3>
                                        <span i18n:translate="classifieds_classifiedsclassified_label_categories_in_this_category">Subcategories in this category</span>: 
                                        <span tal:omit-tag="" tal:content="context/Title">Title</span>
                                </h3>
                                
                                <table border="0" width="100%" class="listing">
                                        <tr>
                                                <th>
                                                        <span i18n:translate="classifieds_classifiedsclassified_label_categories_in_this_category">Categories in this category</span>
                                                        <span tal:content="context/Title"></span>
                                                        <a tal:condition="python:(context.REQUEST.get('sort_order')) != 'reverse' or not context.REQUEST.has_key('sort_order')"
                                                             tal:attributes="href string:${here/absolute_url}?sort_order=reverse">
                                                            [<span i18n:translate="classifieds_sorting">sort</span>]
                                                        </a>
                                                        <a tal:condition="python:(context.REQUEST.get('sort_order')=='reverse')"
                                                             tal:attributes="href string:${here/absolute_url}">
                                                            [<span i18n:translate="classifieds_sorting">sort</span>]
                                                        </a>
                                                </th>
                                        </tr>
                                        
                                        <tbody>
                                                <tr tal:repeat="item python: context.getFolderContents(contentFilter={'meta_type':['ClassifiedsCategory'],'sort_on':'sortable_title', 'sort_order':context.REQUEST.get('sort_order')})" tal:attributes="class python:repeat['item'].odd()==1 and 'odd' or 'even'">
                                                        <td>
                                                                <img tal:attributes="src string:${item/getIcon}" />
                                                                <a tal:attributes="href string:${item/getURL}" tal:content="item/Title">Name</a>
                                                                (<span id="classifieds_classified_amount" tal:content="python: view.getNumberOfClassifieds(item)" />)
                                                                
                                                                
                                                        </td>
                                                </tr>
                                        </tbody>
                                </table>
                                
                        </span>
                </span>
                <br />
                <!-- end categories -->                

                
                <!-- list classifieds if there is no search -->
                <span tal:define="listresults python: context.getFolderContents(contentFilter={'meta_type':['Classified'],'sort_on':context.REQUEST.get('sort_on'), 'sort_order':context.REQUEST.get('sort_order')});
                     Batch python:modules['Products.CMFPlone'].Batch;
                     b_size python:30;
                     b_start python:0;
                     b_start request/b_start | b_start;">
                        
                        
                        <span tal:condition="python: context.getFolderContents(contentFilter={'meta_type':['Classified']})">
                                <h3>
                                        <span i18n:translate="classifieds_classifiedsclassified_label_classifieds_in_this_category">Classifieds in the category</span>: 
                                        <span tal:omit-tag="" tal:content="context/Title">Title</span>
                                </h3>
                                
                                <div tal:condition="python: listresults and not view.search()" tal:define="batch python:Batch(listresults, b_size, int(b_start), orphan=1);">
                                                <table border="0" width="100%" class="listing">
                                                        <tr>
                                                                <th i18n:translate="classifieds_classifiedsclassified_label_image">
                                                                        Image
                                                                </th>
                                                                <th>
                                                                        <span i18n:translate="classifieds_classifiedsclassified_label_classifieds_in_this_category">Classifieds in this category</span>
                                                                        <span tal:content="context/Title"></span>
                                                                        
                                                                        <a tal:condition="python:(context.REQUEST.get('sort_order')) != 'reverse' or not context.REQUEST.has_key('sort_order')"
                                                                             tal:attributes="href string:${here/absolute_url}?sort_order=reverse&sort_on=sortable_title">
                                                                            [<span i18n:translate="classifieds_sorting">sort</span>]
                                                                        </a>
                                                                        <a tal:condition="python:(context.REQUEST.get('sort_order')=='reverse')"
                                                                             tal:attributes="href string:${here/absolute_url}?sort_on=sortable_title">
                                                                            [<span i18n:translate="classifieds_sorting">sort</span>]
                                                                        </a>                                                
                                                                </th>
                                                                <th>
                                                                        <span tal:omit-tag="" i18n:translate="classifieds_classifiedsclassified_label_price">Price</span>
                                                                        <a tal:condition="python:(context.REQUEST.get('sort_order')) != 'reverse' or not context.REQUEST.has_key('sort_order')"
                                                                             tal:attributes="href string:${here/absolute_url}?sort_order=reverse&sort_on=price">
                                                                            [<span i18n:translate="classifieds_sorting">sort</span>]
                                                                        </a>
                                                                        <a tal:condition="python:(context.REQUEST.get('sort_order')=='reverse')"
                                                                             tal:attributes="href string:${here/absolute_url}?sort_on=price">
                                                                            [<span tal:omit-tag="" i18n:translate="classifieds_sorting">sort</span>]
                                                                        </a>                                                
                                                                        
                                                                </th>        
                                                        </tr>
                                                        <tbody>
                                                                <tr tal:repeat="item batch" tal:attributes="class python:repeat['item'].odd()==1 and 'odd' or 'even'">
                                                                        <!-- isExpired checks if a item is expired -->
                                                                        <span tal:omit-tag="" tal:condition="python:not portal.isExpired(item)">
                                                                                <td>
                                                                                        <span tal:condition="item/hasImage">
                                                                                                <img class="image_tile" tal:attributes="src python:item.getImageTile" />
                                                                
                                                                                        </span>
                                                                                        <span tal:condition="not: item/getImageTile">
                                                                                                <img class="image_tile" src="++resource++collective.classifieds.images/no_photo.jpg" />
                                                                                                <span i18n:translate="marketplace_no_image_tile_label">No Image</span>
                                                                                        </span>
                                                                                </td>
                                                                                <td>
                                                                                        <a tal:attributes="href string:${item/getURL}" tal:content="item/Title">Name</a>
                                                                                </td>
                                                                                <td>
                                                                                        <span tal:content="python:'%0.2f' % item['price']" />
                                                                                </td>
                                                                        </span>
                                                                </tr>
                                                        </tbody>
                                                </table>
                                        <!-- show batch/paging navigation -->
                                        <span metal:use-macro="here/batch_macros/macros/navigation" />
                                </div>
                        </span>
                        <!-- end classifieds -->
                </span>
                

        </form>
        


</div>
</body>
</html>
