<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      xml:lang="en" lang="en"
      metal:use-macro="context/prefs_main_template/macros/master"
      i18n:domain="collective.workflowed">

<body>

<div metal:fill-slot="prefs_configlet_main">

    <h1 class="documentFirstHeading"
        i18n:translate="heading_workflow_settings">Workflow Editor</h1>

    <a href=""
        class="link-parent"
        tal:attributes="href string:$portal_url/plone_control_panel"
        i18n:translate="label_up_to_plone_setup">
            Up to Site Setup
    </a>

    <form method="post" tal:attributes="action string:${context/absolute_url}/@@workflowed-controlpanel">
        
        <input type="hidden" name="form.submitted:boolean" value="True" />

            <tal:workflows define="current_wf view/current_workflow_data">

                <div class="field">
                    <label i18n:translate="types_controlpanel_current_workflow">
Current workflow:</label>
                    <select onchange="form.submit()" id="selected_workflow" name="selected_workflow">
                        
                        <tal:wfs repeat="wf view/available_workflows">
                            <option i18n:translate=""
                                    tal:content="wf/title"
                                    tal:attributes="selected python:wf['id'] == view.selected_workflow() and 'selected' or None; value wf/id">Intranet Workflow
                            </option>
                        </tal:wfs>

                    </select>
                    <br/>
                    <ul class="workflowActions">
                        <li> <a href="" tal:attributes="onclick string:window.open('${view/current_workflow_url}/@@sanity-check','workflow_popup','toolbar=0,directories=0,menubar=0,location=0,directories=0,width=800,height=600,scrollbars=1');;return false;"><img src="++resource++collective.workflowed.images/tick.png"> Sanity Check</a>
                        <li> <a href="" tal:attributes="onclick string:window.open('${view/current_workflow_url}/@@to-xml','workflow_popup','toolbar=0,directories=0,menubar=0,location=0,directories=0,width=800,height=600,scrollbars=1');;return false;"><img src="++resource++collective.workflowed.images/page_white_code.png"> Get XML</a>
                        <li> <a href="" tal:attributes="onclick string:window.open('${view/current_workflow_url}/@@to-csv','workflow_popup','toolbar=0,directories=0,menubar=0,location=0,directories=0,width=800,height=600,scrollbars=1');;return false;"><img src="++resource++collective.workflowed.images/page_white_excel.png"> Get CSV</a>
                </ul>
                <ul class="discreet"
                    tal:repeat="desc current_wf/description"
                    tal:condition="current_wf/description">
                    <li tal:content="desc"
                        i18n:translate>Workflow description</li>
                </ul>
                </div>

            </tal:workflows>

    </form>

    <form method="post" tal:attributes="action string:${context/absolute_url}/@@workflowed-add-workflow;">
        <input type="submit" name="form.button.AddWorkflow" class="standalone" value="Add new workflow" i18n:attributes="value label_add_workflow;" />
    </form>

    <br />

    <iframe src="workflowed_iframe" tal:attributes="src string:${portal_url}/@@workflowed-controlpanel-iframe?selected_workflow=${view/selected_workflow}" frameborder="1" width="100%" height="800px">
    </iframe>


</div>

</body>
</html>
