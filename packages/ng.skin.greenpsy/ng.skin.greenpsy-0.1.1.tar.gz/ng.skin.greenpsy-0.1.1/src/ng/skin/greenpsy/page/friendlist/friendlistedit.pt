<html metal:use-macro="context/@@standard_macros/view"
    i18n:domain="zope">
<head>
  <title>FriendListEdit</title>
</head>
<body>
  <div metal:fill-slot="body">

  <div class="message" tal:content="options/message | nothing" tal:condition="options/message | nothing"/>
  <div class="error" tal:content="options/error | nothing" tal:condition="options/error | nothing"/>

  <div class="friendlist" tal:condition="python: len(view.friends.suggestset) > 0">
    <h1 class="friendlistheader">Заявки:</h1>

    <form action="." method="post" tal:attributes="action context/@@absolute_url">
	  <div class="person" tal:repeat="friend view/friends/suggests">
       
        <a tal:attributes="href friend/profile/@@adaptive_url">
        <div class="imagebox">
            <tal:block
                on-error="structure python:'<img src=\'/++resource++images/nophoto-small.gif\'/>'">

              <tal:block 
	          condition="python:path('friend/profile/++attribute++logo').getSize() > 0"
    		  content="structure python:path('friend/profile/++attribute++logo/@@smartimagecontainer/small').tag()">
	      </tal:block>
	      <tal:block 
		    condition="python:path('friend/profile/++attribute++logo').getSize() == 0">
		    <img src="/++resource++images/nophoto-small.gif" alt="NO PHOTO" />
	      </tal:block>
	    </tal:block>
        </div>
        </a>
        <input type="checkbox" name="ids:list" tal:attributes="value friend/id" />
        <br clear="both" />
        <a tal:attributes="href friend/profile/@@adaptive_url">
          <span tal:replace="friend/profile/title">Степан Лондон</span>
        </a> 
      </div>
      
      <br clear="all" />

      <input type="submit" name="multiaccepted:method" class="button" value="Принять" />
      <input type="submit" name="multirejected:method" class="button" value="Отказать" />

    </form>

  </div>

  <br />
        
  <div class="friendlist" tal:condition="python: len(view.friends.set) > 0">
    <h1 class="friendlistheader">Мои друзья: </h1>
    <form action="." method="post" tal:attributes="action context/@@absolute_url">
    
    <tal:block repeat="friend view/friends/friends">
	  <div class="person" tal:condition="python: not view.iscommunity(friend.profile)">
        <a tal:attributes="href friend/profile/@@adaptive_url">
          <div class="imagebox">
            <tal:block
                on-error="structure python:'<img src=\'/++resource++images/nophoto-small.gif\'/>'">
              <tal:block
	              condition="python:path('friend/profile/++attribute++logo').getSize() > 0"
    	          content="structure python:path('friend/profile/++attribute++logo/@@smartimagecontainer/small').tag()">
              </tal:block>
	          <tal:block
		          condition="python:path('friend/profile/++attribute++logo').getSize() == 0">
		        <img src="/++resource++images/nophoto-small.gif" alt="NO PHOTO" />
	          </tal:block>
            </tal:block>
          </div>
        </a>
        <input type="checkbox" name="ids:list" tal:attributes="value friend/id" />
        <br/>
        <a tal:attributes="href friend/profile/@@adaptive_url">
        
          <span class="personname" tal:content="friend/profile/title">Степан Лондон</span>
          <span class="personstatus" tal:content="python:friend.status and 'accepted' or 'waited'">Друг</span>
          <span class="iscommunity"
                tal:condition="python:view.iscommunity(friend.profile)">
            (cообщество)
          </span>
          <a tal:condition="python: not view.iscommunity(friend.profile)"
             tal:attributes="href string: ${friend/profile/@@adaptive_url}/@@chat.html; target friend/profile/__name__;">Сообщения
            <tal:block on-error="string:" define="len python: path('context/++nsinterface++ng.content.profile.exchangeannotation.interfaces.IExchangeAnnotation')[unicode(friend.id)].count"
                condition="len">
	          <span style="color: red">(<tal:block content="len"/>)</span>
	        </tal:block>
          </a>
        </a> 
      </div>

	  <div class="community" tal:condition="python: view.iscommunity(friend.profile)">
        <a tal:attributes="href friend/profile/@@adaptive_url">
          <span class="iscommunity"
                tal:condition="python:view.iscommunity(friend.profile)">
            cообщество
          </span>          

          <div class="imagebox">
            <tal:block
                on-error="structure python:'<img src=\'/++resource++images/nophoto-small.gif\'/>'">
              <tal:block
	              condition="python:path('friend/profile/++attribute++logo').getSize() > 0"
    	          content="structure python:path('friend/profile/++attribute++logo/@@smartimagecontainer/small').tag()">
              </tal:block>
	          <tal:block
		          condition="python:path('friend/profile/++attribute++logo').getSize() == 0">
		        <img src="/++resource++images/nophoto-small.gif" alt="NO PHOTO" />
	          </tal:block>
            </tal:block>
          </div>
        </a>
        <input type="checkbox" name="ids:list" tal:attributes="value friend/id" />
        <br/>
        <a tal:attributes="href friend/profile/@@adaptive_url">
        
          <span class="communityname" tal:content="friend/profile/title">Степан Лондон</span>
          <!--
          <span class="communitystatus" tal:content="python:friend.status and 'accepted' or 'waited'">Друг</span>
          -->
          <a tal:condition="python: not view.iscommunity(friend.profile)"
             tal:attributes="href string: ${friend/profile/@@adaptive_url}/@@chat.html; target friend/profile/__name__;">Сообщения
            <tal:block on-error="string:" define="len python: path('context/++nsinterface++ng.content.profile.exchangeannotation.interfaces.IExchangeAnnotation')[unicode(friend.id)].count"
                condition="len">
	          <span style="color: red">(<tal:block content="len"/>)</span>
	        </tal:block>
          </a>
        </a> 
      </div>
    </tal:block>
      
    <br clear="all" />
      
    <input type="submit" name="multiremove:method" class="button" value="Удалить"/>
      
    </form>

  </div>
      
  <form action="" tal:attributes="action string: ${context/@@absolute_url}/">
    <input type="submit" name="suggest:method" value="Suggest friendship" class="button" />
  </form>
  </div>
</body>
</html>  