<html metal:use-macro="context/@@standard_macros/view"
    i18n:domain="zope">
  <head>
    <title>Full photo image</title>
  </head>
  <body metal:fill-slot="mainbody">
      <div class="chat">
          <tal:block tal:condition="view/checkpermission" define="none view/reset">

              <h1 class="chatheader"><a href="http://www.greenfuture.ru">GreenFuture</a></h1>
        <!--      <img class="chatlogo" src="" alt="logo" tal:attributes="src context/++resource++images/title.gif" /> -->
              <div class="chatworkplace">
                  <form tal:attributes="action string: ${context/@@absolute_url}/" name="mess">
                  <nobr>
                  <span class="chatwith">
                    <b>Переписка с пользователем: <a tal:attributes="href context/@@adaptive_url"
                       tal:content="context/title"
                    /></b>
                  </span>
                  <input type="submit" name="update:method" value="Обновить"> <input type="submit" name="send:method" value="Послать">
                  </nobr>
                  <nobr>
                    <tal:block 
                        tal:on-error="structure python:'<img height=\'100\' width=\'80\' src=\'/++resource++images/nophoto-big.gif\'>'">
                      <tal:block
                          condition="python:path('context/++attribute++logo').getSize() > 0"
                          content="structure python:path('context/++attribute++logo/@@smartimagecontainer/small').tag()">
                      </tal:block>
                      <tal:block
                          condition="python:path('context/++attribute++logo').getSize() == 0">
                        <img height="100" width="80" src="/++resource++images/nophoto-small.gif" alt="NO PHOTO" />
                      </tal:block>
                    </tal:block>
                  <textarea style="width: 100%" rows="3" name="abstract"></textarea>
                  </nobr>
                  </form>
              </div>
              <div style="clear: both; border-bottom: 1px solid green;"></div>

	      <tal:block
                  tal:define="pager view/exchanger_self/@@pager; p python:pager.setPagerParameters(context=context, revert=True, size=15)">
                  <metal:block use-macro="views/ng_skin_macros/values">
                    <metal:block fill-slot="title">Найдено:</metal:block>
		    <metal:block fill-slot="item">
                        <div class="chatmessage" tal:define="message item">
                            <span class="messagetime" tal:content="python:'[' + message.created.strftime('%Y-%m-%d %H:%M') + ']'" />
                            <span class="me"
                                tal:condition="python: message.author == request.principal.id"
                                tal:content="structure python: path('context/@@nickname')[message.author]"
                                />
                            <span class="notme"
                                tal:condition="python: message.author != request.principal.id"
                                tal:content="structure python: path('context/@@nickname')[message.author]"
                              /> 
                                  : <tal:block tal:content="message/abstract"/> 
                        </div>
		    </metal:block>
                  </metal:block>      
	      </tal:block>
              <script>
                  document.forms.mess.onkeydown = register;
                  setTimeout('update()',10000);
                  document.forms.mess.abstract.focus()
                  function update() {
                    var allTags = document.getElementsByTagName("*");
                        len = allTags.length; 
                        flag = 0;

                    if (!document.forms.mess.abstract.value) {

                        for (i = 0; i < len; i++) {
                            if (allTags[i].className=="leftvalues") {
                                flag = 1;
                                break;
                            }
                        }
                        
                        if (!flag) {
                            document.getElementsByName("update:method")[0].click();
                        }
                    }
                  }
                  function register(e) {
                            if (!e) e = window.event;
                            var k = e.keyCode;
                            if (e.ctrlKey) {
                                    var f = document.forms.mess;
                                    if (k == 13) {
                                            document.getElementsByName("send:method")[0].click();
                                    }
                            }
                      
                  }
              </script>
          </tal:block>
          <tal:block tal:condition="not: view/checkpermission">
            Вы можете переписываться только с теми участниками сайта, с которыми установлены
            подтвержденные отношения дружбы, попробуйте <a href="" tal:attributes="href context/@@suggest/@@absolute_url">предложить свою дружбу</a>
          </tal:block> 
      </div>
  </body>
</html>  