<html>
  <head>
    <meta content="text/html; charset=iso-8859-1" http-equiv="Content-Type">
    <title>4Suite API Documentation: Ft.Xml.Xslt.Processor</title>
    <link href="modules.css" type="text/css" rel="stylesheet">
  </head>
  <body>
    <div class="universal-header"><span class="universal-header-prefix">&nbsp;&nbsp;&nbsp;</span>&nbsp;<span class="universal-header-prefix">&nbsp;&nbsp;</span>&nbsp;<span class="universal-header-prefix">&nbsp;</span>&nbsp;<a href="../index.html">4Suite<sup>&trade;</sup> API Documentation</a></div>
    <h1><span class="glyph-arrow">&#9658;</span> Module <span class="this-name"><a href="Ft.html" title="Ft">Ft</a>.<a href="Ft.Xml.html" title="Ft.Xml">Xml</a>.<a href="Ft.Xml.Xslt.html" title="Ft.Xml.Xslt">Xslt</a>.Processor</span></h1>
    <div class="abstract">XSLT processing engine</div>
    <pre class="description">Copyright 2005 Fourthought, Inc. (USA).
Detailed license and copyright information: http://4suite.org/COPYRIGHT
Project home, documentation, distributions: http://4suite.org/</pre>
    <div class="summary-section">
      <table cellpadding="0" cellspacing="0">
        <tbody>
          <tr>
            <td valign="top">
              <div class="summary-header">Classes:</div>
              <div class="summary-list"><span class="class-name"><a href="#Processor">Processor</a></span></div>
            </td>
            <td width="7" valign="middle"></td>
            <td width="1" valign="middle" bgcolor="#C5C5C5"></td>
            <td width="7" valign="middle"></td>
            <td valign="top">
              <div class="summary-header">Globals:</div>
              <div class="summary-list"><span class="global-name"><a href="#DEFAULT_ENCODING">DEFAULT_ENCODING</a></span>, <span class="global-name"><a href="#EMPTY_NAMESPACE">EMPTY_NAMESPACE</a></span>, <span class="global-name"><a href="#XSLT_IMT">XSLT_IMT</a></span></div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
    <div class="section">
      <h2>Classes</h2>
      <dl class="classes">
        <dt class="classdef"><a name="Processor"></a>class <span class="class-name">Processor</span><span class="bases">(<span class="class-name"><span class="undocumented">object</span></span>)</span></dt>
        <dd class="classdesc">
          <div class="abstract">An XSLT processing engine (4XSLT).</div>
          <pre class="description">Typical usage:

from Ft.Lib.Uri import OsPathToUri
from Ft.Xml import InputSource
from Ft.Xml.Xslt import Processor
# this is just one of several ways to create InputSources
styuri = OsPathToUri('/absolute/path/to/stylesheet.xslt')
srcuri = OsPathToUri('/absolute/path/to/doc.xml')
STY = InputSource.DefaultFactory.fromUri(styuri)
SRC = InputSource.DefaultFactory.fromUri(srcuri)
proc = Processor.Processor()
proc.appendStylesheet(STY)
result = proc.run(SRC)

Optional constructor arguments are:

  stylesheetAltUris: a list of alternative base URIs to use when
    resolving relative hrefs in xsl:import/xsl:include instructions.
    These URIs are only tried when the standard XSLT behavior of
    using the base URI of the xsl:import/include element itself
    fails to result in retrieval of a document.

  documentReader: an object that will be used to parse XML source
    documents (not stylesheets). It defaults to
    Ft.Xml.Domlette.NonvalidatingReader, but it can be any object
    that has a parse() method that returns a DOM or Domlette tree.

  implementation: a DOM implementation instance that will be used
    by the processor to create new source tree nodes, such as when
    generating result tree fragments or duplicating the source tree
    when runNode(node, preserveSrc=1) is called. Defaults to
    Ft.Xml.Domlette.implementation. Needs to have a
    createRootNode() method.

See the run() and runNode() methods for additional runtime options.

Important instance attributes:

  .extensionParams: a dictionary that allows one to attach
    additional metadata to a processor instance. We use this
    to make invocation-specific data like HTTP query args and
    logfile handles available to XSLT extension functions &amp; elements
    when invoking the processor via the repository's HTTP server.

  .inputSourceFactory: InputSource factory instance used when
    obtaining source documents. Defaults to
    Ft.Xml.InputSource.DefaultFactory.

  .mediaPref: the preferred/target media, for the purpose of
    picking from multiple xml-stylesheet processing instructions.
    Defaults to None. If set to a string, xml-stylesheet PIs
    without that string in their 'media' pseudo-attribute will be
    ignored.

  .msgPrefix and .msgSuffix: strings emitted before and after
    xsl:message output.

  .stylesheet: the complete stylesheet tree.</pre>
          <h3>Methods</h3>
          <dl class="methods">
            <dt class="methoddef"><a name="Processor-__init__"><span class="method-name">__init__</span></a>(<span class="argument-name">self</span>, <span class="argument-name">stylesheetAltUris</span><span class="argument-default">=None</span>, <span class="argument-name">documentReader</span><span class="argument-default">=None</span>, <span class="argument-name">implementation</span><span class="argument-default">=None</span>, <span class="argument-name">stylesheetIncPaths</span><span class="argument-default">=None</span>)</dt>
            <dd class="methoddesc"></dd>
            <dd class="overrides"><b>Overrides: </b><span class="inherited-name">__init__</span> from class <span class="class-name"><span class="undocumented">object</span></span></dd>
            <dt class="methoddef"><a name="Processor-addHandler"><span class="method-name">addHandler</span></a>(<span class="argument-name">self</span>, <span class="argument-name">outputParams</span>, <span class="argument-name">stream</span>)</dt>
            <dd class="methoddesc">
              <div class="abstract">Intended to be used by XSLT instruction implementations only.</div>
              <pre class="description">Sets up the processor to start processing subsequently
generated content with an output writer wrapper that first
determines which XSLT output method is going to be used (i.e.,
by looking at the output parameters or waiting to see if an
'html' element is the first new node generated), then replaces
itself with the appropriate writer instance.

outputParams is an Ft.Xml.Xslt.OutputParameters instance.

stream will be passed on to the constructor of the real writer.</pre>
            </dd>
            <dt class="methoddef"><a name="Processor-appendStylesheet"><span class="method-name">appendStylesheet</span></a>(<span class="argument-name">self</span>, <span class="argument-name">iSrc</span>)</dt>
            <dd class="methoddesc">
              <div class="abstract">Append a stylesheet from an InputSource.</div>
              <pre class="description">This method establishes the stylesheet that the processor will use to
do the transformation. If a stylesheet has already been appended, then
this method is equivalent to having, in an outer "shell" stylesheet,
an xsl:import for the most recently appended stylesheet followed by an
xsl:import for the stylesheet accessible via the given InputSource.</pre>
            </dd>
            <dt class="methoddef"><a name="Processor-appendStylesheetInstance"><span class="method-name">appendStylesheetInstance</span></a>(<span class="argument-name">self</span>, <span class="argument-name">instance</span>, <span class="argument-name">refUri</span><span class="argument-default">=''</span>)</dt>
            <dd class="methoddesc">
              <div class="abstract">Append an "instant" ("compiled") stylesheet, which is a pickled
Ft.Xml.Xslt.Stylesheet.Stylesheet object that has had its setup()
method called already. Such an instance can be obtained from another
processor, p, as p.stylesheet.root, which you can then pickle, save to
disk, and reuse in a new processor via this method.</div>
              <pre class="description">This method establishes the stylesheet that the processor will use to
do the transformation. If a stylesheet has already been appended, then
this method is equivalent to having an xsl:import of the new stylesheet
in the most recently appended stylesheet.

An exception will be raised if the same stylesheet is appended more
than once, just as if the same stylesheet were imported more than once.

refUri is the base URI to assume for the stylesheet. It defaults to
the base URI of the root node of the original stylesheet document with
the highest import precedence.

Note: Using the instant stylesheet tends to be less efficient than
using the original document and appendStylesheet(), unless the
stylesheet is large and complex, like DocBook XSL.</pre>
            </dd>
            <dt class="methoddef"><a name="Processor-appendStylesheetNode"><span class="method-name">appendStylesheetNode</span></a>(<span class="argument-name">self</span>, <span class="argument-name">node</span>, <span class="argument-name">refUri</span><span class="argument-default">=''</span>, <span class="argument-name">factory</span><span class="argument-default">=None</span>)</dt>
            <dd class="methoddesc">
              <div class="abstract">Append a stylesheet given as a DOM or Domlette Document node.</div>
              <pre class="description">This method establishes the stylesheet that the processor will use to
do the transformation. If a stylesheet has already been appended, then
this method is equivalent to having an xsl:import of the new stylesheet
in the most recently appended stylesheet.

An exception will be raised if the same stylesheet is appended more
than once, just as if the same stylesheet were imported more than once.

refUri is the base URI to assume for the stylesheet. It defaults to
the base URI of the given node.

The given InputSourceFactory will be used in order to read external
entities. It defaults to Ft.Xml.InputSource.DefaultFactory.</pre>
            </dd>
            <dt class="methoddef"><a name="Processor-applyTemplates"><span class="method-name">applyTemplates</span></a>(<span class="argument-name">self</span>, <span class="argument-name">context</span>, <span class="argument-name">params</span><span class="argument-default">=None</span>)</dt>
            <dd class="methoddesc">
              <div class="abstract">Intended to be used by XSLT instruction implementations only.</div>
              <pre class="description">Implements the xsl:apply-templates instruction by attempting to
let the stylesheet apply its own template for the given context.
If the stylesheet does not have a matching template, the
built-in templates are invoked.

context is an XsltContext instance. params is a dictionary of
parameters being passed in, defaulting to None.</pre>
            </dd>
            <dt class="methoddef"><a name="Processor-execute"><span class="method-name">execute</span></a>(<span class="argument-name">self</span>, <span class="argument-name">node</span>, <span class="argument-name">docInputSource</span>, <span class="argument-name">ignorePis</span><span class="argument-default">=0</span>, <span class="argument-name">topLevelParams</span><span class="argument-default">=None</span>, <span class="argument-name">writer</span><span class="argument-default">=None</span>, <span class="argument-name">outputStream</span><span class="argument-default">=None</span>)</dt>
            <dd class="methoddesc">
              <div class="abstract">Warning: do not call this method directly unless you know what
you're doing.  If unsure, you probably want the runNode method.</div>
              <pre class="description">Runs the stylesheet processor against the given XML DOM node with the
stylesheets that have been registered. It does not mutate the source.
If writer is given, it is used in place of the default output method
decisions for choosing the proper writer.</pre>
            </dd>
            <dt class="methoddef"><a name="Processor-getDocumentReader"><span class="method-name">getDocumentReader</span></a>(<span class="argument-name">self</span>)</dt>
            <dd class="methoddesc">
              <div class="abstract">Returns the reader used for source document input sources.</div>
            </dd>
            <dt class="methoddef"><a name="Processor-getStripElements"><span class="method-name">getStripElements</span></a>(<span class="argument-name">self</span>)</dt>
            <dd class="methoddesc"></dd>
            <dt class="methoddef"><a name="Processor-getStylesheetReader"><span class="method-name">getStylesheetReader</span></a>(<span class="argument-name">self</span>)</dt>
            <dd class="methoddesc">
              <div class="abstract">Returns the reader used for stylesheet document input sources.</div>
            </dd>
            <dt class="methoddef"><a name="Processor-messageControl"><span class="method-name">messageControl</span></a>(<span class="argument-name">self</span>, <span class="argument-name">suppress</span>)</dt>
            <dd class="methoddesc">
              <div class="abstract">Controls whether the processor emits warnings and xsl:message
messages. Call with suppress=1 to suppress such output.</div>
            </dd>
            <dt class="methoddef"><a name="Processor-output"><span class="method-name">output</span></a>(<span class="argument-name">self</span>)</dt>
            <dd class="methoddesc"></dd>
            <dt class="methoddef"><a name="Processor-popResult"><span class="method-name">popResult</span></a>(<span class="argument-name">self</span>)</dt>
            <dd class="methoddesc">
              <div class="abstract">Intended to be used by XSLT instruction implementations only.</div>
              <pre class="description">Ends temporary output writing that was started with
pushResultString(), pushResultTree(), or pushResult(), and
returns the result.</pre>
            </dd>
            <dt class="methoddef"><a name="Processor-pushResult"><span class="method-name">pushResult</span></a>(<span class="argument-name">self</span>, <span class="argument-name">handler</span><span class="argument-default">=None</span>)</dt>
            <dd class="methoddesc">
              <div class="abstract">Intended to be used by XSLT instruction implementations only.</div>
              <pre class="description">Sets up the processor to start processing subsequently
generated content with a new output writer (the given handler
of SAX-like output events).</pre>
            </dd>
            <dt class="methoddef"><a name="Processor-pushResultString"><span class="method-name">pushResultString</span></a>(<span class="argument-name">self</span>)</dt>
            <dd class="methoddesc">
              <div class="abstract">Intended to be used by XSLT instruction implementations only.</div>
              <pre class="description">Sets up the processor to start processing subsequently
generated content with an output writer that buffers the text
from text events and keeps track of whether non-text events
occurred. This is used by the implementations of XSLT
instructions such as xsl:attribute.</pre>
            </dd>
            <dt class="methoddef"><a name="Processor-pushResultTree"><span class="method-name">pushResultTree</span></a>(<span class="argument-name">self</span>, <span class="argument-name">baseUri</span>, <span class="argument-name">implementation</span><span class="argument-default">=None</span>)</dt>
            <dd class="methoddesc">
              <div class="abstract">Intended to be used by XSLT instruction implementations only.</div>
              <pre class="description">Sets up the processor to start processing subsequently
generated content with a new output writer that produces
a separate document. The new document will have the given
baseUri as its URI. This is used to generate result tree
fragments.

Allows specifying an alternative DOM implementation for the
creation of the new document.</pre>
            </dd>
            <dt class="methoddef"><a name="Processor-registerExtensionElement"><span class="method-name">registerExtensionElement</span></a>(<span class="argument-name">self</span>, <span class="argument-name">namespace</span>, <span class="argument-name">localName</span>, <span class="argument-name">klass</span>)</dt>
            <dd class="methoddesc">
              <div class="abstract">Register a single extension element.</div>
              <pre class="description">For example, implement your own extension element as a subclass
of Ft.Xml.Xslt.XsltElement. To make the element available to the
Processor, call this method, passing in the namespace URI and
local name of the element, and a direct reference to the class
that implements the extension.

See also registerExtensionModules().</pre>
            </dd>
            <dt class="methoddef"><a name="Processor-registerExtensionFunction"><span class="method-name">registerExtensionFunction</span></a>(<span class="argument-name">self</span>, <span class="argument-name">namespace</span>, <span class="argument-name">localName</span>, <span class="argument-name">function</span>)</dt>
            <dd class="methoddesc">
              <div class="abstract">Register a single extension function.</div>
              <pre class="description">For example, implement your own extension function as a Python
function that takes an Ft.Xml.XPath.Context.Context instance as
its first argument. Then, to make the function available to the
Processor, call this method, passing in the namespace URI and
local name of the function, and a direct reference to the Python
function that implements the extension.

See also registerExtensionModules().</pre>
            </dd>
            <dt class="methoddef"><a name="Processor-registerExtensionModules"><span class="method-name">registerExtensionModules</span></a>(<span class="argument-name">self</span>, <span class="argument-name">moduleList</span>)</dt>
            <dd class="methoddesc">
              <div class="abstract">Registers a list of Python modules that have public ExtFunctions
and/or ExtElements dictionaries.</div>
              <pre class="description">In a Python module that contains extension implementations,
define a dictionary named ExtFunctions that, for each extension
function or element, maps a (namespace-URI, xpath-function-name)
tuple to a direct reference to the Python function that
implements the extension. To make the function available to the
Processor, call this method, passing in ['your.module.name'].

See Ft.Xml.Xslt.Exslt.*, Ft.Xml.Xslt.BuiltInExtFunctions and
BuiltInExtElements for working examples of extension modules.</pre>
            </dd>
            <dt class="methoddef"><a name="Processor-removeHandler"><span class="method-name">removeHandler</span></a>(<span class="argument-name">self</span>)</dt>
            <dd class="methoddesc">
              <div class="abstract">Intended to be used by XSLT instruction implementations only.</div>
              <pre class="description">Deletes the most recently added output writer.</pre>
            </dd>
            <dt class="methoddef"><a name="Processor-reset"><span class="method-name">reset</span></a>(<span class="argument-name">self</span>)</dt>
            <dd class="methoddesc">
              <div class="abstract">Returns the processor to a state where it can be used to do a
new transformation with a new stylesheet. Deletes the current
stylesheet tree, and may do other cleanup.</div>
            </dd>
            <dt class="methoddef"><a name="Processor-run"><span class="method-name">run</span></a>(<span class="argument-name">self</span>, <span class="argument-name">iSrc</span>, <span class="argument-name">ignorePis</span><span class="argument-default">=0</span>, <span class="argument-name">topLevelParams</span><span class="argument-default">=None</span>, <span class="argument-name">writer</span><span class="argument-default">=None</span>, <span class="argument-name">outputStream</span><span class="argument-default">=None</span>)</dt>
            <dd class="methoddesc">
              <div class="abstract">Transform a source document as given via an InputSource.</div>
              <pre class="description">Assumes that either the Processor instance has already had
stylesheets appended (via appendStylesheet(), for example), or
the source document contains xml-stylesheet processing
instructions that are not being ignored.

The ignorePis flag, if set, will cause xml-stylesheet
processing instructions in the source document to be ignored.

The topLevelParams argument is an optional dictionary of
stylesheet parameters, the keys of which may be given as
strings if they have no namespace, or as (uri, localname)
tuples otherwise.

The optional writer argument is a SAX-like event handler that
is an Ft.Xml.Xslt.NullWriter subclass. The default writer is
either an Ft.Xml.Xslt.XmlWriter, HtmlWriter or PlainTextWriter,
depending on the stylesheet(s).

The optional outputStream argument is a Python file-like object
to be used as the destination for the writer's output.</pre>
            </dd>
            <dt class="methoddef"><a name="Processor-runNode"><span class="method-name">runNode</span></a>(<span class="argument-name">self</span>, <span class="argument-name">node</span>, <span class="argument-name">sourceUri</span><span class="argument-default">=None</span>, <span class="argument-name">ignorePis</span><span class="argument-default">=0</span>, <span class="argument-name">topLevelParams</span><span class="argument-default">=None</span>, <span class="argument-name">writer</span><span class="argument-default">=None</span>, <span class="argument-name">outputStream</span><span class="argument-default">=None</span>, <span class="argument-name">preserveSrc</span><span class="argument-default">=0</span>, <span class="argument-name">docInputSource</span><span class="argument-default">=None</span>)</dt>
            <dd class="methoddesc">
              <div class="abstract">Transform a source document as given via a Domlette document
node.</div>
              <pre class="description">Use Ft.Xml.Domlette.ConvertDocument() to create a Domlette
from some other type of DOM.

Assumes that either the Processor instance has already had
stylesheets appended (via appendStylesheet(), for example), or
the source document contains xml-stylesheet processing
instructions that are not being ignored.

sourceUri - The absolute URI of the document
entity that the node represents, and should be explicitly
provided, even if it is available from the node itself.

ignorePis - (flag) If set, will cause xml-stylesheet
processing instructions in the source document to be ignored.

topLevelParams - optional dictionary of
stylesheet parameters, the keys of which may be given as
strings if they have no namespace, or as (uri, localname)
tuples otherwise.

writer - optional SAX-like event handler that
is an Ft.Xml.Xslt.NullWriter subclass. The default writer is
either an Ft.Xml.Xslt.XmlWriter, HtmlWriter or PlainTextWriter,
depending on the stylesheet(s).

outputStream - optional Python file-like object
to be used as the destination for the writer's output.

preserveSrc - (flag) If set signals that the source DOM should not be
mutated, as would normally happen when honoring XSLT whitespace
stripping requirements. Setting preserveSrc results in the
creation of a copy of the source DOM.

isrc - optional input source used strictly for further resolution
relative the given DOM</pre>
            </dd>
            <dt class="methoddef"><a name="Processor-setDocumentReader"><span class="method-name">setDocumentReader</span></a>(<span class="argument-name">self</span>, <span class="argument-name">docReader</span>)</dt>
            <dd class="methoddesc">
              <div class="abstract">Sets the reader used for source document input sources.</div>
              <pre class="description">The reader can be anything with a parse() interface that
returns a DOM tree. It is normally
Ft.Xml.Domlette.NonvalidatingReader or whatever was specified in
the Processor constructor. This method is sometimes used to set
the reader to Domlette.ValidatingReader.</pre>
            </dd>
            <dt class="methoddef"><a name="Processor-setStylesheetReader"><span class="method-name">setStylesheetReader</span></a>(<span class="argument-name">self</span>, <span class="argument-name">reader</span>)</dt>
            <dd class="methoddesc">
              <div class="abstract">Sets the reader used for stylesheet document input sources.</div>
              <pre class="description">It is normally an instance of
Ft.Xml.Xslt.StylesheetReader.StylesheetReader</pre>
            </dd>
            <dt class="methoddef"><a name="Processor-warning"><span class="method-name">warning</span></a>(<span class="argument-name">self</span>, <span class="argument-name">message</span>)</dt>
            <dd class="methoddesc">
              <div class="abstract">Emits a warning via Python's warnings framework, unless warnings
are suppressed (see messageControl()).</div>
              <pre class="description">Used, for example, to announce that built-in templates are being
invoked with params.</pre>
            </dd>
            <dt class="methoddef"><a name="Processor-xslMessage"><span class="method-name">xslMessage</span></a>(<span class="argument-name">self</span>, <span class="argument-name">msg</span>)</dt>
            <dd class="methoddesc">
              <div class="abstract">Intended to be used by XSLT instruction implementations only.</div>
              <pre class="description">Used by xsl:message to emit a message to sys.stderr, unless such
messages are suppressed (see messageControl()). Uses the
msgPrefix &amp; msgSuffix instance attributes.</pre>
            </dd>
          </dl>
          <h3>Methods inherited from class <span class="undocumented">object</span></h3>
          <div class="inherited"><span class="inherited-name">__delattr__</span>, <span class="inherited-name">__getattribute__</span>, <span class="inherited-name">__hash__</span>, <span class="inherited-name">__new__</span>, <span class="inherited-name">__reduce__</span>, <span class="inherited-name">__reduce_ex__</span>, <span class="inherited-name">__repr__</span>, <span class="inherited-name">__setattr__</span>, <span class="inherited-name">__str__</span></div>
          <h3>Members</h3>
          <dl class="members">
            <dt class="memberdef"><a name="__dict__"><span class="member-name">__dict__</span></a> = &lt;attribute '__dict__' of 'Processor' objects&gt;</dt>
            <dt class="memberdef"><a name="__weakref__"><span class="member-name">__weakref__</span></a> = &lt;attribute '__weakref__' of 'Processor' objects&gt;</dt>
            <dt class="memberdef"><a name="writer"><span class="member-name">writer</span></a> = &lt;property object&gt;</dt>
          </dl>
          <h3>Members inherited from class <span class="undocumented">object</span></h3>
          <div class="inherited"><span class="inherited-name">__class__</span></div>
        </dd>
      </dl>
    </div>
    <div class="section">
      <h2>Globals</h2>
      <dl class="globals">
        <dt class="globaldef"><a name="DEFAULT_ENCODING"><span class="global-name">DEFAULT_ENCODING</span></a> = 'UTF-8'</dt>
        <dd class="globaldesc"></dd>
        <dt class="globaldef"><a name="EMPTY_NAMESPACE"><span class="global-name">EMPTY_NAMESPACE</span></a> = None</dt>
        <dd class="globaldesc"></dd>
        <dt class="globaldef"><a name="XSLT_IMT"><span class="global-name">XSLT_IMT</span></a> = ['application/xslt+xml', 'application/xslt', 'text/xml', 'application/xml']</dt>
        <dd class="globaldesc"></dd>
      </dl>
    </div>
    <div class="universal-footer">Last modified on 2006-08-21 18:38:32</div>
  </body>
</html>
