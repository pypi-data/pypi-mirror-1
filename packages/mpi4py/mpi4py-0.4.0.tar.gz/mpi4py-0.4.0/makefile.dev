# -*- makefile -*-

CFLAGS:='-Wall -pedantic -Wno-long-long'

PYTHON = python

SETUP_PY=setup.py
#SETUPOPT=-q

BUILD_PY=build
BUILDOPT=

PCKBUILD = CFLAGS=${CFLAGS} ${PYTHON} ${SETUP_PY} ${SETUPOPT} ${BUILD_PY} ${BUILDOPT}

MAKEDEV = ${MAKE} -f makefile.dev
CLEAN = ${RM} -r build 	_configtest.*


all: all-py

all-py:
#	${MAKEDEV} PYTHON=python2.3 all-mpi
	${MAKEDEV} PYTHON=python2.4 all-mpi
	${MAKEDEV} PYTHON=python2.5 all-mpi

all-mpi: mpi-0 mpi-1 mpi-2 mpi-3 mpi-4

mpi-0:
	${CLEAN}; ${PCKBUILD}
	${CLEAN}; ${PCKBUILD} --mpicc=mpicc
	${CLEAN}; MPICC=qwerty ${PCKBUILD} --mpicc=mpicc
	${CLEAN}; MPICC=mpicc  ${PCKBUILD}
	${CLEAN}; MPICC=mpicxx ${PCKBUILD}
	${CLEAN}


mpi-1:
	${CLEAN}; MPICC= MPICXX= ${PCKBUILD} --mpi=mpich2
	${CLEAN}; MPICC= MPICXX= ${PCKBUILD} --mpi=openmpi
	${CLEAN}; MPICC= MPICXX= ${PCKBUILD} --mpi=lam     
	${CLEAN}; MPICC= MPICXX= ${PCKBUILD} --mpi=mpich     
	${CLEAN}

mpi-2:
	${CLEAN}; MPICC= MPICXX= MPI_CFG=mpich2	 ${PCKBUILD}
	${CLEAN}; MPICC= MPICXX= MPI_CFG=openmpi ${PCKBUILD}
	${CLEAN}; MPICC= MPICXX= MPI_CFG=lam     ${PCKBUILD}
	${CLEAN}; MPICC= MPICXX= MPI_CFG=mpich   ${PCKBUILD}
	${CLEAN}

mpi-3:
	${RM} /tmp/mpi.cfg; cp mpi.cfg /tmp/mpi.cfg
	${CLEAN}; MPICC= MPICXX= ${PCKBUILD} --mpi=mpich2,/tmp/mpi.cfg
	${CLEAN}; MPICC= MPICXX= ${PCKBUILD} --mpi=openmpi,/tmp/mpi.cfg
	${CLEAN}; MPICC= MPICXX= ${PCKBUILD} --mpi=lam,/tmp/mpi.cfg
	${CLEAN}; MPICC= MPICXX= ${PCKBUILD} --mpi=mpich,/tmp/mpi.cfg
	${RM} /tmp/mpi.cfg
	${CLEAN}

mpi-4:
	${RM} /tmp/mpi.cfg; cp mpi.cfg /tmp/mpi.cfg
	${CLEAN}; MPICC= MPICXX= MPI_CFG=mpich2,/tmp/mpi.cfg  ${PCKBUILD}
	${CLEAN}; MPICC= MPICXX= MPI_CFG=openmpi,/tmp/mpi.cfg ${PCKBUILD}
	${CLEAN}; MPICC= MPICXX= MPI_CFG=lam,/tmp/mpi.cfg     ${PCKBUILD}
	${CLEAN}; MPICC= MPICXX= MPI_CFG=mpich,/tmp/mpi.cfg   ${PCKBUILD}
	${RM} /tmp/mpi.cfg
	${CLEAN}
