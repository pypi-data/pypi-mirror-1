<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head>
  <meta content="text/html;charset=ISO-8859-1" http-equiv="Content-Type" />
  
  <title>Creating Applications: Adding Multivalued Fields</title><meta name="generator" content="amaya 8.1a, see http://www.w3.org/Amaya/" />
  <link href="styles.css" rel="stylesheet" type="text/css" /></head>
<body>
<h1>Creating Applications: Adding Multivalued Fields</h1>
<p>Although some applications only require multiple-choice fields where
only a single value may be chosen, in many situations it is desirable
to be able to choose an arbitrary number of values for a particular
field. However, up&nbsp;to this point, we have been content to
represent form data using a single attribute on a single element to
represent any given field value. With multivalued fields, we must
choose a different strategy in using XML to represent such information.</p>
<p>Let us consider permitting multiple type values to be associated
with our items. We revise our <a href="data.html">form data structure</a>
to
be the following:</p>
<pre>&lt;?xml version="1.0"?&gt;<br />&lt;structure&gt;<br />  &lt;item value="some value"&gt;<br />    &lt;type&gt;<br />      &lt;type-enum value="some type"/&gt;<br />      &lt;type-enum value="some other type"/&gt;<br />    &lt;/type&gt;<br />    &lt;subitem subvalue="some other value"/&gt;<br />  &lt;/item&gt;<br />&lt;/structure&gt;</pre>
<h2>Multivalued Fields</h2>
<p>We shall now take advantage of those HTML form fields which permit
users to select one
or many values presented in a list or menu.</p>

  <p>Some item:&nbsp;<input name="value" value="some value" /><input name="remove" value="Remove" type="submit" /></p>
  <p>Item type:
  <select multiple="multiple" name="type"><option>(Not selected)</option><option>Important</option><option>Not important</option><option>Personal</option></select>
  </p>
  <p>Itself containing more items:</p>
  <p>Sub-item: <input name="subvalue" value="some other value" /><input name="remove2" value="Remove" type="submit" /></p>

From the&nbsp;item type list many value may now be selected.
<p>Taking the&nbsp;example HTML code from before, we can add a
definition of this new list to the template to produce something
like this:</p>
<pre>&lt;html xmlns="http://www.w3.org/1999/xhtml"<br />      xmlns:template="http://www.boddie.org.uk/ns/xmltools/template"&gt;<br />&lt;head&gt;<br />  &lt;title&gt;Example&lt;/title&gt;<br />&lt;/head&gt;<br />&lt;body template:element="structure"&gt;<br />&lt;form action="" method="post"&gt;<br /><br />&lt;!-- Template text between the start and the interesting part. --&gt;<br /><br />&lt;div template:element="item"&gt;<br />  &lt;p&gt;<br />    Some item: &lt;input template:attribute-field="value" name="..." type="text" value="..." /&gt;<br />    &lt;input name="..." template:selector-field="remove" type="submit" value="Remove" /&gt;<br />  &lt;/p&gt;<br />  &lt;p&gt;<br />    Item type:<br />    &lt;select name="..." <span style="font-weight: bold;">template:multiple-choice-list-field="type,type-enum,value"</span> <span style="font-weight: bold;">multiple="multiple"</span>&gt;<br />      &lt;option <span style="font-weight: bold;"><span style="font-family: monospace;">template:multiple-choice-list-value="type-enum,value,selected"</span></span> value="..." /&gt;<br />    &lt;/select&gt;<br />  &lt;/p&gt;<br />  &lt;p&gt;<br />    Itself containing more items:<br />  &lt;/p&gt;<br />  &lt;p template:element="subitem"&gt;<br />    Sub-item: &lt;input template:attribute-field="subvalue" name="..." type="text" value="..." /&gt;<br />    &lt;input name="..." template:selector-field="remove2" type="submit" value="Remove" /&gt;<br />  &lt;/p&gt;<br />  &lt;p&gt;<br />    &lt;input name="..." template:selector-field="add2,subitem" type="submit" value="Add subitem" /&gt;<br />  &lt;/p&gt;<br />&lt;/div&gt;<br />&lt;p&gt;<br />  &lt;input name="..." template:selector-field="add,item" type="submit" value="Add item" /&gt;<br />&lt;/p&gt;<span style="font-weight: bold;"><br /><br /></span>&lt;!-- Template text between the interesting part and the end. --&gt;<br /><br />&lt;/form&gt;<br />&lt;/body&gt;<br />&lt;/html&gt;</pre>
<p>From the previous <a href="multiple.html">single-valued case</a>,
some crucial changes have been made:</p>
<ol>
  <li>The&nbsp;<code>select</code> element remains mapped onto the&nbsp;<code>type</code>
element in the form data structure. However, we use a different attribute,&nbsp;<code>template:multiple-choice-list-field</code>, to indicate that a&nbsp;<code>type</code>
element is created when the form data is submitted, but instead of a single value being added to the <code>value</code> attribute of that one element, a separate&nbsp;<code>type-enum</code>
element is created within the&nbsp;<code>type</code>
element with a value in its <code>value</code> attribute <span style="font-style: italic;">for each value submitted</span>. This means that many&nbsp;<code>type-enum</code>
elements may be created within the&nbsp;<code>type</code>
element, and each one of them will have a different <code>value</code> attribute.</li>
  <li>Of course, the&nbsp;<code>select</code> element now has a&nbsp;<code>multiple</code>
attribute defined to permit multiple value selections.</li>
  <li>Inside the&nbsp;<code>select</code> element, the <code>option</code>
element now employs the <code>template:multiple-choice-list-value</code> annotation.</li>
</ol>
<h2>Output Structures</h2>
<p>Unlike in the single-valued case, the revised the form data
structure for input is almost the same as the structure used by the
template. Indeed, the subtle differences cannot be represented in our
simplistic presentation of the structure:</p>
<pre>&lt;?xml version="1.0"?&gt;<br />&lt;structure&gt;<br />  &lt;item value="some value"&gt;<br />    &lt;type&gt;<br />      &lt;type-enum value="some type"/&gt;<br />      &lt;type-enum value="some other type"/&gt;<br />    &lt;/type&gt;<br />    &lt;subitem subvalue="some other value"/&gt;<br />  &lt;/item&gt;<br />&lt;/structure&gt;</pre>
<p>In fact, the principal difference arises through the number of&nbsp;<code>type-enum</code>
elements that occur in the input, representing the values selected by
the user, and the number that occur in the output, representing the
complete range of values available for selection.
</p>
<h3>Presenting the Extra Values</h3>
<p>In most respects, the presentation of the extra values is the same
as in the single-valued case. The result of the presentation of the
extra values is that the&nbsp;<code>type</code> element in the
this example&nbsp;structure fragment...</p>
<pre>&lt;type&gt;<br />  &lt;type-enum value="(Not selected)"/&gt;<br />  &lt;type-enum value="Important" value-is-set="true"/&gt;<br />  &lt;type-enum value="Not important" value-is-set="true"/&gt;<br />  &lt;type-enum value="Personal"/&gt;<br />&lt;/type&gt;<br /></pre>
<p>...is transformed into something resembling this HTML code:</p>
<pre>&lt;select name="..." multiple="multiple"&gt;<br />  &lt;option value="(Not selected)"&gt;(Not selected)&lt;/option&gt;<br />  &lt;option value="Important" selected="selected"&gt;Important&lt;/option&gt;<br />  &lt;option value="Not important" selected="selected"&gt;Not important&lt;/option&gt;<br />  &lt;option value="Personal"&gt;Personal&lt;/option&gt;<br />&lt;/select&gt;<br /></pre>
<p>Above, the special&nbsp;<code>value-is-set</code>
attribute is an XSLForms mechanism to remember which values were set.
Fortunately, the document initialisation mechanism automatically
distinguishes between different multiple-choice field types and
understands where the above approach needs to be employed.</p>
<ul>
</ul><h3>Updating the Web Resource</h3>
<p>To update the special WebStack resource,&nbsp;we
now need to modify a few of the class attributes and to add a few
others:</p>
<pre>    template_resources = {<br />        "structure" : ("structure_multivalue_template.xhtml", "structure_output.xsl")<br />        }<br /></pre>
<p>With these adjustments, it should now be possible to manipulate the
items and subitems whilst specifying multiple type values on each item.
Note that it may be necessary to remove the old stylesheet for
producing output,&nbsp;<code>structure_output.xsl</code>, so that the
multivalue version of the template is taken into use.</p>
<h2>Improving the Presented Values</h2>
<p>In the application we have been developing, we have been content to show the multiple-choice values as they are known in the application - that is, the application refers to values like&nbsp;<code>Personal</code>
and the same text is shown to users of the application. However, there
are various situations where this is not desirable, and the <a href="labels.html">usage of separate labels</a> is described in the next section of the development <a href="overview.html">process</a>.</p>
</body></html>