<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head>
  <meta content="text/html;charset=ISO-8859-1" http-equiv="Content-Type" />
  
  <title>Creating Applications: Adding Multiple-Choice Fields and Values</title><meta name="generator" content="amaya 8.1a, see http://www.w3.org/Amaya/" />
  <link href="styles.css" rel="stylesheet" type="text/css" /></head>
<body>
<h1>Creating Applications: Adding Multiple-Choice Fields and Values</h1>
<p>Up to this point, we have only considered two kinds of Web form
fields: text entry fields and action buttons. Since most Web forms
offer more convenient ways of entering certain kinds of data, we shall
now investigate multiple-choice fields as an example of how XSLForms
handles more complicated types of fields.</p>
<p>We shall revise our <a href="data.html">form data structure</a> to
be the following:</p>
<pre>&lt;?xml version="1.0"?&gt;<br />&lt;structure&gt;<br />  &lt;item value="some value"&gt;<br />    &lt;type value="some type"/&gt;<br />    &lt;subitem subvalue="some other value"/&gt;<br />  &lt;/item&gt;<br />&lt;/structure&gt;</pre>
<h2>Single-Valued Fields</h2>
<p>Whilst HTML offers types of form fields where users can select one
or many values presented in a list or menu, we shall first consider the
case where only a single value can be chosen from such a selection.</p>
<form method="post" action="" name="single">
  <p>Some item:&nbsp;<input name="value" value="some value" /><input name="remove" value="Remove" type="submit" /></p>
  <p>Item type:
  <select name="type"><option>(Not selected)</option><option>Important</option><option>Not important</option><option>Personal</option></select>
  </p>
  <p>Itself containing more items:</p>
  <p>Sub-item: <input name="subvalue" value="some other value" /><input name="remove2" value="Remove" type="submit" /></p>
</form>
From the&nbsp;item type list only one value may be selected.
<p>Taking the&nbsp;example HTML code from before, we can add a
definition of this new list to the template to produce something
like this:</p>
<pre>&lt;html xmlns="http://www.w3.org/1999/xhtml"<br />      xmlns:template="http://www.boddie.org.uk/ns/xmltools/template"&gt;<br />&lt;head&gt;<br />  &lt;title&gt;Example&lt;/title&gt;<br />&lt;/head&gt;<br />&lt;body template:element="structure"&gt;<br />&lt;form action="" method="post"&gt;<br /><br />&lt;!-- Template text between the start and the interesting part. --&gt;<br /><br />&lt;div template:element="item"&gt;<br />  &lt;p&gt;<br />    Some item: &lt;input template:attribute-field="value" name="..." type="text" value="..." /&gt;<br />    &lt;input name="..." template:selector-field="remove" type="submit" value="Remove" /&gt;<br />  &lt;/p&gt;<br />  <span style="font-weight: bold;">&lt;p&gt;</span><br style="font-weight: bold;" /><span style="font-weight: bold;">    Item type:</span><br style="font-weight: bold;" /><span style="font-weight: bold;">    &lt;select template:multiple-choice-field="type,value" name="..."&gt;</span><br style="font-weight: bold;" /><span style="font-weight: bold;">      &lt;option template:multiple-choice-value="type-enum,value,selected" value="..." /&gt;</span><br style="font-weight: bold;" /><span style="font-weight: bold;">    &lt;/select&gt;</span><br style="font-weight: bold;" /><span style="font-weight: bold;">  &lt;/p&gt;</span><br />  &lt;p&gt;<br />    Itself containing more items:<br />  &lt;/p&gt;<br />  &lt;p template:element="subitem"&gt;<br />    Sub-item: &lt;input template:attribute-field="subvalue" name="..." type="text" value="..." /&gt;<br />    &lt;input name="..." template:selector-field="remove2" type="submit" value="Remove" /&gt;<br />  &lt;/p&gt;<br />  &lt;p&gt;<br />    &lt;input name="..." template:selector-field="add2,subitem" type="submit" value="Add subitem" /&gt;<br />  &lt;/p&gt;<br />&lt;/div&gt;<br />&lt;p&gt;<br />  &lt;input name="..." template:selector-field="add,item" type="submit" value="Add item" /&gt;<br />&lt;/p&gt;<span style="font-weight: bold;"><br /><br /></span>&lt;!-- Template text between the interesting part and the end. --&gt;<br /><br />&lt;/form&gt;<br />&lt;/body&gt;<br />&lt;/html&gt;</pre>
<p>There are a lot of details here that need to be explained. Here is
what was done:</p>
<ol>
  <li>A paragraph was added to provide some space on the page for the
field.</li>
  <li>Inside the paragraph, next to the label text, an HTML&nbsp;<code>select</code>
element was added.</li>
  <li>The&nbsp;<code>select</code> element is mapped onto the&nbsp;<code>type</code>
element in the form data structure, indicating using a special&nbsp;<code>template:multiple-choice-field</code> attribute that the&nbsp;<code>value</code> attribute of the&nbsp;<code>type</code>
element will contain any chosen value from the list of values displayed in the page.</li>
  <li>Inside the&nbsp;<code>select</code> element, we include an&nbsp;<code>option</code>
element which&nbsp;defines the values which will be presented to users
of the form. Here, the special&nbsp;<code>template:multiple-choice-value</code> attribute indicates that the&nbsp;<code>option</code> element maps onto
a&nbsp;<code>type-enum</code> element which is not mentioned in our
revised form data structure above; this will be discussed below.</li>
</ol>
<h2>Output Structures</h2>
<p>Although we revised the form data structure above, and whilst the
revised structure can describe form data submitted by users of our
application, it is unfortunately not sufficient to define the form data
that is to be presented. Consider the multiple-choice values that shall
be presented to users: such values are not defined in our revised
structure. Therefore, we shall define an output form data structure as
follows:</p>
<pre>&lt;?xml version="1.0"?&gt;<br />&lt;structure&gt;<br />  &lt;item value="some value"&gt;<br />    &lt;type value="some type"&gt;<br />      &lt;type-enum value="choice #n"/&gt;<br />    &lt;/type&gt;<br />    &lt;subitem subvalue="some other value"/&gt;<br />  &lt;/item&gt;<br />&lt;/structure&gt;</pre>
<h3>Presenting the Extra Values</h3>
<p>In the template, the&nbsp;<code>option</code> element is presented
using a number of special annotations which make more sense when
considering the above output structure:</p>
<ul>
  <li>The&nbsp;<code>template:multiple-choice-value</code> annotation states that the
    <code>option</code> element maps into the&nbsp;<code>type-enum</code>
element, meaning that each&nbsp;<code>type-enum</code> element will be
reproduced as an option inside the list or menu presented in the Web
form.</li>
  <li>The&nbsp;<code>template:multiple-choice-value</code> annotation also states that the
contents of&nbsp;the <code>option</code> element will correspond to
the value of the&nbsp;<code>type-enum</code> element's&nbsp;<code>value</code>
attribute.</li>
  <li>The&nbsp;<code>template:multiple-choice-value</code> annotation provides a final piece of information: the name of an attribute which will be created on the <code>option</code> element if the element's value matches the enclosing <code>select</code> element's value. This has the effect of making sure that the <code>select</code> element always reveals the selected value in its list of values.
    </li><li>The <code>value</code> attribute is set to a value which does not matter - it will be replaced in the final output.</li></ul>
<p>The result of this is that the&nbsp;<code>type</code> element in the
this example&nbsp;structure fragment...</p>
<pre>&lt;type value="2"&gt;<br />  &lt;type-enum value="(Not selected)"/&gt;<br />  &lt;type-enum value="Important"/&gt;<br />  &lt;type-enum value="Not important"/&gt;<br />  &lt;type-enum value="Personal"/&gt;<br />&lt;/type&gt;</pre>
<p>...is transformed into something resembling this HTML code:</p>
<pre>&lt;select name="..."&gt;<br />  &lt;option value="(Not selected)"&gt;(Not selected)&lt;/option&gt;<br />  &lt;option value="Important" selected="selected"&gt;Important&lt;/option&gt;<br />  &lt;option value="Not important"&gt;Not important&lt;/option&gt;<br />  &lt;option value="Personal"&gt;Personal&lt;/option&gt;<br />&lt;/select&gt;</pre>
<p>Such presentation techniques are sufficient if the input form data
structure is identical to the output structure, but since we will
receive a structure resembling that defined
earlier (where the multiple-choice values are never sent back to the
application), yet need to present a structure like the one above, we
will
need to find a way of merging the range of allowed values into the
user-edited form data before presenting that data using our template.</p>
<h2><a name="DocumentInitialisation"></a>Document Initialisation</h2>
<p>There are many possible ways of inserting extra XML elements into an
existing XML document, but XSLForms provides an easy way of defining
lists of values that will be included in the way we desire. First, let
us define a
document containing all the possible values for the type field:</p>
<pre>&lt;?xml version="1.0"?&gt;<br />&lt;type&gt;<br />  &lt;type-enum value="(Not selected)"/&gt;<br />  &lt;type-enum value="Important"/&gt;<br />  &lt;type-enum value="Not important"/&gt;<br />  &lt;type-enum value="Personal"/&gt;<br />&lt;/type&gt;</pre>
<p>We shall refer to this document when inserting the different&nbsp;<code>type-enum</code>
elements into our input form data structure to produce the output
structure described above; it can be
found in <code>examples/Common/VerySimple/Resources/structure_types.xml</code>.</p>
<h3>Amending the Resource</h3>
<p>To take advantage of this new information, it is necessary to
introduce some code into the Web resource to perform the document initialisation. The special WebStack resource that we <a href="Web-resource.html">subclassed earlier</a> provides some
convenient mechanisms for introducing XML documents and initialisations, and we
shall add a few extra attributes to our resource class in order to take
advantage of them:</p>
<pre>    # Under template_resources...<br /><br />    init_resources = {<br />        "structure" : ("structure_template.xhtml", "structure_input.xsl")<br />        }<br />    document_resources = {<br />        "types" : "structure_types.xml"<br />        }</pre>
<p>These attributes define the following things:</p>
<ol>
  <li>A initialisation called <code>structure</code> which links
the&nbsp;<code>structure_template.xhtml</code> file (the template) to the&nbsp;<code>structure_input.xsl</code> stylesheet file. This is very similar to the way the <code>template_resources</code> dictionary links&nbsp;templates to&nbsp;other stylesheet files producing&nbsp;output.</li>
  <li>A document referred to by the name&nbsp;<code>types</code> which
is provided by the&nbsp;<code>structure_types.xml</code> file.</li>
</ol>
<p>To actually perform the initalisation or merge operation, we need to add a few extra
lines of code after the addition and deletion operations in the&nbsp;<code>respond_to_form</code>
method:</p>
<pre>        # Under the addition and deletion operations...<br /><br />        # Initialise the document, adding enumerations/ranges.<br /><br />        structure_xsl = self.prepare_initialiser("structure")<br />        types_xml = self.prepare_document("types")<br />        structure = self.get_result([structure_xsl], structure, references={"type" : types_xml})<br /><br />        # Start the response.</pre>
<p>These lines do the following things:</p>
<ol>
  <li>Obtain the stylesheet for the&nbsp;<code>structure</code> initialisation.</li>
  <li>Obtain the&nbsp;<code>types</code>&nbsp;document containing the
values to be merged into the form data.</li>
  <li>Take the stylesheet and apply it to the form data,&nbsp;<code>structure</code>,
using a reference to the&nbsp;<code>types</code> document containing
the values.</li>
</ol>
<p>The result of this should be a processed&nbsp;<code>structure</code>
document containing the type values for each&nbsp;<code>type</code>
element in that document.</p>
<h2>Other Multiple-Choice Data</h2>
<p>We have now added a simple, single-valued multiple-choice field to
the application. However, many applications often need to obtain <a href="multivalue.html">multivalued multiple-choice data</a>, and this
kind of information is investigated in the next part of the development
<a href="overview.html">process</a>.</p>
</body></html>