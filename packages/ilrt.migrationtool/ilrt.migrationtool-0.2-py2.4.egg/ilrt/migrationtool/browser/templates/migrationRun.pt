<h1 tal:replace="structure context/manage_page_header">PAGE HEADER</h1>
<h2 tal:define="manage_tabs_message options/manage_tabs_message | nothing"
    tal:replace="structure context/manage_tabs">TABS</h2>

<p>
<b>Instance version:</b> <span tal:replace="context/getInstanceVersion" /> <br />
<b>File system version:</b> <span tal:replace="context/getFileSystemVersion" /> <br />
</p>

<p><b>Note:</b> 
<span style="background-color:red; color: white; font-weight: bold">
Please ensure you have a backup of your Plone site before performing migration.</span> 
Some migrations perform a catalog and security update, this may take a long time on large sites. Be patient.</p>

<hr />

<p tal:condition="context/needMigrating">
Your selected theme instance is out of sync with the filesystem code. Click "Migrate" to bring this theme instance in line with your file system code.

<form action="upgrade" method="post">

<br />
<input name="dry_run" type="checkbox" value="1:int" />Dry run - print the result of the migration without actually writing anything to the database.
<br />

<input type="submit" value="Migrate"/>

</form>
</p>

<p tal:condition="not:context/needMigrating">
Your theme instance is up to date. 
</p>

<hr/>

<form action="setInstanceVersion" method="post">
<p>
If you're <strong>absolutely</strong> sure your theme instance is not <span tal:replace="context/getInstanceVersion" />, choose the version you think it is below and click "update instance version". 
This will allow migrations from that version. <i>You should not normally need to do this.</i>
</p>

<select name="version">
 <option value="version"
    tal:repeat="ver context/knownVersions"
    tal:attributes="value ver;"
    tal:content="ver">version number</option>
</select><br />

<p><input type="submit" value="Update Instance Version"/></p>
</form>

<h1 tal:replace="structure context/manage_page_footer">PAGE FOOTER</h1>

