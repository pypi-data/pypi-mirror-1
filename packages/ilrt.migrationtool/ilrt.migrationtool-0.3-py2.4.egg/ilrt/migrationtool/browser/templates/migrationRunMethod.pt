<h1 tal:replace="structure context/manage_page_header">PAGE HEADER</h1>
<h2 tal:define="manage_tabs_message options/manage_tabs_message | nothing"
    tal:replace="structure context/manage_tabs">TABS</h2>

<p>
<b>Instance version:</b> <span tal:replace="context/getInstanceVersion" /> <br />
<b>File system version:</b> <span tal:replace="context/getFileSystemVersion" /> <br />
</p>


<p><b>Note:</b> 
This screen is to aid debugging the creation of migration scripts. <br />
<span style="background-color:red; color: white; font-weight: bold">
Older migrations methods may no longer run due to the site being in a different state, or may rely on a preceding method to run. 
Please do not run individual migration methods on a production site.</span> 
Some migrations perform a catalog and security update, this may take a long time on large sites. Be patient.</p>

<hr />

<p>
Pick a migration script, and then select the method name you wish to run
</p>

<form id="migrationform" method="post" action="setMigration">
<select name="migration_id"
        onchange="document.getElementById('migrationform').submit();">        
 <option value="">--- Choose a migration ---</option>
 <option value="context-migration-id selected python:mig/migration==context/migration_id"
    tal:repeat="mig context/migrations"
    tal:attributes="value mig/migration;"
    tal:content="mig/migration">MIGRATION_NAME</option>
</select>
</form>

<form  tal:condition="context/getMigrationMethods" 
       id="runmigrationform" method="post" action="runMigrationMethod">
<select name="method">
 <option value="method"
    tal:repeat="me context/getMigrationMethods"
    tal:attributes="value me;"
    tal:content="me">migration method</option>
</select><br />

<p>
<input name="dry_run" type="checkbox" value="1:int" />Dry run - print the result of the migration without actually writing anything to the database.
</p>

<input type="submit" name="Run" value="Run" />
</form>

<h1 tal:replace="structure context/manage_page_footer">PAGE FOOTER</h1>

