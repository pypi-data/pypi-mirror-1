<tal:block define="egg_id context/getEgg;
		   contexts container/portal_quickinstaller/listInstalledProducts;
                   likely_contexts python:[c for c in contexts if c['title'] != 'Site Migration Tool'];  
                   ">
<h1 tal:replace="structure context/manage_page_header">PAGE HEADER</h1>
<h2 tal:define="manage_tabs_message options/manage_tabs_message | nothing"
    tal:replace="structure context/manage_tabs">TABS</h2>

<p>This migration and setup tool allows you to handle migrating between releases of the main theme egg for your plone site.</p>

<ul tal:condition="options/out | request/out | nothing"> 
   <li tal:repeat="log options/out | request/out"
       tal:content="python:log" >
       Migration action log line
   </li>
</ul>

<p>Select the egg (or Product) that corresponds to the main theme (or Customisation Policy) for this plone site.<br />
The egg should contain a migrations folder with a migration script with the methods you aim to run on 
the site to roll out the next version of it. <br />
Along with any previous migrations since it went live.</p> 
<p>An example of what is required is given <a href="site_migration/@@site_migration_help">on the help tab</a></p>  

<form id="profileform" method="post" action="setExtensionContext">
<select name="context_id"
        onchange="document.getElementById('profileform').submit();">        
 <option value="context-EGG_ID"
    tal:repeat="context likely_contexts"
    tal:attributes="value context/id; selected python:egg_id==context['id']"
    tal:content="context/title">CONTEXT_TITLE</option>
</select>
</form>

<tal:migrations tal:condition=context/migrations>
<p>... <span replace="context/id | nothing" /> has the following migrations:</p> 
<ul>
 <li tal:repeat="mig python:context.migrations.keys()">
     <span tal:replace="mig | nothing" />
       for migrating from
       <span tal:replace="python:context.migrations[mig][0]" />
       to
       <span tal:replace="python:context.migrations[mig][1]" />
 </li>
</ul>
</tal:migrations>

<p>If you wish to upgrade your instance to the new release of the theme 
(or downgrade to an old release), go to <a href="@@manage_do_migration">migrate</a>.</p>

<hr />

<p>Core site version information:</p>

<ul>
<li tal:repeat="version context/coreVersionsList" prefix="setup">
    <tal:block tal:replace="python:version[0] + ' : ' + version[1]" />
</li>
</ul>

<h1 tal:replace="structure context/manage_page_footer">PAGE FOOTER</h1>
</tal:block>

