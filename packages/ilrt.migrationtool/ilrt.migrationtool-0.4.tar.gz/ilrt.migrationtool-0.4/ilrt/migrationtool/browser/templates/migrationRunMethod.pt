<h1 tal:replace="structure context/manage_page_header">PAGE HEADER</h1>
<h2 tal:define="manage_tabs_message options/manage_tabs_message | nothing"
    tal:replace="structure context/manage_tabs">TABS</h2>

<p>
<b>Instance version:</b> <span tal:replace="context/getInstanceVersion" /> <br />
<b>File system version:</b> <span tal:replace="context/getFileSystemVersion" /> <br />
</p>


<p><b>Note:</b> 
This screen is to aid debugging the creation of migration scripts. <br />
<span style="background-color:red; color: white; font-weight: bold">
<br />Please do not run individual migration methods on a production site.
</span>
<br />
<br />Older migrations methods may no longer run due to the site being in a different state, or may rely on a preceding method to run.  
<br />Some migrations perform a catalog and security update, this may take a long time on large sites. Be patient.</p>
<p>The migration tool assumes all your migration methods take (portal, out) as their arguments</p>
<hr />

<p>
Pick a migration script, and then select the method name you wish to run
</p>

<form name="migrationform" method="post" action="setMigration">
<select name="migration_id">
 <option tal:condition="context/migration_id" tal:attributes="value context/migration_id"
                                              tal:content="context/migration_id" />
 <option value="">--- Choose a migration ---</option>
 <option value="context-migration-id selected python:mig==context/migration_id"
    tal:repeat="mig python:context.migrations.keys()"
    tal:attributes="value mig;"
    tal:content="mig">MIGRATION_NAME</option>
</select>
<input type="submit" name="submit" value="Choose migration" />
</form>

<form  tal:condition="context/getMigrationMethods" 
       id="runmigrationform" method="post" action="runMigrationMethod">
<select name="method">
 <option value="method"
    tal:repeat="me context/getMigrationMethods"
    tal:attributes="value me;"
    tal:content="me">migration method</option>
</select><br />

<!-- p>
Currently dry run doesnt work so method always runs for real!
<input name="dry_run" type="checkbox" value="1:int" />Dry run - print the result of the migration without actually writing anything to the database.
<p -->
<p>Run the migration method on your site</p>

<input type="submit" name="Run" value="Run" />
</form>

<h1 tal:replace="structure context/manage_page_footer">PAGE FOOTER</h1>

