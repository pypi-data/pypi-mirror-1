<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
  xmlns:tal="http://xml.zope.org/namespaces/tal"
  xmlns:metal="http://xml.zope.org/namespaces/metal"
  xmlns:i18n="http://xml.zope.org/namespaces/i18n"
  lang="en"
  metal:use-macro="context/main_template/macros/master"
  i18n:domain="on.sales">
  <body>

    <!--
    This is the top level SalesArea view, intended for viewing nested
    SalesAreas in the following fashion:

    * We use the title, description and outermost area delivers the title
    -->
    <metal:css fill-slot="css_slot">
      <style type="text/css" media="all"
	tal:content="string: @import url(${context/++resource++on-sales.css});"></style>
    </metal:css>
    
    <metal:main fill-slot="main">
      <tal:main-macro metal:define-macro="main">

        <div tal:replace="structure provider:plone.abovecontenttitle" />

	  <h1 class="documentFirstHeading">
            <span metal:use-macro="python:context.widget('title', mode='view')" />
	  </h1>

	  <div tal:replace="structure provider:plone.belowcontenttitle" />

	    <div class="documentDescription">
	      <span metal:use-macro="python:context.widget('description', mode='view')" />
	    </div>

	    <div tal:replace="structure provider:plone.abovecontentbody" />

	      <!-- Aus plone.users (Oliver Morgan) -->
	      <div class="portrait">
		<span tal:content="structure python:here.getField('map').tag(here)" />
	      </div>

	      <div class="salesagent-info">	
		<label tal:condition="here/responsible_salesagent"
		  class="label"
		  for="parent-fieldname-responsible_salesagent" i18n:translate="label_salesagent">
		  Responsible&nbsp;for&nbsp;your&nbsp;Area:</label>
		<div metal:use-macro="python:context.widget('responsible_salesagent', mode='view')" />

		  <div tal:repeat="agent view/responsiblesalesagent">
		    <a tal:attributes="href agent/url">
		      <span tal:content="agent/name" />
		    </a>
		  </div>

		  <br />
		    <a tal:attributes="href string:@@Email_Form"
		      i18n:translate="salesarea_sales_enquiry">
		      <img src="#" tal:attributes="src string:/${context/virtual_url_path}/++resource++on.sales.images/icon-qmark-1.gif"
			alt="Sales Enquiry" title="Sales Enquiry"
			i18n:translate="alt title" />
		    </a>

		    <div tal:content="context/getSalesAreaTreeAsString">
		      List of Areas
		    </div>
		    <hr />
		      <!-- display the list of areas -->

		      <div
			tal:define="subareas context/getSalesAreaTree"
			tal:condition="subareas"
			tal:repeat="area subareas">

			<!-- now list one area at a time -->

			<div id="#"
			  tal:define="level area/level"
			  tal:attributes="id python: 'salesarea-title-' + str(level)"
			  tal:content="area/title">Title</div>
			<div tal:condition="area/description | nothing" tal:content="area/description">description</div>
			<div tal:condition="python: area['level'] == 0 and area['map']"
			  tal:content="structure area/map">map </div>
			<!-- div tal:condition="python: area['level'] == 0 and not area['map']">
			  map attribute unset</div >
			
			<div tal:condition="python: area['level'] > 0">
			  no map to be displayed at this level</div -->
			<a tal:attributes="href string:${area/id}/@@Email_Form"
			  i18n:translate="salesarea_sales_enquiry">
			  <img src="#" tal:attributes="src string:/${context/virtual_url_path}/++resource++on.sales.images/icon-qmark-2.gif"
			    alt="Sales Enquiry" title="Sales Enquiry"
			    i18n:translate="alt title" />
			</a>
			<a tal:attributes="href string:${area/id}/@@details"
			  i18n:translate="salesarea_details">
			  <img src="#" tal:attributes="src string:/${context/virtual_url_path}/++resource++on.sales.images/icon-magnifier-2.gif"
			    alt="Area Details" title="Area Details"
			    i18n:translate="alt title" />
			</a>

			<hr />
			  <!--div tal:content="python: 'Object: ' + str(area)">object dump </div -->
			  <hr />
			    
		      </div>
		      
		</div>
		<div metal:use-macro="context/document_relateditems/macros/relatedItems">
		  show related items if they exist
		</div>
		
		<div tal:replace="structure provider:plone.belowcontentbody" />

      </tal:main-macro>
    </metal:main>

  </body>
</html>

