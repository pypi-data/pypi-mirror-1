source file: <b>/opt/devel/celery/celery/tests/test_pickle.py</b><br>


file stats: <b>36 lines, 36 executed: 100.0% covered</b>
<pre>
<font color="green">   1. import unittest</font>
<font color="green">   2. import pickle</font>
<font color="black">   3. </font>
<font color="green">   4. class RegularException(Exception):</font>
<font color="green">   5.     pass</font>
<font color="black">   6. </font>
<font color="black">   7. </font>
<font color="green">   8. class ArgOverrideException(Exception):</font>
<font color="green">   9.     def __init__(self, message, status_code=10):</font>
<font color="green">  10.         self.status_code = status_code</font>
<font color="green">  11.         super(ArgOverrideException, self).__init__(message, status_code)</font>
<font color="black">  12. </font>
<font color="black">  13. </font>
<font color="green">  14. class TestPickle(unittest.TestCase):</font>
<font color="black">  15.     # See: http://www.reddit.com/r/django/comments/8gdwi/</font>
<font color="black">  16.     #      celery_distributed_task_queue_for_django/c097hr1</font>
<font color="black">  17. </font>
<font color="green">  18.     def test_pickle_regular_exception(self):</font>
<font color="black">  19. </font>
<font color="green">  20.         e = None</font>
<font color="green">  21.         try:</font>
<font color="green">  22.             raise RegularException(&quot;RegularException raised&quot;)</font>
<font color="green">  23.         except RegularException, e:</font>
<font color="green">  24.             pass</font>
<font color="black">  25. </font>
<font color="green">  26.         pickled = pickle.dumps({&quot;exception&quot;: e})</font>
<font color="green">  27.         unpickled = pickle.loads(pickled)</font>
<font color="green">  28.         exception = unpickled.get(&quot;exception&quot;)</font>
<font color="green">  29.         self.assertTrue(exception)</font>
<font color="green">  30.         self.assertTrue(isinstance(exception, RegularException))</font>
<font color="green">  31.         self.assertEquals(exception.args, (&quot;RegularException raised&quot;, ))</font>
<font color="black">  32. </font>
<font color="black">  33. </font>
<font color="green">  34.     def test_pickle_arg_override_exception(self):</font>
<font color="black">  35. </font>
<font color="green">  36.         e = None</font>
<font color="green">  37.         try:</font>
<font color="green">  38.             raise ArgOverrideException(&quot;ArgOverrideException raised&quot;,</font>
<font color="green">  39.                     status_code=100)</font>
<font color="green">  40.         except ArgOverrideException, e:</font>
<font color="green">  41.             pass</font>
<font color="black">  42. </font>
<font color="green">  43.         pickled = pickle.dumps({&quot;exception&quot;: e})</font>
<font color="green">  44.         unpickled = pickle.loads(pickled)</font>
<font color="green">  45.         exception = unpickled.get(&quot;exception&quot;)</font>
<font color="green">  46.         self.assertTrue(exception)</font>
<font color="green">  47.         self.assertTrue(isinstance(exception, ArgOverrideException))</font>
<font color="green">  48.         self.assertEquals(exception.args, (&quot;ArgOverrideException raised&quot;,</font>
<font color="green">  49.                                           100))</font>
<font color="green">  50.         self.assertEquals(exception.status_code, 100)</font>
</pre>

