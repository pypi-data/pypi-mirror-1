<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      lang="en"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="rendezvous">
<body>

<div metal:fill-slot="main">
  <form method="post" action="." tal:attributes="action python:context.absolute_url()+'/@@add-participation'">
  <table id="rendezvous">
    <thead>
      <tr class="rendezvousdates">
        <th class="noborder">&nbsp;</th>
        <tal:block tal:repeat="row python:view.getPropositionsItemsByOrderedDates()">
          <tal:block define="date python:row[0];
                             props python:row[1];">
            <th tal:content="python:context.toLocalizedTime(date)" tal:attributes="colspan python:len(props)"></th>
          </tal:block>
        </tal:block>
      </tr>
      <tr>
        <th class="noborder">&nbsp;</th>
        <tal:block tal:repeat="row python:view.getPropositionsItemsByOrderedDates()">
          <tal:block define="date python:row[0];
                             props python:row[1];">
            <tal:block tal:repeat="prop props">
              <th tal:content="python:prop[0] and prop[0] or '-'"></th>
            </tal:block>
          </tal:block>
        </tal:block>
      </tr>
    </thead>
    <tbody>
      <tr tal:repeat="participant context/getParticipants">
        <td tal:content="python:view.getFullname(participant)">name</td>
        <tal:block tal:repeat="row python:view.getPropositionsItemsByOrderedDates()">
          <tal:block define="date python:row[0];
                             props python:row[1];">
            <tal:block tal:repeat="prop props">
              <td tal:define="class_ python:view.getParticipationClass(participant, prop[1])"
                  tal:attributes="class class_"
                  tal:content="python:class_ == view.AVAILABLE and 'OK' or (class_ == view.UNKNOWN and '?' or '')"></td>
            </tal:block>
          </tal:block>
        </tal:block>
      </tr>
      <tr tal:define="hasParticipated python:member.id in context.getParticipants()">
        <td tal:content="python:member.getProperty('fullname')" />
        <tal:block tal:repeat="row python:view.getPropositionsItemsByOrderedDates()">
          <tal:block define="date python:row[0];
                             props python:row[1];">
            <tal:block tal:repeat="prop props">
              <td><input type="checkbox"
                         name="propositions:list"
                         value="."
                         tal:attributes="value python:prop[1];
                                         checked python:hasParticipated and (view.getParticipationClass(member.id, prop[1]) == view.AVAILABLE and 'checked')"/></td>
            </tal:block>
          </tal:block>
        </tal:block>
      </tr>
      <tr>
        <td class="noborder"/>
        <tal:block tal:repeat="row python:view.getPropositionsItemsByOrderedDates()">
          <tal:block define="date python:row[0];
                             props python:row[1];">
            <tal:block tal:repeat="prop props">
              <td class="noborder" tal:content="python:view.getNbParticipantsForProposition(prop[1])">&nbsp;</td>
            </tal:block>
          </tal:block>
        </tal:block>
      </tr>
    </tbody>
  </table>
  <input type="submit" name="save" value="Save" i18n:attributes="value" />
  </form>

</div>

</body>
</html>
